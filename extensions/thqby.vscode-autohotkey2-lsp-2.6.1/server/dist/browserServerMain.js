"use strict";var $m=Object.create;var Io=Object.defineProperty;var Wm=Object.getOwnPropertyDescriptor;var Im=Object.getOwnPropertyNames;var Vm=Object.getPrototypeOf,Um=Object.prototype.hasOwnProperty;var Bm=(e,t)=>()=>(e&&(t=e(e=0)),t);var Ue=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Hm=(e,t)=>{for(var n in t)Io(e,n,{get:t[n],enumerable:!0})},nf=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Im(t))!Um.call(e,i)&&i!==n&&Io(e,i,{get:()=>t[i],enumerable:!(r=Wm(t,i))||r.enumerable});return e};var vn=(e,t,n)=>(n=e!=null?$m(Vm(e)):{},nf(t||!e||!e.__esModule?Io(n,"default",{value:e,enumerable:!0}):n,e)),Ka=e=>nf(Io({},"__esModule",{value:!0}),e);var mr=Ue(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.stringArray=Tn.array=Tn.func=Tn.error=Tn.number=Tn.string=Tn.boolean=void 0;function Gm(e){return e===!0||e===!1}Tn.boolean=Gm;function af(e){return typeof e=="string"||e instanceof String}Tn.string=af;function Xm(e){return typeof e=="number"||e instanceof Number}Tn.number=Xm;function Qm(e){return e instanceof Error}Tn.error=Qm;function Jm(e){return typeof e=="function"}Tn.func=Jm;function cf(e){return Array.isArray(e)}Tn.array=cf;function Ym(e){return cf(e)&&e.every(t=>af(t))}Tn.stringArray=Ym});var lc=Ue(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.Message=Ye.NotificationType9=Ye.NotificationType8=Ye.NotificationType7=Ye.NotificationType6=Ye.NotificationType5=Ye.NotificationType4=Ye.NotificationType3=Ye.NotificationType2=Ye.NotificationType1=Ye.NotificationType0=Ye.NotificationType=Ye.RequestType9=Ye.RequestType8=Ye.RequestType7=Ye.RequestType6=Ye.RequestType5=Ye.RequestType4=Ye.RequestType3=Ye.RequestType2=Ye.RequestType1=Ye.RequestType=Ye.RequestType0=Ye.AbstractMessageSignature=Ye.ParameterStructures=Ye.ResponseError=Ye.ErrorCodes=void 0;var Yi=mr(),ja;(function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.jsonrpcReservedErrorRangeStart=-32099,e.serverErrorStart=-32099,e.MessageWriteError=-32099,e.MessageReadError=-32098,e.PendingResponseRejected=-32097,e.ConnectionInactive=-32096,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.jsonrpcReservedErrorRangeEnd=-32e3,e.serverErrorEnd=-32e3})(ja||(Ye.ErrorCodes=ja={}));var $a=class e extends Error{constructor(t,n,r){super(n),this.code=Yi.number(t)?t:ja.UnknownErrorCode,this.data=r,Object.setPrototypeOf(this,e.prototype)}toJson(){let t={code:this.code,message:this.message};return this.data!==void 0&&(t.data=this.data),t}};Ye.ResponseError=$a;var Nn=class e{constructor(t){this.kind=t}static is(t){return t===e.auto||t===e.byName||t===e.byPosition}toString(){return this.kind}};Ye.ParameterStructures=Nn;Nn.auto=new Nn("auto");Nn.byPosition=new Nn("byPosition");Nn.byName=new Nn("byName");var Xt=class{constructor(t,n){this.method=t,this.numberOfParams=n}get parameterStructures(){return Nn.auto}};Ye.AbstractMessageSignature=Xt;var Wa=class extends Xt{constructor(t){super(t,0)}};Ye.RequestType0=Wa;var Ia=class extends Xt{constructor(t,n=Nn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};Ye.RequestType=Ia;var Va=class extends Xt{constructor(t,n=Nn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};Ye.RequestType1=Va;var Ua=class extends Xt{constructor(t){super(t,2)}};Ye.RequestType2=Ua;var Ba=class extends Xt{constructor(t){super(t,3)}};Ye.RequestType3=Ba;var Ha=class extends Xt{constructor(t){super(t,4)}};Ye.RequestType4=Ha;var za=class extends Xt{constructor(t){super(t,5)}};Ye.RequestType5=za;var Ga=class extends Xt{constructor(t){super(t,6)}};Ye.RequestType6=Ga;var Xa=class extends Xt{constructor(t){super(t,7)}};Ye.RequestType7=Xa;var Qa=class extends Xt{constructor(t){super(t,8)}};Ye.RequestType8=Qa;var Ja=class extends Xt{constructor(t){super(t,9)}};Ye.RequestType9=Ja;var Ya=class extends Xt{constructor(t,n=Nn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};Ye.NotificationType=Ya;var Za=class extends Xt{constructor(t){super(t,0)}};Ye.NotificationType0=Za;var ec=class extends Xt{constructor(t,n=Nn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};Ye.NotificationType1=ec;var tc=class extends Xt{constructor(t){super(t,2)}};Ye.NotificationType2=tc;var nc=class extends Xt{constructor(t){super(t,3)}};Ye.NotificationType3=nc;var ic=class extends Xt{constructor(t){super(t,4)}};Ye.NotificationType4=ic;var rc=class extends Xt{constructor(t){super(t,5)}};Ye.NotificationType5=rc;var oc=class extends Xt{constructor(t){super(t,6)}};Ye.NotificationType6=oc;var sc=class extends Xt{constructor(t){super(t,7)}};Ye.NotificationType7=sc;var ac=class extends Xt{constructor(t){super(t,8)}};Ye.NotificationType8=ac;var cc=class extends Xt{constructor(t){super(t,9)}};Ye.NotificationType9=cc;var lf;(function(e){function t(i){let s=i;return s&&Yi.string(s.method)&&(Yi.string(s.id)||Yi.number(s.id))}e.isRequest=t;function n(i){let s=i;return s&&Yi.string(s.method)&&i.id===void 0}e.isNotification=n;function r(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(Yi.string(s.id)||Yi.number(s.id)||s.id===null)}e.isResponse=r})(lf||(Ye.Message=lf={}))});var fc=Ue(Ai=>{"use strict";var uf;Object.defineProperty(Ai,"__esModule",{value:!0});Ai.LRUCache=Ai.LinkedMap=Ai.Touch=void 0;var wn;(function(e){e.None=0,e.First=1,e.AsOld=e.First,e.Last=2,e.AsNew=e.Last})(wn||(Ai.Touch=wn={}));var Uo=class{constructor(){this[uf]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(t){return this._map.has(t)}get(t,n=wn.None){let r=this._map.get(t);if(r)return n!==wn.None&&this.touch(r,n),r.value}set(t,n,r=wn.None){let i=this._map.get(t);if(i)i.value=n,r!==wn.None&&this.touch(i,r);else{switch(i={key:t,value:n,next:void 0,previous:void 0},r){case wn.None:this.addItemLast(i);break;case wn.First:this.addItemFirst(i);break;case wn.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(t,i),this._size++}return this}delete(t){return!!this.remove(t)}remove(t){let n=this._map.get(t);if(n)return this._map.delete(t),this.removeItem(n),this._size--,n.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let t=this._head;return this._map.delete(t.key),this.removeItem(t),this._size--,t.value}forEach(t,n){let r=this._state,i=this._head;for(;i;){if(n?t.bind(n)(i.value,i.key,this):t(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let t=this._state,n=this._head,r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let i={value:n.key,done:!1};return n=n.next,i}else return{value:void 0,done:!0}}};return r}values(){let t=this._state,n=this._head,r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let i={value:n.value,done:!1};return n=n.next,i}else return{value:void 0,done:!0}}};return r}entries(){let t=this._state,n=this._head,r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let i={value:[n.key,n.value],done:!1};return n=n.next,i}else return{value:void 0,done:!0}}};return r}[(uf=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(t){if(t>=this.size)return;if(t===0){this.clear();return}let n=this._head,r=this.size;for(;n&&r>t;)this._map.delete(n.key),n=n.next,r--;this._head=n,this._size=r,n&&(n.previous=void 0),this._state++}addItemFirst(t){if(!this._head&&!this._tail)this._tail=t;else if(this._head)t.next=this._head,this._head.previous=t;else throw new Error("Invalid list");this._head=t,this._state++}addItemLast(t){if(!this._head&&!this._tail)this._head=t;else if(this._tail)t.previous=this._tail,this._tail.next=t;else throw new Error("Invalid list");this._tail=t,this._state++}removeItem(t){if(t===this._head&&t===this._tail)this._head=void 0,this._tail=void 0;else if(t===this._head){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this._head=t.next}else if(t===this._tail){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this._tail=t.previous}else{let n=t.next,r=t.previous;if(!n||!r)throw new Error("Invalid list");n.previous=r,r.next=n}t.next=void 0,t.previous=void 0,this._state++}touch(t,n){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(n!==wn.First&&n!==wn.Last)){if(n===wn.First){if(t===this._head)return;let r=t.next,i=t.previous;t===this._tail?(i.next=void 0,this._tail=i):(r.previous=i,i.next=r),t.previous=void 0,t.next=this._head,this._head.previous=t,this._head=t,this._state++}else if(n===wn.Last){if(t===this._tail)return;let r=t.next,i=t.previous;t===this._head?(r.previous=void 0,this._head=r):(r.previous=i,i.next=r),t.next=void 0,t.previous=this._tail,this._tail.next=t,this._tail=t,this._state++}}}toJSON(){let t=[];return this.forEach((n,r)=>{t.push([r,n])}),t}fromJSON(t){this.clear();for(let[n,r]of t)this.set(n,r)}};Ai.LinkedMap=Uo;var uc=class extends Uo{constructor(t,n=1){super(),this._limit=t,this._ratio=Math.min(Math.max(0,n),1)}get limit(){return this._limit}set limit(t){this._limit=t,this.checkTrim()}get ratio(){return this._ratio}set ratio(t){this._ratio=Math.min(Math.max(0,t),1),this.checkTrim()}get(t,n=wn.AsNew){return super.get(t,n)}peek(t){return super.get(t,wn.None)}set(t,n){return super.set(t,n,wn.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};Ai.LRUCache=uc});var df=Ue(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.Disposable=void 0;var ff;(function(e){function t(n){return{dispose:n}}e.create=t})(ff||(Bo.Disposable=ff={}))});var Ni=Ue(hc=>{"use strict";Object.defineProperty(hc,"__esModule",{value:!0});var dc;function pc(){if(dc===void 0)throw new Error("No runtime abstraction layer installed");return dc}(function(e){function t(n){if(n===void 0)throw new Error("No runtime abstraction layer provided");dc=n}e.install=t})(pc||(pc={}));hc.default=pc});var br=Ue(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.Emitter=_r.Event=void 0;var Zm=Ni(),pf;(function(e){let t={dispose(){}};e.None=function(){return t}})(pf||(_r.Event=pf={}));var gc=class{add(t,n=null,r){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(t),this._contexts.push(n),Array.isArray(r)&&r.push({dispose:()=>this.remove(t,n)})}remove(t,n=null){if(!this._callbacks)return;let r=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===t)if(this._contexts[i]===n){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else r=!0;if(r)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...t){if(!this._callbacks)return[];let n=[],r=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,a=r.length;s<a;s++)try{n.push(r[s].apply(i[s],t))}catch(p){(0,Zm.default)().console.error(p)}return n}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Ho=class e{constructor(t){this._options=t}get event(){return this._event||(this._event=(t,n,r)=>{this._callbacks||(this._callbacks=new gc),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(t,n);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(t,n),i.dispose=e._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(r)&&r.push(i),i}),this._event}fire(t){this._callbacks&&this._callbacks.invoke.call(this._callbacks,t)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};_r.Emitter=Ho;Ho._noop=function(){}});var Xo=Ue(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.CancellationTokenSource=yr.CancellationToken=void 0;var e_=Ni(),t_=mr(),mc=br(),zo;(function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:mc.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:mc.Event.None});function t(n){let r=n;return r&&(r===e.None||r===e.Cancelled||t_.boolean(r.isCancellationRequested)&&!!r.onCancellationRequested)}e.is=t})(zo||(yr.CancellationToken=zo={}));var n_=Object.freeze(function(e,t){let n=(0,e_.default)().timer.setTimeout(e.bind(t),0);return{dispose(){n.dispose()}}}),Go=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?n_:(this._emitter||(this._emitter=new mc.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},_c=class{get token(){return this._token||(this._token=new Go),this._token}cancel(){this._token?this._token.cancel():this._token=zo.Cancelled}dispose(){this._token?this._token instanceof Go&&this._token.dispose():this._token=zo.None}};yr.CancellationTokenSource=_c});var hf=Ue(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.SharedArrayReceiverStrategy=kr.SharedArraySenderStrategy=void 0;var i_=Xo(),no;(function(e){e.Continue=0,e.Cancelled=1})(no||(no={}));var bc=class{constructor(){this.buffers=new Map}enableCancellation(t){if(t.id===null)return;let n=new SharedArrayBuffer(4),r=new Int32Array(n,0,1);r[0]=no.Continue,this.buffers.set(t.id,n),t.$cancellationData=n}async sendCancellation(t,n){let r=this.buffers.get(n);if(r===void 0)return;let i=new Int32Array(r,0,1);Atomics.store(i,0,no.Cancelled)}cleanup(t){this.buffers.delete(t)}dispose(){this.buffers.clear()}};kr.SharedArraySenderStrategy=bc;var yc=class{constructor(t){this.data=new Int32Array(t,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===no.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},kc=class{constructor(t){this.token=new yc(t)}cancel(){}dispose(){}},vc=class{constructor(){this.kind="request"}createCancellationTokenSource(t){let n=t.$cancellationData;return n===void 0?new i_.CancellationTokenSource:new kc(n)}};kr.SharedArrayReceiverStrategy=vc});var wc=Ue(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.Semaphore=void 0;var r_=Ni(),Tc=class{constructor(t=1){if(t<=0)throw new Error("Capacity must be greater than 0");this._capacity=t,this._active=0,this._waiting=[]}lock(t){return new Promise((n,r)=>{this._waiting.push({thunk:t,resolve:n,reject:r}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,r_.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let t=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let n=t.thunk();n instanceof Promise?n.then(r=>{this._active--,t.resolve(r),this.runNext()},r=>{this._active--,t.reject(r),this.runNext()}):(this._active--,t.resolve(n),this.runNext())}catch(n){this._active--,t.reject(n),this.runNext()}}};Qo.Semaphore=Tc});var mf=Ue(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.ReadableStreamMessageReader=Mi.AbstractMessageReader=Mi.MessageReader=void 0;var xc=Ni(),vr=mr(),Rc=br(),o_=wc(),gf;(function(e){function t(n){let r=n;return r&&vr.func(r.listen)&&vr.func(r.dispose)&&vr.func(r.onError)&&vr.func(r.onClose)&&vr.func(r.onPartialMessage)}e.is=t})(gf||(Mi.MessageReader=gf={}));var Jo=class{constructor(){this.errorEmitter=new Rc.Emitter,this.closeEmitter=new Rc.Emitter,this.partialMessageEmitter=new Rc.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(t){this.errorEmitter.fire(this.asError(t))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(t){this.partialMessageEmitter.fire(t)}asError(t){return t instanceof Error?t:new Error(`Reader received error. Reason: ${vr.string(t.message)?t.message:"unknown"}`)}};Mi.AbstractMessageReader=Jo;var Cc;(function(e){function t(n){let r,i,s,a=new Map,p,u=new Map;if(n===void 0||typeof n=="string")r=n??"utf-8";else{if(r=n.charset??"utf-8",n.contentDecoder!==void 0&&(s=n.contentDecoder,a.set(s.name,s)),n.contentDecoders!==void 0)for(let f of n.contentDecoders)a.set(f.name,f);if(n.contentTypeDecoder!==void 0&&(p=n.contentTypeDecoder,u.set(p.name,p)),n.contentTypeDecoders!==void 0)for(let f of n.contentTypeDecoders)u.set(f.name,f)}return p===void 0&&(p=(0,xc.default)().applicationJson.decoder,u.set(p.name,p)),{charset:r,contentDecoder:s,contentDecoders:a,contentTypeDecoder:p,contentTypeDecoders:u}}e.fromOptions=t})(Cc||(Cc={}));var Dc=class extends Jo{constructor(t,n){super(),this.readable=t,this.options=Cc.fromOptions(n),this.buffer=(0,xc.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new o_.Semaphore(1)}set partialMessageTimeout(t){this._partialMessageTimeout=t}get partialMessageTimeout(){return this._partialMessageTimeout}listen(t){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=t;let n=this.readable.onData(r=>{this.onData(r)});return this.readable.onError(r=>this.fireError(r)),this.readable.onClose(()=>this.fireClose()),n}onData(t){try{for(this.buffer.append(t);;){if(this.nextMessageLength===-1){let r=this.buffer.tryReadHeaders(!0);if(!r)return;let i=r.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(r))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let n=this.buffer.tryReadBody(this.nextMessageLength);if(n===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let r=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(n):n,i=await this.options.contentTypeDecoder.decode(r,this.options);this.callback(i)}).catch(r=>{this.fireError(r)})}}catch(n){this.fireError(n)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,xc.default)().timer.setTimeout((t,n)=>{this.partialMessageTimer=void 0,t===this.messageToken&&(this.firePartialMessage({messageToken:t,waitingTime:n}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};Mi.ReadableStreamMessageReader=Dc});var vf=Ue(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.WriteableStreamMessageWriter=Li.AbstractMessageWriter=Li.MessageWriter=void 0;var _f=Ni(),io=mr(),s_=wc(),bf=br(),a_="Content-Length: ",yf=`\r
`,kf;(function(e){function t(n){let r=n;return r&&io.func(r.dispose)&&io.func(r.onClose)&&io.func(r.onError)&&io.func(r.write)}e.is=t})(kf||(Li.MessageWriter=kf={}));var Yo=class{constructor(){this.errorEmitter=new bf.Emitter,this.closeEmitter=new bf.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(t,n,r){this.errorEmitter.fire([this.asError(t),n,r])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(t){return t instanceof Error?t:new Error(`Writer received error. Reason: ${io.string(t.message)?t.message:"unknown"}`)}};Li.AbstractMessageWriter=Yo;var Sc;(function(e){function t(n){return n===void 0||typeof n=="string"?{charset:n??"utf-8",contentTypeEncoder:(0,_f.default)().applicationJson.encoder}:{charset:n.charset??"utf-8",contentEncoder:n.contentEncoder,contentTypeEncoder:n.contentTypeEncoder??(0,_f.default)().applicationJson.encoder}}e.fromOptions=t})(Sc||(Sc={}));var Ec=class extends Yo{constructor(t,n){super(),this.writable=t,this.options=Sc.fromOptions(n),this.errorCount=0,this.writeSemaphore=new s_.Semaphore(1),this.writable.onError(r=>this.fireError(r)),this.writable.onClose(()=>this.fireClose())}async write(t){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(t,this.options).then(r=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(r):r).then(r=>{let i=[];return i.push(a_,r.byteLength.toString(),yf),i.push(yf),this.doWrite(t,i,r)},r=>{throw this.fireError(r),r}))}async doWrite(t,n,r){try{return await this.writable.write(n.join(""),"ascii"),this.writable.write(r)}catch(i){return this.handleError(i,t),Promise.reject(i)}}handleError(t,n){this.errorCount++,this.fireError(t,n,this.errorCount)}end(){this.writable.end()}};Li.WriteableStreamMessageWriter=Ec});var Tf=Ue(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.AbstractMessageBuffer=void 0;var c_=13,l_=10,u_=`\r
`,Pc=class{constructor(t="utf-8"){this._encoding=t,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(t){let n=typeof t=="string"?this.fromString(t,this._encoding):t;this._chunks.push(n),this._totalLength+=n.byteLength}tryReadHeaders(t=!1){if(this._chunks.length===0)return;let n=0,r=0,i=0,s=0;e:for(;r<this._chunks.length;){let f=this._chunks[r];for(i=0;i<f.length;){switch(f[i]){case c_:switch(n){case 0:n=1;break;case 2:n=3;break;default:n=0}break;case l_:switch(n){case 1:n=2;break;case 3:n=4,i++;break e;default:n=0}break;default:n=0}i++}s+=f.byteLength,r++}if(n!==4)return;let a=this._read(s+i),p=new Map,u=this.toString(a,"ascii").split(u_);if(u.length<2)return p;for(let f=0;f<u.length-2;f++){let c=u[f],m=c.indexOf(":");if(m===-1)throw new Error(`Message header must separate key and value using ':'
${c}`);let y=c.substr(0,m),h=c.substr(m+1).trim();p.set(t?y.toLowerCase():y,h)}return p}tryReadBody(t){if(!(this._totalLength<t))return this._read(t)}get numberOfBytes(){return this._totalLength}_read(t){if(t===0)return this.emptyBuffer();if(t>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===t){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=t,this.asNative(s)}if(this._chunks[0].byteLength>t){let s=this._chunks[0],a=this.asNative(s,t);return this._chunks[0]=s.slice(t),this._totalLength-=t,a}let n=this.allocNative(t),r=0,i=0;for(;t>0;){let s=this._chunks[i];if(s.byteLength>t){let a=s.slice(0,t);n.set(a,r),r+=t,this._chunks[i]=s.slice(t),this._totalLength-=t,t-=t}else n.set(s,r),r+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,t-=s.byteLength}return n}};Zo.AbstractMessageBuffer=Pc});var Df=Ue(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.createMessageConnection=pt.ConnectionOptions=pt.MessageStrategy=pt.CancellationStrategy=pt.CancellationSenderStrategy=pt.CancellationReceiverStrategy=pt.RequestCancellationReceiverStrategy=pt.IdCancellationReceiverStrategy=pt.ConnectionStrategy=pt.ConnectionError=pt.ConnectionErrors=pt.LogTraceNotification=pt.SetTraceNotification=pt.TraceFormat=pt.TraceValues=pt.Trace=pt.NullLogger=pt.ProgressType=pt.ProgressToken=void 0;var wf=Ni(),Yt=mr(),at=lc(),Rf=fc(),ro=br(),Oc=Xo(),ao;(function(e){e.type=new at.NotificationType("$/cancelRequest")})(ao||(ao={}));var Ac;(function(e){function t(n){return typeof n=="string"||typeof n=="number"}e.is=t})(Ac||(pt.ProgressToken=Ac={}));var oo;(function(e){e.type=new at.NotificationType("$/progress")})(oo||(oo={}));var Nc=class{constructor(){}};pt.ProgressType=Nc;var Mc;(function(e){function t(n){return Yt.func(n)}e.is=t})(Mc||(Mc={}));pt.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Ot;(function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Compact=2]="Compact",e[e.Verbose=3]="Verbose"})(Ot||(pt.Trace=Ot={}));var xf;(function(e){e.Off="off",e.Messages="messages",e.Compact="compact",e.Verbose="verbose"})(xf||(pt.TraceValues=xf={}));(function(e){function t(r){if(!Yt.string(r))return e.Off;switch(r=r.toLowerCase(),r){case"off":return e.Off;case"messages":return e.Messages;case"compact":return e.Compact;case"verbose":return e.Verbose;default:return e.Off}}e.fromString=t;function n(r){switch(r){case e.Off:return"off";case e.Messages:return"messages";case e.Compact:return"compact";case e.Verbose:return"verbose";default:return"off"}}e.toString=n})(Ot||(pt.Trace=Ot={}));var qn;(function(e){e.Text="text",e.JSON="json"})(qn||(pt.TraceFormat=qn={}));(function(e){function t(n){return Yt.string(n)?(n=n.toLowerCase(),n==="json"?e.JSON:e.Text):e.Text}e.fromString=t})(qn||(pt.TraceFormat=qn={}));var Lc;(function(e){e.type=new at.NotificationType("$/setTrace")})(Lc||(pt.SetTraceNotification=Lc={}));var es;(function(e){e.type=new at.NotificationType("$/logTrace")})(es||(pt.LogTraceNotification=es={}));var so;(function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"})(so||(pt.ConnectionErrors=so={}));var Tr=class e extends Error{constructor(t,n){super(n),this.code=t,Object.setPrototypeOf(this,e.prototype)}};pt.ConnectionError=Tr;var Fc;(function(e){function t(n){let r=n;return r&&Yt.func(r.cancelUndispatched)}e.is=t})(Fc||(pt.ConnectionStrategy=Fc={}));var ts;(function(e){function t(n){let r=n;return r&&(r.kind===void 0||r.kind==="id")&&Yt.func(r.createCancellationTokenSource)&&(r.dispose===void 0||Yt.func(r.dispose))}e.is=t})(ts||(pt.IdCancellationReceiverStrategy=ts={}));var Kc;(function(e){function t(n){let r=n;return r&&r.kind==="request"&&Yt.func(r.createCancellationTokenSource)&&(r.dispose===void 0||Yt.func(r.dispose))}e.is=t})(Kc||(pt.RequestCancellationReceiverStrategy=Kc={}));var ns;(function(e){e.Message=Object.freeze({createCancellationTokenSource(n){return new Oc.CancellationTokenSource}});function t(n){return ts.is(n)||Kc.is(n)}e.is=t})(ns||(pt.CancellationReceiverStrategy=ns={}));var is;(function(e){e.Message=Object.freeze({sendCancellation(n,r){return n.sendNotification(ao.type,{id:r})},cleanup(n){}});function t(n){let r=n;return r&&Yt.func(r.sendCancellation)&&Yt.func(r.cleanup)}e.is=t})(is||(pt.CancellationSenderStrategy=is={}));var rs;(function(e){e.Message=Object.freeze({receiver:ns.Message,sender:is.Message});function t(n){let r=n;return r&&ns.is(r.receiver)&&is.is(r.sender)}e.is=t})(rs||(pt.CancellationStrategy=rs={}));var os;(function(e){function t(n){let r=n;return r&&Yt.func(r.handleMessage)}e.is=t})(os||(pt.MessageStrategy=os={}));var Cf;(function(e){function t(n){let r=n;return r&&(rs.is(r.cancellationStrategy)||Fc.is(r.connectionStrategy)||os.is(r.messageStrategy))}e.is=t})(Cf||(pt.ConnectionOptions=Cf={}));var ri;(function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"})(ri||(ri={}));function f_(e,t,n,r){let i=n!==void 0?n:pt.NullLogger,s=0,a=0,p=0,u="2.0",f,c=new Map,m,y=new Map,h=new Map,C,F=new Rf.LinkedMap,ne=new Map,R=new Set,g=new Map,b=Ot.Off,d=qn.Text,X,_=ri.New,Se=new ro.Emitter,je=new ro.Emitter,Pe=new ro.Emitter,Be=new ro.Emitter,ie=new ro.Emitter,P=r&&r.cancellationStrategy?r.cancellationStrategy:rs.Message;function j(S){if(S===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+S.toString()}function he(S){return S===null?"res-unknown-"+(++p).toString():"res-"+S.toString()}function ge(){return"not-"+(++a).toString()}function pe(S,Z){at.Message.isRequest(Z)?S.set(j(Z.id),Z):at.Message.isResponse(Z)?S.set(he(Z.id),Z):S.set(ge(),Z)}function k(S){}function lt(){return _===ri.Listening}function It(){return _===ri.Closed}function ye(){return _===ri.Disposed}function Et(){(_===ri.New||_===ri.Listening)&&(_=ri.Closed,je.fire(void 0))}function fn(S){Se.fire([S,void 0,void 0])}function kt(S){Se.fire(S)}e.onClose(Et),e.onError(fn),t.onClose(Et),t.onError(kt);function we(){C||F.size===0||(C=(0,wf.default)().timer.setImmediate(()=>{C=void 0,gt()}))}function ot(S){at.Message.isRequest(S)?et(S):at.Message.isNotification(S)?z(S):at.Message.isResponse(S)?I(S):Oe(S)}function gt(){if(F.size===0)return;let S=F.shift();try{let Z=r?.messageStrategy;os.is(Z)?Z.handleMessage(S,ot):ot(S)}finally{we()}}let xt=S=>{try{if(at.Message.isNotification(S)&&S.method===ao.type.method){let Z=S.params.id,Te=j(Z),$e=F.get(Te);if(at.Message.isRequest($e)){let Ie=r?.connectionStrategy,dt=Ie&&Ie.cancelUndispatched?Ie.cancelUndispatched($e,k):void 0;if(dt&&(dt.error!==void 0||dt.result!==void 0)){F.delete(Te),g.delete(Z),dt.id=$e.id,st(dt,S.method,Date.now()),t.write(dt).catch(()=>i.error("Sending response for canceled message failed."));return}}let ke=g.get(Z);if(ke!==void 0){ke.cancel(),ze(S);return}else R.add(Z)}pe(F,S)}finally{we()}};function et(S){if(ye())return;function Z(tt,ht,Dt){let Vt={jsonrpc:u,id:S.id};tt instanceof at.ResponseError?Vt.error=tt.toJson():Vt.result=tt===void 0?null:tt,st(Vt,ht,Dt),t.write(Vt).catch(()=>i.error("Sending response failed."))}function Te(tt,ht,Dt){let Vt={jsonrpc:u,id:S.id,error:tt.toJson()};st(Vt,ht,Dt),t.write(Vt).catch(()=>i.error("Sending response failed."))}function $e(tt,ht,Dt){tt===void 0&&(tt=null);let Vt={jsonrpc:u,id:S.id,result:tt};st(Vt,ht,Dt),t.write(Vt).catch(()=>i.error("Sending response failed."))}Ze(S);let ke=c.get(S.method),Ie,dt;ke&&(Ie=ke.type,dt=ke.handler);let Ct=Date.now();if(dt||f){let tt=S.id??String(Date.now()),ht=ts.is(P.receiver)?P.receiver.createCancellationTokenSource(tt):P.receiver.createCancellationTokenSource(S);S.id!==null&&R.has(S.id)&&ht.cancel(),S.id!==null&&g.set(tt,ht);try{let Dt;if(dt)if(S.params===void 0){if(Ie!==void 0&&Ie.numberOfParams!==0){Te(new at.ResponseError(at.ErrorCodes.InvalidParams,`Request ${S.method} defines ${Ie.numberOfParams} params but received none.`),S.method,Ct);return}Dt=dt(ht.token)}else if(Array.isArray(S.params)){if(Ie!==void 0&&Ie.parameterStructures===at.ParameterStructures.byName){Te(new at.ResponseError(at.ErrorCodes.InvalidParams,`Request ${S.method} defines parameters by name but received parameters by position`),S.method,Ct);return}Dt=dt(...S.params,ht.token)}else{if(Ie!==void 0&&Ie.parameterStructures===at.ParameterStructures.byPosition){Te(new at.ResponseError(at.ErrorCodes.InvalidParams,`Request ${S.method} defines parameters by position but received parameters by name`),S.method,Ct);return}Dt=dt(S.params,ht.token)}else f&&(Dt=f(S.method,S.params,ht.token));let Vt=Dt;Dt?Vt.then?Vt.then(gn=>{g.delete(tt),Z(gn,S.method,Ct)},gn=>{g.delete(tt),gn instanceof at.ResponseError?Te(gn,S.method,Ct):gn&&Yt.string(gn.message)?Te(new at.ResponseError(at.ErrorCodes.InternalError,`Request ${S.method} failed with message: ${gn.message}`),S.method,Ct):Te(new at.ResponseError(at.ErrorCodes.InternalError,`Request ${S.method} failed unexpectedly without providing any details.`),S.method,Ct)}):(g.delete(tt),Z(Dt,S.method,Ct)):(g.delete(tt),$e(Dt,S.method,Ct))}catch(Dt){g.delete(tt),Dt instanceof at.ResponseError?Z(Dt,S.method,Ct):Dt&&Yt.string(Dt.message)?Te(new at.ResponseError(at.ErrorCodes.InternalError,`Request ${S.method} failed with message: ${Dt.message}`),S.method,Ct):Te(new at.ResponseError(at.ErrorCodes.InternalError,`Request ${S.method} failed unexpectedly without providing any details.`),S.method,Ct)}}else Te(new at.ResponseError(at.ErrorCodes.MethodNotFound,`Unhandled method ${S.method}`),S.method,Ct)}function I(S){if(!ye())if(S.id===null)S.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(S.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let Z=S.id,Te=ne.get(Z);if(Ee(S,Te),Te!==void 0){ne.delete(Z);try{if(S.error){let $e=S.error;Te.reject(new at.ResponseError($e.code,$e.message,$e.data))}else if(S.result!==void 0)Te.resolve(S.result);else throw new Error("Should never happen.")}catch($e){$e.message?i.error(`Response handler '${Te.method}' failed with message: ${$e.message}`):i.error(`Response handler '${Te.method}' failed unexpectedly.`)}}}}function z(S){if(ye())return;let Z,Te;if(S.method===ao.type.method){let $e=S.params.id;R.delete($e),ze(S);return}else{let $e=y.get(S.method);$e&&(Te=$e.handler,Z=$e.type)}if(Te||m)try{if(ze(S),Te)if(S.params===void 0)Z!==void 0&&Z.numberOfParams!==0&&Z.parameterStructures!==at.ParameterStructures.byName&&i.error(`Notification ${S.method} defines ${Z.numberOfParams} params but received none.`),Te();else if(Array.isArray(S.params)){let $e=S.params;S.method===oo.type.method&&$e.length===2&&Ac.is($e[0])?Te({token:$e[0],value:$e[1]}):(Z!==void 0&&(Z.parameterStructures===at.ParameterStructures.byName&&i.error(`Notification ${S.method} defines parameters by name but received parameters by position`),Z.numberOfParams!==S.params.length&&i.error(`Notification ${S.method} defines ${Z.numberOfParams} params but received ${$e.length} arguments`)),Te(...$e))}else Z!==void 0&&Z.parameterStructures===at.ParameterStructures.byPosition&&i.error(`Notification ${S.method} defines parameters by position but received parameters by name`),Te(S.params);else m&&m(S.method,S.params)}catch($e){$e.message?i.error(`Notification handler '${S.method}' failed with message: ${$e.message}`):i.error(`Notification handler '${S.method}' failed unexpectedly.`)}else Pe.fire(S)}function Oe(S){if(!S){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(S,null,4)}`);let Z=S;if(Yt.string(Z.id)||Yt.number(Z.id)){let Te=Z.id,$e=ne.get(Te);$e&&$e.reject(new Error("The received response has neither a result nor an error property."))}}function Ae(S){if(S!=null)switch(b){case Ot.Verbose:return JSON.stringify(S,null,4);case Ot.Compact:return JSON.stringify(S);default:return}}function Lt(S){if(!(b===Ot.Off||!X))if(d===qn.Text){let Z;(b===Ot.Verbose||b===Ot.Compact)&&S.params&&(Z=`Params: ${Ae(S.params)}

`),X.log(`Sending request '${S.method} - (${S.id})'.`,Z)}else Le("send-request",S)}function fe(S){if(!(b===Ot.Off||!X))if(d===qn.Text){let Z;(b===Ot.Verbose||b===Ot.Compact)&&(S.params?Z=`Params: ${Ae(S.params)}

`:Z=`No parameters provided.

`),X.log(`Sending notification '${S.method}'.`,Z)}else Le("send-notification",S)}function st(S,Z,Te){if(!(b===Ot.Off||!X))if(d===qn.Text){let $e;(b===Ot.Verbose||b===Ot.Compact)&&(S.error&&S.error.data?$e=`Error data: ${Ae(S.error.data)}

`:S.result?$e=`Result: ${Ae(S.result)}

`:S.error===void 0&&($e=`No result returned.

`)),X.log(`Sending response '${Z} - (${S.id})'. Processing request took ${Date.now()-Te}ms`,$e)}else Le("send-response",S)}function Ze(S){if(!(b===Ot.Off||!X))if(d===qn.Text){let Z;(b===Ot.Verbose||b===Ot.Compact)&&S.params&&(Z=`Params: ${Ae(S.params)}

`),X.log(`Received request '${S.method} - (${S.id})'.`,Z)}else Le("receive-request",S)}function ze(S){if(!(b===Ot.Off||!X||S.method===es.type.method))if(d===qn.Text){let Z;(b===Ot.Verbose||b===Ot.Compact)&&(S.params?Z=`Params: ${Ae(S.params)}

`:Z=`No parameters provided.

`),X.log(`Received notification '${S.method}'.`,Z)}else Le("receive-notification",S)}function Ee(S,Z){if(!(b===Ot.Off||!X))if(d===qn.Text){let Te;if((b===Ot.Verbose||b===Ot.Compact)&&(S.error&&S.error.data?Te=`Error data: ${Ae(S.error.data)}

`:S.result?Te=`Result: ${Ae(S.result)}

`:S.error===void 0&&(Te=`No result returned.

`)),Z){let $e=S.error?` Request failed: ${S.error.message} (${S.error.code}).`:"";X.log(`Received response '${Z.method} - (${S.id})' in ${Date.now()-Z.timerStart}ms.${$e}`,Te)}else X.log(`Received response ${S.id} without active response promise.`,Te)}else Le("receive-response",S)}function Le(S,Z){if(!X||b===Ot.Off)return;let Te={isLSPMessage:!0,type:S,message:Z,timestamp:Date.now()};X.log(Te)}function vt(){if(It())throw new Tr(so.Closed,"Connection is closed.");if(ye())throw new Tr(so.Disposed,"Connection is disposed.")}function Ft(){if(lt())throw new Tr(so.AlreadyListening,"Connection is already listening")}function nn(){if(!lt())throw new Error("Call listen() first.")}function Tt(S){return S===void 0?null:S}function We(S){if(S!==null)return S}function Xe(S){return S!=null&&!Array.isArray(S)&&typeof S=="object"}function de(S,Z){switch(S){case at.ParameterStructures.auto:return Xe(Z)?We(Z):[Tt(Z)];case at.ParameterStructures.byName:if(!Xe(Z))throw new Error("Received parameters by name but param is not an object literal.");return We(Z);case at.ParameterStructures.byPosition:return[Tt(Z)];default:throw new Error(`Unknown parameter structure ${S.toString()}`)}}function Je(S,Z){let Te,$e=S.numberOfParams;switch($e){case 0:Te=void 0;break;case 1:Te=de(S.parameterStructures,Z[0]);break;default:Te=[];for(let ke=0;ke<Z.length&&ke<$e;ke++)Te.push(Tt(Z[ke]));if(Z.length<$e)for(let ke=Z.length;ke<$e;ke++)Te.push(null);break}return Te}let Pn={sendNotification:(S,...Z)=>{vt();let Te,$e;if(Yt.string(S)){Te=S;let Ie=Z[0],dt=0,Ct=at.ParameterStructures.auto;at.ParameterStructures.is(Ie)&&(dt=1,Ct=Ie);let tt=Z.length,ht=tt-dt;switch(ht){case 0:$e=void 0;break;case 1:$e=de(Ct,Z[dt]);break;default:if(Ct===at.ParameterStructures.byName)throw new Error(`Received ${ht} parameters for 'by Name' notification parameter structure.`);$e=Z.slice(dt,tt).map(Dt=>Tt(Dt));break}}else{let Ie=Z;Te=S.method,$e=Je(S,Ie)}let ke={jsonrpc:u,method:Te,params:$e};return fe(ke),t.write(ke).catch(Ie=>{throw i.error("Sending notification failed."),Ie})},onNotification:(S,Z)=>{vt();let Te;return Yt.func(S)?m=S:Z&&(Yt.string(S)?(Te=S,y.set(S,{type:void 0,handler:Z})):(Te=S.method,y.set(S.method,{type:S,handler:Z}))),{dispose:()=>{Te!==void 0?y.delete(Te):m=void 0}}},onProgress:(S,Z,Te)=>{if(h.has(Z))throw new Error(`Progress handler for token ${Z} already registered`);return h.set(Z,Te),{dispose:()=>{h.delete(Z)}}},sendProgress:(S,Z,Te)=>Pn.sendNotification(oo.type,{token:Z,value:Te}),onUnhandledProgress:Be.event,sendRequest:(S,...Z)=>{vt(),nn();let Te,$e,ke;if(Yt.string(S)){Te=S;let tt=Z[0],ht=Z[Z.length-1],Dt=0,Vt=at.ParameterStructures.auto;at.ParameterStructures.is(tt)&&(Dt=1,Vt=tt);let gn=Z.length;Oc.CancellationToken.is(ht)&&(gn=gn-1,ke=ht);let On=gn-Dt;switch(On){case 0:$e=void 0;break;case 1:$e=de(Vt,Z[Dt]);break;default:if(Vt===at.ParameterStructures.byName)throw new Error(`Received ${On} parameters for 'by Name' request parameter structure.`);$e=Z.slice(Dt,gn).map(Gt=>Tt(Gt));break}}else{let tt=Z;Te=S.method,$e=Je(S,tt);let ht=S.numberOfParams;ke=Oc.CancellationToken.is(tt[ht])?tt[ht]:void 0}let Ie=s++,dt;ke&&(dt=ke.onCancellationRequested(()=>{let tt=P.sender.sendCancellation(Pn,Ie);return tt===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${Ie}`),Promise.resolve()):tt.catch(()=>{i.log(`Sending cancellation messages for id ${Ie} failed`)})}));let Ct={jsonrpc:u,id:Ie,method:Te,params:$e};return Lt(Ct),typeof P.sender.enableCancellation=="function"&&P.sender.enableCancellation(Ct),new Promise(async(tt,ht)=>{let Dt=On=>{tt(On),P.sender.cleanup(Ie),dt?.dispose()},Vt=On=>{ht(On),P.sender.cleanup(Ie),dt?.dispose()},gn={method:Te,timerStart:Date.now(),resolve:Dt,reject:Vt};try{await t.write(Ct),ne.set(Ie,gn)}catch(On){throw i.error("Sending request failed."),gn.reject(new at.ResponseError(at.ErrorCodes.MessageWriteError,On.message?On.message:"Unknown reason")),On}})},onRequest:(S,Z)=>{vt();let Te=null;return Mc.is(S)?(Te=void 0,f=S):Yt.string(S)?(Te=null,Z!==void 0&&(Te=S,c.set(S,{handler:Z,type:void 0}))):Z!==void 0&&(Te=S.method,c.set(S.method,{type:S,handler:Z})),{dispose:()=>{Te!==null&&(Te!==void 0?c.delete(Te):f=void 0)}}},hasPendingResponse:()=>ne.size>0,trace:async(S,Z,Te)=>{let $e=!1,ke=qn.Text;Te!==void 0&&(Yt.boolean(Te)?$e=Te:($e=Te.sendNotification||!1,ke=Te.traceFormat||qn.Text)),b=S,d=ke,b===Ot.Off?X=void 0:X=Z,$e&&!It()&&!ye()&&await Pn.sendNotification(Lc.type,{value:Ot.toString(S)})},onError:Se.event,onClose:je.event,onUnhandledNotification:Pe.event,onDispose:ie.event,end:()=>{t.end()},dispose:()=>{if(ye())return;_=ri.Disposed,ie.fire(void 0);let S=new at.ResponseError(at.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let Z of ne.values())Z.reject(S);ne=new Map,g=new Map,R=new Set,F=new Rf.LinkedMap,Yt.func(t.dispose)&&t.dispose(),Yt.func(e.dispose)&&e.dispose()},listen:()=>{vt(),Ft(),_=ri.Listening,e.listen(xt)},inspect:()=>{(0,wf.default)().console.log("inspect")}};return Pn.onNotification(es.type,S=>{if(b===Ot.Off||!X)return;let Z=b===Ot.Verbose||b===Ot.Compact;X.log(S.message,Z?S.verbose:void 0)}),Pn.onNotification(oo.type,S=>{let Z=h.get(S.token);Z?Z(S.value):Be.fire(S)}),Pn}pt.createMessageConnection=f_});var ss=Ue(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.ProgressType=ee.ProgressToken=ee.createMessageConnection=ee.NullLogger=ee.ConnectionOptions=ee.ConnectionStrategy=ee.AbstractMessageBuffer=ee.WriteableStreamMessageWriter=ee.AbstractMessageWriter=ee.MessageWriter=ee.ReadableStreamMessageReader=ee.AbstractMessageReader=ee.MessageReader=ee.SharedArrayReceiverStrategy=ee.SharedArraySenderStrategy=ee.CancellationToken=ee.CancellationTokenSource=ee.Emitter=ee.Event=ee.Disposable=ee.LRUCache=ee.Touch=ee.LinkedMap=ee.ParameterStructures=ee.NotificationType9=ee.NotificationType8=ee.NotificationType7=ee.NotificationType6=ee.NotificationType5=ee.NotificationType4=ee.NotificationType3=ee.NotificationType2=ee.NotificationType1=ee.NotificationType0=ee.NotificationType=ee.ErrorCodes=ee.ResponseError=ee.RequestType9=ee.RequestType8=ee.RequestType7=ee.RequestType6=ee.RequestType5=ee.RequestType4=ee.RequestType3=ee.RequestType2=ee.RequestType1=ee.RequestType0=ee.RequestType=ee.Message=ee.RAL=void 0;ee.MessageStrategy=ee.CancellationStrategy=ee.CancellationSenderStrategy=ee.CancellationReceiverStrategy=ee.ConnectionError=ee.ConnectionErrors=ee.LogTraceNotification=ee.SetTraceNotification=ee.TraceFormat=ee.TraceValues=ee.Trace=void 0;var Ut=lc();Object.defineProperty(ee,"Message",{enumerable:!0,get:function(){return Ut.Message}});Object.defineProperty(ee,"RequestType",{enumerable:!0,get:function(){return Ut.RequestType}});Object.defineProperty(ee,"RequestType0",{enumerable:!0,get:function(){return Ut.RequestType0}});Object.defineProperty(ee,"RequestType1",{enumerable:!0,get:function(){return Ut.RequestType1}});Object.defineProperty(ee,"RequestType2",{enumerable:!0,get:function(){return Ut.RequestType2}});Object.defineProperty(ee,"RequestType3",{enumerable:!0,get:function(){return Ut.RequestType3}});Object.defineProperty(ee,"RequestType4",{enumerable:!0,get:function(){return Ut.RequestType4}});Object.defineProperty(ee,"RequestType5",{enumerable:!0,get:function(){return Ut.RequestType5}});Object.defineProperty(ee,"RequestType6",{enumerable:!0,get:function(){return Ut.RequestType6}});Object.defineProperty(ee,"RequestType7",{enumerable:!0,get:function(){return Ut.RequestType7}});Object.defineProperty(ee,"RequestType8",{enumerable:!0,get:function(){return Ut.RequestType8}});Object.defineProperty(ee,"RequestType9",{enumerable:!0,get:function(){return Ut.RequestType9}});Object.defineProperty(ee,"ResponseError",{enumerable:!0,get:function(){return Ut.ResponseError}});Object.defineProperty(ee,"ErrorCodes",{enumerable:!0,get:function(){return Ut.ErrorCodes}});Object.defineProperty(ee,"NotificationType",{enumerable:!0,get:function(){return Ut.NotificationType}});Object.defineProperty(ee,"NotificationType0",{enumerable:!0,get:function(){return Ut.NotificationType0}});Object.defineProperty(ee,"NotificationType1",{enumerable:!0,get:function(){return Ut.NotificationType1}});Object.defineProperty(ee,"NotificationType2",{enumerable:!0,get:function(){return Ut.NotificationType2}});Object.defineProperty(ee,"NotificationType3",{enumerable:!0,get:function(){return Ut.NotificationType3}});Object.defineProperty(ee,"NotificationType4",{enumerable:!0,get:function(){return Ut.NotificationType4}});Object.defineProperty(ee,"NotificationType5",{enumerable:!0,get:function(){return Ut.NotificationType5}});Object.defineProperty(ee,"NotificationType6",{enumerable:!0,get:function(){return Ut.NotificationType6}});Object.defineProperty(ee,"NotificationType7",{enumerable:!0,get:function(){return Ut.NotificationType7}});Object.defineProperty(ee,"NotificationType8",{enumerable:!0,get:function(){return Ut.NotificationType8}});Object.defineProperty(ee,"NotificationType9",{enumerable:!0,get:function(){return Ut.NotificationType9}});Object.defineProperty(ee,"ParameterStructures",{enumerable:!0,get:function(){return Ut.ParameterStructures}});var qc=fc();Object.defineProperty(ee,"LinkedMap",{enumerable:!0,get:function(){return qc.LinkedMap}});Object.defineProperty(ee,"LRUCache",{enumerable:!0,get:function(){return qc.LRUCache}});Object.defineProperty(ee,"Touch",{enumerable:!0,get:function(){return qc.Touch}});var d_=df();Object.defineProperty(ee,"Disposable",{enumerable:!0,get:function(){return d_.Disposable}});var Sf=br();Object.defineProperty(ee,"Event",{enumerable:!0,get:function(){return Sf.Event}});Object.defineProperty(ee,"Emitter",{enumerable:!0,get:function(){return Sf.Emitter}});var Ef=Xo();Object.defineProperty(ee,"CancellationTokenSource",{enumerable:!0,get:function(){return Ef.CancellationTokenSource}});Object.defineProperty(ee,"CancellationToken",{enumerable:!0,get:function(){return Ef.CancellationToken}});var Pf=hf();Object.defineProperty(ee,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return Pf.SharedArraySenderStrategy}});Object.defineProperty(ee,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return Pf.SharedArrayReceiverStrategy}});var jc=mf();Object.defineProperty(ee,"MessageReader",{enumerable:!0,get:function(){return jc.MessageReader}});Object.defineProperty(ee,"AbstractMessageReader",{enumerable:!0,get:function(){return jc.AbstractMessageReader}});Object.defineProperty(ee,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return jc.ReadableStreamMessageReader}});var $c=vf();Object.defineProperty(ee,"MessageWriter",{enumerable:!0,get:function(){return $c.MessageWriter}});Object.defineProperty(ee,"AbstractMessageWriter",{enumerable:!0,get:function(){return $c.AbstractMessageWriter}});Object.defineProperty(ee,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return $c.WriteableStreamMessageWriter}});var p_=Tf();Object.defineProperty(ee,"AbstractMessageBuffer",{enumerable:!0,get:function(){return p_.AbstractMessageBuffer}});var _n=Df();Object.defineProperty(ee,"ConnectionStrategy",{enumerable:!0,get:function(){return _n.ConnectionStrategy}});Object.defineProperty(ee,"ConnectionOptions",{enumerable:!0,get:function(){return _n.ConnectionOptions}});Object.defineProperty(ee,"NullLogger",{enumerable:!0,get:function(){return _n.NullLogger}});Object.defineProperty(ee,"createMessageConnection",{enumerable:!0,get:function(){return _n.createMessageConnection}});Object.defineProperty(ee,"ProgressToken",{enumerable:!0,get:function(){return _n.ProgressToken}});Object.defineProperty(ee,"ProgressType",{enumerable:!0,get:function(){return _n.ProgressType}});Object.defineProperty(ee,"Trace",{enumerable:!0,get:function(){return _n.Trace}});Object.defineProperty(ee,"TraceValues",{enumerable:!0,get:function(){return _n.TraceValues}});Object.defineProperty(ee,"TraceFormat",{enumerable:!0,get:function(){return _n.TraceFormat}});Object.defineProperty(ee,"SetTraceNotification",{enumerable:!0,get:function(){return _n.SetTraceNotification}});Object.defineProperty(ee,"LogTraceNotification",{enumerable:!0,get:function(){return _n.LogTraceNotification}});Object.defineProperty(ee,"ConnectionErrors",{enumerable:!0,get:function(){return _n.ConnectionErrors}});Object.defineProperty(ee,"ConnectionError",{enumerable:!0,get:function(){return _n.ConnectionError}});Object.defineProperty(ee,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return _n.CancellationReceiverStrategy}});Object.defineProperty(ee,"CancellationSenderStrategy",{enumerable:!0,get:function(){return _n.CancellationSenderStrategy}});Object.defineProperty(ee,"CancellationStrategy",{enumerable:!0,get:function(){return _n.CancellationStrategy}});Object.defineProperty(ee,"MessageStrategy",{enumerable:!0,get:function(){return _n.MessageStrategy}});var h_=Ni();ee.RAL=h_.default});var Af=Ue(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});var ui=ss(),as=class e extends ui.AbstractMessageBuffer{constructor(t="utf-8"){super(t),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return e.emptyBuffer}fromString(t,n){return new TextEncoder().encode(t)}toString(t,n){return n==="ascii"?this.asciiDecoder.decode(t):new TextDecoder(n).decode(t)}asNative(t,n){return n===void 0?t:t.slice(0,n)}allocNative(t){return new Uint8Array(t)}};as.emptyBuffer=new Uint8Array(0);var Wc=class{constructor(t){this.socket=t,this._onData=new ui.Emitter,this._messageListener=n=>{n.data.arrayBuffer().then(i=>{this._onData.fire(new Uint8Array(i))},()=>{(0,ui.RAL)().console.error("Converting blob to array buffer failed.")})},this.socket.addEventListener("message",this._messageListener)}onClose(t){return this.socket.addEventListener("close",t),ui.Disposable.create(()=>this.socket.removeEventListener("close",t))}onError(t){return this.socket.addEventListener("error",t),ui.Disposable.create(()=>this.socket.removeEventListener("error",t))}onEnd(t){return this.socket.addEventListener("end",t),ui.Disposable.create(()=>this.socket.removeEventListener("end",t))}onData(t){return this._onData.event(t)}},Ic=class{constructor(t){this.socket=t}onClose(t){return this.socket.addEventListener("close",t),ui.Disposable.create(()=>this.socket.removeEventListener("close",t))}onError(t){return this.socket.addEventListener("error",t),ui.Disposable.create(()=>this.socket.removeEventListener("error",t))}onEnd(t){return this.socket.addEventListener("end",t),ui.Disposable.create(()=>this.socket.removeEventListener("end",t))}write(t,n){if(typeof t=="string"){if(n!==void 0&&n!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${n}`);this.socket.send(t)}else this.socket.send(t);return Promise.resolve()}end(){this.socket.close()}},g_=new TextEncoder,Of=Object.freeze({messageBuffer:Object.freeze({create:e=>new as(e)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(e,t)=>{if(t.charset!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t.charset}`);return Promise.resolve(g_.encode(JSON.stringify(e,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(e,t)=>{if(!(e instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(t.charset).decode(e)))}})}),stream:Object.freeze({asReadableStream:e=>new Wc(e),asWritableStream:e=>new Ic(e)}),console,timer:Object.freeze({setTimeout(e,t,...n){let r=setTimeout(e,t,...n);return{dispose:()=>clearTimeout(r)}},setImmediate(e,...t){let n=setTimeout(e,0,...t);return{dispose:()=>clearTimeout(n)}},setInterval(e,t,...n){let r=setInterval(e,t,...n);return{dispose:()=>clearInterval(r)}}})});function Vc(){return Of}(function(e){function t(){ui.RAL.install(Of)}e.install=t})(Vc||(Vc={}));Uc.default=Vc});var Fi=Ue(jn=>{"use strict";var m_=jn&&jn.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),__=jn&&jn.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&m_(t,e,n)};Object.defineProperty(jn,"__esModule",{value:!0});jn.createMessageConnection=jn.BrowserMessageWriter=jn.BrowserMessageReader=void 0;var b_=Af();b_.default.install();var wr=ss();__(ss(),jn);var Bc=class extends wr.AbstractMessageReader{constructor(t){super(),this._onData=new wr.Emitter,this._messageListener=n=>{this._onData.fire(n.data)},t.addEventListener("error",n=>this.fireError(n)),t.onmessage=this._messageListener}listen(t){return this._onData.event(t)}};jn.BrowserMessageReader=Bc;var Hc=class extends wr.AbstractMessageWriter{constructor(t){super(),this.port=t,this.errorCount=0,t.addEventListener("error",n=>this.fireError(n))}write(t){try{return this.port.postMessage(t),Promise.resolve()}catch(n){return this.handleError(n,t),Promise.reject(n)}}handleError(t,n){this.errorCount++,this.fireError(t,n,this.errorCount)}end(){}};jn.BrowserMessageWriter=Hc;function y_(e,t,n,r){return n===void 0&&(n=wr.NullLogger),wr.ConnectionStrategy.is(r)&&(r={connectionStrategy:r}),(0,wr.createMessageConnection)(e,t,n,r)}jn.createMessageConnection=y_});var zc=Ue((Ky,Nf)=>{"use strict";Nf.exports=Fi()});var ms={};Hm(ms,{AnnotatedTextEdit:()=>vi,ChangeAnnotation:()=>Zi,ChangeAnnotationIdentifier:()=>bn,CodeAction:()=>xl,CodeActionContext:()=>Rl,CodeActionKind:()=>wl,CodeActionTriggerKind:()=>mo,CodeDescription:()=>il,CodeLens:()=>Cl,Color:()=>ls,ColorInformation:()=>Jc,ColorPresentation:()=>Yc,Command:()=>er,CompletionItem:()=>dl,CompletionItemKind:()=>Bn,CompletionItemLabelDetails:()=>fl,CompletionItemTag:()=>cl,CompletionList:()=>pl,CreateFile:()=>xr,DeleteFile:()=>Dr,Diagnostic:()=>uo,DiagnosticRelatedInformation:()=>us,DiagnosticSeverity:()=>tl,DiagnosticTag:()=>nl,DocumentHighlight:()=>bl,DocumentHighlightKind:()=>_l,DocumentLink:()=>Sl,DocumentSymbol:()=>Tl,DocumentUri:()=>Gc,EOL:()=>k_,FoldingRange:()=>el,FoldingRangeKind:()=>Zc,FormattingOptions:()=>Dl,Hover:()=>hl,InlayHint:()=>Kl,InlayHintKind:()=>hs,InlayHintLabelPart:()=>gs,InlineCompletionContext:()=>Vl,InlineCompletionItem:()=>jl,InlineCompletionList:()=>$l,InlineCompletionTriggerKind:()=>Wl,InlineValueContext:()=>Fl,InlineValueEvaluatableExpression:()=>Ll,InlineValueText:()=>Nl,InlineValueVariableLookup:()=>Ml,InsertReplaceEdit:()=>ll,InsertTextFormat:()=>Ki,InsertTextMode:()=>ul,Location:()=>lo,LocationLink:()=>Qc,MarkedString:()=>ho,MarkupContent:()=>Sr,MarkupKind:()=>ps,OptionalVersionedTextDocumentIdentifier:()=>po,ParameterInformation:()=>gl,Position:()=>Un,Range:()=>Qt,RenameFile:()=>Cr,SelectedCompletionInfo:()=>Il,SelectionRange:()=>El,SemanticTokenModifiers:()=>Ol,SemanticTokenTypes:()=>Pl,SemanticTokens:()=>Al,SignatureInformation:()=>ml,StringValue:()=>ql,SymbolInformation:()=>kl,SymbolKind:()=>go,SymbolTag:()=>yl,TextDocument:()=>Bl,TextDocumentEdit:()=>fo,TextDocumentIdentifier:()=>ol,TextDocumentItem:()=>al,TextEdit:()=>fi,URI:()=>cs,VersionedTextDocumentIdentifier:()=>sl,WorkspaceChange:()=>rl,WorkspaceEdit:()=>fs,WorkspaceFolder:()=>Ul,WorkspaceSymbol:()=>vl,integer:()=>Xc,uinteger:()=>co});var Gc,cs,Xc,co,Un,Qt,lo,Qc,ls,Jc,Yc,Zc,el,us,tl,nl,il,uo,er,fi,Zi,bn,vi,fo,xr,Cr,Dr,fs,Rr,ds,rl,ol,sl,po,al,ps,Sr,Bn,Ki,cl,ll,ul,fl,dl,pl,ho,hl,gl,ml,_l,bl,go,yl,kl,vl,Tl,wl,mo,Rl,xl,Cl,Dl,Sl,El,Pl,Ol,Al,Nl,Ml,Ll,Fl,hs,gs,Kl,ql,jl,$l,Wl,Il,Vl,Ul,k_,Bl,Hl,U,_o=Bm(()=>{"use strict";(function(e){function t(n){return typeof n=="string"}e.is=t})(Gc||(Gc={}));(function(e){function t(n){return typeof n=="string"}e.is=t})(cs||(cs={}));(function(e){e.MIN_VALUE=-2147483648,e.MAX_VALUE=2147483647;function t(n){return typeof n=="number"&&e.MIN_VALUE<=n&&n<=e.MAX_VALUE}e.is=t})(Xc||(Xc={}));(function(e){e.MIN_VALUE=0,e.MAX_VALUE=2147483647;function t(n){return typeof n=="number"&&e.MIN_VALUE<=n&&n<=e.MAX_VALUE}e.is=t})(co||(co={}));(function(e){function t(r,i){return r===Number.MAX_VALUE&&(r=co.MAX_VALUE),i===Number.MAX_VALUE&&(i=co.MAX_VALUE),{line:r,character:i}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&U.uinteger(i.line)&&U.uinteger(i.character)}e.is=n})(Un||(Un={}));(function(e){function t(r,i,s,a){if(U.uinteger(r)&&U.uinteger(i)&&U.uinteger(s)&&U.uinteger(a))return{start:Un.create(r,i),end:Un.create(s,a)};if(Un.is(r)&&Un.is(i))return{start:r,end:i};throw new Error(`Range#create called with invalid arguments[${r}, ${i}, ${s}, ${a}]`)}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&Un.is(i.start)&&Un.is(i.end)}e.is=n})(Qt||(Qt={}));(function(e){function t(r,i){return{uri:r,range:i}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&Qt.is(i.range)&&(U.string(i.uri)||U.undefined(i.uri))}e.is=n})(lo||(lo={}));(function(e){function t(r,i,s,a){return{targetUri:r,targetRange:i,targetSelectionRange:s,originSelectionRange:a}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&Qt.is(i.targetRange)&&U.string(i.targetUri)&&Qt.is(i.targetSelectionRange)&&(Qt.is(i.originSelectionRange)||U.undefined(i.originSelectionRange))}e.is=n})(Qc||(Qc={}));(function(e){function t(r,i,s,a){return{red:r,green:i,blue:s,alpha:a}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&U.numberRange(i.red,0,1)&&U.numberRange(i.green,0,1)&&U.numberRange(i.blue,0,1)&&U.numberRange(i.alpha,0,1)}e.is=n})(ls||(ls={}));(function(e){function t(r,i){return{range:r,color:i}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&Qt.is(i.range)&&ls.is(i.color)}e.is=n})(Jc||(Jc={}));(function(e){function t(r,i,s){return{label:r,textEdit:i,additionalTextEdits:s}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&U.string(i.label)&&(U.undefined(i.textEdit)||fi.is(i))&&(U.undefined(i.additionalTextEdits)||U.typedArray(i.additionalTextEdits,fi.is))}e.is=n})(Yc||(Yc={}));(function(e){e.Comment="comment",e.Imports="imports",e.Region="region"})(Zc||(Zc={}));(function(e){function t(r,i,s,a,p,u){let f={startLine:r,endLine:i};return U.defined(s)&&(f.startCharacter=s),U.defined(a)&&(f.endCharacter=a),U.defined(p)&&(f.kind=p),U.defined(u)&&(f.collapsedText=u),f}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&U.uinteger(i.startLine)&&U.uinteger(i.startLine)&&(U.undefined(i.startCharacter)||U.uinteger(i.startCharacter))&&(U.undefined(i.endCharacter)||U.uinteger(i.endCharacter))&&(U.undefined(i.kind)||U.string(i.kind))}e.is=n})(el||(el={}));(function(e){function t(r,i){return{location:r,message:i}}e.create=t;function n(r){let i=r;return U.defined(i)&&lo.is(i.location)&&U.string(i.message)}e.is=n})(us||(us={}));(function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4})(tl||(tl={}));(function(e){e.Unnecessary=1,e.Deprecated=2})(nl||(nl={}));(function(e){function t(n){let r=n;return U.objectLiteral(r)&&U.string(r.href)}e.is=t})(il||(il={}));(function(e){function t(r,i,s,a,p,u){let f={range:r,message:i};return U.defined(s)&&(f.severity=s),U.defined(a)&&(f.code=a),U.defined(p)&&(f.source=p),U.defined(u)&&(f.relatedInformation=u),f}e.create=t;function n(r){var i;let s=r;return U.defined(s)&&Qt.is(s.range)&&U.string(s.message)&&(U.number(s.severity)||U.undefined(s.severity))&&(U.integer(s.code)||U.string(s.code)||U.undefined(s.code))&&(U.undefined(s.codeDescription)||U.string((i=s.codeDescription)===null||i===void 0?void 0:i.href))&&(U.string(s.source)||U.undefined(s.source))&&(U.undefined(s.relatedInformation)||U.typedArray(s.relatedInformation,us.is))}e.is=n})(uo||(uo={}));(function(e){function t(r,i,...s){let a={title:r,command:i};return U.defined(s)&&s.length>0&&(a.arguments=s),a}e.create=t;function n(r){let i=r;return U.defined(i)&&U.string(i.title)&&U.string(i.command)}e.is=n})(er||(er={}));(function(e){function t(s,a){return{range:s,newText:a}}e.replace=t;function n(s,a){return{range:{start:s,end:s},newText:a}}e.insert=n;function r(s){return{range:s,newText:""}}e.del=r;function i(s){let a=s;return U.objectLiteral(a)&&U.string(a.newText)&&Qt.is(a.range)}e.is=i})(fi||(fi={}));(function(e){function t(r,i,s){let a={label:r};return i!==void 0&&(a.needsConfirmation=i),s!==void 0&&(a.description=s),a}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&U.string(i.label)&&(U.boolean(i.needsConfirmation)||i.needsConfirmation===void 0)&&(U.string(i.description)||i.description===void 0)}e.is=n})(Zi||(Zi={}));(function(e){function t(n){let r=n;return U.string(r)}e.is=t})(bn||(bn={}));(function(e){function t(s,a,p){return{range:s,newText:a,annotationId:p}}e.replace=t;function n(s,a,p){return{range:{start:s,end:s},newText:a,annotationId:p}}e.insert=n;function r(s,a){return{range:s,newText:"",annotationId:a}}e.del=r;function i(s){let a=s;return fi.is(a)&&(Zi.is(a.annotationId)||bn.is(a.annotationId))}e.is=i})(vi||(vi={}));(function(e){function t(r,i){return{textDocument:r,edits:i}}e.create=t;function n(r){let i=r;return U.defined(i)&&po.is(i.textDocument)&&Array.isArray(i.edits)}e.is=n})(fo||(fo={}));(function(e){function t(r,i,s){let a={kind:"create",uri:r};return i!==void 0&&(i.overwrite!==void 0||i.ignoreIfExists!==void 0)&&(a.options=i),s!==void 0&&(a.annotationId=s),a}e.create=t;function n(r){let i=r;return i&&i.kind==="create"&&U.string(i.uri)&&(i.options===void 0||(i.options.overwrite===void 0||U.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||U.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||bn.is(i.annotationId))}e.is=n})(xr||(xr={}));(function(e){function t(r,i,s,a){let p={kind:"rename",oldUri:r,newUri:i};return s!==void 0&&(s.overwrite!==void 0||s.ignoreIfExists!==void 0)&&(p.options=s),a!==void 0&&(p.annotationId=a),p}e.create=t;function n(r){let i=r;return i&&i.kind==="rename"&&U.string(i.oldUri)&&U.string(i.newUri)&&(i.options===void 0||(i.options.overwrite===void 0||U.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||U.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||bn.is(i.annotationId))}e.is=n})(Cr||(Cr={}));(function(e){function t(r,i,s){let a={kind:"delete",uri:r};return i!==void 0&&(i.recursive!==void 0||i.ignoreIfNotExists!==void 0)&&(a.options=i),s!==void 0&&(a.annotationId=s),a}e.create=t;function n(r){let i=r;return i&&i.kind==="delete"&&U.string(i.uri)&&(i.options===void 0||(i.options.recursive===void 0||U.boolean(i.options.recursive))&&(i.options.ignoreIfNotExists===void 0||U.boolean(i.options.ignoreIfNotExists)))&&(i.annotationId===void 0||bn.is(i.annotationId))}e.is=n})(Dr||(Dr={}));(function(e){function t(n){let r=n;return r&&(r.changes!==void 0||r.documentChanges!==void 0)&&(r.documentChanges===void 0||r.documentChanges.every(i=>U.string(i.kind)?xr.is(i)||Cr.is(i)||Dr.is(i):fo.is(i)))}e.is=t})(fs||(fs={}));Rr=class{constructor(t,n){this.edits=t,this.changeAnnotations=n}insert(t,n,r){let i,s;if(r===void 0?i=fi.insert(t,n):bn.is(r)?(s=r,i=vi.insert(t,n,r)):(this.assertChangeAnnotations(this.changeAnnotations),s=this.changeAnnotations.manage(r),i=vi.insert(t,n,s)),this.edits.push(i),s!==void 0)return s}replace(t,n,r){let i,s;if(r===void 0?i=fi.replace(t,n):bn.is(r)?(s=r,i=vi.replace(t,n,r)):(this.assertChangeAnnotations(this.changeAnnotations),s=this.changeAnnotations.manage(r),i=vi.replace(t,n,s)),this.edits.push(i),s!==void 0)return s}delete(t,n){let r,i;if(n===void 0?r=fi.del(t):bn.is(n)?(i=n,r=vi.del(t,n)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(n),r=vi.del(t,i)),this.edits.push(r),i!==void 0)return i}add(t){this.edits.push(t)}all(){return this.edits}clear(){this.edits.splice(0,this.edits.length)}assertChangeAnnotations(t){if(t===void 0)throw new Error("Text edit change is not configured to manage change annotations.")}},ds=class{constructor(t){this._annotations=t===void 0?Object.create(null):t,this._counter=0,this._size=0}all(){return this._annotations}get size(){return this._size}manage(t,n){let r;if(bn.is(t)?r=t:(r=this.nextId(),n=t),this._annotations[r]!==void 0)throw new Error(`Id ${r} is already in use.`);if(n===void 0)throw new Error(`No annotation provided for id ${r}`);return this._annotations[r]=n,this._size++,r}nextId(){return this._counter++,this._counter.toString()}},rl=class{constructor(t){this._textEditChanges=Object.create(null),t!==void 0?(this._workspaceEdit=t,t.documentChanges?(this._changeAnnotations=new ds(t.changeAnnotations),t.changeAnnotations=this._changeAnnotations.all(),t.documentChanges.forEach(n=>{if(fo.is(n)){let r=new Rr(n.edits,this._changeAnnotations);this._textEditChanges[n.textDocument.uri]=r}})):t.changes&&Object.keys(t.changes).forEach(n=>{let r=new Rr(t.changes[n]);this._textEditChanges[n]=r})):this._workspaceEdit={}}get edit(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit}getTextEditChange(t){if(po.is(t)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");let n={uri:t.uri,version:t.version},r=this._textEditChanges[n.uri];if(!r){let i=[],s={textDocument:n,edits:i};this._workspaceEdit.documentChanges.push(s),r=new Rr(i,this._changeAnnotations),this._textEditChanges[n.uri]=r}return r}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");let n=this._textEditChanges[t];if(!n){let r=[];this._workspaceEdit.changes[t]=r,n=new Rr(r),this._textEditChanges[t]=n}return n}}initDocumentChanges(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new ds,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())}initChanges(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))}createFile(t,n,r){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");let i;Zi.is(n)||bn.is(n)?i=n:r=n;let s,a;if(i===void 0?s=xr.create(t,r):(a=bn.is(i)?i:this._changeAnnotations.manage(i),s=xr.create(t,r,a)),this._workspaceEdit.documentChanges.push(s),a!==void 0)return a}renameFile(t,n,r,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");let s;Zi.is(r)||bn.is(r)?s=r:i=r;let a,p;if(s===void 0?a=Cr.create(t,n,i):(p=bn.is(s)?s:this._changeAnnotations.manage(s),a=Cr.create(t,n,i,p)),this._workspaceEdit.documentChanges.push(a),p!==void 0)return p}deleteFile(t,n,r){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");let i;Zi.is(n)||bn.is(n)?i=n:r=n;let s,a;if(i===void 0?s=Dr.create(t,r):(a=bn.is(i)?i:this._changeAnnotations.manage(i),s=Dr.create(t,r,a)),this._workspaceEdit.documentChanges.push(s),a!==void 0)return a}};(function(e){function t(r){return{uri:r}}e.create=t;function n(r){let i=r;return U.defined(i)&&U.string(i.uri)}e.is=n})(ol||(ol={}));(function(e){function t(r,i){return{uri:r,version:i}}e.create=t;function n(r){let i=r;return U.defined(i)&&U.string(i.uri)&&U.integer(i.version)}e.is=n})(sl||(sl={}));(function(e){function t(r,i){return{uri:r,version:i}}e.create=t;function n(r){let i=r;return U.defined(i)&&U.string(i.uri)&&(i.version===null||U.integer(i.version))}e.is=n})(po||(po={}));(function(e){function t(r,i,s,a){return{uri:r,languageId:i,version:s,text:a}}e.create=t;function n(r){let i=r;return U.defined(i)&&U.string(i.uri)&&U.string(i.languageId)&&U.integer(i.version)&&U.string(i.text)}e.is=n})(al||(al={}));(function(e){e.PlainText="plaintext",e.Markdown="markdown";function t(n){let r=n;return r===e.PlainText||r===e.Markdown}e.is=t})(ps||(ps={}));(function(e){function t(n){let r=n;return U.objectLiteral(n)&&ps.is(r.kind)&&U.string(r.value)}e.is=t})(Sr||(Sr={}));(function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25})(Bn||(Bn={}));(function(e){e.PlainText=1,e.Snippet=2})(Ki||(Ki={}));(function(e){e.Deprecated=1})(cl||(cl={}));(function(e){function t(r,i,s){return{newText:r,insert:i,replace:s}}e.create=t;function n(r){let i=r;return i&&U.string(i.newText)&&Qt.is(i.insert)&&Qt.is(i.replace)}e.is=n})(ll||(ll={}));(function(e){e.asIs=1,e.adjustIndentation=2})(ul||(ul={}));(function(e){function t(n){let r=n;return r&&(U.string(r.detail)||r.detail===void 0)&&(U.string(r.description)||r.description===void 0)}e.is=t})(fl||(fl={}));(function(e){function t(n){return{label:n}}e.create=t})(dl||(dl={}));(function(e){function t(n,r){return{items:n||[],isIncomplete:!!r}}e.create=t})(pl||(pl={}));(function(e){function t(r){return r.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}e.fromPlainText=t;function n(r){let i=r;return U.string(i)||U.objectLiteral(i)&&U.string(i.language)&&U.string(i.value)}e.is=n})(ho||(ho={}));(function(e){function t(n){let r=n;return!!r&&U.objectLiteral(r)&&(Sr.is(r.contents)||ho.is(r.contents)||U.typedArray(r.contents,ho.is))&&(n.range===void 0||Qt.is(n.range))}e.is=t})(hl||(hl={}));(function(e){function t(n,r){return r?{label:n,documentation:r}:{label:n}}e.create=t})(gl||(gl={}));(function(e){function t(n,r,...i){let s={label:n};return U.defined(r)&&(s.documentation=r),U.defined(i)?s.parameters=i:s.parameters=[],s}e.create=t})(ml||(ml={}));(function(e){e.Text=1,e.Read=2,e.Write=3})(_l||(_l={}));(function(e){function t(n,r){let i={range:n};return U.number(r)&&(i.kind=r),i}e.create=t})(bl||(bl={}));(function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26})(go||(go={}));(function(e){e.Deprecated=1})(yl||(yl={}));(function(e){function t(n,r,i,s,a){let p={name:n,kind:r,location:{uri:s,range:i}};return a&&(p.containerName=a),p}e.create=t})(kl||(kl={}));(function(e){function t(n,r,i,s){return s!==void 0?{name:n,kind:r,location:{uri:i,range:s}}:{name:n,kind:r,location:{uri:i}}}e.create=t})(vl||(vl={}));(function(e){function t(r,i,s,a,p,u){let f={name:r,detail:i,kind:s,range:a,selectionRange:p};return u!==void 0&&(f.children=u),f}e.create=t;function n(r){let i=r;return i&&U.string(i.name)&&U.number(i.kind)&&Qt.is(i.range)&&Qt.is(i.selectionRange)&&(i.detail===void 0||U.string(i.detail))&&(i.deprecated===void 0||U.boolean(i.deprecated))&&(i.children===void 0||Array.isArray(i.children))&&(i.tags===void 0||Array.isArray(i.tags))}e.is=n})(Tl||(Tl={}));(function(e){e.Empty="",e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports",e.SourceFixAll="source.fixAll"})(wl||(wl={}));(function(e){e.Invoked=1,e.Automatic=2})(mo||(mo={}));(function(e){function t(r,i,s){let a={diagnostics:r};return i!=null&&(a.only=i),s!=null&&(a.triggerKind=s),a}e.create=t;function n(r){let i=r;return U.defined(i)&&U.typedArray(i.diagnostics,uo.is)&&(i.only===void 0||U.typedArray(i.only,U.string))&&(i.triggerKind===void 0||i.triggerKind===mo.Invoked||i.triggerKind===mo.Automatic)}e.is=n})(Rl||(Rl={}));(function(e){function t(r,i,s){let a={title:r},p=!0;return typeof i=="string"?(p=!1,a.kind=i):er.is(i)?a.command=i:a.edit=i,p&&s!==void 0&&(a.kind=s),a}e.create=t;function n(r){let i=r;return i&&U.string(i.title)&&(i.diagnostics===void 0||U.typedArray(i.diagnostics,uo.is))&&(i.kind===void 0||U.string(i.kind))&&(i.edit!==void 0||i.command!==void 0)&&(i.command===void 0||er.is(i.command))&&(i.isPreferred===void 0||U.boolean(i.isPreferred))&&(i.edit===void 0||fs.is(i.edit))}e.is=n})(xl||(xl={}));(function(e){function t(r,i){let s={range:r};return U.defined(i)&&(s.data=i),s}e.create=t;function n(r){let i=r;return U.defined(i)&&Qt.is(i.range)&&(U.undefined(i.command)||er.is(i.command))}e.is=n})(Cl||(Cl={}));(function(e){function t(r,i){return{tabSize:r,insertSpaces:i}}e.create=t;function n(r){let i=r;return U.defined(i)&&U.uinteger(i.tabSize)&&U.boolean(i.insertSpaces)}e.is=n})(Dl||(Dl={}));(function(e){function t(r,i,s){return{range:r,target:i,data:s}}e.create=t;function n(r){let i=r;return U.defined(i)&&Qt.is(i.range)&&(U.undefined(i.target)||U.string(i.target))}e.is=n})(Sl||(Sl={}));(function(e){function t(r,i){return{range:r,parent:i}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&Qt.is(i.range)&&(i.parent===void 0||e.is(i.parent))}e.is=n})(El||(El={}));(function(e){e.namespace="namespace",e.type="type",e.class="class",e.enum="enum",e.interface="interface",e.struct="struct",e.typeParameter="typeParameter",e.parameter="parameter",e.variable="variable",e.property="property",e.enumMember="enumMember",e.event="event",e.function="function",e.method="method",e.macro="macro",e.keyword="keyword",e.modifier="modifier",e.comment="comment",e.string="string",e.number="number",e.regexp="regexp",e.operator="operator",e.decorator="decorator"})(Pl||(Pl={}));(function(e){e.declaration="declaration",e.definition="definition",e.readonly="readonly",e.static="static",e.deprecated="deprecated",e.abstract="abstract",e.async="async",e.modification="modification",e.documentation="documentation",e.defaultLibrary="defaultLibrary"})(Ol||(Ol={}));(function(e){function t(n){let r=n;return U.objectLiteral(r)&&(r.resultId===void 0||typeof r.resultId=="string")&&Array.isArray(r.data)&&(r.data.length===0||typeof r.data[0]=="number")}e.is=t})(Al||(Al={}));(function(e){function t(r,i){return{range:r,text:i}}e.create=t;function n(r){let i=r;return i!=null&&Qt.is(i.range)&&U.string(i.text)}e.is=n})(Nl||(Nl={}));(function(e){function t(r,i,s){return{range:r,variableName:i,caseSensitiveLookup:s}}e.create=t;function n(r){let i=r;return i!=null&&Qt.is(i.range)&&U.boolean(i.caseSensitiveLookup)&&(U.string(i.variableName)||i.variableName===void 0)}e.is=n})(Ml||(Ml={}));(function(e){function t(r,i){return{range:r,expression:i}}e.create=t;function n(r){let i=r;return i!=null&&Qt.is(i.range)&&(U.string(i.expression)||i.expression===void 0)}e.is=n})(Ll||(Ll={}));(function(e){function t(r,i){return{frameId:r,stoppedLocation:i}}e.create=t;function n(r){let i=r;return U.defined(i)&&Qt.is(r.stoppedLocation)}e.is=n})(Fl||(Fl={}));(function(e){e.Type=1,e.Parameter=2;function t(n){return n===1||n===2}e.is=t})(hs||(hs={}));(function(e){function t(r){return{value:r}}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&(i.tooltip===void 0||U.string(i.tooltip)||Sr.is(i.tooltip))&&(i.location===void 0||lo.is(i.location))&&(i.command===void 0||er.is(i.command))}e.is=n})(gs||(gs={}));(function(e){function t(r,i,s){let a={position:r,label:i};return s!==void 0&&(a.kind=s),a}e.create=t;function n(r){let i=r;return U.objectLiteral(i)&&Un.is(i.position)&&(U.string(i.label)||U.typedArray(i.label,gs.is))&&(i.kind===void 0||hs.is(i.kind))&&i.textEdits===void 0||U.typedArray(i.textEdits,fi.is)&&(i.tooltip===void 0||U.string(i.tooltip)||Sr.is(i.tooltip))&&(i.paddingLeft===void 0||U.boolean(i.paddingLeft))&&(i.paddingRight===void 0||U.boolean(i.paddingRight))}e.is=n})(Kl||(Kl={}));(function(e){function t(n){return{kind:"snippet",value:n}}e.createSnippet=t})(ql||(ql={}));(function(e){function t(n,r,i,s){return{insertText:n,filterText:r,range:i,command:s}}e.create=t})(jl||(jl={}));(function(e){function t(n){return{items:n}}e.create=t})($l||($l={}));(function(e){e.Invoked=0,e.Automatic=1})(Wl||(Wl={}));(function(e){function t(n,r){return{range:n,text:r}}e.create=t})(Il||(Il={}));(function(e){function t(n,r){return{triggerKind:n,selectedCompletionInfo:r}}e.create=t})(Vl||(Vl={}));(function(e){function t(n){let r=n;return U.objectLiteral(r)&&cs.is(r.uri)&&U.string(r.name)}e.is=t})(Ul||(Ul={}));k_=[`
`,`\r
`,"\r"];(function(e){function t(s,a,p,u){return new Hl(s,a,p,u)}e.create=t;function n(s){let a=s;return!!(U.defined(a)&&U.string(a.uri)&&(U.undefined(a.languageId)||U.string(a.languageId))&&U.uinteger(a.lineCount)&&U.func(a.getText)&&U.func(a.positionAt)&&U.func(a.offsetAt))}e.is=n;function r(s,a){let p=s.getText(),u=i(a,(c,m)=>{let y=c.range.start.line-m.range.start.line;return y===0?c.range.start.character-m.range.start.character:y}),f=p.length;for(let c=u.length-1;c>=0;c--){let m=u[c],y=s.offsetAt(m.range.start),h=s.offsetAt(m.range.end);if(h<=f)p=p.substring(0,y)+m.newText+p.substring(h,p.length);else throw new Error("Overlapping edit");f=y}return p}e.applyEdits=r;function i(s,a){if(s.length<=1)return s;let p=s.length/2|0,u=s.slice(0,p),f=s.slice(p);i(u,a),i(f,a);let c=0,m=0,y=0;for(;c<u.length&&m<f.length;)a(u[c],f[m])<=0?s[y++]=u[c++]:s[y++]=f[m++];for(;c<u.length;)s[y++]=u[c++];for(;m<f.length;)s[y++]=f[m++];return s}})(Bl||(Bl={}));Hl=class{constructor(t,n,r,i){this._uri=t,this._languageId=n,this._version=r,this._content=i,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(t){if(t){let n=this.offsetAt(t.start),r=this.offsetAt(t.end);return this._content.substring(n,r)}return this._content}update(t,n){this._content=t.text,this._version=n,this._lineOffsets=void 0}getLineOffsets(){if(this._lineOffsets===void 0){let t=[],n=this._content,r=!0;for(let i=0;i<n.length;i++){r&&(t.push(i),r=!1);let s=n.charAt(i);r=s==="\r"||s===`
`,s==="\r"&&i+1<n.length&&n.charAt(i+1)===`
`&&i++}r&&n.length>0&&t.push(n.length),this._lineOffsets=t}return this._lineOffsets}positionAt(t){t=Math.max(Math.min(t,this._content.length),0);let n=this.getLineOffsets(),r=0,i=n.length;if(i===0)return Un.create(0,t);for(;r<i;){let a=Math.floor((r+i)/2);n[a]>t?i=a:r=a+1}let s=r-1;return Un.create(s,t-n[s])}offsetAt(t){let n=this.getLineOffsets();if(t.line>=n.length)return this._content.length;if(t.line<0)return 0;let r=n[t.line],i=t.line+1<n.length?n[t.line+1]:this._content.length;return Math.max(Math.min(r+t.character,i),r)}get lineCount(){return this.getLineOffsets().length}};(function(e){let t=Object.prototype.toString;function n(h){return typeof h<"u"}e.defined=n;function r(h){return typeof h>"u"}e.undefined=r;function i(h){return h===!0||h===!1}e.boolean=i;function s(h){return t.call(h)==="[object String]"}e.string=s;function a(h){return t.call(h)==="[object Number]"}e.number=a;function p(h,C,F){return t.call(h)==="[object Number]"&&C<=h&&h<=F}e.numberRange=p;function u(h){return t.call(h)==="[object Number]"&&-2147483648<=h&&h<=2147483647}e.integer=u;function f(h){return t.call(h)==="[object Number]"&&0<=h&&h<=2147483647}e.uinteger=f;function c(h){return t.call(h)==="[object Function]"}e.func=c;function m(h){return h!==null&&typeof h=="object"}e.objectLiteral=m;function y(h,C){return Array.isArray(h)&&h.every(C)}e.typedArray=y})(U||(U={}))});var Jt=Ue(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.ProtocolNotificationType=Mn.ProtocolNotificationType0=Mn.ProtocolRequestType=Mn.ProtocolRequestType0=Mn.RegistrationType=Mn.MessageDirection=void 0;var Er=Fi(),Mf;(function(e){e.clientToServer="clientToServer",e.serverToClient="serverToClient",e.both="both"})(Mf||(Mn.MessageDirection=Mf={}));var zl=class{constructor(t){this.method=t}};Mn.RegistrationType=zl;var Gl=class extends Er.RequestType0{constructor(t){super(t)}};Mn.ProtocolRequestType0=Gl;var Xl=class extends Er.RequestType{constructor(t){super(t,Er.ParameterStructures.byName)}};Mn.ProtocolRequestType=Xl;var Ql=class extends Er.NotificationType0{constructor(t){super(t)}};Mn.ProtocolNotificationType0=Ql;var Jl=class extends Er.NotificationType{constructor(t){super(t,Er.ParameterStructures.byName)}};Mn.ProtocolNotificationType=Jl});var _s=Ue(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.objectLiteral=cn.typedArray=cn.stringArray=cn.array=cn.func=cn.error=cn.number=cn.string=cn.boolean=void 0;function v_(e){return e===!0||e===!1}cn.boolean=v_;function Lf(e){return typeof e=="string"||e instanceof String}cn.string=Lf;function T_(e){return typeof e=="number"||e instanceof Number}cn.number=T_;function w_(e){return e instanceof Error}cn.error=w_;function R_(e){return typeof e=="function"}cn.func=R_;function Ff(e){return Array.isArray(e)}cn.array=Ff;function x_(e){return Ff(e)&&e.every(t=>Lf(t))}cn.stringArray=x_;function C_(e,t){return Array.isArray(e)&&e.every(t)}cn.typedArray=C_;function D_(e){return e!==null&&typeof e=="object"}cn.objectLiteral=D_});var jf=Ue(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});bs.ImplementationRequest=void 0;var Kf=Jt(),qf;(function(e){e.method="textDocument/implementation",e.messageDirection=Kf.MessageDirection.clientToServer,e.type=new Kf.ProtocolRequestType(e.method)})(qf||(bs.ImplementationRequest=qf={}))});var If=Ue(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});ys.TypeDefinitionRequest=void 0;var $f=Jt(),Wf;(function(e){e.method="textDocument/typeDefinition",e.messageDirection=$f.MessageDirection.clientToServer,e.type=new $f.ProtocolRequestType(e.method)})(Wf||(ys.TypeDefinitionRequest=Wf={}))});var Bf=Ue(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.DidChangeWorkspaceFoldersNotification=Pr.WorkspaceFoldersRequest=void 0;var ks=Jt(),Vf;(function(e){e.method="workspace/workspaceFolders",e.messageDirection=ks.MessageDirection.serverToClient,e.type=new ks.ProtocolRequestType0(e.method)})(Vf||(Pr.WorkspaceFoldersRequest=Vf={}));var Uf;(function(e){e.method="workspace/didChangeWorkspaceFolders",e.messageDirection=ks.MessageDirection.clientToServer,e.type=new ks.ProtocolNotificationType(e.method)})(Uf||(Pr.DidChangeWorkspaceFoldersNotification=Uf={}))});var Gf=Ue(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});vs.ConfigurationRequest=void 0;var Hf=Jt(),zf;(function(e){e.method="workspace/configuration",e.messageDirection=Hf.MessageDirection.serverToClient,e.type=new Hf.ProtocolRequestType(e.method)})(zf||(vs.ConfigurationRequest=zf={}))});var Jf=Ue(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.ColorPresentationRequest=Or.DocumentColorRequest=void 0;var Ts=Jt(),Xf;(function(e){e.method="textDocument/documentColor",e.messageDirection=Ts.MessageDirection.clientToServer,e.type=new Ts.ProtocolRequestType(e.method)})(Xf||(Or.DocumentColorRequest=Xf={}));var Qf;(function(e){e.method="textDocument/colorPresentation",e.messageDirection=Ts.MessageDirection.clientToServer,e.type=new Ts.ProtocolRequestType(e.method)})(Qf||(Or.ColorPresentationRequest=Qf={}))});var ed=Ue(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.FoldingRangeRefreshRequest=Ar.FoldingRangeRequest=void 0;var ws=Jt(),Yf;(function(e){e.method="textDocument/foldingRange",e.messageDirection=ws.MessageDirection.clientToServer,e.type=new ws.ProtocolRequestType(e.method)})(Yf||(Ar.FoldingRangeRequest=Yf={}));var Zf;(function(e){e.method="workspace/foldingRange/refresh",e.messageDirection=ws.MessageDirection.serverToClient,e.type=new ws.ProtocolRequestType0(e.method)})(Zf||(Ar.FoldingRangeRefreshRequest=Zf={}))});var id=Ue(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});Rs.DeclarationRequest=void 0;var td=Jt(),nd;(function(e){e.method="textDocument/declaration",e.messageDirection=td.MessageDirection.clientToServer,e.type=new td.ProtocolRequestType(e.method)})(nd||(Rs.DeclarationRequest=nd={}))});var sd=Ue(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});xs.SelectionRangeRequest=void 0;var rd=Jt(),od;(function(e){e.method="textDocument/selectionRange",e.messageDirection=rd.MessageDirection.clientToServer,e.type=new rd.ProtocolRequestType(e.method)})(od||(xs.SelectionRangeRequest=od={}))});var ud=Ue(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.WorkDoneProgressCancelNotification=qi.WorkDoneProgressCreateRequest=qi.WorkDoneProgress=void 0;var S_=Fi(),Cs=Jt(),ad;(function(e){e.type=new S_.ProgressType;function t(n){return n===e.type}e.is=t})(ad||(qi.WorkDoneProgress=ad={}));var cd;(function(e){e.method="window/workDoneProgress/create",e.messageDirection=Cs.MessageDirection.serverToClient,e.type=new Cs.ProtocolRequestType(e.method)})(cd||(qi.WorkDoneProgressCreateRequest=cd={}));var ld;(function(e){e.method="window/workDoneProgress/cancel",e.messageDirection=Cs.MessageDirection.clientToServer,e.type=new Cs.ProtocolNotificationType(e.method)})(ld||(qi.WorkDoneProgressCancelNotification=ld={}))});var hd=Ue(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.CallHierarchyOutgoingCallsRequest=ji.CallHierarchyIncomingCallsRequest=ji.CallHierarchyPrepareRequest=void 0;var Nr=Jt(),fd;(function(e){e.method="textDocument/prepareCallHierarchy",e.messageDirection=Nr.MessageDirection.clientToServer,e.type=new Nr.ProtocolRequestType(e.method)})(fd||(ji.CallHierarchyPrepareRequest=fd={}));var dd;(function(e){e.method="callHierarchy/incomingCalls",e.messageDirection=Nr.MessageDirection.clientToServer,e.type=new Nr.ProtocolRequestType(e.method)})(dd||(ji.CallHierarchyIncomingCallsRequest=dd={}));var pd;(function(e){e.method="callHierarchy/outgoingCalls",e.messageDirection=Nr.MessageDirection.clientToServer,e.type=new Nr.ProtocolRequestType(e.method)})(pd||(ji.CallHierarchyOutgoingCallsRequest=pd={}))});var kd=Ue(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.SemanticTokensRefreshRequest=Ln.SemanticTokensRangeRequest=Ln.SemanticTokensDeltaRequest=Ln.SemanticTokensRequest=Ln.SemanticTokensRegistrationType=Ln.TokenFormat=void 0;var Ti=Jt(),gd;(function(e){e.Relative="relative"})(gd||(Ln.TokenFormat=gd={}));var bo;(function(e){e.method="textDocument/semanticTokens",e.type=new Ti.RegistrationType(e.method)})(bo||(Ln.SemanticTokensRegistrationType=bo={}));var md;(function(e){e.method="textDocument/semanticTokens/full",e.messageDirection=Ti.MessageDirection.clientToServer,e.type=new Ti.ProtocolRequestType(e.method),e.registrationMethod=bo.method})(md||(Ln.SemanticTokensRequest=md={}));var _d;(function(e){e.method="textDocument/semanticTokens/full/delta",e.messageDirection=Ti.MessageDirection.clientToServer,e.type=new Ti.ProtocolRequestType(e.method),e.registrationMethod=bo.method})(_d||(Ln.SemanticTokensDeltaRequest=_d={}));var bd;(function(e){e.method="textDocument/semanticTokens/range",e.messageDirection=Ti.MessageDirection.clientToServer,e.type=new Ti.ProtocolRequestType(e.method),e.registrationMethod=bo.method})(bd||(Ln.SemanticTokensRangeRequest=bd={}));var yd;(function(e){e.method="workspace/semanticTokens/refresh",e.messageDirection=Ti.MessageDirection.serverToClient,e.type=new Ti.ProtocolRequestType0(e.method)})(yd||(Ln.SemanticTokensRefreshRequest=yd={}))});var wd=Ue(Ds=>{"use strict";Object.defineProperty(Ds,"__esModule",{value:!0});Ds.ShowDocumentRequest=void 0;var vd=Jt(),Td;(function(e){e.method="window/showDocument",e.messageDirection=vd.MessageDirection.serverToClient,e.type=new vd.ProtocolRequestType(e.method)})(Td||(Ds.ShowDocumentRequest=Td={}))});var Cd=Ue(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.LinkedEditingRangeRequest=void 0;var Rd=Jt(),xd;(function(e){e.method="textDocument/linkedEditingRange",e.messageDirection=Rd.MessageDirection.clientToServer,e.type=new Rd.ProtocolRequestType(e.method)})(xd||(Ss.LinkedEditingRangeRequest=xd={}))});var Md=Ue(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.WillDeleteFilesRequest=Rn.DidDeleteFilesNotification=Rn.DidRenameFilesNotification=Rn.WillRenameFilesRequest=Rn.DidCreateFilesNotification=Rn.WillCreateFilesRequest=Rn.FileOperationPatternKind=void 0;var Hn=Jt(),Dd;(function(e){e.file="file",e.folder="folder"})(Dd||(Rn.FileOperationPatternKind=Dd={}));var Sd;(function(e){e.method="workspace/willCreateFiles",e.messageDirection=Hn.MessageDirection.clientToServer,e.type=new Hn.ProtocolRequestType(e.method)})(Sd||(Rn.WillCreateFilesRequest=Sd={}));var Ed;(function(e){e.method="workspace/didCreateFiles",e.messageDirection=Hn.MessageDirection.clientToServer,e.type=new Hn.ProtocolNotificationType(e.method)})(Ed||(Rn.DidCreateFilesNotification=Ed={}));var Pd;(function(e){e.method="workspace/willRenameFiles",e.messageDirection=Hn.MessageDirection.clientToServer,e.type=new Hn.ProtocolRequestType(e.method)})(Pd||(Rn.WillRenameFilesRequest=Pd={}));var Od;(function(e){e.method="workspace/didRenameFiles",e.messageDirection=Hn.MessageDirection.clientToServer,e.type=new Hn.ProtocolNotificationType(e.method)})(Od||(Rn.DidRenameFilesNotification=Od={}));var Ad;(function(e){e.method="workspace/didDeleteFiles",e.messageDirection=Hn.MessageDirection.clientToServer,e.type=new Hn.ProtocolNotificationType(e.method)})(Ad||(Rn.DidDeleteFilesNotification=Ad={}));var Nd;(function(e){e.method="workspace/willDeleteFiles",e.messageDirection=Hn.MessageDirection.clientToServer,e.type=new Hn.ProtocolRequestType(e.method)})(Nd||(Rn.WillDeleteFilesRequest=Nd={}))});var jd=Ue($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.MonikerRequest=$i.MonikerKind=$i.UniquenessLevel=void 0;var Ld=Jt(),Fd;(function(e){e.document="document",e.project="project",e.group="group",e.scheme="scheme",e.global="global"})(Fd||($i.UniquenessLevel=Fd={}));var Kd;(function(e){e.$import="import",e.$export="export",e.local="local"})(Kd||($i.MonikerKind=Kd={}));var qd;(function(e){e.method="textDocument/moniker",e.messageDirection=Ld.MessageDirection.clientToServer,e.type=new Ld.ProtocolRequestType(e.method)})(qd||($i.MonikerRequest=qd={}))});var Vd=Ue(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0});Wi.TypeHierarchySubtypesRequest=Wi.TypeHierarchySupertypesRequest=Wi.TypeHierarchyPrepareRequest=void 0;var Mr=Jt(),$d;(function(e){e.method="textDocument/prepareTypeHierarchy",e.messageDirection=Mr.MessageDirection.clientToServer,e.type=new Mr.ProtocolRequestType(e.method)})($d||(Wi.TypeHierarchyPrepareRequest=$d={}));var Wd;(function(e){e.method="typeHierarchy/supertypes",e.messageDirection=Mr.MessageDirection.clientToServer,e.type=new Mr.ProtocolRequestType(e.method)})(Wd||(Wi.TypeHierarchySupertypesRequest=Wd={}));var Id;(function(e){e.method="typeHierarchy/subtypes",e.messageDirection=Mr.MessageDirection.clientToServer,e.type=new Mr.ProtocolRequestType(e.method)})(Id||(Wi.TypeHierarchySubtypesRequest=Id={}))});var Hd=Ue(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.InlineValueRefreshRequest=Lr.InlineValueRequest=void 0;var Es=Jt(),Ud;(function(e){e.method="textDocument/inlineValue",e.messageDirection=Es.MessageDirection.clientToServer,e.type=new Es.ProtocolRequestType(e.method)})(Ud||(Lr.InlineValueRequest=Ud={}));var Bd;(function(e){e.method="workspace/inlineValue/refresh",e.messageDirection=Es.MessageDirection.serverToClient,e.type=new Es.ProtocolRequestType0(e.method)})(Bd||(Lr.InlineValueRefreshRequest=Bd={}))});var Qd=Ue(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.InlayHintRefreshRequest=Ii.InlayHintResolveRequest=Ii.InlayHintRequest=void 0;var Fr=Jt(),zd;(function(e){e.method="textDocument/inlayHint",e.messageDirection=Fr.MessageDirection.clientToServer,e.type=new Fr.ProtocolRequestType(e.method)})(zd||(Ii.InlayHintRequest=zd={}));var Gd;(function(e){e.method="inlayHint/resolve",e.messageDirection=Fr.MessageDirection.clientToServer,e.type=new Fr.ProtocolRequestType(e.method)})(Gd||(Ii.InlayHintResolveRequest=Gd={}));var Xd;(function(e){e.method="workspace/inlayHint/refresh",e.messageDirection=Fr.MessageDirection.serverToClient,e.type=new Fr.ProtocolRequestType0(e.method)})(Xd||(Ii.InlayHintRefreshRequest=Xd={}))});var ip=Ue(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.DiagnosticRefreshRequest=zn.WorkspaceDiagnosticRequest=zn.DocumentDiagnosticRequest=zn.DocumentDiagnosticReportKind=zn.DiagnosticServerCancellationData=void 0;var np=Fi(),E_=_s(),Kr=Jt(),Jd;(function(e){function t(n){let r=n;return r&&E_.boolean(r.retriggerRequest)}e.is=t})(Jd||(zn.DiagnosticServerCancellationData=Jd={}));var Yd;(function(e){e.Full="full",e.Unchanged="unchanged"})(Yd||(zn.DocumentDiagnosticReportKind=Yd={}));var Zd;(function(e){e.method="textDocument/diagnostic",e.messageDirection=Kr.MessageDirection.clientToServer,e.type=new Kr.ProtocolRequestType(e.method),e.partialResult=new np.ProgressType})(Zd||(zn.DocumentDiagnosticRequest=Zd={}));var ep;(function(e){e.method="workspace/diagnostic",e.messageDirection=Kr.MessageDirection.clientToServer,e.type=new Kr.ProtocolRequestType(e.method),e.partialResult=new np.ProgressType})(ep||(zn.WorkspaceDiagnosticRequest=ep={}));var tp;(function(e){e.method="workspace/diagnostic/refresh",e.messageDirection=Kr.MessageDirection.serverToClient,e.type=new Kr.ProtocolRequestType0(e.method)})(tp||(zn.DiagnosticRefreshRequest=tp={}))});var up=Ue(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.DidCloseNotebookDocumentNotification=rn.DidSaveNotebookDocumentNotification=rn.DidChangeNotebookDocumentNotification=rn.NotebookCellArrayChange=rn.DidOpenNotebookDocumentNotification=rn.NotebookDocumentSyncRegistrationType=rn.NotebookDocument=rn.NotebookCell=rn.ExecutionSummary=rn.NotebookCellKind=void 0;var yo=(_o(),Ka(ms)),oi=_s(),di=Jt(),Yl;(function(e){e.Markup=1,e.Code=2;function t(n){return n===1||n===2}e.is=t})(Yl||(rn.NotebookCellKind=Yl={}));var Zl;(function(e){function t(i,s){let a={executionOrder:i};return(s===!0||s===!1)&&(a.success=s),a}e.create=t;function n(i){let s=i;return oi.objectLiteral(s)&&yo.uinteger.is(s.executionOrder)&&(s.success===void 0||oi.boolean(s.success))}e.is=n;function r(i,s){return i===s?!0:i==null||s===null||s===void 0?!1:i.executionOrder===s.executionOrder&&i.success===s.success}e.equals=r})(Zl||(rn.ExecutionSummary=Zl={}));var Ps;(function(e){function t(s,a){return{kind:s,document:a}}e.create=t;function n(s){let a=s;return oi.objectLiteral(a)&&Yl.is(a.kind)&&yo.DocumentUri.is(a.document)&&(a.metadata===void 0||oi.objectLiteral(a.metadata))}e.is=n;function r(s,a){let p=new Set;return s.document!==a.document&&p.add("document"),s.kind!==a.kind&&p.add("kind"),s.executionSummary!==a.executionSummary&&p.add("executionSummary"),(s.metadata!==void 0||a.metadata!==void 0)&&!i(s.metadata,a.metadata)&&p.add("metadata"),(s.executionSummary!==void 0||a.executionSummary!==void 0)&&!Zl.equals(s.executionSummary,a.executionSummary)&&p.add("executionSummary"),p}e.diff=r;function i(s,a){if(s===a)return!0;if(s==null||a===null||a===void 0||typeof s!=typeof a||typeof s!="object")return!1;let p=Array.isArray(s),u=Array.isArray(a);if(p!==u)return!1;if(p&&u){if(s.length!==a.length)return!1;for(let f=0;f<s.length;f++)if(!i(s[f],a[f]))return!1}if(oi.objectLiteral(s)&&oi.objectLiteral(a)){let f=Object.keys(s),c=Object.keys(a);if(f.length!==c.length||(f.sort(),c.sort(),!i(f,c)))return!1;for(let m=0;m<f.length;m++){let y=f[m];if(!i(s[y],a[y]))return!1}}return!0}})(Ps||(rn.NotebookCell=Ps={}));var rp;(function(e){function t(r,i,s,a){return{uri:r,notebookType:i,version:s,cells:a}}e.create=t;function n(r){let i=r;return oi.objectLiteral(i)&&oi.string(i.uri)&&yo.integer.is(i.version)&&oi.typedArray(i.cells,Ps.is)}e.is=n})(rp||(rn.NotebookDocument=rp={}));var qr;(function(e){e.method="notebookDocument/sync",e.messageDirection=di.MessageDirection.clientToServer,e.type=new di.RegistrationType(e.method)})(qr||(rn.NotebookDocumentSyncRegistrationType=qr={}));var op;(function(e){e.method="notebookDocument/didOpen",e.messageDirection=di.MessageDirection.clientToServer,e.type=new di.ProtocolNotificationType(e.method),e.registrationMethod=qr.method})(op||(rn.DidOpenNotebookDocumentNotification=op={}));var sp;(function(e){function t(r){let i=r;return oi.objectLiteral(i)&&yo.uinteger.is(i.start)&&yo.uinteger.is(i.deleteCount)&&(i.cells===void 0||oi.typedArray(i.cells,Ps.is))}e.is=t;function n(r,i,s){let a={start:r,deleteCount:i};return s!==void 0&&(a.cells=s),a}e.create=n})(sp||(rn.NotebookCellArrayChange=sp={}));var ap;(function(e){e.method="notebookDocument/didChange",e.messageDirection=di.MessageDirection.clientToServer,e.type=new di.ProtocolNotificationType(e.method),e.registrationMethod=qr.method})(ap||(rn.DidChangeNotebookDocumentNotification=ap={}));var cp;(function(e){e.method="notebookDocument/didSave",e.messageDirection=di.MessageDirection.clientToServer,e.type=new di.ProtocolNotificationType(e.method),e.registrationMethod=qr.method})(cp||(rn.DidSaveNotebookDocumentNotification=cp={}));var lp;(function(e){e.method="notebookDocument/didClose",e.messageDirection=di.MessageDirection.clientToServer,e.type=new di.ProtocolNotificationType(e.method),e.registrationMethod=qr.method})(lp||(rn.DidCloseNotebookDocumentNotification=lp={}))});var pp=Ue(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.InlineCompletionRequest=void 0;var fp=Jt(),dp;(function(e){e.method="textDocument/inlineCompletion",e.messageDirection=fp.MessageDirection.clientToServer,e.type=new fp.ProtocolRequestType(e.method)})(dp||(Os.InlineCompletionRequest=dp={}))});var Ch=Ue(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.WorkspaceSymbolRequest=x.CodeActionResolveRequest=x.CodeActionRequest=x.DocumentSymbolRequest=x.DocumentHighlightRequest=x.ReferencesRequest=x.DefinitionRequest=x.SignatureHelpRequest=x.SignatureHelpTriggerKind=x.HoverRequest=x.CompletionResolveRequest=x.CompletionRequest=x.CompletionTriggerKind=x.PublishDiagnosticsNotification=x.WatchKind=x.RelativePattern=x.FileChangeType=x.DidChangeWatchedFilesNotification=x.WillSaveTextDocumentWaitUntilRequest=x.WillSaveTextDocumentNotification=x.TextDocumentSaveReason=x.DidSaveTextDocumentNotification=x.DidCloseTextDocumentNotification=x.DidChangeTextDocumentNotification=x.TextDocumentContentChangeEvent=x.DidOpenTextDocumentNotification=x.TextDocumentSyncKind=x.TelemetryEventNotification=x.LogMessageNotification=x.ShowMessageRequest=x.ShowMessageNotification=x.MessageType=x.DidChangeConfigurationNotification=x.ExitNotification=x.ShutdownRequest=x.InitializedNotification=x.InitializeErrorCodes=x.InitializeRequest=x.WorkDoneProgressOptions=x.TextDocumentRegistrationOptions=x.StaticRegistrationOptions=x.PositionEncodingKind=x.FailureHandlingKind=x.ResourceOperationKind=x.UnregistrationRequest=x.RegistrationRequest=x.DocumentSelector=x.NotebookCellTextDocumentFilter=x.NotebookDocumentFilter=x.TextDocumentFilter=void 0;x.MonikerRequest=x.MonikerKind=x.UniquenessLevel=x.WillDeleteFilesRequest=x.DidDeleteFilesNotification=x.WillRenameFilesRequest=x.DidRenameFilesNotification=x.WillCreateFilesRequest=x.DidCreateFilesNotification=x.FileOperationPatternKind=x.LinkedEditingRangeRequest=x.ShowDocumentRequest=x.SemanticTokensRegistrationType=x.SemanticTokensRefreshRequest=x.SemanticTokensRangeRequest=x.SemanticTokensDeltaRequest=x.SemanticTokensRequest=x.TokenFormat=x.CallHierarchyPrepareRequest=x.CallHierarchyOutgoingCallsRequest=x.CallHierarchyIncomingCallsRequest=x.WorkDoneProgressCancelNotification=x.WorkDoneProgressCreateRequest=x.WorkDoneProgress=x.SelectionRangeRequest=x.DeclarationRequest=x.FoldingRangeRefreshRequest=x.FoldingRangeRequest=x.ColorPresentationRequest=x.DocumentColorRequest=x.ConfigurationRequest=x.DidChangeWorkspaceFoldersNotification=x.WorkspaceFoldersRequest=x.TypeDefinitionRequest=x.ImplementationRequest=x.ApplyWorkspaceEditRequest=x.ExecuteCommandRequest=x.PrepareRenameRequest=x.RenameRequest=x.PrepareSupportDefaultBehavior=x.DocumentOnTypeFormattingRequest=x.DocumentRangesFormattingRequest=x.DocumentRangeFormattingRequest=x.DocumentFormattingRequest=x.DocumentLinkResolveRequest=x.DocumentLinkRequest=x.CodeLensRefreshRequest=x.CodeLensResolveRequest=x.CodeLensRequest=x.WorkspaceSymbolResolveRequest=void 0;x.InlineCompletionRequest=x.DidCloseNotebookDocumentNotification=x.DidSaveNotebookDocumentNotification=x.DidChangeNotebookDocumentNotification=x.NotebookCellArrayChange=x.DidOpenNotebookDocumentNotification=x.NotebookDocumentSyncRegistrationType=x.NotebookDocument=x.NotebookCell=x.ExecutionSummary=x.NotebookCellKind=x.DiagnosticRefreshRequest=x.WorkspaceDiagnosticRequest=x.DocumentDiagnosticRequest=x.DocumentDiagnosticReportKind=x.DiagnosticServerCancellationData=x.InlayHintRefreshRequest=x.InlayHintResolveRequest=x.InlayHintRequest=x.InlineValueRefreshRequest=x.InlineValueRequest=x.TypeHierarchySupertypesRequest=x.TypeHierarchySubtypesRequest=x.TypeHierarchyPrepareRequest=void 0;var Ce=Jt(),hp=(_o(),Ka(ms)),pn=_s(),P_=jf();Object.defineProperty(x,"ImplementationRequest",{enumerable:!0,get:function(){return P_.ImplementationRequest}});var O_=If();Object.defineProperty(x,"TypeDefinitionRequest",{enumerable:!0,get:function(){return O_.TypeDefinitionRequest}});var Th=Bf();Object.defineProperty(x,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return Th.WorkspaceFoldersRequest}});Object.defineProperty(x,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return Th.DidChangeWorkspaceFoldersNotification}});var A_=Gf();Object.defineProperty(x,"ConfigurationRequest",{enumerable:!0,get:function(){return A_.ConfigurationRequest}});var wh=Jf();Object.defineProperty(x,"DocumentColorRequest",{enumerable:!0,get:function(){return wh.DocumentColorRequest}});Object.defineProperty(x,"ColorPresentationRequest",{enumerable:!0,get:function(){return wh.ColorPresentationRequest}});var Rh=ed();Object.defineProperty(x,"FoldingRangeRequest",{enumerable:!0,get:function(){return Rh.FoldingRangeRequest}});Object.defineProperty(x,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return Rh.FoldingRangeRefreshRequest}});var N_=id();Object.defineProperty(x,"DeclarationRequest",{enumerable:!0,get:function(){return N_.DeclarationRequest}});var M_=sd();Object.defineProperty(x,"SelectionRangeRequest",{enumerable:!0,get:function(){return M_.SelectionRangeRequest}});var ru=ud();Object.defineProperty(x,"WorkDoneProgress",{enumerable:!0,get:function(){return ru.WorkDoneProgress}});Object.defineProperty(x,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return ru.WorkDoneProgressCreateRequest}});Object.defineProperty(x,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return ru.WorkDoneProgressCancelNotification}});var ou=hd();Object.defineProperty(x,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return ou.CallHierarchyIncomingCallsRequest}});Object.defineProperty(x,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return ou.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(x,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return ou.CallHierarchyPrepareRequest}});var jr=kd();Object.defineProperty(x,"TokenFormat",{enumerable:!0,get:function(){return jr.TokenFormat}});Object.defineProperty(x,"SemanticTokensRequest",{enumerable:!0,get:function(){return jr.SemanticTokensRequest}});Object.defineProperty(x,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return jr.SemanticTokensDeltaRequest}});Object.defineProperty(x,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return jr.SemanticTokensRangeRequest}});Object.defineProperty(x,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return jr.SemanticTokensRefreshRequest}});Object.defineProperty(x,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return jr.SemanticTokensRegistrationType}});var L_=wd();Object.defineProperty(x,"ShowDocumentRequest",{enumerable:!0,get:function(){return L_.ShowDocumentRequest}});var F_=Cd();Object.defineProperty(x,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return F_.LinkedEditingRangeRequest}});var tr=Md();Object.defineProperty(x,"FileOperationPatternKind",{enumerable:!0,get:function(){return tr.FileOperationPatternKind}});Object.defineProperty(x,"DidCreateFilesNotification",{enumerable:!0,get:function(){return tr.DidCreateFilesNotification}});Object.defineProperty(x,"WillCreateFilesRequest",{enumerable:!0,get:function(){return tr.WillCreateFilesRequest}});Object.defineProperty(x,"DidRenameFilesNotification",{enumerable:!0,get:function(){return tr.DidRenameFilesNotification}});Object.defineProperty(x,"WillRenameFilesRequest",{enumerable:!0,get:function(){return tr.WillRenameFilesRequest}});Object.defineProperty(x,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return tr.DidDeleteFilesNotification}});Object.defineProperty(x,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return tr.WillDeleteFilesRequest}});var su=jd();Object.defineProperty(x,"UniquenessLevel",{enumerable:!0,get:function(){return su.UniquenessLevel}});Object.defineProperty(x,"MonikerKind",{enumerable:!0,get:function(){return su.MonikerKind}});Object.defineProperty(x,"MonikerRequest",{enumerable:!0,get:function(){return su.MonikerRequest}});var au=Vd();Object.defineProperty(x,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return au.TypeHierarchyPrepareRequest}});Object.defineProperty(x,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return au.TypeHierarchySubtypesRequest}});Object.defineProperty(x,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return au.TypeHierarchySupertypesRequest}});var xh=Hd();Object.defineProperty(x,"InlineValueRequest",{enumerable:!0,get:function(){return xh.InlineValueRequest}});Object.defineProperty(x,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return xh.InlineValueRefreshRequest}});var cu=Qd();Object.defineProperty(x,"InlayHintRequest",{enumerable:!0,get:function(){return cu.InlayHintRequest}});Object.defineProperty(x,"InlayHintResolveRequest",{enumerable:!0,get:function(){return cu.InlayHintResolveRequest}});Object.defineProperty(x,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return cu.InlayHintRefreshRequest}});var ko=ip();Object.defineProperty(x,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return ko.DiagnosticServerCancellationData}});Object.defineProperty(x,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return ko.DocumentDiagnosticReportKind}});Object.defineProperty(x,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return ko.DocumentDiagnosticRequest}});Object.defineProperty(x,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return ko.WorkspaceDiagnosticRequest}});Object.defineProperty(x,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return ko.DiagnosticRefreshRequest}});var pi=up();Object.defineProperty(x,"NotebookCellKind",{enumerable:!0,get:function(){return pi.NotebookCellKind}});Object.defineProperty(x,"ExecutionSummary",{enumerable:!0,get:function(){return pi.ExecutionSummary}});Object.defineProperty(x,"NotebookCell",{enumerable:!0,get:function(){return pi.NotebookCell}});Object.defineProperty(x,"NotebookDocument",{enumerable:!0,get:function(){return pi.NotebookDocument}});Object.defineProperty(x,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return pi.NotebookDocumentSyncRegistrationType}});Object.defineProperty(x,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return pi.DidOpenNotebookDocumentNotification}});Object.defineProperty(x,"NotebookCellArrayChange",{enumerable:!0,get:function(){return pi.NotebookCellArrayChange}});Object.defineProperty(x,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return pi.DidChangeNotebookDocumentNotification}});Object.defineProperty(x,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return pi.DidSaveNotebookDocumentNotification}});Object.defineProperty(x,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return pi.DidCloseNotebookDocumentNotification}});var K_=pp();Object.defineProperty(x,"InlineCompletionRequest",{enumerable:!0,get:function(){return K_.InlineCompletionRequest}});var eu;(function(e){function t(n){let r=n;return pn.string(r)||pn.string(r.language)||pn.string(r.scheme)||pn.string(r.pattern)}e.is=t})(eu||(x.TextDocumentFilter=eu={}));var tu;(function(e){function t(n){let r=n;return pn.objectLiteral(r)&&(pn.string(r.notebookType)||pn.string(r.scheme)||pn.string(r.pattern))}e.is=t})(tu||(x.NotebookDocumentFilter=tu={}));var nu;(function(e){function t(n){let r=n;return pn.objectLiteral(r)&&(pn.string(r.notebook)||tu.is(r.notebook))&&(r.language===void 0||pn.string(r.language))}e.is=t})(nu||(x.NotebookCellTextDocumentFilter=nu={}));var iu;(function(e){function t(n){if(!Array.isArray(n))return!1;for(let r of n)if(!pn.string(r)&&!eu.is(r)&&!nu.is(r))return!1;return!0}e.is=t})(iu||(x.DocumentSelector=iu={}));var gp;(function(e){e.method="client/registerCapability",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolRequestType(e.method)})(gp||(x.RegistrationRequest=gp={}));var mp;(function(e){e.method="client/unregisterCapability",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolRequestType(e.method)})(mp||(x.UnregistrationRequest=mp={}));var _p;(function(e){e.Create="create",e.Rename="rename",e.Delete="delete"})(_p||(x.ResourceOperationKind=_p={}));var bp;(function(e){e.Abort="abort",e.Transactional="transactional",e.TextOnlyTransactional="textOnlyTransactional",e.Undo="undo"})(bp||(x.FailureHandlingKind=bp={}));var yp;(function(e){e.UTF8="utf-8",e.UTF16="utf-16",e.UTF32="utf-32"})(yp||(x.PositionEncodingKind=yp={}));var kp;(function(e){function t(n){let r=n;return r&&pn.string(r.id)&&r.id.length>0}e.hasId=t})(kp||(x.StaticRegistrationOptions=kp={}));var vp;(function(e){function t(n){let r=n;return r&&(r.documentSelector===null||iu.is(r.documentSelector))}e.is=t})(vp||(x.TextDocumentRegistrationOptions=vp={}));var Tp;(function(e){function t(r){let i=r;return pn.objectLiteral(i)&&(i.workDoneProgress===void 0||pn.boolean(i.workDoneProgress))}e.is=t;function n(r){let i=r;return i&&pn.boolean(i.workDoneProgress)}e.hasWorkDoneProgress=n})(Tp||(x.WorkDoneProgressOptions=Tp={}));var wp;(function(e){e.method="initialize",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(wp||(x.InitializeRequest=wp={}));var Rp;(function(e){e.unknownProtocolVersion=1})(Rp||(x.InitializeErrorCodes=Rp={}));var xp;(function(e){e.method="initialized",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(xp||(x.InitializedNotification=xp={}));var Cp;(function(e){e.method="shutdown",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType0(e.method)})(Cp||(x.ShutdownRequest=Cp={}));var Dp;(function(e){e.method="exit",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType0(e.method)})(Dp||(x.ExitNotification=Dp={}));var Sp;(function(e){e.method="workspace/didChangeConfiguration",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(Sp||(x.DidChangeConfigurationNotification=Sp={}));var Ep;(function(e){e.Error=1,e.Warning=2,e.Info=3,e.Log=4,e.Debug=5})(Ep||(x.MessageType=Ep={}));var Pp;(function(e){e.method="window/showMessage",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolNotificationType(e.method)})(Pp||(x.ShowMessageNotification=Pp={}));var Op;(function(e){e.method="window/showMessageRequest",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolRequestType(e.method)})(Op||(x.ShowMessageRequest=Op={}));var Ap;(function(e){e.method="window/logMessage",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolNotificationType(e.method)})(Ap||(x.LogMessageNotification=Ap={}));var Np;(function(e){e.method="telemetry/event",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolNotificationType(e.method)})(Np||(x.TelemetryEventNotification=Np={}));var Mp;(function(e){e.None=0,e.Full=1,e.Incremental=2})(Mp||(x.TextDocumentSyncKind=Mp={}));var Lp;(function(e){e.method="textDocument/didOpen",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(Lp||(x.DidOpenTextDocumentNotification=Lp={}));var Fp;(function(e){function t(r){let i=r;return i!=null&&typeof i.text=="string"&&i.range!==void 0&&(i.rangeLength===void 0||typeof i.rangeLength=="number")}e.isIncremental=t;function n(r){let i=r;return i!=null&&typeof i.text=="string"&&i.range===void 0&&i.rangeLength===void 0}e.isFull=n})(Fp||(x.TextDocumentContentChangeEvent=Fp={}));var Kp;(function(e){e.method="textDocument/didChange",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(Kp||(x.DidChangeTextDocumentNotification=Kp={}));var qp;(function(e){e.method="textDocument/didClose",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(qp||(x.DidCloseTextDocumentNotification=qp={}));var jp;(function(e){e.method="textDocument/didSave",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(jp||(x.DidSaveTextDocumentNotification=jp={}));var $p;(function(e){e.Manual=1,e.AfterDelay=2,e.FocusOut=3})($p||(x.TextDocumentSaveReason=$p={}));var Wp;(function(e){e.method="textDocument/willSave",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(Wp||(x.WillSaveTextDocumentNotification=Wp={}));var Ip;(function(e){e.method="textDocument/willSaveWaitUntil",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(Ip||(x.WillSaveTextDocumentWaitUntilRequest=Ip={}));var Vp;(function(e){e.method="workspace/didChangeWatchedFiles",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolNotificationType(e.method)})(Vp||(x.DidChangeWatchedFilesNotification=Vp={}));var Up;(function(e){e.Created=1,e.Changed=2,e.Deleted=3})(Up||(x.FileChangeType=Up={}));var Bp;(function(e){function t(n){let r=n;return pn.objectLiteral(r)&&(hp.URI.is(r.baseUri)||hp.WorkspaceFolder.is(r.baseUri))&&pn.string(r.pattern)}e.is=t})(Bp||(x.RelativePattern=Bp={}));var Hp;(function(e){e.Create=1,e.Change=2,e.Delete=4})(Hp||(x.WatchKind=Hp={}));var zp;(function(e){e.method="textDocument/publishDiagnostics",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolNotificationType(e.method)})(zp||(x.PublishDiagnosticsNotification=zp={}));var Gp;(function(e){e.Invoked=1,e.TriggerCharacter=2,e.TriggerForIncompleteCompletions=3})(Gp||(x.CompletionTriggerKind=Gp={}));var Xp;(function(e){e.method="textDocument/completion",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(Xp||(x.CompletionRequest=Xp={}));var Qp;(function(e){e.method="completionItem/resolve",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(Qp||(x.CompletionResolveRequest=Qp={}));var Jp;(function(e){e.method="textDocument/hover",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(Jp||(x.HoverRequest=Jp={}));var Yp;(function(e){e.Invoked=1,e.TriggerCharacter=2,e.ContentChange=3})(Yp||(x.SignatureHelpTriggerKind=Yp={}));var Zp;(function(e){e.method="textDocument/signatureHelp",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(Zp||(x.SignatureHelpRequest=Zp={}));var eh;(function(e){e.method="textDocument/definition",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(eh||(x.DefinitionRequest=eh={}));var th;(function(e){e.method="textDocument/references",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(th||(x.ReferencesRequest=th={}));var nh;(function(e){e.method="textDocument/documentHighlight",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(nh||(x.DocumentHighlightRequest=nh={}));var ih;(function(e){e.method="textDocument/documentSymbol",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(ih||(x.DocumentSymbolRequest=ih={}));var rh;(function(e){e.method="textDocument/codeAction",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(rh||(x.CodeActionRequest=rh={}));var oh;(function(e){e.method="codeAction/resolve",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(oh||(x.CodeActionResolveRequest=oh={}));var sh;(function(e){e.method="workspace/symbol",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(sh||(x.WorkspaceSymbolRequest=sh={}));var ah;(function(e){e.method="workspaceSymbol/resolve",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(ah||(x.WorkspaceSymbolResolveRequest=ah={}));var ch;(function(e){e.method="textDocument/codeLens",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(ch||(x.CodeLensRequest=ch={}));var lh;(function(e){e.method="codeLens/resolve",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(lh||(x.CodeLensResolveRequest=lh={}));var uh;(function(e){e.method="workspace/codeLens/refresh",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolRequestType0(e.method)})(uh||(x.CodeLensRefreshRequest=uh={}));var fh;(function(e){e.method="textDocument/documentLink",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(fh||(x.DocumentLinkRequest=fh={}));var dh;(function(e){e.method="documentLink/resolve",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(dh||(x.DocumentLinkResolveRequest=dh={}));var ph;(function(e){e.method="textDocument/formatting",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(ph||(x.DocumentFormattingRequest=ph={}));var hh;(function(e){e.method="textDocument/rangeFormatting",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(hh||(x.DocumentRangeFormattingRequest=hh={}));var gh;(function(e){e.method="textDocument/rangesFormatting",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(gh||(x.DocumentRangesFormattingRequest=gh={}));var mh;(function(e){e.method="textDocument/onTypeFormatting",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(mh||(x.DocumentOnTypeFormattingRequest=mh={}));var _h;(function(e){e.Identifier=1})(_h||(x.PrepareSupportDefaultBehavior=_h={}));var bh;(function(e){e.method="textDocument/rename",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(bh||(x.RenameRequest=bh={}));var yh;(function(e){e.method="textDocument/prepareRename",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(yh||(x.PrepareRenameRequest=yh={}));var kh;(function(e){e.method="workspace/executeCommand",e.messageDirection=Ce.MessageDirection.clientToServer,e.type=new Ce.ProtocolRequestType(e.method)})(kh||(x.ExecuteCommandRequest=kh={}));var vh;(function(e){e.method="workspace/applyEdit",e.messageDirection=Ce.MessageDirection.serverToClient,e.type=new Ce.ProtocolRequestType("workspace/applyEdit")})(vh||(x.ApplyWorkspaceEditRequest=vh={}))});var Sh=Ue(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.createProtocolConnection=void 0;var Dh=Fi();function q_(e,t,n,r){return Dh.ConnectionStrategy.is(r)&&(r={connectionStrategy:r}),(0,Dh.createMessageConnection)(e,t,n,r)}As.createProtocolConnection=q_});var Ph=Ue(Fn=>{"use strict";var j_=Fn&&Fn.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Ns=Fn&&Fn.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&j_(t,e,n)};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.LSPErrorCodes=Fn.createProtocolConnection=void 0;Ns(Fi(),Fn);Ns((_o(),Ka(ms)),Fn);Ns(Jt(),Fn);Ns(Ch(),Fn);var $_=Sh();Object.defineProperty(Fn,"createProtocolConnection",{enumerable:!0,get:function(){return $_.createProtocolConnection}});var Eh;(function(e){e.lspReservedErrorRangeStart=-32899,e.RequestFailed=-32803,e.ServerCancelled=-32802,e.ContentModified=-32801,e.RequestCancelled=-32800,e.lspReservedErrorRangeEnd=-32800})(Eh||(Fn.LSPErrorCodes=Eh={}))});var on=Ue(hi=>{"use strict";var W_=hi&&hi.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Oh=hi&&hi.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&W_(t,e,n)};Object.defineProperty(hi,"__esModule",{value:!0});hi.createProtocolConnection=void 0;var I_=zc();Oh(zc(),hi);Oh(Ph(),hi);function V_(e,t,n,r){return(0,I_.createMessageConnection)(e,t,n,r)}hi.createProtocolConnection=V_});var uu=Ue(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.SemanticTokensBuilder=Vi.SemanticTokensDiff=Vi.SemanticTokensFeature=void 0;var Ms=on(),U_=e=>class extends e{get semanticTokens(){return{refresh:()=>this.connection.sendRequest(Ms.SemanticTokensRefreshRequest.type),on:t=>{let n=Ms.SemanticTokensRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))},onDelta:t=>{let n=Ms.SemanticTokensDeltaRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))},onRange:t=>{let n=Ms.SemanticTokensRangeRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))}}}};Vi.SemanticTokensFeature=U_;var Ls=class{constructor(t,n){this.originalSequence=t,this.modifiedSequence=n}computeDiff(){let t=this.originalSequence.length,n=this.modifiedSequence.length,r=0;for(;r<n&&r<t&&this.originalSequence[r]===this.modifiedSequence[r];)r++;if(r<n&&r<t){let i=t-1,s=n-1;for(;i>=r&&s>=r&&this.originalSequence[i]===this.modifiedSequence[s];)i--,s--;(i<r||s<r)&&(i++,s++);let a=i-r+1,p=this.modifiedSequence.slice(r,s+1);return p.length===1&&p[0]===this.originalSequence[i]?[{start:r,deleteCount:a-1}]:[{start:r,deleteCount:a,data:p}]}else return r<n?[{start:r,deleteCount:0,data:this.modifiedSequence.slice(r)}]:r<t?[{start:r,deleteCount:t-r}]:[]}};Vi.SemanticTokensDiff=Ls;var lu=class{constructor(){this._prevData=void 0,this.initialize()}initialize(){this._id=Date.now(),this._prevLine=0,this._prevChar=0,this._data=[],this._dataLen=0}push(t,n,r,i,s){let a=t,p=n;this._dataLen>0&&(a-=this._prevLine,a===0&&(p-=this._prevChar)),this._data[this._dataLen++]=a,this._data[this._dataLen++]=p,this._data[this._dataLen++]=r,this._data[this._dataLen++]=i,this._data[this._dataLen++]=s,this._prevLine=t,this._prevChar=n}get id(){return this._id.toString()}previousResult(t){this.id===t&&(this._prevData=this._data),this.initialize()}build(){return this._prevData=void 0,{resultId:this.id,data:this._data}}canBuildEdits(){return this._prevData!==void 0}buildEdits(){return this._prevData!==void 0?{resultId:this.id,edits:new Ls(this._prevData,this._data).computeDiff()}:this.build()}};Vi.SemanticTokensBuilder=lu});var Ah=Ue(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.InlineCompletionFeature=void 0;var B_=on(),H_=e=>class extends e{get inlineCompletion(){return{on:t=>this.connection.onRequest(B_.InlineCompletionRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n)))}}};Fs.InlineCompletionFeature=H_});var du=Ue(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});Ks.TextDocuments=void 0;var nr=on(),fu=class{constructor(t){this._configuration=t,this._syncedDocuments=new Map,this._onDidChangeContent=new nr.Emitter,this._onDidOpen=new nr.Emitter,this._onDidClose=new nr.Emitter,this._onDidSave=new nr.Emitter,this._onWillSave=new nr.Emitter}get onDidOpen(){return this._onDidOpen.event}get onDidChangeContent(){return this._onDidChangeContent.event}get onWillSave(){return this._onWillSave.event}onWillSaveWaitUntil(t){this._willSaveWaitUntil=t}get onDidSave(){return this._onDidSave.event}get onDidClose(){return this._onDidClose.event}get(t){return this._syncedDocuments.get(t)}all(){return Array.from(this._syncedDocuments.values())}keys(){return Array.from(this._syncedDocuments.keys())}listen(t){t.__textDocumentSync=nr.TextDocumentSyncKind.Incremental;let n=[];return n.push(t.onDidOpenTextDocument(r=>{let i=r.textDocument,s=this._configuration.create(i.uri,i.languageId,i.version,i.text);this._syncedDocuments.set(i.uri,s);let a=Object.freeze({document:s});this._onDidOpen.fire(a),this._onDidChangeContent.fire(a)})),n.push(t.onDidChangeTextDocument(r=>{let i=r.textDocument,s=r.contentChanges;if(s.length===0)return;let{version:a}=i;if(a==null)throw new Error(`Received document change event for ${i.uri} without valid version identifier`);let p=this._syncedDocuments.get(i.uri);p!==void 0&&(p=this._configuration.update(p,s,a),this._syncedDocuments.set(i.uri,p),this._onDidChangeContent.fire(Object.freeze({document:p})))})),n.push(t.onDidCloseTextDocument(r=>{let i=this._syncedDocuments.get(r.textDocument.uri);i!==void 0&&(this._syncedDocuments.delete(r.textDocument.uri),this._onDidClose.fire(Object.freeze({document:i})))})),n.push(t.onWillSaveTextDocument(r=>{let i=this._syncedDocuments.get(r.textDocument.uri);i!==void 0&&this._onWillSave.fire(Object.freeze({document:i,reason:r.reason}))})),n.push(t.onWillSaveTextDocumentWaitUntil((r,i)=>{let s=this._syncedDocuments.get(r.textDocument.uri);return s!==void 0&&this._willSaveWaitUntil?this._willSaveWaitUntil(Object.freeze({document:s,reason:r.reason}),i):[]})),n.push(t.onDidSaveTextDocument(r=>{let i=this._syncedDocuments.get(r.textDocument.uri);i!==void 0&&this._onDidSave.fire(Object.freeze({document:i}))})),nr.Disposable.create(()=>{n.forEach(r=>r.dispose())})}};Ks.TextDocuments=fu});var hu=Ue($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.NotebookDocuments=$r.NotebookSyncFeature=void 0;var Gn=on(),Nh=du(),z_=e=>class extends e{get synchronization(){return{onDidOpenNotebookDocument:t=>this.connection.onNotification(Gn.DidOpenNotebookDocumentNotification.type,n=>{t(n)}),onDidChangeNotebookDocument:t=>this.connection.onNotification(Gn.DidChangeNotebookDocumentNotification.type,n=>{t(n)}),onDidSaveNotebookDocument:t=>this.connection.onNotification(Gn.DidSaveNotebookDocumentNotification.type,n=>{t(n)}),onDidCloseNotebookDocument:t=>this.connection.onNotification(Gn.DidCloseNotebookDocumentNotification.type,n=>{t(n)})}}};$r.NotebookSyncFeature=z_;var qs=class e{onDidOpenTextDocument(t){return this.openHandler=t,Gn.Disposable.create(()=>{this.openHandler=void 0})}openTextDocument(t){this.openHandler&&this.openHandler(t)}onDidChangeTextDocument(t){return this.changeHandler=t,Gn.Disposable.create(()=>{this.changeHandler=t})}changeTextDocument(t){this.changeHandler&&this.changeHandler(t)}onDidCloseTextDocument(t){return this.closeHandler=t,Gn.Disposable.create(()=>{this.closeHandler=void 0})}closeTextDocument(t){this.closeHandler&&this.closeHandler(t)}onWillSaveTextDocument(){return e.NULL_DISPOSE}onWillSaveTextDocumentWaitUntil(){return e.NULL_DISPOSE}onDidSaveTextDocument(){return e.NULL_DISPOSE}};qs.NULL_DISPOSE=Object.freeze({dispose:()=>{}});var pu=class{constructor(t){t instanceof Nh.TextDocuments?this._cellTextDocuments=t:this._cellTextDocuments=new Nh.TextDocuments(t),this.notebookDocuments=new Map,this.notebookCellMap=new Map,this._onDidOpen=new Gn.Emitter,this._onDidChange=new Gn.Emitter,this._onDidSave=new Gn.Emitter,this._onDidClose=new Gn.Emitter}get cellTextDocuments(){return this._cellTextDocuments}getCellTextDocument(t){return this._cellTextDocuments.get(t.document)}getNotebookDocument(t){return this.notebookDocuments.get(t)}getNotebookCell(t){let n=this.notebookCellMap.get(t);return n&&n[0]}findNotebookDocumentForCell(t){let n=typeof t=="string"?t:t.document,r=this.notebookCellMap.get(n);return r&&r[1]}get onDidOpen(){return this._onDidOpen.event}get onDidSave(){return this._onDidSave.event}get onDidChange(){return this._onDidChange.event}get onDidClose(){return this._onDidClose.event}listen(t){let n=new qs,r=[];return r.push(this.cellTextDocuments.listen(n)),r.push(t.notebooks.synchronization.onDidOpenNotebookDocument(i=>{this.notebookDocuments.set(i.notebookDocument.uri,i.notebookDocument);for(let s of i.cellTextDocuments)n.openTextDocument({textDocument:s});this.updateCellMap(i.notebookDocument),this._onDidOpen.fire(i.notebookDocument)})),r.push(t.notebooks.synchronization.onDidChangeNotebookDocument(i=>{let s=this.notebookDocuments.get(i.notebookDocument.uri);if(s===void 0)return;s.version=i.notebookDocument.version;let a=s.metadata,p=!1,u=i.change;u.metadata!==void 0&&(p=!0,s.metadata=u.metadata);let f=[],c=[],m=[],y=[];if(u.cells!==void 0){let R=u.cells;if(R.structure!==void 0){let g=R.structure.array;if(s.cells.splice(g.start,g.deleteCount,...g.cells!==void 0?g.cells:[]),R.structure.didOpen!==void 0)for(let b of R.structure.didOpen)n.openTextDocument({textDocument:b}),f.push(b.uri);if(R.structure.didClose)for(let b of R.structure.didClose)n.closeTextDocument({textDocument:b}),c.push(b.uri)}if(R.data!==void 0){let g=new Map(R.data.map(b=>[b.document,b]));for(let b=0;b<=s.cells.length;b++){let d=g.get(s.cells[b].document);if(d!==void 0){let X=s.cells.splice(b,1,d);if(m.push({old:X[0],new:d}),g.delete(d.document),g.size===0)break}}}if(R.textContent!==void 0)for(let g of R.textContent)n.changeTextDocument({textDocument:g.document,contentChanges:g.changes}),y.push(g.document.uri)}this.updateCellMap(s);let h={notebookDocument:s};p&&(h.metadata={old:a,new:s.metadata});let C=[];for(let R of f)C.push(this.getNotebookCell(R));let F=[];for(let R of c)F.push(this.getNotebookCell(R));let ne=[];for(let R of y)ne.push(this.getNotebookCell(R));(C.length>0||F.length>0||m.length>0||ne.length>0)&&(h.cells={added:C,removed:F,changed:{data:m,textContent:ne}}),(h.metadata!==void 0||h.cells!==void 0)&&this._onDidChange.fire(h)})),r.push(t.notebooks.synchronization.onDidSaveNotebookDocument(i=>{let s=this.notebookDocuments.get(i.notebookDocument.uri);s!==void 0&&this._onDidSave.fire(s)})),r.push(t.notebooks.synchronization.onDidCloseNotebookDocument(i=>{let s=this.notebookDocuments.get(i.notebookDocument.uri);if(s!==void 0){this._onDidClose.fire(s);for(let a of i.cellTextDocuments)n.closeTextDocument({textDocument:a});this.notebookDocuments.delete(i.notebookDocument.uri);for(let a of s.cells)this.notebookCellMap.delete(a.document)}})),Gn.Disposable.create(()=>{r.forEach(i=>i.dispose())})}updateCellMap(t){for(let n of t.cells)this.notebookCellMap.set(n.document,[n,t])}};$r.NotebookDocuments=pu});var gu=Ue(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.thenable=ln.typedArray=ln.stringArray=ln.array=ln.func=ln.error=ln.number=ln.string=ln.boolean=void 0;function G_(e){return e===!0||e===!1}ln.boolean=G_;function Mh(e){return typeof e=="string"||e instanceof String}ln.string=Mh;function X_(e){return typeof e=="number"||e instanceof Number}ln.number=X_;function Q_(e){return e instanceof Error}ln.error=Q_;function Lh(e){return typeof e=="function"}ln.func=Lh;function Fh(e){return Array.isArray(e)}ln.array=Fh;function J_(e){return Fh(e)&&e.every(t=>Mh(t))}ln.stringArray=J_;function Y_(e,t){return Array.isArray(e)&&e.every(t)}ln.typedArray=Y_;function Z_(e){return e&&Lh(e.then)}ln.thenable=Z_});var mu=Ue(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.generateUuid=Xn.parse=Xn.isUUID=Xn.v4=Xn.empty=void 0;var vo=class{constructor(t){this._value=t}asHex(){return this._value}equals(t){return this.asHex()===t.asHex()}},To=class e extends vo{static _oneOf(t){return t[Math.floor(t.length*Math.random())]}static _randomHex(){return e._oneOf(e._chars)}constructor(){super([e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),"-",e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),"-","4",e._randomHex(),e._randomHex(),e._randomHex(),"-",e._oneOf(e._timeHighBits),e._randomHex(),e._randomHex(),e._randomHex(),"-",e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex()].join(""))}};To._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];To._timeHighBits=["8","9","a","b"];Xn.empty=new vo("00000000-0000-0000-0000-000000000000");function Kh(){return new To}Xn.v4=Kh;var eb=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function qh(e){return eb.test(e)}Xn.isUUID=qh;function tb(e){if(!qh(e))throw new Error("invalid uuid");return new vo(e)}Xn.parse=tb;function nb(){return Kh().asHex()}Xn.generateUuid=nb});var jh=Ue(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.attachPartialResult=Bi.ProgressFeature=Bi.attachWorkDone=void 0;var Ui=on(),ib=mu(),ir=class e{constructor(t,n){this._connection=t,this._token=n,e.Instances.set(this._token,this)}begin(t,n,r,i){let s={kind:"begin",title:t,percentage:n,message:r,cancellable:i};this._connection.sendProgress(Ui.WorkDoneProgress.type,this._token,s)}report(t,n){let r={kind:"report"};typeof t=="number"?(r.percentage=t,n!==void 0&&(r.message=n)):r.message=t,this._connection.sendProgress(Ui.WorkDoneProgress.type,this._token,r)}done(){e.Instances.delete(this._token),this._connection.sendProgress(Ui.WorkDoneProgress.type,this._token,{kind:"end"})}};ir.Instances=new Map;var js=class extends ir{constructor(t,n){super(t,n),this._source=new Ui.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose(),super.done()}cancel(){this._source.cancel()}},wo=class{constructor(){}begin(){}report(){}done(){}},$s=class extends wo{constructor(){super(),this._source=new Ui.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose()}cancel(){this._source.cancel()}};function rb(e,t){if(t===void 0||t.workDoneToken===void 0)return new wo;let n=t.workDoneToken;return delete t.workDoneToken,new ir(e,n)}Bi.attachWorkDone=rb;var ob=e=>class extends e{constructor(){super(),this._progressSupported=!1}initialize(t){super.initialize(t),t?.window?.workDoneProgress===!0&&(this._progressSupported=!0,this.connection.onNotification(Ui.WorkDoneProgressCancelNotification.type,n=>{let r=ir.Instances.get(n.token);(r instanceof js||r instanceof $s)&&r.cancel()}))}attachWorkDoneProgress(t){return t===void 0?new wo:new ir(this.connection,t)}createWorkDoneProgress(){if(this._progressSupported){let t=(0,ib.generateUuid)();return this.connection.sendRequest(Ui.WorkDoneProgressCreateRequest.type,{token:t}).then(()=>new js(this.connection,t))}else return Promise.resolve(new $s)}};Bi.ProgressFeature=ob;var _u;(function(e){e.type=new Ui.ProgressType})(_u||(_u={}));var bu=class{constructor(t,n){this._connection=t,this._token=n}report(t){this._connection.sendProgress(_u.type,this._token,t)}};function sb(e,t){if(t===void 0||t.partialResultToken===void 0)return;let n=t.partialResultToken;return delete t.partialResultToken,new bu(e,n)}Bi.attachPartialResult=sb});var $h=Ue(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});Ws.ConfigurationFeature=void 0;var ab=on(),cb=gu(),lb=e=>class extends e{getConfiguration(t){return t?cb.string(t)?this._getConfiguration({section:t}):this._getConfiguration(t):this._getConfiguration({})}_getConfiguration(t){let n={items:Array.isArray(t)?t:[t]};return this.connection.sendRequest(ab.ConfigurationRequest.type,n).then(r=>Array.isArray(r)?Array.isArray(t)?r:r[0]:Array.isArray(t)?[]:null)}};Ws.ConfigurationFeature=lb});var Wh=Ue(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.WorkspaceFoldersFeature=void 0;var Is=on(),ub=e=>class extends e{constructor(){super(),this._notificationIsAutoRegistered=!1}initialize(t){super.initialize(t);let n=t.workspace;n&&n.workspaceFolders&&(this._onDidChangeWorkspaceFolders=new Is.Emitter,this.connection.onNotification(Is.DidChangeWorkspaceFoldersNotification.type,r=>{this._onDidChangeWorkspaceFolders.fire(r.event)}))}fillServerCapabilities(t){super.fillServerCapabilities(t);let n=t.workspace?.workspaceFolders?.changeNotifications;this._notificationIsAutoRegistered=n===!0||typeof n=="string"}getWorkspaceFolders(){return this.connection.sendRequest(Is.WorkspaceFoldersRequest.type)}get onDidChangeWorkspaceFolders(){if(!this._onDidChangeWorkspaceFolders)throw new Error("Client doesn't support sending workspace folder change events.");return!this._notificationIsAutoRegistered&&!this._unregistration&&(this._unregistration=this.connection.client.register(Is.DidChangeWorkspaceFoldersNotification.type)),this._onDidChangeWorkspaceFolders.event}};Vs.WorkspaceFoldersFeature=ub});var Ih=Ue(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});Us.CallHierarchyFeature=void 0;var yu=on(),fb=e=>class extends e{get callHierarchy(){return{onPrepare:t=>this.connection.onRequest(yu.CallHierarchyPrepareRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n),void 0)),onIncomingCalls:t=>{let n=yu.CallHierarchyIncomingCallsRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))},onOutgoingCalls:t=>{let n=yu.CallHierarchyOutgoingCallsRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))}}}};Us.CallHierarchyFeature=fb});var Vh=Ue(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.ShowDocumentFeature=void 0;var db=on(),pb=e=>class extends e{showDocument(t){return this.connection.sendRequest(db.ShowDocumentRequest.type,t)}};Bs.ShowDocumentFeature=pb});var Uh=Ue(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});Hs.FileOperationsFeature=void 0;var Wr=on(),hb=e=>class extends e{onDidCreateFiles(t){return this.connection.onNotification(Wr.DidCreateFilesNotification.type,n=>{t(n)})}onDidRenameFiles(t){return this.connection.onNotification(Wr.DidRenameFilesNotification.type,n=>{t(n)})}onDidDeleteFiles(t){return this.connection.onNotification(Wr.DidDeleteFilesNotification.type,n=>{t(n)})}onWillCreateFiles(t){return this.connection.onRequest(Wr.WillCreateFilesRequest.type,(n,r)=>t(n,r))}onWillRenameFiles(t){return this.connection.onRequest(Wr.WillRenameFilesRequest.type,(n,r)=>t(n,r))}onWillDeleteFiles(t){return this.connection.onRequest(Wr.WillDeleteFilesRequest.type,(n,r)=>t(n,r))}};Hs.FileOperationsFeature=hb});var Bh=Ue(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});zs.LinkedEditingRangeFeature=void 0;var gb=on(),mb=e=>class extends e{onLinkedEditingRange(t){return this.connection.onRequest(gb.LinkedEditingRangeRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n),void 0))}};zs.LinkedEditingRangeFeature=mb});var Hh=Ue(Gs=>{"use strict";Object.defineProperty(Gs,"__esModule",{value:!0});Gs.TypeHierarchyFeature=void 0;var ku=on(),_b=e=>class extends e{get typeHierarchy(){return{onPrepare:t=>this.connection.onRequest(ku.TypeHierarchyPrepareRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n),void 0)),onSupertypes:t=>{let n=ku.TypeHierarchySupertypesRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))},onSubtypes:t=>{let n=ku.TypeHierarchySubtypesRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))}}}};Gs.TypeHierarchyFeature=_b});var Gh=Ue(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.InlineValueFeature=void 0;var zh=on(),bb=e=>class extends e{get inlineValue(){return{refresh:()=>this.connection.sendRequest(zh.InlineValueRefreshRequest.type),on:t=>this.connection.onRequest(zh.InlineValueRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n)))}}};Xs.InlineValueFeature=bb});var Qh=Ue(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.FoldingRangeFeature=void 0;var Xh=on(),yb=e=>class extends e{get foldingRange(){return{refresh:()=>this.connection.sendRequest(Xh.FoldingRangeRefreshRequest.type),on:t=>{let n=Xh.FoldingRangeRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))}}}};Qs.FoldingRangeFeature=yb});var Jh=Ue(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.InlayHintFeature=void 0;var vu=on(),kb=e=>class extends e{get inlayHint(){return{refresh:()=>this.connection.sendRequest(vu.InlayHintRefreshRequest.type),on:t=>this.connection.onRequest(vu.InlayHintRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n))),resolve:t=>this.connection.onRequest(vu.InlayHintResolveRequest.type,(n,r)=>t(n,r))}}};Js.InlayHintFeature=kb});var Yh=Ue(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.DiagnosticFeature=void 0;var Ro=on(),vb=e=>class extends e{get diagnostics(){return{refresh:()=>this.connection.sendRequest(Ro.DiagnosticRefreshRequest.type),on:t=>this.connection.onRequest(Ro.DocumentDiagnosticRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(Ro.DocumentDiagnosticRequest.partialResult,n))),onWorkspace:t=>this.connection.onRequest(Ro.WorkspaceDiagnosticRequest.type,(n,r)=>t(n,r,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(Ro.WorkspaceDiagnosticRequest.partialResult,n)))}}};Ys.DiagnosticFeature=vb});var Zh=Ue(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.MonikerFeature=void 0;var Tb=on(),wb=e=>class extends e{get moniker(){return{on:t=>{let n=Tb.MonikerRequest.type;return this.connection.onRequest(n,(r,i)=>t(r,i,this.attachWorkDoneProgress(r),this.attachPartialResultProgress(n,r)))}}}};Zs.MonikerFeature=wb});var hg=Ue(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.createConnection=St.combineFeatures=St.combineNotebooksFeatures=St.combineLanguagesFeatures=St.combineWorkspaceFeatures=St.combineWindowFeatures=St.combineClientFeatures=St.combineTracerFeatures=St.combineTelemetryFeatures=St.combineConsoleFeatures=St._NotebooksImpl=St._LanguagesImpl=St.BulkUnregistration=St.BulkRegistration=St.ErrorMessageTracker=void 0;var Ke=on(),Qn=gu(),wu=mu(),ft=jh(),Rb=$h(),xb=Wh(),Cb=Ih(),Db=uu(),Sb=Vh(),Eb=Uh(),Pb=Bh(),Ob=Hh(),Ab=Gh(),Nb=Qh(),Mb=Jh(),Lb=Yh(),Fb=hu(),Kb=Zh();function Tu(e){if(e!==null)return e}var Ru=class{constructor(){this._messages=Object.create(null)}add(t){let n=this._messages[t];n||(n=0),n++,this._messages[t]=n}sendErrors(t){Object.keys(this._messages).forEach(n=>{t.window.showErrorMessage(n)})}};St.ErrorMessageTracker=Ru;var ea=class{constructor(){}rawAttach(t){this._rawConnection=t}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}fillServerCapabilities(t){}initialize(t){}error(t){this.send(Ke.MessageType.Error,t)}warn(t){this.send(Ke.MessageType.Warning,t)}info(t){this.send(Ke.MessageType.Info,t)}log(t){this.send(Ke.MessageType.Log,t)}debug(t){this.send(Ke.MessageType.Debug,t)}send(t,n){this._rawConnection&&this._rawConnection.sendNotification(Ke.LogMessageNotification.type,{type:t,message:n}).catch(()=>{(0,Ke.RAL)().console.error("Sending log message failed")})}},xu=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}showErrorMessage(t,...n){let r={type:Ke.MessageType.Error,message:t,actions:n};return this.connection.sendRequest(Ke.ShowMessageRequest.type,r).then(Tu)}showWarningMessage(t,...n){let r={type:Ke.MessageType.Warning,message:t,actions:n};return this.connection.sendRequest(Ke.ShowMessageRequest.type,r).then(Tu)}showInformationMessage(t,...n){let r={type:Ke.MessageType.Info,message:t,actions:n};return this.connection.sendRequest(Ke.ShowMessageRequest.type,r).then(Tu)}},eg=(0,Sb.ShowDocumentFeature)((0,ft.ProgressFeature)(xu)),tg;(function(e){function t(){return new ta}e.create=t})(tg||(St.BulkRegistration=tg={}));var ta=class{constructor(){this._registrations=[],this._registered=new Set}add(t,n){let r=Qn.string(t)?t:t.method;if(this._registered.has(r))throw new Error(`${r} is already added to this registration`);let i=wu.generateUuid();this._registrations.push({id:i,method:r,registerOptions:n||{}}),this._registered.add(r)}asRegistrationParams(){return{registrations:this._registrations}}},ng;(function(e){function t(){return new xo(void 0,[])}e.create=t})(ng||(St.BulkUnregistration=ng={}));var xo=class{constructor(t,n){this._connection=t,this._unregistrations=new Map,n.forEach(r=>{this._unregistrations.set(r.method,r)})}get isAttached(){return!!this._connection}attach(t){this._connection=t}add(t){this._unregistrations.set(t.method,t)}dispose(){let t=[];for(let r of this._unregistrations.values())t.push(r);let n={unregisterations:t};this._connection.sendRequest(Ke.UnregistrationRequest.type,n).catch(()=>{this._connection.console.info("Bulk unregistration failed.")})}disposeSingle(t){let n=Qn.string(t)?t:t.method,r=this._unregistrations.get(n);if(!r)return!1;let i={unregisterations:[r]};return this._connection.sendRequest(Ke.UnregistrationRequest.type,i).then(()=>{this._unregistrations.delete(n)},s=>{this._connection.console.info(`Un-registering request handler for ${r.id} failed.`)}),!0}},na=class{attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}register(t,n,r){return t instanceof ta?this.registerMany(t):t instanceof xo?this.registerSingle1(t,n,r):this.registerSingle2(t,n)}registerSingle1(t,n,r){let i=Qn.string(n)?n:n.method,s=wu.generateUuid(),a={registrations:[{id:s,method:i,registerOptions:r||{}}]};return t.isAttached||t.attach(this.connection),this.connection.sendRequest(Ke.RegistrationRequest.type,a).then(p=>(t.add({id:s,method:i}),t),p=>(this.connection.console.info(`Registering request handler for ${i} failed.`),Promise.reject(p)))}registerSingle2(t,n){let r=Qn.string(t)?t:t.method,i=wu.generateUuid(),s={registrations:[{id:i,method:r,registerOptions:n||{}}]};return this.connection.sendRequest(Ke.RegistrationRequest.type,s).then(a=>Ke.Disposable.create(()=>{this.unregisterSingle(i,r).catch(()=>{this.connection.console.info(`Un-registering capability with id ${i} failed.`)})}),a=>(this.connection.console.info(`Registering request handler for ${r} failed.`),Promise.reject(a)))}unregisterSingle(t,n){let r={unregisterations:[{id:t,method:n}]};return this.connection.sendRequest(Ke.UnregistrationRequest.type,r).catch(()=>{this.connection.console.info(`Un-registering request handler for ${t} failed.`)})}registerMany(t){let n=t.asRegistrationParams();return this.connection.sendRequest(Ke.RegistrationRequest.type,n).then(()=>new xo(this._connection,n.registrations.map(r=>({id:r.id,method:r.method}))),r=>(this.connection.console.info("Bulk registration failed."),Promise.reject(r)))}},Cu=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}applyEdit(t){function n(i){return i&&!!i.edit}let r=n(t)?t:{edit:t};return this.connection.sendRequest(Ke.ApplyWorkspaceEditRequest.type,r)}},ig=(0,Eb.FileOperationsFeature)((0,xb.WorkspaceFoldersFeature)((0,Rb.ConfigurationFeature)(Cu))),ia=class{constructor(){this._trace=Ke.Trace.Off}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}set trace(t){this._trace=t}log(t,n){this._trace!==Ke.Trace.Off&&this.connection.sendNotification(Ke.LogTraceNotification.type,{message:t,verbose:this._trace===Ke.Trace.Verbose?n:void 0}).catch(()=>{})}},ra=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}logEvent(t){this.connection.sendNotification(Ke.TelemetryEventNotification.type,t).catch(()=>{this.connection.console.log("Sending TelemetryEventNotification failed")})}},oa=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}attachWorkDoneProgress(t){return(0,ft.attachWorkDone)(this.connection,t)}attachPartialResultProgress(t,n){return(0,ft.attachPartialResult)(this.connection,n)}};St._LanguagesImpl=oa;var rg=(0,Nb.FoldingRangeFeature)((0,Kb.MonikerFeature)((0,Lb.DiagnosticFeature)((0,Mb.InlayHintFeature)((0,Ab.InlineValueFeature)((0,Ob.TypeHierarchyFeature)((0,Pb.LinkedEditingRangeFeature)((0,Db.SemanticTokensFeature)((0,Cb.CallHierarchyFeature)(oa))))))))),sa=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}attachWorkDoneProgress(t){return(0,ft.attachWorkDone)(this.connection,t)}attachPartialResultProgress(t,n){return(0,ft.attachPartialResult)(this.connection,n)}};St._NotebooksImpl=sa;var og=(0,Fb.NotebookSyncFeature)(sa);function sg(e,t){return function(n){return t(e(n))}}St.combineConsoleFeatures=sg;function ag(e,t){return function(n){return t(e(n))}}St.combineTelemetryFeatures=ag;function cg(e,t){return function(n){return t(e(n))}}St.combineTracerFeatures=cg;function lg(e,t){return function(n){return t(e(n))}}St.combineClientFeatures=lg;function ug(e,t){return function(n){return t(e(n))}}St.combineWindowFeatures=ug;function fg(e,t){return function(n){return t(e(n))}}St.combineWorkspaceFeatures=fg;function dg(e,t){return function(n){return t(e(n))}}St.combineLanguagesFeatures=dg;function pg(e,t){return function(n){return t(e(n))}}St.combineNotebooksFeatures=pg;function qb(e,t){function n(i,s,a){return i&&s?a(i,s):i||s}return{__brand:"features",console:n(e.console,t.console,sg),tracer:n(e.tracer,t.tracer,cg),telemetry:n(e.telemetry,t.telemetry,ag),client:n(e.client,t.client,lg),window:n(e.window,t.window,ug),workspace:n(e.workspace,t.workspace,fg),languages:n(e.languages,t.languages,dg),notebooks:n(e.notebooks,t.notebooks,pg)}}St.combineFeatures=qb;function jb(e,t,n){let r=n&&n.console?new(n.console(ea)):new ea,i=e(r);r.rawAttach(i);let s=n&&n.tracer?new(n.tracer(ia)):new ia,a=n&&n.telemetry?new(n.telemetry(ra)):new ra,p=n&&n.client?new(n.client(na)):new na,u=n&&n.window?new(n.window(eg)):new eg,f=n&&n.workspace?new(n.workspace(ig)):new ig,c=n&&n.languages?new(n.languages(rg)):new rg,m=n&&n.notebooks?new(n.notebooks(og)):new og,y=[r,s,a,p,u,f,c,m];function h(g){return g instanceof Promise?g:Qn.thenable(g)?new Promise((b,d)=>{g.then(X=>b(X),X=>d(X))}):Promise.resolve(g)}let C,F,ne,R={listen:()=>i.listen(),sendRequest:(g,...b)=>i.sendRequest(Qn.string(g)?g:g.method,...b),onRequest:(g,b)=>i.onRequest(g,b),sendNotification:(g,b)=>{let d=Qn.string(g)?g:g.method;return i.sendNotification(d,b)},onNotification:(g,b)=>i.onNotification(g,b),onProgress:i.onProgress,sendProgress:i.sendProgress,onInitialize:g=>(F=g,{dispose:()=>{F=void 0}}),onInitialized:g=>i.onNotification(Ke.InitializedNotification.type,g),onShutdown:g=>(C=g,{dispose:()=>{C=void 0}}),onExit:g=>(ne=g,{dispose:()=>{ne=void 0}}),get console(){return r},get telemetry(){return a},get tracer(){return s},get client(){return p},get window(){return u},get workspace(){return f},get languages(){return c},get notebooks(){return m},onDidChangeConfiguration:g=>i.onNotification(Ke.DidChangeConfigurationNotification.type,g),onDidChangeWatchedFiles:g=>i.onNotification(Ke.DidChangeWatchedFilesNotification.type,g),__textDocumentSync:void 0,onDidOpenTextDocument:g=>i.onNotification(Ke.DidOpenTextDocumentNotification.type,g),onDidChangeTextDocument:g=>i.onNotification(Ke.DidChangeTextDocumentNotification.type,g),onDidCloseTextDocument:g=>i.onNotification(Ke.DidCloseTextDocumentNotification.type,g),onWillSaveTextDocument:g=>i.onNotification(Ke.WillSaveTextDocumentNotification.type,g),onWillSaveTextDocumentWaitUntil:g=>i.onRequest(Ke.WillSaveTextDocumentWaitUntilRequest.type,g),onDidSaveTextDocument:g=>i.onNotification(Ke.DidSaveTextDocumentNotification.type,g),sendDiagnostics:g=>i.sendNotification(Ke.PublishDiagnosticsNotification.type,g),onHover:g=>i.onRequest(Ke.HoverRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),void 0)),onCompletion:g=>i.onRequest(Ke.CompletionRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onCompletionResolve:g=>i.onRequest(Ke.CompletionResolveRequest.type,g),onSignatureHelp:g=>i.onRequest(Ke.SignatureHelpRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),void 0)),onDeclaration:g=>i.onRequest(Ke.DeclarationRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onDefinition:g=>i.onRequest(Ke.DefinitionRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onTypeDefinition:g=>i.onRequest(Ke.TypeDefinitionRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onImplementation:g=>i.onRequest(Ke.ImplementationRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onReferences:g=>i.onRequest(Ke.ReferencesRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onDocumentHighlight:g=>i.onRequest(Ke.DocumentHighlightRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onDocumentSymbol:g=>i.onRequest(Ke.DocumentSymbolRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onWorkspaceSymbol:g=>i.onRequest(Ke.WorkspaceSymbolRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onWorkspaceSymbolResolve:g=>i.onRequest(Ke.WorkspaceSymbolResolveRequest.type,g),onCodeAction:g=>i.onRequest(Ke.CodeActionRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onCodeActionResolve:g=>i.onRequest(Ke.CodeActionResolveRequest.type,(b,d)=>g(b,d)),onCodeLens:g=>i.onRequest(Ke.CodeLensRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onCodeLensResolve:g=>i.onRequest(Ke.CodeLensResolveRequest.type,(b,d)=>g(b,d)),onDocumentFormatting:g=>i.onRequest(Ke.DocumentFormattingRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),void 0)),onDocumentRangeFormatting:g=>i.onRequest(Ke.DocumentRangeFormattingRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),void 0)),onDocumentOnTypeFormatting:g=>i.onRequest(Ke.DocumentOnTypeFormattingRequest.type,(b,d)=>g(b,d)),onRenameRequest:g=>i.onRequest(Ke.RenameRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),void 0)),onPrepareRename:g=>i.onRequest(Ke.PrepareRenameRequest.type,(b,d)=>g(b,d)),onDocumentLinks:g=>i.onRequest(Ke.DocumentLinkRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onDocumentLinkResolve:g=>i.onRequest(Ke.DocumentLinkResolveRequest.type,(b,d)=>g(b,d)),onDocumentColor:g=>i.onRequest(Ke.DocumentColorRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onColorPresentation:g=>i.onRequest(Ke.ColorPresentationRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onFoldingRanges:g=>i.onRequest(Ke.FoldingRangeRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onSelectionRanges:g=>i.onRequest(Ke.SelectionRangeRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),(0,ft.attachPartialResult)(i,b))),onExecuteCommand:g=>i.onRequest(Ke.ExecuteCommandRequest.type,(b,d)=>g(b,d,(0,ft.attachWorkDone)(i,b),void 0)),dispose:()=>i.dispose()};for(let g of y)g.attach(R);return i.onRequest(Ke.InitializeRequest.type,g=>{t.initialize(g),Qn.string(g.trace)&&(s.trace=Ke.Trace.fromString(g.trace));for(let b of y)b.initialize(g.capabilities);if(F){let b=F(g,new Ke.CancellationTokenSource().token,(0,ft.attachWorkDone)(i,g),void 0);return h(b).then(d=>{if(d instanceof Ke.ResponseError)return d;let X=d;X||(X={capabilities:{}});let _=X.capabilities;_||(_={},X.capabilities=_),_.textDocumentSync===void 0||_.textDocumentSync===null?_.textDocumentSync=Qn.number(R.__textDocumentSync)?R.__textDocumentSync:Ke.TextDocumentSyncKind.None:!Qn.number(_.textDocumentSync)&&!Qn.number(_.textDocumentSync.change)&&(_.textDocumentSync.change=Qn.number(R.__textDocumentSync)?R.__textDocumentSync:Ke.TextDocumentSyncKind.None);for(let Se of y)Se.fillServerCapabilities(_);return X})}else{let b={capabilities:{textDocumentSync:Ke.TextDocumentSyncKind.None}};for(let d of y)d.fillServerCapabilities(b.capabilities);return b}}),i.onRequest(Ke.ShutdownRequest.type,()=>{if(t.shutdownReceived=!0,C)return C(new Ke.CancellationTokenSource().token)}),i.onNotification(Ke.ExitNotification.type,()=>{try{ne&&ne()}finally{t.shutdownReceived?t.exit(0):t.exit(1)}}),i.onNotification(Ke.SetTraceNotification.type,g=>{s.trace=Ke.Trace.fromString(g.value)}),R}St.createConnection=jb});var Du=Ue(xn=>{"use strict";var $b=xn&&xn.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),mg=xn&&xn.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&$b(t,e,n)};Object.defineProperty(xn,"__esModule",{value:!0});xn.ProposedFeatures=xn.NotebookDocuments=xn.TextDocuments=xn.SemanticTokensBuilder=void 0;var Wb=uu();Object.defineProperty(xn,"SemanticTokensBuilder",{enumerable:!0,get:function(){return Wb.SemanticTokensBuilder}});var Ib=Ah();mg(on(),xn);var Vb=du();Object.defineProperty(xn,"TextDocuments",{enumerable:!0,get:function(){return Vb.TextDocuments}});var Ub=hu();Object.defineProperty(xn,"NotebookDocuments",{enumerable:!0,get:function(){return Ub.NotebookDocuments}});mg(hg(),xn);var gg;(function(e){e.all={__brand:"features",languages:Ib.InlineCompletionFeature}})(gg||(xn.ProposedFeatures=gg={}))});var bg=Ue((Gk,_g)=>{"use strict";_g.exports=on()});var $n=Ue(gi=>{"use strict";var Bb=gi&&gi.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),kg=gi&&gi.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&Bb(t,e,n)};Object.defineProperty(gi,"__esModule",{value:!0});gi.createConnection=void 0;var aa=Du();kg(bg(),gi);kg(Du(),gi);var yg=!1,Hb={initialize:e=>{},get shutdownReceived(){return yg},set shutdownReceived(e){yg=e},exit:e=>{}};function zb(e,t,n,r){let i,s,a,p;e!==void 0&&e.__brand==="features"&&(i=e,e=t,t=n,n=r),aa.ConnectionStrategy.is(e)||aa.ConnectionOptions.is(e)?p=e:(s=e,a=t,p=n);let u=f=>(0,aa.createProtocolConnection)(s,a,f,p);return(0,aa.createConnection)(u,Hb,i)}gi.createConnection=zb});var Tg=Ue((Qk,vg)=>{"use strict";vg.exports=$n()});var ca=Ue((Zk,xg)=>{"use strict";function mi(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function Rg(e,t){for(var n="",r=0,i=-1,s=0,a,p=0;p<=e.length;++p){if(p<e.length)a=e.charCodeAt(p);else{if(a===47)break;a=47}if(a===47){if(!(i===p-1||s===1))if(i!==p-1&&s===2){if(n.length<2||r!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var u=n.lastIndexOf("/");if(u!==n.length-1){u===-1?(n="",r=0):(n=n.slice(0,u),r=n.length-1-n.lastIndexOf("/")),i=p,s=0;continue}}else if(n.length===2||n.length===1){n="",r=0,i=p,s=0;continue}}t&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+="/"+e.slice(i+1,p):n=e.slice(i+1,p),r=p-i-1;i=p,s=0}else a===46&&s!==-1?++s:s=-1}return n}function Gb(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+e+r:r}var Ir={resolve:function(){for(var t="",n=!1,r,i=arguments.length-1;i>=-1&&!n;i--){var s;i>=0?s=arguments[i]:(r===void 0&&(r=process_cwd()),s=r),mi(s),s.length!==0&&(t=s+"/"+t,n=s.charCodeAt(0)===47)}return t=Rg(t,!n),n?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(t){if(mi(t),t.length===0)return".";var n=t.charCodeAt(0)===47,r=t.charCodeAt(t.length-1)===47;return t=Rg(t,!n),t.length===0&&!n&&(t="."),t.length>0&&r&&(t+="/"),n?"/"+t:t},isAbsolute:function(t){return mi(t),t.length>0&&t.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var t,n=0;n<arguments.length;++n){var r=arguments[n];mi(r),r.length>0&&(t===void 0?t=r:t+="/"+r)}return t===void 0?".":Ir.normalize(t)},relative:function(t,n){if(mi(t),mi(n),t===n||(t=Ir.resolve(t),n=Ir.resolve(n),t===n))return"";for(var r=1;r<t.length&&t.charCodeAt(r)===47;++r);for(var i=t.length,s=i-r,a=1;a<n.length&&n.charCodeAt(a)===47;++a);for(var p=n.length,u=p-a,f=s<u?s:u,c=-1,m=0;m<=f;++m){if(m===f){if(u>f){if(n.charCodeAt(a+m)===47)return n.slice(a+m+1);if(m===0)return n.slice(a+m)}else s>f&&(t.charCodeAt(r+m)===47?c=m:m===0&&(c=0));break}var y=t.charCodeAt(r+m),h=n.charCodeAt(a+m);if(y!==h)break;y===47&&(c=m)}var C="";for(m=r+c+1;m<=i;++m)(m===i||t.charCodeAt(m)===47)&&(C.length===0?C+="..":C+="/..");return C.length>0?C+n.slice(a+c):(a+=c,n.charCodeAt(a)===47&&++a,n.slice(a))},_makeLong:function(t){return t},dirname:function(t){if(mi(t),t.length===0)return".";for(var n=t.charCodeAt(0),r=n===47,i=-1,s=!0,a=t.length-1;a>=1;--a)if(n=t.charCodeAt(a),n===47){if(!s){i=a;break}}else s=!1;return i===-1?r?"/":".":r&&i===1?"//":t.slice(0,i)},basename:function(t,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');mi(t);var r=0,i=-1,s=!0,a;if(n!==void 0&&n.length>0&&n.length<=t.length){if(n.length===t.length&&n===t)return"";var p=n.length-1,u=-1;for(a=t.length-1;a>=0;--a){var f=t.charCodeAt(a);if(f===47){if(!s){r=a+1;break}}else u===-1&&(s=!1,u=a+1),p>=0&&(f===n.charCodeAt(p)?--p===-1&&(i=a):(p=-1,i=u))}return r===i?i=u:i===-1&&(i=t.length),t.slice(r,i)}else{for(a=t.length-1;a>=0;--a)if(t.charCodeAt(a)===47){if(!s){r=a+1;break}}else i===-1&&(s=!1,i=a+1);return i===-1?"":t.slice(r,i)}},extname:function(t){mi(t);for(var n=-1,r=0,i=-1,s=!0,a=0,p=t.length-1;p>=0;--p){var u=t.charCodeAt(p);if(u===47){if(!s){r=p+1;break}continue}i===-1&&(s=!1,i=p+1),u===46?n===-1?n=p:a!==1&&(a=1):n!==-1&&(a=-1)}return n===-1||i===-1||a===0||a===1&&n===i-1&&n===r+1?"":t.slice(n,i)},format:function(t){if(t===null||typeof t!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return Gb("/",t)},parse:function(t){mi(t);var n={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return n;var r=t.charCodeAt(0),i=r===47,s;i?(n.root="/",s=1):s=0;for(var a=-1,p=0,u=-1,f=!0,c=t.length-1,m=0;c>=s;--c){if(r=t.charCodeAt(c),r===47){if(!f){p=c+1;break}continue}u===-1&&(f=!1,u=c+1),r===46?a===-1?a=c:m!==1&&(m=1):a!==-1&&(m=-1)}return a===-1||u===-1||m===0||m===1&&a===u-1&&a===p+1?u!==-1&&(p===0&&i?n.base=n.name=t.slice(1,u):n.base=n.name=t.slice(p,u)):(p===0&&i?(n.name=t.slice(1,a),n.base=t.slice(1,u)):(n.name=t.slice(p,a),n.base=t.slice(p,u)),n.ext=t.slice(a,u)),p>0?n.dir=t.slice(0,p-1):i&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};Ir.posix=Ir;xg.exports=Ir});var Vo=class e{constructor(t,n,r,i){this._uri=t,this._languageId=n,this._version=r,this._content=i,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(t){if(t){let n=this.offsetAt(t.start),r=this.offsetAt(t.end);return this._content.substring(n,r)}return this._content}update(t,n){for(let r of t)if(e.isIncremental(r)){let i=sf(r.range),s=this.offsetAt(i.start),a=this.offsetAt(i.end);this._content=this._content.substring(0,s)+r.text+this._content.substring(a,this._content.length);let p=Math.max(i.start.line,0),u=Math.max(i.end.line,0),f=this._lineOffsets,c=rf(r.text,!1,s);if(u-p===c.length)for(let y=0,h=c.length;y<h;y++)f[y+p+1]=c[y];else c.length<1e4?f.splice(p+1,u-p,...c):this._lineOffsets=f=f.slice(0,p+1).concat(c,f.slice(u+1));let m=r.text.length-(a-s);if(m!==0)for(let y=p+1+c.length,h=f.length;y<h;y++)f[y]=f[y]+m}else if(e.isFull(r))this._content=r.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=n}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=rf(this._content,!0)),this._lineOffsets}positionAt(t){t=Math.max(Math.min(t,this._content.length),0);let n=this.getLineOffsets(),r=0,i=n.length;if(i===0)return{line:0,character:t};for(;r<i;){let a=Math.floor((r+i)/2);n[a]>t?i=a:r=a+1}let s=r-1;return t=this.ensureBeforeEOL(t,n[s]),{line:s,character:t-n[s]}}offsetAt(t){let n=this.getLineOffsets();if(t.line>=n.length)return this._content.length;if(t.line<0)return 0;let r=n[t.line];if(t.character<=0)return r;let i=t.line+1<n.length?n[t.line+1]:this._content.length,s=Math.min(r+t.character,i);return this.ensureBeforeEOL(s,r)}ensureBeforeEOL(t,n){for(;t>n&&of(this._content.charCodeAt(t-1));)t--;return t}get lineCount(){return this.getLineOffsets().length}static isIncremental(t){let n=t;return n!=null&&typeof n.text=="string"&&n.range!==void 0&&(n.rangeLength===void 0||typeof n.rangeLength=="number")}static isFull(t){let n=t;return n!=null&&typeof n.text=="string"&&n.range===void 0&&n.rangeLength===void 0}},An;(function(e){function t(i,s,a,p){return new Vo(i,s,a,p)}e.create=t;function n(i,s,a){if(i instanceof Vo)return i.update(s,a),i;throw new Error("TextDocument.update: document must be created by TextDocument.create")}e.update=n;function r(i,s){let a=i.getText(),p=qa(s.map(zm),(c,m)=>{let y=c.range.start.line-m.range.start.line;return y===0?c.range.start.character-m.range.start.character:y}),u=0,f=[];for(let c of p){let m=i.offsetAt(c.range.start);if(m<u)throw new Error("Overlapping edit");m>u&&f.push(a.substring(u,m)),c.newText.length&&f.push(c.newText),u=i.offsetAt(c.range.end)}return f.push(a.substr(u)),f.join("")}e.applyEdits=r})(An||(An={}));function qa(e,t){if(e.length<=1)return e;let n=e.length/2|0,r=e.slice(0,n),i=e.slice(n);qa(r,t),qa(i,t);let s=0,a=0,p=0;for(;s<r.length&&a<i.length;)t(r[s],i[a])<=0?e[p++]=r[s++]:e[p++]=i[a++];for(;s<r.length;)e[p++]=r[s++];for(;a<i.length;)e[p++]=i[a++];return e}function rf(e,t,n=0){let r=t?[n]:[];for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);of(s)&&(s===13&&i+1<e.length&&e.charCodeAt(i+1)===10&&i++,r.push(n+i+1))}return r}function of(e){return e===13||e===10}function sf(e){let t=e.start,n=e.end;return t.line>n.line||t.line===n.line&&t.character>n.character?{start:n,end:t}:e}function zm(e){let t=sf(e.range);return t!==e.range?{newText:e.newText,range:t}:e}var ni=vn(Tg());_o();var wg;(()=>{"use strict";var e={470:i=>{function s(u){if(typeof u!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(u))}function a(u,f){for(var c,m="",y=0,h=-1,C=0,F=0;F<=u.length;++F){if(F<u.length)c=u.charCodeAt(F);else{if(c===47)break;c=47}if(c===47){if(!(h===F-1||C===1))if(h!==F-1&&C===2){if(m.length<2||y!==2||m.charCodeAt(m.length-1)!==46||m.charCodeAt(m.length-2)!==46){if(m.length>2){var ne=m.lastIndexOf("/");if(ne!==m.length-1){ne===-1?(m="",y=0):y=(m=m.slice(0,ne)).length-1-m.lastIndexOf("/"),h=F,C=0;continue}}else if(m.length===2||m.length===1){m="",y=0,h=F,C=0;continue}}f&&(m.length>0?m+="/..":m="..",y=2)}else m.length>0?m+="/"+u.slice(h+1,F):m=u.slice(h+1,F),y=F-h-1;h=F,C=0}else c===46&&C!==-1?++C:C=-1}return m}var p={resolve:function(){for(var u,f="",c=!1,m=arguments.length-1;m>=-1&&!c;m--){var y;m>=0?y=arguments[m]:(u===void 0&&(u=process_cwd()),y=u),s(y),y.length!==0&&(f=y+"/"+f,c=y.charCodeAt(0)===47)}return f=a(f,!c),c?f.length>0?"/"+f:"/":f.length>0?f:"."},normalize:function(u){if(s(u),u.length===0)return".";var f=u.charCodeAt(0)===47,c=u.charCodeAt(u.length-1)===47;return(u=a(u,!f)).length!==0||f||(u="."),u.length>0&&c&&(u+="/"),f?"/"+u:u},isAbsolute:function(u){return s(u),u.length>0&&u.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var u,f=0;f<arguments.length;++f){var c=arguments[f];s(c),c.length>0&&(u===void 0?u=c:u+="/"+c)}return u===void 0?".":p.normalize(u)},relative:function(u,f){if(s(u),s(f),u===f||(u=p.resolve(u))===(f=p.resolve(f)))return"";for(var c=1;c<u.length&&u.charCodeAt(c)===47;++c);for(var m=u.length,y=m-c,h=1;h<f.length&&f.charCodeAt(h)===47;++h);for(var C=f.length-h,F=y<C?y:C,ne=-1,R=0;R<=F;++R){if(R===F){if(C>F){if(f.charCodeAt(h+R)===47)return f.slice(h+R+1);if(R===0)return f.slice(h+R)}else y>F&&(u.charCodeAt(c+R)===47?ne=R:R===0&&(ne=0));break}var g=u.charCodeAt(c+R);if(g!==f.charCodeAt(h+R))break;g===47&&(ne=R)}var b="";for(R=c+ne+1;R<=m;++R)R!==m&&u.charCodeAt(R)!==47||(b.length===0?b+="..":b+="/..");return b.length>0?b+f.slice(h+ne):(h+=ne,f.charCodeAt(h)===47&&++h,f.slice(h))},_makeLong:function(u){return u},dirname:function(u){if(s(u),u.length===0)return".";for(var f=u.charCodeAt(0),c=f===47,m=-1,y=!0,h=u.length-1;h>=1;--h)if((f=u.charCodeAt(h))===47){if(!y){m=h;break}}else y=!1;return m===-1?c?"/":".":c&&m===1?"//":u.slice(0,m)},basename:function(u,f){if(f!==void 0&&typeof f!="string")throw new TypeError('"ext" argument must be a string');s(u);var c,m=0,y=-1,h=!0;if(f!==void 0&&f.length>0&&f.length<=u.length){if(f.length===u.length&&f===u)return"";var C=f.length-1,F=-1;for(c=u.length-1;c>=0;--c){var ne=u.charCodeAt(c);if(ne===47){if(!h){m=c+1;break}}else F===-1&&(h=!1,F=c+1),C>=0&&(ne===f.charCodeAt(C)?--C==-1&&(y=c):(C=-1,y=F))}return m===y?y=F:y===-1&&(y=u.length),u.slice(m,y)}for(c=u.length-1;c>=0;--c)if(u.charCodeAt(c)===47){if(!h){m=c+1;break}}else y===-1&&(h=!1,y=c+1);return y===-1?"":u.slice(m,y)},extname:function(u){s(u);for(var f=-1,c=0,m=-1,y=!0,h=0,C=u.length-1;C>=0;--C){var F=u.charCodeAt(C);if(F!==47)m===-1&&(y=!1,m=C+1),F===46?f===-1?f=C:h!==1&&(h=1):f!==-1&&(h=-1);else if(!y){c=C+1;break}}return f===-1||m===-1||h===0||h===1&&f===m-1&&f===c+1?"":u.slice(f,m)},format:function(u){if(u===null||typeof u!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof u);return function(f,c){var m=c.dir||c.root,y=c.base||(c.name||"")+(c.ext||"");return m?m===c.root?m+y:m+"/"+y:y}(0,u)},parse:function(u){s(u);var f={root:"",dir:"",base:"",ext:"",name:""};if(u.length===0)return f;var c,m=u.charCodeAt(0),y=m===47;y?(f.root="/",c=1):c=0;for(var h=-1,C=0,F=-1,ne=!0,R=u.length-1,g=0;R>=c;--R)if((m=u.charCodeAt(R))!==47)F===-1&&(ne=!1,F=R+1),m===46?h===-1?h=R:g!==1&&(g=1):h!==-1&&(g=-1);else if(!ne){C=R+1;break}return h===-1||F===-1||g===0||g===1&&h===F-1&&h===C+1?F!==-1&&(f.base=f.name=C===0&&y?u.slice(1,F):u.slice(C,F)):(C===0&&y?(f.name=u.slice(1,h),f.base=u.slice(1,F)):(f.name=u.slice(C,h),f.base=u.slice(C,F)),f.ext=u.slice(h,F)),C>0?f.dir=u.slice(0,C-1):y&&(f.dir="/"),f},sep:"/",delimiter:":",win32:null,posix:null};p.posix=p,i.exports=p}},t={};function n(i){var s=t[i];if(s!==void 0)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.d=(i,s)=>{for(var a in s)n.o(s,a)&&!n.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:s[a]})},n.o=(i,s)=>Object.prototype.hasOwnProperty.call(i,s),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var r={};(()=>{let i;n.r(r),n.d(r,{URI:()=>y,Utils:()=>Be}),typeof process=="object"?i=process.platform==="win32":typeof navigator=="object"&&(i=navigator.userAgent.indexOf("Windows")>=0);let s=/^\w[\w\d+.-]*$/,a=/^\//,p=/^\/\//;function u(ie,P){if(!ie.scheme&&P)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${ie.authority}", path: "${ie.path}", query: "${ie.query}", fragment: "${ie.fragment}"}`);if(ie.scheme&&!s.test(ie.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(ie.path){if(ie.authority){if(!a.test(ie.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(p.test(ie.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}let f="",c="/",m=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class y{static isUri(P){return P instanceof y||!!P&&typeof P.authority=="string"&&typeof P.fragment=="string"&&typeof P.path=="string"&&typeof P.query=="string"&&typeof P.scheme=="string"&&typeof P.fsPath=="string"&&typeof P.with=="function"&&typeof P.toString=="function"}scheme;authority;path;query;fragment;constructor(P,j,he,ge,pe,k=!1){typeof P=="object"?(this.scheme=P.scheme||f,this.authority=P.authority||f,this.path=P.path||f,this.query=P.query||f,this.fragment=P.fragment||f):(this.scheme=function(lt,It){return lt||It?lt:"file"}(P,k),this.authority=j||f,this.path=function(lt,It){switch(lt){case"https":case"http":case"file":It?It[0]!==c&&(It=c+It):It=c}return It}(this.scheme,he||f),this.query=ge||f,this.fragment=pe||f,u(this,k))}get fsPath(){return g(this,!1)}with(P){if(!P)return this;let{scheme:j,authority:he,path:ge,query:pe,fragment:k}=P;return j===void 0?j=this.scheme:j===null&&(j=f),he===void 0?he=this.authority:he===null&&(he=f),ge===void 0?ge=this.path:ge===null&&(ge=f),pe===void 0?pe=this.query:pe===null&&(pe=f),k===void 0?k=this.fragment:k===null&&(k=f),j===this.scheme&&he===this.authority&&ge===this.path&&pe===this.query&&k===this.fragment?this:new C(j,he,ge,pe,k)}static parse(P,j=!1){let he=m.exec(P);return he?new C(he[2]||f,_(he[4]||f),_(he[5]||f),_(he[7]||f),_(he[9]||f),j):new C(f,f,f,f,f)}static file(P){let j=f;if(i&&(P=P.replace(/\\/g,c)),P[0]===c&&P[1]===c){let he=P.indexOf(c,2);he===-1?(j=P.substring(2),P=c):(j=P.substring(2,he),P=P.substring(he)||c)}return new C("file",j,P,f,f)}static from(P){let j=new C(P.scheme,P.authority,P.path,P.query,P.fragment);return u(j,!0),j}toString(P=!1){return b(this,P)}toJSON(){return this}static revive(P){if(P){if(P instanceof y)return P;{let j=new C(P);return j._formatted=P.external,j._fsPath=P._sep===h?P.fsPath:null,j}}return P}}let h=i?1:void 0;class C extends y{_formatted=null;_fsPath=null;get fsPath(){return this._fsPath||(this._fsPath=g(this,!1)),this._fsPath}toString(P=!1){return P?b(this,!0):(this._formatted||(this._formatted=b(this,!1)),this._formatted)}toJSON(){let P={$mid:1};return this._fsPath&&(P.fsPath=this._fsPath,P._sep=h),this._formatted&&(P.external=this._formatted),this.path&&(P.path=this.path),this.scheme&&(P.scheme=this.scheme),this.authority&&(P.authority=this.authority),this.query&&(P.query=this.query),this.fragment&&(P.fragment=this.fragment),P}}let F={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function ne(ie,P,j){let he,ge=-1;for(let pe=0;pe<ie.length;pe++){let k=ie.charCodeAt(pe);if(k>=97&&k<=122||k>=65&&k<=90||k>=48&&k<=57||k===45||k===46||k===95||k===126||P&&k===47||j&&k===91||j&&k===93||j&&k===58)ge!==-1&&(he+=encodeURIComponent(ie.substring(ge,pe)),ge=-1),he!==void 0&&(he+=ie.charAt(pe));else{he===void 0&&(he=ie.substr(0,pe));let lt=F[k];lt!==void 0?(ge!==-1&&(he+=encodeURIComponent(ie.substring(ge,pe)),ge=-1),he+=lt):ge===-1&&(ge=pe)}}return ge!==-1&&(he+=encodeURIComponent(ie.substring(ge))),he!==void 0?he:ie}function R(ie){let P;for(let j=0;j<ie.length;j++){let he=ie.charCodeAt(j);he===35||he===63?(P===void 0&&(P=ie.substr(0,j)),P+=F[he]):P!==void 0&&(P+=ie[j])}return P!==void 0?P:ie}function g(ie,P){let j;return j=ie.authority&&ie.path.length>1&&ie.scheme==="file"?`//${ie.authority}${ie.path}`:ie.path.charCodeAt(0)===47&&(ie.path.charCodeAt(1)>=65&&ie.path.charCodeAt(1)<=90||ie.path.charCodeAt(1)>=97&&ie.path.charCodeAt(1)<=122)&&ie.path.charCodeAt(2)===58?P?ie.path.substr(1):ie.path[1].toLowerCase()+ie.path.substr(2):ie.path,i&&(j=j.replace(/\//g,"\\")),j}function b(ie,P){let j=P?R:ne,he="",{scheme:ge,authority:pe,path:k,query:lt,fragment:It}=ie;if(ge&&(he+=ge,he+=":"),(pe||ge==="file")&&(he+=c,he+=c),pe){let ye=pe.indexOf("@");if(ye!==-1){let Et=pe.substr(0,ye);pe=pe.substr(ye+1),ye=Et.lastIndexOf(":"),ye===-1?he+=j(Et,!1,!1):(he+=j(Et.substr(0,ye),!1,!1),he+=":",he+=j(Et.substr(ye+1),!1,!0)),he+="@"}pe=pe.toLowerCase(),ye=pe.lastIndexOf(":"),ye===-1?he+=j(pe,!1,!0):(he+=j(pe.substr(0,ye),!1,!0),he+=pe.substr(ye))}if(k){if(k.length>=3&&k.charCodeAt(0)===47&&k.charCodeAt(2)===58){let ye=k.charCodeAt(1);ye>=65&&ye<=90&&(k=`/${String.fromCharCode(ye+32)}:${k.substr(3)}`)}else if(k.length>=2&&k.charCodeAt(1)===58){let ye=k.charCodeAt(0);ye>=65&&ye<=90&&(k=`${String.fromCharCode(ye+32)}:${k.substr(2)}`)}he+=j(k,!0,!1)}return lt&&(he+="?",he+=j(lt,!1,!1)),It&&(he+="#",he+=P?It:ne(It,!1,!1)),he}function d(ie){try{return decodeURIComponent(ie)}catch{return ie.length>3?ie.substr(0,3)+d(ie.substr(3)):ie}}let X=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function _(ie){return ie.match(X)?ie.replace(X,P=>d(P)):ie}var Se=n(470);let je=Se.posix||Se,Pe="/";var Be;(function(ie){ie.joinPath=function(P,...j){return P.with({path:je.join(P.path,...j)})},ie.resolvePath=function(P,...j){let he=P.path,ge=!1;he[0]!==Pe&&(he=Pe+he,ge=!0);let pe=je.resolve(he,...j);return ge&&pe[0]===Pe&&!P.authority&&(pe=pe.substring(1)),P.with({path:pe})},ie.dirname=function(P){if(P.path.length===0||P.path===Pe)return P;let j=je.dirname(P.path);return j.length===1&&j.charCodeAt(0)===46&&(j=""),P.with({path:j})},ie.basename=function(P){return je.basename(P.path)},ie.extname=function(P){return je.extname(P.path)}})(Be||(Be={}))})(),wg=r})();var{URI:En,Utils:Jk}=wg;var $o=vn(ca());var Hr=vn(ca()),T=vn($n());var Cg=["autotrim","blockinput","click","clipwait","control","controlclick","controlfocus","controlget","controlgetfocus","controlgetpos","controlgettext","controlmove","controlsend","controlsendraw","controlsettext","coordmode","critical","detecthiddentext","detecthiddenwindows","drive","driveget","drivespacefree","envadd","envdiv","envget","envmult","envset","envsub","envupdate","exit","exitapp","fileappend","filecopy","filecopydir","filecreatedir","filecreateshortcut","filedelete","fileencoding","filegetattrib","filegetshortcut","filegetsize","filegettime","filegetversion","fileinstall","filemove","filemovedir","fileopen","fileread","filereadline","filerecycle","filerecycleempty","fileremovedir","fileselectfile","fileselectfolder","filesetattrib","filesettime","format","formattime","getkeystate","gosub","groupactivate","groupadd","groupclose","groupdeactivate","gui","guicontrol","guicontrolget","hotkey","ifequal","ifexist","ifgreater","ifgreaterorequal","ifless","iflessorequal","ifmsgbox","ifnotequal","ifnotexist","ifwinactive","ifwinexist","ifwinnotactive","ifwinnotexist","imagesearch","inidelete","iniread","iniwrite","input","inputbox","keywait","listlines","menu","mouseclick","mouseclickdrag","mousegetpos","mousemove","msgbox","onerror","onexit","outputdebug","pause","pixelgetcolor","pixelsearch","postmessage","process","progress","random","regdelete","regread","regwrite","run","runas","runwait","send","sendevent","sendinput","sendlevel","sendmessage","sendmode","sendplay","sendraw","setbatchlines","setcapslockstate","setcontroldelay","setdefaultmousespeed","setenv","setformat","setkeydelay","setmousedelay","setnumlockstate","setregview","setscrolllockstate","setstorecapslockmode","settimer","settitlematchmode","setwindelay","setworkingdir","shutdown","sleep","sort","soundbeep","soundget","soundgetwavevolume","soundplay","soundset","soundsetwavevolume","splashimage","splashtextoff","splashtexton","splitpath","statusbargettext","statusbarwait","stringcasesense","stringleft","stringlower","stringright","stringtrimleft","stringtrimright","stringupper","suspend","sysget","thread","tooltip","transform","traytip","urldownloadtofile","winactivate","winactivatebottom","winclose","winget","wingetactivestats","wingetactivetitle","wingetclass","wingetpos","wingettext","wingettitle","winhide","winkill","winmaximize","winmenuselectitem","winminimize","winminimizeall","winminimizeallundo","winmove","winrestore","winset","winsettitle","winshow","winwait","winwaitactive","winwaitclose","winwaitnotactive"],Co={space:" ",tab:"	"},Su=["str","astr","wstr","int64","int","uint","short","ushort","char","uchar","float","double","ptr","uptr","hresult"],Do={"\uFF0C":",","\u3002":".","\uFF1B":";","\u2018":"'","\u2019":"'","\u3010":"[","\u3011":"]","\u300A":"<","\u300B":">","\uFF1F":"?","\uFF1A":":","\u201C":'"',"\u201D":'"',"\uFF08":"(","\uFF09":")","\uFF01":"!"},Dg=["abstract","access","alias","argument","async","augments","author","borrows","callback","class","classdesc","constant","constructor","constructs","copyright","default","deprecated","description","emits","enum","event","example","exports","extends","external","field","file","fileoverview","fires","function","generator","global","hideconstructor","host","ignore","implements","inheritdoc","inner","instance","interface","kind","lends","license","link","linkcode","linkplain","listens","member","memberof","method","mixes","module","name","namespace","overload","override","package","param","private","prop","property","protected","public","readonly","requires","returns","satisfies","see","since","static","summary","template","this","throws","todo","tutorial","type","typedef","var","variation","version","virtual","yields"];var Eg={},wi={author:Fe("completionitem.author","Add file infos about author, description, date, version."),comment:Fe("completionitem.generatecomment","Generate comment template of current function/method."),include:Fe("completionitem.include","Auto import from '{0}'"),prototype:Fe("completionitem.prototype","Retrieve or set the object on which all instances of the class are based."),thishotkey:Fe("completionitem.thishotkey","The hidden parameter to the hotkey function."),value:Fe("completionitem.value","Within the dynamic property 'set', 'Value' contains the value being assigned."),new:Fe("completionitem.new","export construct a new instance of the class."),this:Fe("completionitem.this","In the class, access other instance variables and methods of the class through 'this'."),super:Fe("completionitem.super","In the inherited class, 'super' can replace 'this' to access the superclass version of the method or property that is overridden in the derived class.")},Xb={include:Fe("codeaction.include","Import '{0}'")},B={acceptparams:Fe("diagnostic.acceptparams","'{0}' accepts {1} parameter(s)"),assignerr:Fe("diagnostic.assignerr","This {0} '{1}' cannot be used as an output variable"),classinfuncerr:Fe("diagnostic.classinfuncerr","Functions cannot contain classes"),classuseerr:Fe("diagnostic.classuseerr","This class cannot be used as an output variable"),conflictserr:Fe("diagnostic.conflictserr","This {0} declaration '{2}' conflicts with an existing {1}"),declarationerr:Fe("diagnostic.declarationerr","Unexpected declaration"),defaultvalmissing:Fe("diagnostic.defaultvalmissing","Parameter default required. Specifically: '{0}'"),deprecated:Fe("diagnostic.deprecated","Using '{0}' instead of '{1}'"),didyoumean:Fe("diagnostic.didyoumean","Did you mean to use '{0}'?"),dupdeclaration:Fe("diagnostic.dupdeclaration","Duplicate declaration"),duplabel:Fe("diagnostic.duplabel","Duplicate label"),filenotexist:Fe("diagnostic.filenotexist","'{0}' does not exist"),funccallerr:Fe("diagnostic.funccallerr","Function calls require a space or '(', use comma only between parameters"),funccallerr2:Fe("diagnostic.funccallerr2","In the expression, the function call requires parentheses"),globalconflicts:Fe("diagnostic.globalconflicts","This global declaration conflicts with an existing {0}"),hotdeferr:Fe("diagnostic.hotdeferr","Hotkeys/hotstrings cannot be defined in functions/classes"),hotmissbrace:Fe("diagnostic.hotmissbrace","Hotkey or hotstring is missing its opening brace"),invaliddefinition:Fe("diagnostic.invaliddefinition","Invalid {0} definition"),invalidencoding:Fe("diagnostic.invalidencoding","'{0}' invalid file encoding"),invalidhotdef:Fe("diagnostic.invalidhotdef","Invalid hotkey definition"),invalidparam:Fe("diagnostic.invalidparam","Invalid parameter definition"),invalidprop:Fe("diagnostic.invalidprop","Invalid dynamic property"),invalidpropname:Fe("diagnostic.invalidpropname","Invalid property name in object literal"),invalidsymbolname:Fe("diagnostic.invalidsymbolname","Invalid symbol naming '{0}'"),invalidsuper:Fe("diagnostic.invalidsuper","'super' is valid only inside a class"),invalidscope:Fe("diagnostic.invalidscope","'{0}' cannot be used in functions/classes"),maybehavenotmember:Fe("diagnostic.maybehavenotmember","Class '{0}' might not have member '{1}'"),maybev1:Fe("diagnostic.maybev1","This appears be a v1 script, continue parsing?"),missing:Fe("diagnostic.missing","Missing '{0}'"),missingparam:Fe("diagnostic.missingparam","Missing a required parameter"),missingoperand:Fe("diagnostic.missingoperand","Missing operand"),missingretval:Fe("diagnostic.missingretval","The function missing a return value"),missingspace:Fe("diagnostic.missingspace","Missing space or operator before this"),objectliteralerr:Fe("diagnostic.objectliteralerr","Error in object literal"),outofloop:Fe("diagnostic.outofloop","Break/Continue must be enclosed by a Loop"),paramcounterr:Fe("diagnostic.paramcounterr","Expected {0} parameters, but got {1}"),pathinvalid:Fe("diagnostic.pathinvalid","Invalid file path"),propdeclaraerr:Fe("diagnostic.propdeclaraerr","Not a valid method, class or property definition"),propemptyparams:Fe("diagnostic.propemptyparams","Empty [] not permitted"),propnotinit:Fe("diagnostic.propnotinit","Property declaration is not initialized"),requirev1:Fe("diagnostic.requirev1","This script requires AutoHotkey v1, continue parsing?"),requireVerN:e=>B.requireversion(Og(e)),requireversion:Fe("diagnostic.requireversion","This feature requires the AutoHotkey version: {0}"),requirevariable:Fe("diagnostic.requirevariable","'&' requires a variable"),reservedworderr:Fe("diagnostic.reservedworderr","The following reserved word '{0}' must not be used as a variable name"),resourcenotfound:Fe("diagnostic.resourcenotfound","No resource found or could not be resolved"),skipline:Fe("diagnostic.skipline","The line is skipped and not resolved"),syntaxerror:Fe("diagnostic.syntaxerror","Syntax error. Specifically: {0}"),tryswitchtov1:Fe("diagnostic.tryswitchtov1","Try switching to AutoHotkey v1."),typemaybenot:Fe("diagnostic.typemaybenot","This param should be a '{0}'"),unexpected:Fe("diagnostic.unexpected","Unexpected '{0}'"),unknown:Fe("diagnostic.unknown","Unknown {0}"),unknownoperatoruse:Fe("diagnostic.unknownoperatoruse","Unknown operator use"),unknowntoken:Fe("diagnostic.unknowntoken","Unknown token '{0}'"),unsupportinclude:Fe("diagnostic.unsupportinclude","#Include in functions and classes cannot correctly deduce scope and code completion"),unterminated:Fe("diagnostic.unterminated","Unterminated string text")},Ri={callwithoutparentheses:Fe("warn.callwithoutparentheses","This function or method call has no parentheses"),localsameasglobal:Fe("warn.localsameasglobal","This local variable '{0}' has the same name as a global variable"),notimplemented:Fe("warn.notimplemented","This feature has not been implemented"),varisunset:Fe("warn.varisunset","Variable '{0}' appears to never be assigned a value")},Eu={ahkpatherr:Fe("setting.ahkpatherr","The AutoHotkey interpreter does not exist, re-specify in'Settings-AutoHotkey2.InterpreterPath'"),getenverr:Fe("setting.getenverr","Failed to get script built-in variables, such as A_MyDocuments, ..."),valueerr:Fe("setting.valueerr","The value of 'Settings-AutoHotkey2.{0}' is not valid. Expect '{1}'. Specifically: {2}"),versionerr:Fe("setting.versionerr","The current AutoHotkey.exe is not the v2 version, and cannot get the correct syntax analysis, completion and other functions")},la={switchtov1:Fe("action.switchtov1","Switch to ahk v1"),skipline:Fe("action.skipline","Skip the line"),stopparsing:Fe("action.stopparsing","Stop parsing")},Pu={cannotrename:Fe("response.cannotrename","The element can't be renamed."),cannotrenamestdlib:Fe("response.cannotrenamestdlib","Elements defined in the standard AutoHotkey library can't be renamed.")};function Pg(){{let e=So(`${rr}/package.nls.<>.json`);e&&(Eg=JSON.parse(e.text))}}function Fe(e,t){return(...n)=>n.length?Qb(Sg(e,t),...n):Sg(e,t)}function Sg(e,t){return Eg[e]||t}function Qb(e,...t){return e.replace(/\{(\d+)\}/g,(...n)=>{let r=parseInt(n[1]);return r<t.length?t[r]:" "})}var ur=(m=>(m[m.class=0]="class",m[m.function=1]="function",m[m.method=2]="method",m[m.module=3]="module",m[m.parameter=4]="parameter",m[m.variable=5]="variable",m[m.property=6]="property",m[m.keyword=7]="keyword",m[m.string=8]="string",m[m.number=9]="number",m[m.operator=10]="operator",m))(ur||{}),Ou={type:0},ua={type:7},Vr={type:9},Ag={type:10},Jb={type:4},Ng={type:6},fa={type:8},Mo=(s=>(s[s.static=1]="static",s[s.readonly=2]="readonly",s[s.definition=4]="definition",s[s.defaultLibrary=8]="defaultLibrary",s[s.deprecated=16]="deprecated",s))(Mo||{});var Jn;(t=>{function e(n,r,i,s,a,p,u){let f="",c=!1,m=!1,y=[];a.format?.(a);for(let h of a)y.push(f.length),f+=`, ${h.pass_by_ref?(c=!0,++y[y.length-1],"&"):""}${h.name}${h.defaultVal?` := ${h.defaultVal}`:h.defaultVal===null?"?":h.arr?(m=!0,"*"):""}`;return{assume:0,static:u,variadic:m,children:p,hasref:c,name:n,kind:r,range:i,selectionRange:s,params:a,param_offsets:y,param_def_len:f.length||2,full:`${u?"static ":""}${n}(${f.substring(2)})`,declaration:{},global:{},local:{},labels:{}}}t.create=e})(Jn||={});var Wt;(t=>{function e(n,r,i){return{name:n,kind:r,range:i,selectionRange:{...i}}}t.create=e})(Wt||={});function yn(e){return e<48?!1:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e>127}String.prototype.trim=function(){return this.replace(/^[ \t\r\n]+|[ \t\r\n]+$/g,"")};String.prototype.trimStart=function(){return this.replace(/^[ \t\r\n]+/,"")};String.prototype.trimEnd=function(){return this.replace(/[ \t\r\n]+$/,"")};var Yb=new RegExp(/['" \t](c|background|#)?((0x)?[\da-f]{6}([\da-f]{2})?|(black|silver|gray|white|maroon|red|purple|fuchsia|green|lime|olive|yellow|navy|blue|teal|aqua))\b/i),Zb=JSON.parse('{ "black": "000000", "silver": "c0c0c0", "gray": "808080", "white": "ffffff", "maroon": "800000", "red": "ff0000", "purple": "800080", "fuchsia": "ff00ff", "green": "008000", "lime": "00ff00", "olive": "808000", "yellow": "ffff00", "navy": "000080", "blue": "0000ff", "teal": "008080", "aqua": "00ffff" }'),Cn=` 	\r
`,Mu="% : + ++ - -- * ** / // & && | || ^ < << <= = == => > >> >>> >= ? ?? ! != !== ~ ~= := += -= *= /= //= &= |= ^= ??= <<= >>= >>>=".split(" "),Lu="export break case continue for global goto if local loop return static switch throw try while".split(" "),Fu=Lu.concat("as catch else false finally isset super true until and contains in is not or".split(" ")),Ge={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",Conditional:"Conditional",Expression:"Expression"},Kg=/^(alttab|alttabandmenu|alttabmenu|alttabmenudismiss|shiftalttab|shift|lshift|rshift|alt|lalt|ralt|control|lcontrol|rcontrol|ctrl|lctrl|rctrl|lwin|rwin|appskey|lbutton|rbutton|mbutton|wheeldown|wheelup|wheelleft|wheelright|xbutton1|xbutton2|(0*[2-9]|0*1[0-6]?)?joy0*([1-9]|[12]\d|3[012])|space|tab|enter|escape|esc|backspace|bs|delete|del|insert|ins|pgdn|pgup|home|end|up|down|left|right|printscreen|ctrlbreak|pause|help|sleep|scrolllock|capslock|numlock|numpad0|numpad1|numpad2|numpad3|numpad4|numpad5|numpad6|numpad7|numpad8|numpad9|numpadmult|numpadadd|numpadsub|numpaddiv|numpaddot|numpaddel|numpadins|numpadclear|numpadleft|numpadright|numpaddown|numpadup|numpadhome|numpadend|numpadpgdn|numpadpgup|numpadenter|f1|f2|f3|f4|f5|f6|f7|f8|f9|f10|f11|f12|f13|f14|f15|f16|f17|f18|f19|f20|f21|f22|f23|f24|browser_back|browser_forward|browser_refresh|browser_stop|browser_search|browser_favorites|browser_home|volume_mute|volume_down|volume_up|media_next|media_prev|media_stop|media_play_pause|launch_mail|launch_media|launch_app1|launch_app2|vk[a-f\d]{1,2}(sc[a-f\d]+)?|sc[a-f\d]+|`[;{]|[\x21-\x7E])$/i,Qe={type:"",content:"",offset:0,length:0,topofline:0,next_token_offset:-1},Ur=[":=","??="],ey=Mu.indexOf(":="),ty=Fu.indexOf("and"),Au=["[","{","=>"],qg="isset throw super false true".split(" "),sr={collapse:2,expand:1,none:0},en={start:{line:0,character:0},end:{line:0,character:0}},Nu=["__NEW","__INIT","__ITEM","__ENUM","__GET","__CALL","__SET","__DELETE"],Bt=Di("Any"),ma=Di("Float",T.SymbolKind.Number),_a=Di("Integer",T.SymbolKind.Number),si=Di("Number",T.SymbolKind.Number),Zn=Di("String",T.SymbolKind.String),da=Di("Array",T.SymbolKind.Class,"Array"),Yn=Di("Object",T.SymbolKind.Class),ny=Di("unset",T.SymbolKind.Null),ci=Di("VarRef",T.SymbolKind.Class,"Any"),qu={...Zn},ju={...Zn},ba={...Zn},zr={def:!0,detail:wi.this(),is_param:!0,kind:T.SymbolKind.Variable,name:"this",range:en,selectionRange:en},Oo={...zr,name:"super",detail:wi.super()},Rt=new RegExp("^[^\0-/:-@[-^`{-\x7F]+$"),Eo,Mg={$DIRPATH:ju,$DLLFUNC:qu,$FILEPATH:ba,ANY:Bt,ARRAY:da,FLOAT:ma,INTEGER:_a,NUMBER:si,OBJECT:Yn,STRING:Zn,UNSET:ny,VARREF:ci},pa=class{message;token;constructor(t,n){this.message=t,this.token=n}},ei=class e{actionwhenv1="Continue";actived=!1;beautify;checkmember;children=[];d=0;d_uri="";declaration={};diagnostics=[];diag_pending;diag_timer;last_diags=0;dlldir=new Map;dllpaths=[];document;find_token;foldingranges=[];fsPath="";get_token;need_scriptdir=!1;include={};includedir=new Map;isparsed=!1;is_virtual=!1;labels={};libdirs=[];linepos={};maybev1;object={method:{},property:{}};parseScript;scriptdir="";scriptpath="";STB=new T.SemanticTokensBuilder;symbolInformation;texts={};typedef={};tokenranges=[];tokens={};uri="";workspaceFolder="";hotstringExecuteAction=!1;constructor(t,n,r=0){let i,s,a,p,u,f,c,m,y,h,C,F,ne,R,g,b,d,X,_=this,Se=En.parse(t.uri),je=!0,Pe=!0,Be=!1,ie=ga,P=!1,j=0,he=!1,ge=!1,pe,k,lt,It,ye,Et,fn,kt,we,ot,gt,xt,et,I,z,Oe,Ae={TK_START_EXPR:Rm,TK_END_EXPR:xm,TK_START_BLOCK:Cm,TK_END_BLOCK:Dm,TK_WORD:Na,TK_RESERVED:Na,TK_STRING:Sm,TK_EQUALS:Em,TK_OPERATOR:Om,TK_COMMA:Pm,TK_BLOCK_COMMENT:Am,TK_INLINE_COMMENT:Nm,TK_COMMENT:Mm,TK_DOT:Lm,TK_HOT:Ma,TK_SHARP:Ma,TK_NUMBER:Fm,TK_LABEL:Km,TK_HOTLINE:Ma,TK_UNKNOWN:qm};this.document=t,t.uri&&(je=!1,this.uri=t.uri.toLowerCase(),this.setWorkspaceFolder(),this.scriptpath=(this.fsPath=Se.fsPath).replace(/[\\/][^\\/]+$/,""),this.initLibDirs(n),Se.scheme!=="file"&&Se.fsPath.substring(1,3)===":\\"&&(this.is_virtual=!0)),this.get_token=function(v,O=!1){let D,E,re;for(v!==void 0&&(D=d,re=g,d=v);(E=an()).type.endsWith("COMMENT")&&O;);return v!==void 0&&(d=D,g=re),E},this.find_token=function(v,O=!1){let D=v,E=h[v],re,L=_.tokens,o={...L[-1]??Qe,type:""};if(!E)return o;if(Cn.includes(E)){for(;Cn.includes(E=h[++D]););if(re=L[D])return re;if(!E&&(re=L[_.tokenranges[_.tokenranges.length-1]?.start])){if(re.offset<=v&&v<re.offset+re.length)return re;re=void 0}}else{if(yn(E.charCodeAt(0)))for(;yn(h.charCodeAt(--D)););else for(;!Cn.includes(E=h.charAt(--D))&&!yn(E.charCodeAt(0)););if(!(re=L[++D]??L[D-1])&&h[D]==="."){for(;yn(h.charCodeAt(--D)););re=L[D+1]}}if(!re&&h.slice(D=h.lastIndexOf(`
`,D)+1,v).trim()&&(re=_.find_token(D)),re){if(re.offset<=v&&v<re.offset+re.length)return re;for(;(re=L[re.next_token_offset])&&!(re.offset>v);)if(v<re.offset+re.length)return re}return!O&&_.findStrOrComment(v)||o},this.beautify=function(v,O){let D;for(!_.isparsed&&_.parseScript(),ye={break_chained_methods:!1,ignore_comment:!1,indent_string:"	",max_preserve_newlines:3,preserve_newlines:!0,space_before_conditional:!0,space_after_double_colon:!0,space_in_empty_paren:!1,space_in_other:!0,space_in_paren:!1,wrap_line_length:0,...v},et=I="",i=!0,g={...Qe},R=-1,D=C,we=_.get_token(0),Et=h.substring(h.lastIndexOf(`
`,d=we.offset)+1,d),Oe=z=!1,Be=!0,fn=ye.indent_string??"	",kt=ye.space_in_other??!0,pe=[S()],It=[],k=void 0,tt(Ge.BlockStatement),ye.symbol_with_same_case&&Hi({textDocument:_.document}),O&&(D=_.document.offsetAt(O.end),we=_.find_token(_.document.offsetAt(O.start)),O.start=_.document.positionAt(d=we.offset),Et=h.substring(h.lastIndexOf(`
`,d)+1,d).match(/^[ \t]*/)[0]);;){if(xt=(we=an()).type,gt=(ot=we.content).toLowerCase(),we.fat_arrow_end)for(;k.in_fat_arrow;)ht();if(we.offset>=D){if(O){let L=we.previous_token,o=d;if(et==="TK_RESERVED"&&["try","else","finally"].includes(I)&&dt(),(!k.declaration_statement||!Te())&&ke(),L?.type){for(;(we=_.find_token(L.skip_pos??L.offset+L.length)).offset<D;)L=we;for(o=L.offset+L.length;" 	".includes(h[o]);o++);for(Cn.includes(h.charAt(o))||(o=L.offset+L.length);Te();)pe.pop()}O.end=_.document.positionAt(o),v.indent_string=Et+fn.repeat(k.indentation_level)}for(;k.mode===Ge.Statement;)ht();break}else if(Oe&&!(Oe=b?!re(we):xt!=="TK_START_BLOCK"||we.data))ht(),et="TK_END_EXPR",k.last_text=")",F=b>0;else if(F=b>0){if(p!==!1){ke();for(let L=1;L<b;L++)pe.push(S())}else if(!Oe&&!k.in_expression&&(we.type.endsWith("COMMENT")||!Zt(k.mode===Ge.Statement?we.previous_token??Qe:{},we))&&!(et==="TK_RESERVED"&&["catch","else","finally","until"].includes(I))){ye.max_preserve_newlines&&b>ye.max_preserve_newlines&&(b=ye.max_preserve_newlines),Te()||pe.push(S());for(let L=1;L<b;L++)pe.push(S())}}Ae[xt](),xt.endsWith("COMMENT")||(!Oe&&xt==="TK_RESERVED"&&["if","for","while","loop","catch","switch"].includes(gt)&&(Oe=!0,tt(Ge.Conditional),gt!=="switch"&&dt()),k.last_text=gt,k.had_comment=0,et=xt,I=gt)}let E=pe.map(L=>L.text.join("")).join(`
`);return pe=[],Be=!1,E;function re(L){if(![Ge.Conditional,Ge.Statement].includes(k.mode)||k.parent.mode===Ge.ObjectLiteral)return!1;switch(L.type){case"TK_DOT":case"TK_COMMA":case"TK_EQUALS":case"TK_COMMENT":case"TK_INLINE_COMMENT":case"TK_BLOCK_COMMENT":return!1;case"TK_OPERATOR":return/^(!|~|not|%|\+\+|--)$/i.test(L.content)&&!Zt(L.previous_token??Qe,L);case"TK_STRING":return!L.ignore&&!Zt(L.previous_token??Qe,L);default:{let o=L.previous_token??Qe;switch(o.type){case"TK_COMMA":case"TK_EQUALS":return!1;case"TK_OPERATOR":return/^(\+\+|--|%)$/.test(o.content)}}}return!0}};function Lt(v,O){ye={max_preserve_newlines:1},kt=!0,fn="	",Be=!0,Et="",delete O.format;for(let D of O){if(!D.range_offset)continue;let[E,re]=D.range_offset;for(et=I="",pe=[S()],z=!1,It=[],k=void 0,tt(Ge.Expression),we=v[v[E].next_token_offset];we&&we.offset<re;we=v[we.next_token_offset])xt=we.type,ot=we.content,gt=ot.toLowerCase(),Ae[xt](),et=xt,k.last_text=I=gt;D.defaultVal=pe.map(L=>L.text.join("")).join(`
`).trim()}Be=!1,pe=[]}if(r||/\.d\.(ahk2?|ah2)$/i.test(this.fsPath))this.d=r||1,je||=!0,this.parseScript=function(){let v=[],O=[],D=this.uri,E="",re=0,L=0,o=0,l=0,nt=!1,K=de(0,0),qe=T.DocumentSymbol.create("",void 0,T.SymbolKind.Namespace,K,K,this.children),H=[],Y,w,xe;for(this.clear(),f={region:[],bracket:[]},a={},X=[],h=this.document.getText(),C=h.length,m=this.scriptpath,g={...Qe},i=!0,d=0,R=-1,u=ne=void 0,y=this.include,qe.property=qe.$property=this.declaration;an().length;);for(H=Object.values(this.tokens),o=H.length;re<o;)switch((Y=H[re]).type){case"TK_WORD":if(Y.topofline>0){if(re<o-4&&Y.content==="class"){Y.type="TK_RESERVED";break}}else if(!nt){re++;break}if(L=re+1,L<o){if(l&&((w=H[L]).topofline||["=>","?",":","[","{"].includes(w.content))){let Ne=Wt.create(Y.content,T.SymbolKind.Property,K=de(Y.offset,Y.length)),ae=Ne,Q={type:6,modifier:4|nt},Me=w.content==="=>";Y.symbol=Y.definition=Ne,ae.parent=qe,ae.has_this_param=!0;let oe=[];if(Nu.includes(E=Ne.name.toUpperCase())||(Y.semantic=Q),Ne.static=nt,Ne.full=`(${O.join(".")}) ${nt?"static ":""}`+Ne.name,(xe=a[Ne.selectionRange.start.line])&&We(xe.symbol=Ne,xe),qe.children?.push(Ne),qe.since||((nt?qe.property:qe.$property)[E]??=Ne,(this.object.property[E]??=[]).push(Ne)),w.content==="["){if(oe=He("]"),oe.length){ae.children=ae.params=oe,ae.full+=`[${oe.full}]`,ae.param_offsets=oe.offset,ae.param_def_len=oe.full.length+2,ae.declaration=ae.local={};for(let De of oe)ae.local[E=De.name.toUpperCase()]??=De}if(!(w=H[++L]))break}if(w.content==="{"){let De=Ne;for(;(Y=H[++L]).content!=="}";)if(Y.content==="=>"){let it=Jn.create(w.content,T.SymbolKind.Function,K=de(w.offset,w.length),{...K},oe);E=w.content.toLowerCase(),it.parent=Ne,w.symbol=w.definition=it,Ve(it),(E==="get"||E==="set")&&(it.has_this_param=!0,De[E]=it)}else w=Y;Ne.type_annotations=De.get?.type_annotations,Me=!!(De.get&&!De.set),Ne.range.end=this.document.positionAt(Y.offset+Y.length)}else if(w.content==="=>"){let De=Jn.create("get",T.SymbolKind.Function,K=de(w.offset,w.length),{...K},oe);De.parent=Ne,Ne.get=De,Me=!0,De.has_this_param=!0,Ve(De),Ne.type_annotations=De.type_annotations,Ne.range.end=De.range.end}else delete ae.has_this_param,w.content==="?"&&(w.ignore=!0,w=H[++L],Ne.defaultVal=null),w?.content===":"?Ve(Ne):(w=H[--L],Ne.range.end=this.document.positionAt(w.offset+w.length));Me&&(Q.modifier|=2)}else if((w=H[L]).content==="("){let Ne=He(),ae=ct(Y.content,Ne,de(Y.offset,Y.length),nt);if(H[L+1]?.content==="=>"?(++L,Ve(ae)):ae.range.end=this.document.positionAt(w.offset+w.length),ae.full+=` => ${Wn(ae.type_annotations)||"void"}`,Y.symbol=Y.definition=ae,Nu.includes(E=ae.name.toUpperCase())||(Y.semantic={type:l?2:1,modifier:6|nt}),(xe=a[ae.selectionRange.start.line])&&We(xe.symbol=ae,xe),qe.children?.push(ae),qe.since??ae.since)l||(cr[E]=ae.since);else{l&&(ae.has_this_param=!0,ae.kind=T.SymbolKind.Method,ae.full=`(${O.join(".")}) ${ae.full}`,ae.parent=qe,(this.object.method[E]??=[]).push(ae));let Q=nt?qe.property:qe.$property;Q[E]?Q[E].call=ae:Q[E]=ae}}else if(!l&&(["=>",":",","].includes(w.content)||w.topofline)){let Ne=Wt.create(Y.content,T.SymbolKind.Variable,K=de(Y.offset,Y.length));Y.symbol=Y.definition=Ne,Ne.assigned=Ne.def=!0,(xe=a[Ne.selectionRange.start.line])&&We(xe.symbol=Ne,xe),["=>",":"].includes(w.content)?Ve(Ne):w.content!==","&&--L,E=Ne.name.toUpperCase(),qe.children.push(Ne),Ne.since?cr[E]=Ne.since:qe.property[E]??=Ne}}re=L+1,nt=!1;break;case"TK_RESERVED":if(nt=!1,Y.topofline!==1)Y.type="TK_WORD";else if((E=Y.content.toLowerCase())==="static")nt=!0,re++;else if(E==="class"){let Ne="",ae=T.DocumentSymbol.create((Y=H[++re]).content,void 0,T.SymbolKind.Class,de(H[re-1].offset,0),de(Y.offset,Y.length),[]);if(L=re+1,O.push(ae.name),Y.semantic={type:0,modifier:6},Y.symbol=Y.definition=ae,ae.extends="",ae.uri??=this.uri,(w=H[L])?.content==="<"&&!w.topofline){let Q={},Me=0;for(;(w=H[++L])?.type==="TK_WORD";){let oe=de(w.offset,w.length),De={name:w.content,data:Me,kind:T.SymbolKind.TypeParameter,range:oe,selectionRange:oe};if(Me++,Q[w.content.toUpperCase()]??=De,(w=H[++L])?.content==="="&&(Ve(De),w=H[++L]),w?.content!==",")break}w?.content===">"?(ae.type_params=Q,w=H[++L]):yt(">")}if(w?.content.toLowerCase()==="extends"){for((w=H[L+1])?.type==="TK_WORD"&&this.children.push(Wt.create(w.content,T.SymbolKind.Variable,de(w.offset,w.length)));++L<o&&(w=H[L]).content!=="{";)Ne+=w.content;ae.extends=Ne}(xe=a[ae.selectionRange.start.line])&&We(xe.symbol=ae,xe),ae.full=O.join("."),ae.property={},ae.prototype={...ae,detail:void 0,property:ae.$property={}},E=ae.name.toUpperCase(),qe.children.push(ae),ae.since?l||(cr[E]=ae.since):(!l&&ae.name.startsWith("$")?_.typedef:qe.property)[E]??=ae,l++,v.push(qe),qe=ae,ae.type_annotations=[ae.full],re=L+1}else E==="global"&&H[re+1].type==="TK_WORD"?re++:Y.type="TK_WORD";break;case"TK_END_BLOCK":l&&(qe.range.end=qe.prototype.range.end=this.document.positionAt(Y.offset+Y.length),qe.property.PROTOTYPE={...qe.prototype,children:void 0,name:"Prototype",kind:T.SymbolKind.Property,full:`(${qe.full}) Prototype`,selectionRange:en,type_annotations:[qe.full]},qe.uri=D,(qe=qe.prototype).uri=D,this.addFoldingRangePos(qe.range.start,qe.range.end),Object.values(qe.property).forEach(Ne=>Ne.parent=qe),l--,O.pop(),qe=v.pop());default:re++,nt=!1;break}if(this.d<0)return;if(this.d&2){let Ne=D.endsWith("/ahk2_h.d.ahk")?1:0,ae;for(let[Q,Me]of Object.entries(this.declaration))switch(Me.kind){case T.SymbolKind.Function:Me.def=!1,Me.uri=D;case T.SymbolKind.Class:Me.overwrite??=Ne,Me.def??=!0,(!(ae=qt[Q])||Ne>=(ae.overwrite??0))&&(qt[Q]=Me);break;case T.SymbolKind.Variable:Me.def&&(qt[Q]=Me,Me.uri=D);break}}Ze(),Gr({},this.children,this),this.isparsed=!0,f.region.forEach(Ne=>this.addFoldingRange(Ne,d-1,"region"));function Ve(Ne){let ae=Q();if((w=H[--L])||(w=H[L=H.length-1]),ae.length){let Me=new Set(ae);Me.delete("void"),Ne.type_annotations=Array.from(Me)}return Ne.range.end=_.document.positionAt(w.offset+w.length),L;function Q(){let Me,oe,De,it,mt=[];e:for(;w=H[++L];){switch(w.type){case"TK_WORD":for(De=w.content,it="TK_WORD",(oe=De==="typeof")&&H[L+1]?.type===it&&!H[L+1].topofline&&(w.semantic=Ag,w=H[++L],De=w.content),(De.toLowerCase()!=="this"||Ne.kind===T.SymbolKind.Function&&Ne.parent?.kind!==T.SymbolKind.Property)&&(w.semantic=Ou);(w=H[++L])&&!w.topofline&&w.type!==it&&(/^[.#~]$/.test(w.content)||w.type==="TK_WORD"&&(w.semantic=Ou));)De+=w.content,it=w.type;if(w?.content==="<"&&!w.topofline){let rt=[];for(;;){if(rt.push(Q()),!w||w.content===">"){let $t={name:De,kind:De.toLowerCase()==="comobject"?T.SymbolKind.Interface:T.SymbolKind.Class,extends:De,full:`${De}<${rt.map(Pt=>Wn(Pt)).join(", ")}>`,range:en,selectionRange:en};$t.generic_types=rt,oe?$t.prototype={...$t}:$t.data=Mg[De.toUpperCase()],mt.push($t),w=H[++L];break}if(w.content!==","){yt(">"),w=H[++L];break}}}else De&&mt.push(oe?`typeof ${De}`:Mg[De.toUpperCase()]??De);break;case"TK_NUMBER":case"TK_STRING":mt.push(w.content),w=H[++L];break;case"TK_START_BLOCK":{let rt="",$t={},Pt=w,un=["TK_NUMBER","TK_RESERVED","TK_WORD"];for(;un.includes((w=wt())?.type);){let _t=Wt.create(w.content,T.SymbolKind.Property,de(w.offset,w.length));if($t[w.content.toUpperCase()]??=_t,w.semantic=Ng,rt+=", "+w.content,xe&&xe===a[_t.selectionRange.start.line]&&We(_t,xe),(w=H[++L])?.content==="?"&&(w.ignore=!0,w=H[++L],_t.defaultVal=null,rt+="?"),w?.content===":"&&(Ve(_t),w=H[++L],rt+=`: ${Wn(_t.type_annotations)||"unknown"}`),w?.content!==",")break;xe=void 0}if(w?.content==="}"){let _t=T.DocumentSymbol.create("",void 0,T.SymbolKind.Class,en,en);_t.property=$t,_t.name=_t.extends="",_t.uri=_.uri,mt.push(Pt.data=w.data=_t),_t.full=(rt=rt.substring(2))&&`{ ${rt} }`}else yt("}"),Pt.data=Yn,w?.content==="}"&&(w.data=Yn);w=H[++L];break}case"TK_COMMENT":case"TK_BLOCK_COMMENT":xe=w;case"TK_INLINE_COMMENT":continue;default:if(w.content==="(")if(",:=?&*)[".includes((Me=H[L+2])?.content??"\0")||Me?.content==="=>"){let rt=w.offset,$t=He(),Pt=ct("",$t,de(rt,0));if(L>=o)break e;H[L+1]?.content==="=>"?(++L,Ve(Pt),w=H[++L]):Pt.range.end=_.document.positionAt(w.offset+w.length),Pt.full+=` => ${Wn(Pt.type_annotations)||"void"}`,mt.push(Pt),Pt.uri=_.uri,xe&&xe===a[Pt.selectionRange.start.line]&&We(xe.symbol=Pt,xe)}else mt.push(...Q()),w?.content===")"&&(w=H[++L]);else if(w.content==="-"&&(w=H[++L])?.type==="TK_NUMBER")mt.push(`-${w.content}`),w=H[++L];else{w.content.toLowerCase()==="throw"&&w.previous_token?.content==="=>"&&(w=H[++L]);break e}break}if(w?.content!=="|")break;xe=void 0}return mt}}function He(Ne=")"){let ae=[],Q=ae.offset??=[],Me=[],oe,De,it=!0,mt=0,rt="";e:for(;(w=H[++L])&&w.content!==Ne;)switch(w.type){case"TK_STRING":if(it!==!0){yt(Ne);break}oe=Wt.create(w.content,T.SymbolKind.String,de(w.offset,w.length)),Q.push(rt.length),rt+=w.content,ae.push(oe),it=!1,(w=H[++L])?.content==="["?(mt++,w.ignore=!0,rt+=" ["):L--;break;case"TK_WORD":if(!it){yt(Ne);break e}if(oe=Wt.create(w.content,T.SymbolKind.Variable,de(w.offset,w.length)),it===1&&(ae.hasref=oe.pass_by_ref=!0,rt+="&",it=!0),oe.assigned=oe.def=oe.is_param=!0,ae.push(oe),w.semantic=Jb,Q.push(rt.length),rt+=w.content,w=H[++L],mt&&(oe.defaultVal=!1),w?.content==="*"?(ae.variadic=oe.arr=!0,w=H[++L],rt+="*"):w?.content==="?"&&(oe.defaultVal=null,w.ignore=!0,w=H[++L],rt+="?"),w?.content===":"&&(w=H[L=Ve(oe)+1],rt+=`: ${Wn(oe.type_annotations)||"unknown"}`),!w||w.content===":="&&(!(w=H[++L])||w.content===Ne||(oe.defaultVal=w.content,"-+".includes(w.content)&&H[L+1]?.type==="TK_NUMBER"&&(oe.defaultVal+=H[++L].content),rt+=` := ${oe.defaultVal}`,!(w=H[++L]))))break e;w.content==="["?(mt++,w.ignore=!0,w=H[++L],rt+=" ["):mt&&w.content==="]"&&(mt--,w.ignore=!0,w=H[++L],rt+="]"),w?.content===","?rt+=", ":(L--,it=!1);break;default:if(w.content===","){if(it){yt(Ne);break e}rt+=", ",it=!0}else if(w.content==="*"){if(!it){yt(Ne);break e}oe=Wt.create("",T.SymbolKind.Variable,de(w.offset,0)),ae.variadic=oe.arr=oe.assigned=oe.def=oe.is_param=!0,mt&&(oe.defaultVal=!1),it=!1,Me.push(rt.length),rt+="*",De?De.data=ae.length%(De.arr=2):De=oe}else if(w.content==="[")mt++,w.ignore=!0,rt+="[";else if(mt&&w.content==="]")mt--,w.ignore=!0,rt=rt.trimEnd()+"] ";else if(it===!0&&w.content==="&")it=1,w.op_type=-1;else{yt(Ne);break e}break}return ae.full=rt,De&&(ae.push(De),Q.push(...Me)),ae}function ct(Ne,ae,Q,Me=!1){let oe={assume:0,children:[],declaration:{},full:`${Me?"static ":""}${Ne}(${ae.full})`,global:{},local:{},hasref:ae.hasref,kind:T.SymbolKind.Function,labels:{},name:Ne,param_def_len:ae.full.length+2,param_offsets:ae.offset,params:ae,range:Q,selectionRange:{...Q},static:Me,variadic:ae.variadic};oe.local=oe.declaration;for(let De of ae)oe.local[De.name.toUpperCase()]=De;return delete oe.local[""],oe}function wt(){for(;(w=H[++L])?.type.endsWith("COMMENT")&&(xe=w););return w}function yt(Ne){let ae=1,Q={">":"<",")":"(","]":"[","}":"{"}[Ne];for(fe(w??=H.at(-1));(w=H[++L])&&(w.content!==Ne||--ae);){if(w.topofline>0)return L--;w.content===Q&&++ae}}};else{let v=this.fsPath.replace(/\.\w+$/,".d.ahk");this.fsPath.endsWith("2")||delete this.actionwhenv1,this.parseScript=function(){h=this.document.getText(),C=h.length,m=this.scriptpath,c="",i=!0,he=!1,j=0,g={...Qe},u=ne=void 0,d=0,R=-1,f={region:[],bracket:[]},p=!1,ie=ga,this.clear(),y=this.include,a={},X=[],s=Mt.Warn?.CallWithoutParentheses;try{let O=Qr.get_RCDATA("#2");O&&(y[O.uri]=O.path),this.children.push(...Ee())}catch(O){P=he=ge=!1,O instanceof pa?O.message&&this.addDiagnostic(O.message,O.token.offset,O.token.length,{severity:T.DiagnosticSeverity.Warning}):console.error(O)}Ze(),Gr(this.declaration,this.children,this),this.isparsed=!0,f.region.forEach(O=>this.addFoldingRange(O,d-1,"region")),this.actived&&(this.actionwhenv1??="Continue")}}function fe(v){v.has_warned??=(_.addDiagnostic(B.unexpected(v.content),v.offset,v.length),!0)}function st(v){_.addDiagnostic(B.unexpected("`n"),h.lastIndexOf(`
`,v.offset),1)}function Ze(){for(let v of Object.values(a))v.data!==null||!/^[ \t]*\*?[ \t]*@typedef\s/m.test(v.content)||Xe(_,v.content,{})}function ze(v,O=!1,D=B.maybev1()){if(he)return!1;switch(_.maybev1??=j=1,_.actionwhenv1??=Mt.ActionWhenV1IsDetected){case"SkipLine":{if(!O)return!0;_.addDiagnostic(B.skipline(),v.offset,v.length,{severity:T.DiagnosticSeverity.Warning});let E,re,L="TK_UNKNOWN";if(v.type==="TK_WORD"||v.content==="="&&(L="TK_STRING")){g=v,d=v.offset+v.length;do{if(re=h.indexOf(`
`,d),re<0&&(re=C),E=h.substring(d,re).trimStart()){let o=re-E.length;g=Je(E=E.trimEnd(),L,o,E.length,0)}for((v=_.find_token(d=re,!0)).content==="("&&(delete _.tokens[v.offset],g={...Qe}),ge=!0,v=Gt();v.ignore&&v.type==="TK_STRING";)re=h.indexOf(`
`,d),re<0&&(re=C),(E=h.substring(d,re).trimEnd())&&(v.content+=E,v.length+=E.length),d=re,v=Gt();ge=!1}while(Zt({},v));d=v.offset}return!0}case"SwitchToV1":if(!_.actived)break;console.info([_.document.uri,D,B.tryswitchtov1()].join(" ")),D="",Ku(_.document.uri);break;case"Continue":return!1;case"Warn":{if(!_.actived)break;Dn?.window.showWarningMessage(`file: '${_.fsPath}', ${D}`,{title:la.switchtov1(),action:"SwitchToV1"},{title:la.skipline(),action:"SkipLine"},{title:la.stopparsing(),action:"Stop"}).then(E=>{(_.actionwhenv1=E?.action??"Continue")!=="Stop"&&(_.actionwhenv1==="SwitchToV1"?Ku(_.document.uri):_.update())});break}}throw _.clear(),d=C,new pa(D,v)}function Ee(v=0,O=_,D=""){let E=[],re=_.document,L=_.tokens,o=_.tokens[d-1]??Qe,l=o.previous_token??Qe,nt=0,K=!0,qe="",H,Y,w,xe,Ve,He=u,ct=P,wt=[],yt=[];return Pe=!0,v&3&&(wt.push(d-1),delete o.data),u=O,P=!1,Q(),u=He,P=ct,o.type==="TK_EOF"&&nt>(v&3?-1:0)?_.addDiagnostic(B.missing("}"),wt[nt-(v&3?0:1)],1):Ve!==void 0&&_.addFoldingRange(Ve,l.offset,"region"),E;function Ne(){if(h[o.offset+o.length]!=="(")return!1;if(v===2)return!0;let A=l,W=o,M=g,se=d,N={"(":-1,"[":0,"{":0},V="",$="";Pe=!1;e:for(;Re();)switch($=o.content){case"(":case"[":case"{":N[$]++;break;case")":case"]":case"}":if(--N[{")":"(","]":"[","}":"{"}[$]]<0){$===")"&&!N["["]&&!N["{"]&&Re()&&(V=o.content);break e}break}return l=A,o=W,g=M,d=se,K=!0,V==="=>"||V==="{"}function ae(A){let W=A.op_type??=M(A);return(W>=0&&(A.topofline===1||!ai(A.previous_token))||W<=0&&!se(_.get_token(A.offset+A.length,!0)))&&_.addDiagnostic(B.missingoperand(),A.offset,A.length),A.op_type;function M(N){switch(N.content.toLowerCase()){case"!":case"~":case"not":return-1;case"%":return N.previous_pair_pos===void 0?-1:1;case"&":case"+":case"-":return N.topofline<1&&ai(N.previous_token??Qe)?0:-1;case"++":case"--":return ai(N)?1:-1;case":":return 0;case"?":return N.ignore?1:0;case"*":if(",([".includes(N.previous_token?.content??"\0")&&",),]()[]".includes(N.previous_token.content+(_.get_token(N.offset+1,!0).content||"\0")))return-1;default:return 0}}function se(N){switch(N?.type){case"TK_START_BLOCK":case"TK_START_EXPR":case"TK_NUMBER":case"TK_STRING":return!0;case"TK_WORD":return!(N.topofline===1&&Rt.test(A.content)&&O.ranges);case"TK_RESERVED":return qg.includes(N.content.toLowerCase());case"TK_OPERATOR":return(N.op_type??=M(N))===-1;case"TK_END_EXPR":case"TK_EOF":if(A.op_type<1&&A.content==="*")return A.op_type=1;default:return!1}}}function Q(A=0){for(o.type==="TK_START_BLOCK"&&(delete o.data,Re(),K=!1,!o.topofline&&!l.topofline&&fe(o));Pe=!0,Re();){if(o.topofline===1){let W;if(Y=o.offset,v===2)Rt.test(o.content)&&(o.content.toLowerCase()!=="static"||".[(".includes(h[d])||(W=_.get_token(d,!0)).topofline||!Rt.test(W.content))&&(o.type="TK_WORD");else{let M=yt.length&&o.content.toLowerCase()==="default"&&(W=_.get_token(d,!0)).content===":";if(M||h[d]===":"&&Cn.includes(h.charAt(d+1))&&Rt.test(o.content)){if(W?((o.next_token_offset=W.next_token_offset)>0&&(L[W.next_token_offset].previous_token=o),delete L[W.offset],o.skip_pos=d=W.offset+1):d++,o.content+=":",o.length++,o.type="TK_LABEL",Y=void 0,delete o.semantic,M){let N=yt.pop();yt.push(o.offset),N&&_.addFoldingRange(N,l.offset,"case"),o.hover_word="default",Re(),K=!1,o.topofline||=-1;continue}o.symbol=w=T.DocumentSymbol.create(o.content,void 0,T.SymbolKind.Field,de(o.offset,o.length),de(o.offset,o.length-1)),w.data=wt.at(-1),w.def=!0,E.push(w),(H=a[w.selectionRange.start.line])&&We(w,H);let se=O.labels[w.name.slice(0,-1).toUpperCase()]??=[];se[0]?.def?(_.addDiagnostic(B.duplabel(),o.offset,o.length-1),se.splice(1,0,w)):se.unshift(w),Re(),K=!1,o.topofline||fe(o);continue}}}switch(o.type){case"TK_EOF":return;case"TK_WORD":if(o.topofline>0&&h[d]!=="%"){switch(Re(),l.content.toLowerCase()){case"class":if(!o.topofline&&De())continue;break;case"import":if(kn>=Po&&v===0&&" 	".includes(h[l.offset+l.length])){mt();continue}break;case"macro":if(ie&&v!==2&&!o.topofline&&l.topofline===1&&Rt.test(o.content)&&Ne()){l.type="TK_RESERVED",o.topofline=2,Re();let W=Me(l,null);W&&(W.full=`macro ${W.full}`);continue}break}if(v===2){if(h[l.offset+l.length]==="("){Me(l);break}if(Au.includes(o.content,o.topofline)){let N=l,V=E.length,$=[],G;if(Y=void 0,o.content==="["&&($=Zu("]")??[],Re(),$.length===0&&_.addDiagnostic(B.propemptyparams(),N.offset,l.offset-N.offset+1),!Au.includes(o.content,1))){_.addDiagnostic(B.propdeclaraerr(),N.offset,N.length),K=!1;break}let J=N.topofline===2,me=J?N.previous_token?.offset:N.offset,ve=N.symbol=T.DocumentSymbol.create(N.content,void 0,T.SymbolKind.Property,G=de(N.offset,N.length),{...G});(H=a[ve.selectionRange.start.line])&&We(H.symbol=ve,H),ve.parent=J?O:O.prototype,ve.has_this_param=!0,ve.static=J,ve.children=E.splice(V);let le="";if($.length){let ce=Jn.create("",T.SymbolKind.Function,G,G,$);le=`[${ce.full.slice(1,-1)}]`,ve.local=ce.local,ve.declaration=ce.declaration,ve.param_offsets=ce.param_offsets,ve.params=$,ii(ve)}if(E.push(ve),Sn(N,ve),ve.full=`(${D.slice(0,-1)}) ${J?"static ":""}${N.content}${le}`,N.semantic={type:6,modifier:4|J},o.content==="{"){let ce,ue,q,_e,bt=o.offset;for(o.previous_pair_pos=me,Re(),K=!1,v=1,o.type==="TK_END_BLOCK"&&!l.topofline&&!o.topofline&&fe(o);Re()&&o.type!=="TK_END_BLOCK";)if(o.topofline&&/^[gs]et$/.test(_e=o.content.toLowerCase())){let Kt;if(Re(),ce=l,o.content==="=>")q=Jn.create(_e,T.SymbolKind.Function,de(l.offset,d-l.offset),de(l.offset,l.length),[...$]),v=3,q.returns=[d,0],q.parent=ve,q.children=_t(void 0,"return",1),v=2,q.range.end=re.positionAt(q.returns[1]=l.offset+l.length),o.fat_arrow_end=!0,_.addFoldingRangePos(q.range.start,q.range.end,"line"),_e==="set"?(q.params.unshift(Kt=Wt.create("Value",T.SymbolKind.Variable,T.Range.create(0,0,0,0))),Kt.is_param=Kt.assigned=Kt.def=!0,Kt.detail=wi.value()):ve.returns=q.returns,q.has_this_param=!0,ii(q),_.linepos[q.range.end.line]=ce.offset;else if(o.content==="{")q=Jn.create(_e,T.SymbolKind.Function,de(ce.offset,d-ce.offset),de(ce.offset,3),[...$]),ue=o,q.parent=ve,q.children=Ee(3,q,D),q.range.end=re.positionAt(d),_e==="set"?(q.params.unshift(Kt=Wt.create("Value",T.SymbolKind.Variable,T.Range.create(0,0,0,0))),Kt.is_param=Kt.assigned=Kt.def=!0,Kt.detail=wi.value()):ve.returns=q.returns,q.has_this_param=!0,ii(q),_.addSymbolFolding(q,ue.offset);else if(q=void 0,_.addDiagnostic(B.invalidprop(),o.offset,o.length),o.content==="}"){K=!1;break}else{let tf=0;for(;o.type!=="TK_EOF";){if(o.content==="{")tf++;else if(o.content==="}"&&--tf<0)break;Re()}K=!1}q&&q!==(ve[q.name]??=q)&&_.addDiagnostic(B.dupdeclaration(),ce.offset,ce.length)}else{let Kt=0;for(_.addDiagnostic(B.invalidprop(),o.offset,o.length),K=!1;Re();)if(o.content==="{")Kt++;else if(o.content==="}"&&--Kt<0)break;K=!1}ve.range.end=re.positionAt(d-1),v=2,_.addSymbolFolding(ve,bt),ve.get&&!ve.set&&(N.semantic.modifier|=2)}else if(o.content==="=>"){let ce=d,ue;v=3,ue=Jn.create("get",T.SymbolKind.Function,G=de(ce,d-ce),en,$),ue.parent=ve,ve.get=ue,ve.returns=ue.returns=[d,0],ue.children=_t(void 0,"return",1),v=2,ve.range.end=ue.range.end=re.positionAt(ue.returns[1]=l.offset+l.length),_.addFoldingRangePos(ue.range.start,ue.range.end,"line"),ue.has_this_param=!0,ii(ue),o.fat_arrow_end=!0,_.linepos[ve.range.end.line]=me,N.semantic.modifier|=2}break}o=l,l=Qe,K=!1,d=o.offset+o.length;let W=E.length,M=O;O=O.$property.__INIT;let se=li("");O.children.push(...E.splice(W)),O=M,E.push(...se),se.forEach(N=>N.parent=M),Y!==void 0&&(_.linepos[(l.pos??=re.positionAt(l.offset)).line]=Y)}else h[l.offset+l.length]==="("?Pt(l,"(")||E.push(..._t()):(rt(o),o=l,l=Qe,d=o.offset+o.length,K=!0,$t(),Y!==void 0&&(_.linepos[(l.pos??=re.positionAt(l.offset)).line]=Y));break}if(v===2){let W=E.length,M=O;O=O.$property.__INIT;let se=li("");O.children.push(...E.splice(W)),O=M,E.push(...se),se.forEach(N=>N.parent=M)}else o.topofline?(K=!0,$t()):(K=!1,E.push(..._t())),Y!==void 0&&(_.linepos[(l.pos??=re.positionAt(l.offset)).line]=Y);break;case"TK_SHARP":to();break;case"TK_RESERVED":oe();break;case"TK_START_BLOCK":v===2?fe(o):(nt++,wt.push(d-1));break;case"TK_END_BLOCK":if(--nt>=0&&wt.length){let W=wt.pop();_.addFoldingRange(o.previous_pair_pos=W,d-1),L[W].next_pair_pos=o.offset,o.topofline===1&&(R=o.offset,i=!0)}if(nt<A)if(!(v&3)&&A===0)fe(o),nt=wt.length=0;else{!o.topofline&&fe(o),wt.length&&o.previous_pair_pos===void 0&&(L[o.previous_pair_pos=wt.at(-1)].next_pair_pos=o.offset);return}break;case"TK_END_EXPR":fe(o),Y=void 0;break;case"TK_HOTLINE":{if(o.symbol=w=T.DocumentSymbol.create(o.content,void 0,T.SymbolKind.Event,de(o.offset,o.length),de(o.offset,o.length-2)),w.range.end=re.positionAt(d-1),E.push(w),(H=a[w.selectionRange.start.line])&&We(w,H),v&3&&_.addDiagnostic(B.hotdeferr(),o.offset,o.length),o.ignore){for(;Re()&&!(!o.ignore||o.type!=="TK_STRING"););w.range.end=re.positionAt(l.offset+l.length),K=!1;break}Lg(o.content)||_.addDiagnostic(B.invalidhotdef(),o.offset,o.length);break}case"TK_HOT":{v&3?_.addDiagnostic(B.hotdeferr(),o.offset,o.length):!o.ignore&&!Lg(o.content)&&_.addDiagnostic(B.invalidhotdef(),o.offset,o.length);let W=o,M=T.DocumentSymbol.create(o.content,void 0,T.SymbolKind.Event,de(o.offset,o.length),de(o.offset,o.length-2));(H=a[M.selectionRange.start.line])&&We(M,H),o.symbol=M,Re();let se;for(M.declaration={},E.push(M),M.global={},M.local={},M.labels={};o.type==="TK_SHARP";)to(),Re();if(o.content==="{")o.previous_pair_pos=W.offset,M.params=[se=Wt.create("ThisHotkey",T.SymbolKind.Variable,de(0,0))],se.detail=wi.thishotkey(),M.children=Ee(1,M),M.range=de(W.offset,d-W.offset),_.addSymbolFolding(M,o.offset),ii(M);else if(o.topofline){if(ii(M),K=!1,o.type.startsWith("TK_HOT"))break;(o.type!=="TK_WORD"||!Ne())&&(ze(W),!j&&_.addDiagnostic(B.hotmissbrace(),W.offset,W.length)),K=!1}else{M.params=[se=Wt.create("ThisHotkey",T.SymbolKind.Variable,de(0,0))],se.detail=wi.thishotkey();let N=O,V=v,$=o.content.toLowerCase(),G=E.length;O=M,v=1,$==="return"?M.children=_t(void 0,"return"):["global","local","static"].includes($)?(oe(),M.children=E.splice(G)):(K=!1,un(null,W.offset),M.children=E.splice(G)),O=N,v=V,ii(M);let J=l.offset+l.length;for(;" 	".includes(h[J]);J++);M.range=de(W.offset,J-W.offset),_.linepos[M.range.end.line]=W.offset}break}case"TK_UNKNOWN":_.addDiagnostic(B.unknowntoken(o.content),o.offset,o.length);break;default:o.topofline===1&&(o.type==="TK_COMMA"?fe(o):l!==Qe&&Zt(l,o,O)?o.topofline=-1:l=Qe),K=!1,v===2?(_.addDiagnostic(B.propdeclaraerr(),o.offset,o.length),_t()):(E.push(..._t()),Y!==void 0&&(_.linepos[(l.pos??=re.positionAt(l.offset)).line]=Y));break}}}function Me(A,W=!1,M,se,N){let V=v===2,$=v,G=O,J=de(A.offset,A.length),me=O={},ve=A.semantic={type:1,modifier:6|W},le=E.length,ce=W?A.previous_token.offset:A.offset;if(V?(v=3,me.has_this_param=!0,me.kind=T.SymbolKind.Method,ve.type=2,me.parent=W?G:G.prototype,A.content[0]<="9"&&_.diagnostics.push({message:B.invalidsymbolname(A.content),range:me.selectionRange})):(v=1,me.kind=T.SymbolKind.Function,$&3&&(me.parent=G),A.length?A.content[0]<="9"?_.diagnostics.push({message:B.invalidsymbolname(A.content),range:me.selectionRange}):Fu.includes(A.content.toLowerCase())&&_.diagnostics.push({message:B.reservedworderr(A.content),range:me.selectionRange}):L[A.offset].symbol=me),Object.assign(me,Jn.create(A.content,me.kind,{start:A.pos=J.start,end:{character:0,line:0}},J,M??=Zu()??(_.addDiagnostic(B.invalidparam(),A.offset,o.offset+1-A.offset),[]),void 0,W)),A.symbol=A.definition=me,A.topofline&&(H=a[me.selectionRange.start.line])&&We(H.symbol=me,H),Re()&&o.content==="=>"){let ue=E.splice(le);me.returns=[d,0];let q=se?dn(se,N):_t(void 0,"return",1);o.fat_arrow_end=!0,E.push(me),(me.children=ue).push(...q),me.range.end=re.positionAt(me.returns[1]=l.offset+l.length),_.addFoldingRangePos(me.range.start,me.range.end,"line"),o.topofline&&(_.linepos[me.range.end.line]=ce)}else if(o.content==="{"){let ue=E.splice(le),q=o;E.push(me),(me.children=ue).push(...Ee(v,me,D)),me.range.end=re.positionAt(d),_.addSymbolFolding(me,q.offset),q.previous_pair_pos=ce,o=_.tokens[o.next_pair_pos]??_.find_token(d-1),se&&(kn<sn&&_.addDiagnostic(B.requireVerN(sn),A.offset,q.offset-A.offset,{code:"function definition expressions"}),q.in_expr=o.in_expr=A.offset,i=!1)}else return _.diagnostics.push({message:B.declarationerr(),range:me.selectionRange}),O=G,v=$,K=!1,void 0;return O=G,v=$,V&&(me.full=`(${D.slice(0,-1)}) `+me.full,(_.object.method[A.content.toUpperCase()]??=[]).push(me)),ii(me),me}function oe(){let A=o.content.toLowerCase(),W=l,M=o.offset,se=d,N;if(Pe=!1,h[o.offset-1]==="%"||h[se]==="%"){o.type="TK_WORD",K=!1;return}switch(A){case"global":case"static":case"local":if(Re(),o.topofline&&!Zt(l,o,O))v===2?_.addDiagnostic(B.propdeclaraerr(),l.offset,l.length):A==="local"||O.static===null||E.some($=>$.kind===T.SymbolKind.Variable)?_.addDiagnostic(B.declarationerr(),l.offset,l.length):O.assume=A==="static"?1:2;else if(Rt.test(o.content)){if(h[d]==="("){let ve=!1;!(v&3)||A!=="static"?_.addDiagnostic(B.declarationerr(),l.offset,l.length):(ve=!0,o.topofline=2),o.type="TK_WORD",Re(),Me(l,ve);break}if(K=!1,!(v&3)){A!=="global"?_.addDiagnostic(B.declarationerr(),l.offset,l.length):E.push(...li(""));break}if(v===2&&Au.includes((N=_.get_token(d,!0)).content,N.topofline)){o.topofline=2,o.type="TK_WORD";break}let $=E.length,G=O;v===2&&(o.topofline=2,O=O.property.__INIT);let J=O,me=li(A==="global"?"":A);if(A==="global")for(let ve of me)J.global[ve.name.toUpperCase()]??=ve;else if(v===2){J.children.push(...E.splice($)),O=G;for(let ve of me)ve.static=!0,ve.parent=G,ve.full=ve.full.replace(") ",") static ")}else{let ve=A==="static";for(let le of me)le.static=ve,J.local[le.name.toUpperCase()]??=le}E.push(...me)}else d=se,l.type="TK_WORD",o=l,l=W,_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);K=!1;break;case"loop":{Re(),o.type==="TK_COMMA"&&(ze(l),j&&Re());let $=0,G=1,J="loop",me;if(o.type==="TK_EQUALS"){d=l.offset+l.length,l.type="TK_WORD",o=l,l=W,K=!1,_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);break}else W=l,(K=" 	,".includes(h[d])&&o.type==="TK_WORD"&&["parse","files","read","reg"].includes(me=o.content.toLowerCase()))&&($=1,G=me==="parse"?3:2,o.type="TK_RESERVED",J+=" "+me,l.hover_word=o.hover_word=J,Re(),o.type==="TK_COMMA"&&Re()&&(o.topofline=0),K=!1);if((!o.topofline||o.type==="TK_COMMA")&&o.type!=="TK_START_BLOCK"?E.push(..._t("{",J,$,G)):$&&_.addDiagnostic(B.acceptparams(J,`${$}~${G}`),W.offset,W.length),un(!1,M,!0))return;o.type==="TK_RESERVED"&&o.content.toLowerCase()==="until"&&(K=!0,Y=o.offset,E.push(..._t(void 0,"until",1)));break}case"for":{let $=On("("),G=[],J=[],me=0;for($&&(N=an());Re();)switch(o.type){case"TK_COMMA":me++;break;case"TK_RESERVED":_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);break;case"TK_WORD":{let ve=mn(o,0);ve&&(ve.def=ve.assigned=!0,ve.for_index=me,ve.returns=G,ve.data=J);break}case"TK_OPERATOR":if(o.content.toLowerCase()==="in"){G.push(o.offset+2),E.push(...dn(void 0,"{")),G.push(l.offset+l.length),N&&(o.content!==")"?_.addDiagnostic(B.missing(")"),N.offset,N.length):(K=!0,Re())),J.push(o.offset),!un(!1,M,!0)&&o.type==="TK_RESERVED"&&o.content.toLowerCase()==="until"&&(K=!0,Y=o.offset,E.push(..._t(void 0,"until",1))),J.push(o.offset,me+1);return}_.addDiagnostic(B.unknownoperatoruse(),o.offset,o.length),K=!1;return;default:K=!1;case"TK_END_EXPR":fe(o);return;case"TK_EQUALS":_.addDiagnostic(B.reservedworderr(l.content),l.offset,l.length);return}break}case"break":case"continue":case"goto":if(Re(),!P&&A!=="goto"&&_.addDiagnostic(B.outofloop(),l.offset),o.type==="TK_COMMA"&&(fe(o),ze(l)),o.topofline)K=!1,A==="goto"&&_.addDiagnostic(B.acceptparams(A,1),l.offset,l.length);else{if(Rt.test(o.content))o.type==="TK_NUMBER"&&A!=="goto"?/[^\d]/.test(o.content)&&fe(o):(o.ignore=!0,o.type="TK_WORD",V(o),delete o.semantic),Re(),K=!1;else if(h[l.offset+l.length]==="("){let $=[];Kn("(",")",void 0,void 0,$),$.forEach(G=>{G.content.indexOf(`
`)<0&&V({content:G.content.slice(1,-1),offset:G.offset+1,length:G.length-2,type:"",topofline:0,next_token_offset:-1})}),Re(),K=!1}else if(o.type==="TK_STRING")fe(o),Re(),K=!1;else{d=l.offset+l.length,l.type="TK_WORD",o=l,l=W,K=!1,_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);break}o.topofline||fe(o)}break;case"as":case"catch":case"else":case"finally":case"until":fe(o);break;case"super":Fa();break;case"case":if(yt.length&&o.topofline){let $=yt.pop();yt.push(o.offset),$&&_.addFoldingRange($,l.offset,"case"),Re(),K=!1,o.content!==":"&&!o.topofline?(E.push(..._t(":","case",1,20)),o.content!==":"?(fe(o),K=!1):(K=!0,Re(),K=!1,o.type==="TK_START_BLOCK"?o.previous_pair_pos=M:o.topofline||=-1)):(K=o.content===":",fe(o))}else o.type="TK_WORD",_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);break;case"try":if(Re(),K=!1,o.type==="TK_COMMA"&&ze(l),un(!0,M),o.type==="TK_RESERVED"&&o.content.toLowerCase()!=="else"){for(;o.content.toLowerCase()==="catch";)K=!0,Y=o.offset,it();for(let $ of["else","finally"])o.content.toLowerCase()===$&&(K=!0,Y=o.offset,Re(),K=!1,un(!0,l.offset))}break;case"isset":La(h[o.offset+5]);break;case"false":case"true":_.get_token(d,!0).type==="TK_EQUALS"?_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length):K=!1,o.type="TK_WORD";break;case"export":if(o.semantic=ua,v===0){let $=!1;if(o.semantic=ua,Re(),o.topofline||o.content!=="("&&!Rt.test(o.content)){fe(l);break}if(_.addDiagnostic(Ri.notimplemented(),l.offset,l.length,{code:"module",severity:T.DiagnosticSeverity.Warning}),(A=o.content.toLowerCase())==="default"&&(N=_.get_token(d,!0),!N.topofline&&(Rt.test(N.content)||N.content==="(")&&($=!0,o.semantic=ua,o.type="TK_RESERVED",Re(),A=o.content.toLowerCase())),A==="class"&&" 	".includes(h[d])&&!(N=_.get_token(d,!0)).topofline&&Rt.test(N.content)){o.topofline=2,Re(),De($?"d":"e");break}if(h[d]==="("&&Rt.test(A)?(N=o,Re()):N=void 0,o.content==="("){Me(N??{...Qe,offset:o.offset});break}K=!1,o.topofline=2,$&&_.addDiagnostic(B.declarationerr(),l.offset);let G=li("");for(let J of G)J.export=!0;E.push(...G)}else fe(o);break;case"throw":if(kn>=sn){o.type="TK_WORD",K=!1;break}default:if(N=Gt(),N.type==="TK_EQUALS"||/^([<>]=?|~=|&&|\|\||[.|?:^]|\*\*?|\/\/?|<<|>>|!?==?)$/.test(N.content))o.type="TK_WORD",d=se,_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);else if(l=o,o=N,K=!1,A==="return"||A==="throw"){o.type==="TK_COMMA"&&ze(l);let $=o.offset;E.push(..._t(void 0,A)),v&1&&A==="return"&&$<=l.offset&&(O.returns??=[]).push($,l.offset+l.length)}else if(A==="switch")if(E.push(..._t("{",A,0,2)),o.content==="{"){o.previous_pair_pos=M,K=!0,wt.push(d-1),yt.push(0),Q(++nt);let $=yt.pop();$&&_.addFoldingRange($,l.offset,"case"),Re(),K=!1}else fe(o);else(A==="if"||A==="while")&&(o.type==="TK_COMMA"&&ze(l),E.push(..._t("{",A,1)),un(!1,M,A==="while"));break}function V($){let G=O.labels;if(!G)return;G[A=$.content.toUpperCase()]??=[];let J=de($.offset,$.length);G[A].push($.symbol=w=T.DocumentSymbol.create($.content,void 0,T.SymbolKind.Field,J,J)),w.data=wt.at(-1)}}function De(A){if(!Rt.test(o.content))return!1;let W=o,M=l.offset,se="";if(l.type="TK_RESERVED",o.type!=="TK_WORD"?(o.type="TK_WORD",_.addDiagnostic(B.reservedworderr(o.content),o.offset)):o.content[0]<="9"&&_.addDiagnostic(B.invalidsymbolname(o.content),o.length),v&1&&_.addDiagnostic(B.classinfuncerr(),o.offset,o.length),o=Gt(),!o.topofline&&o.content.toLowerCase()==="extends")if(o=an(),!o.topofline&&o.type==="TK_WORD"){for(se=o.content,mn(o,0,_.children);d<C&&h[d]==="."&&(an(),o=an(),!o.prefix_is_whitespace&&o.type==="TK_WORD");)se+="."+o.content,Sn(o);o.type==="TK_WORD"&&(o=Gt())}else o.content==="{"&&fe(o);if(o.content!=="{"){if(fe(o),o.topofline)return l=o.previous_token,!(K=!1);if(l=o,o=Gt(),o.content!=="{")return l=(o=l).previous_token,d=o.offset+o.length,!(K=!1)}o.previous_pair_pos=M;let N=T.DocumentSymbol.create(W.content,void 0,T.SymbolKind.Class,en,de(W.offset,W.length));W.symbol=W.definition=N,N.full=D+W.content,N.extends=se,N.uri=_.uri,(H=a[N.selectionRange.start.line])&&We(N,H),N.prototype={...N,cache:[],detail:void 0,property:N.$property={}},N.children=[],N.cache=[],N.property={},N.type_annotations=[N.full];let V=Jn.create("__Init",T.SymbolKind.Method,de(0,0),de(0,0),[],[],!0);return(N.property.__INIT=V).ranges=[],V.parent=N,V.full=`(${N.full}) static __Init()`,V.has_this_param=!0,V=Jn.create("__Init",T.SymbolKind.Method,de(0,0),de(0,0),[],[]),(N.$property.__INIT=V).ranges=[],V.parent=N.prototype,V.full=`(${N.full}) __Init()`,V.has_this_param=!0,N.children=Ee(2,N,D+W.content+"."),N.range=N.prototype.range=de(M,d-M),W.semantic={type:0,modifier:6},ii(N),_.addSymbolFolding(N,o.offset),E.push(N),!0}function it(){let A,W,M=o.offset;if(Y=M,l=W=o,A=Gt(),A.topofline||A.content!=="("?(o=A,A=void 0):o=Gt(),o.topofline||o.type!=="TK_WORD"&&!Rt.test(o.content))A?(d=A.offset-1,fe(o)):(K=!1,o.topofline||o.content==="{"?un(null,M):fe(o));else{let se=[];if(K=!0,o.content.toLowerCase()!=="as"){for(;;){let N="";if(o.type!=="TK_WORD"?fe(o):(mn(o),N+=o.content),l=o,o=Gt(),o.type==="TK_DOT")for(Re();;){if(o.type==="TK_WORD")Sn(o),N+="."+o.content,Re();else if(o.content==="%")fe(o),Kn("%","%"),Re(),N="@";else break;if(o.type!=="TK_DOT")break;Re()}if(!N.startsWith("@")&&se.push(N),o.content===","){if(l=o,o=Gt(),!Rt.test(o.content))break}else break}if(A){if(o.content==="{")return _.addDiagnostic(B.missing(")"),A.offset,1),un(null,M);if(o.content===")")return Re(),K=!1,un(null,M)}else if(o.content==="{"||o.topofline)return K=!1,un(null,M)}if(o.content.toLowerCase()==="as")if(l=o,o=Gt(),K=!1,o.type!=="TK_WORD"&&!Rt.test(o.content))fe(W);else if(o.type!=="TK_WORD")_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length),o.type="TK_WORD";else{let N=Gt();if(d=o.offset+o.length,!N.topofline&&N.content!=="{"&&!(A&&N.content===")"))fe(W),K=!1;else{let V=mn(o);V&&(K=!0,V.def=V.assigned=!0,!se.length&&se.push("Error"),V.type_annotations=se),A&&(N.content===")"?(d=N.offset+1,K=!0):_.addDiagnostic(B.missing(")"),A.offset,1)),K&&(Re(),K=!1,un(null,M))}}else A&&(o.content===")"?(l=o,o=Gt()):_.addDiagnostic(B.missing(")"),A.offset,1)),o.topofline?(K=!1,un(null,M)):fe(o)}}function mt(){let A=ua,W={type:3},M=!0,se=!0,N,V,$;if(l.type="TK_RESERVED",l.semantic=A,_.addDiagnostic(Ri.notimplemented(),l.offset,l.length,{code:"module",severity:T.DiagnosticSeverity.Warning}),o.content==="*")Re();else{if(o.topofline)return K=!1,st(o);if(o.content==="{"){let G=o,J={};for(G.data=J;Re();){if(se&&(N=o).type==="TK_WORD"){if(Re(),o.content==="as"?(o.semantic=A,Re(),o.type==="TK_WORD"?(V=o,Re()):(V=void 0,fe(o))):V=l,V){let me=V.content.toUpperCase();J[me]?_.addDiagnostic(B.dupdeclaration(),V.offset,V.length):(J[me]=$=Wt.create(V.content,T.SymbolKind.Variable,de(V.offset,V.length)),N!==V&&($.alias=N.content,$.alias_range=de(N.offset,N.length)),$.decl=$.def=$.assigned=!0,E.push($))}if(se=o.content===",")continue}if(o.content==="}"){i=!1,G.next_pair_pos=o.offset,o.previous_pair_pos=G.offset,_.addFoldingRange(G.offset,o.offset),Re();break}se=o.content===",",fe(o)}}else(M=!Rt.test(o.content))&&fe(o)}if(M){if(o.content.toLowerCase()==="from"){if(o.topofline&&l.content!=="*"&&st(o),o.type="TK_RESERVED",o.semantic=A,Re(),o.topofline)return K=!1,st(o);Rt.test(o.content)?(o.semantic=W,o.type="TK_WORD"):K=!1}else if(K=!1,o.topofline)return st(o)}if(Re(),!M){if((N=l).semantic=W,l.type="TK_WORD",o.content.toLowerCase()==="as"){if(o.semantic=A,Re(),o.topofline)return K=!1,st(o);Rt.test(o.content)?((V=o).semantic=W,o.type="TK_WORD",Re()):(V=void 0,K=!1)}else V=l;V&&($=Wt.create(V.content,T.SymbolKind.Variable,de(V.offset,V.length)),N!==V&&($.alias=N.content,$.alias_range=de(N.offset,N.length)),$.decl=$.def=$.assigned=!0,E.push($))}(K=!o.topofline||Zt(l,o))&&(fe(o),_t())}function rt(A){let W=A.previous_extra_tokens;W&&(W.i=0)}function $t(){let A="",W;if(Re(),K=!1,(W=o.ignore&&o.content==="?")&&(o=an()),o.type!=="TK_EQUALS"&&!/^(=[=>]?|\?\??|:)$/.test(o.content)&&(o.type==="TK_DOT"||`, 	\r
`.includes(A=h.charAt(l.offset+l.length))))if(o.type==="TK_DOT"){let M=mn(l);for(K=!0,W&&M&&(M.returns=null);Re();){if(o.type==="TK_WORD"){let se=!0;if(h[d]==="%")se=!1;else if(Sn(o),Re(),Ur.includes(o.content))se=!1,Oi(l,void 0,()=>{let N=d;return E.push(...dn()),[N,l.offset+l.length]});else if(o.ignore&&o.content==="?"&&(o=an()),o.type==="TK_DOT")continue;K=!1,se&&o.type!=="TK_EQUALS"&&!"=??".includes(o.content||" ")&&`, 	\r
`.includes(A=h.charAt(l.offset+l.length))?Pt(l,A,T.SymbolKind.Method):E.push(..._t())}else K=!1,E.push(..._t());break}}else mn(l),Pt(l,A);else{let M,se;if(/^=>?$/.test(o.content)&&(M=o.content,se=o.offset),j&&M==="="&&ze(o,!0)&&(K=!1,l=Qe,o=Gt()))return;rt(o),o=l,l=Qe,K=!1,d=o.skip_pos??o.offset+o.length,E.push(..._t(void 0,M,se))}}function Pt(A,W,M,se,N){let V={offset:A.offset,miss:[],comma:[],count:0,unknown:!1,name:A.content},$,G,J;if("([".includes(W||="\0")){let ve=o,le=E.length,ce=_.diagnostics.length;if(Kn(W,W==="("?")":"]",o.offset,V),M===void 0&&(J=_.get_token(d,!0),G=J.content,G==="=>"||G==="{"&&N!=="{"&&(A.topofline>0||!J.topofline||v&8)))return E.splice(le),_.diagnostics.splice(ce),A.ignore&&h[A.offset-1]==="%"&&(delete A.ignore,_.addDiagnostic(B.missingspace(),A.offset)),l=A,o=ve,d=o.offset+o.length,K=!0,Me(A,A.topofline===2,void 0,se,N);V.offset=ve.offset,$=de(A.offset,A.length)}else{if(W===","||j){if(!M&&Cg.includes(A.content.toLowerCase())&&ze(A,!0)&&(K=!1,l=Qe,o=Gt()))return;W===","&&_.addDiagnostic(B.funccallerr(),o.offset,1)}(G=o.type)==="TK_OPERATOR"&&!/^(not|\+\+?|--?|!|~|%|&)$/i.test(o.content)&&fe(o),A.paraminfo=V,E.push(..._t(void 0,void 0,void 0,void 0,V)),$=de(A.offset,A.length),(s===!0||s&&G==="TK_START_EXPR")&&_.diagnostics.push({code:"call statement",range:$,message:Ri.callwithoutparentheses(),severity:T.DiagnosticSeverity.Warning})}if(A.ignore)return delete A.semantic,void 0;let me=T.DocumentSymbol.create(A.content,void 0,M??=T.SymbolKind.Function,{...$},$);if(me.paraminfo=V,me.offset=A.offset,A.callsite=me,l===A){let ve=h.indexOf(`
`,A.offset);V.end=ve<0?C:ve}else V.end=l.offset+l.length;switch(me.range.end=re.positionAt(V.end),M){case T.SymbolKind.Method:Oi(A,V.method=!0),A.semantic={type:2};break;case T.SymbolKind.Function:A.semantic={type:1};case T.SymbolKind.Variable:mn(A);break}}function un(A,W,M=!1){let se=P,N=v;if(P||=M,K=!0,v|=4,Pe=!1,o.type==="TK_START_BLOCK")o.previous_pair_pos=W,wt.push(d-1),Q(++nt),Re(),K=o.type==="TK_RESERVED"&&o.content.toLowerCase()==="else";else{if(o.type==="TK_RESERVED"&&Lu.includes(o.content.toLowerCase())){let V=o;oe(),(V===o||V===l&&!K&&!o.topofline)&&(V===o&&V.type==="TK_WORD"?(K=!0,$t()):E.push(..._t()))}else if(o.type==="TK_WORD"){if(o.topofline>0&&o.content.toLowerCase()==="class"){if(Re()&&De())return v=N,A;K=!1}$t()}else o.type!=="TK_EOF"&&(l=Qe,K=!1,E.push(..._t()));Y!==void 0&&(_.linepos[(l.pos??=re.positionAt(l.offset)).line]=Y),K=o.type==="TK_RESERVED"&&o.content.toLowerCase()==="else"}if(P=se,v=N,typeof A=="boolean"){if(A)K=!1;else if(K)return Y=o.offset,Re(),K=!1,un(!0,l.offset),!0}else K=!1;return!1}function _t(A,W,M=0,se=1,N){let V,$=0,G=0,J,me,ve=[],le=N??{offset:0,count:0,comma:[],miss:[],unknown:!1};if(Pe=!1,K){let ce=_.get_token(d,!0);V=ce.content?ce.offset:d+1,ce.type==="TK_COMMA"?le.miss.push(le.count++):(!ce.topofline||Zt(o,ce))&&(++le.count,J=ce)}else V=o.content?o.offset:l.offset+l.length+1,o.type==="TK_COMMA"?le.miss.push(le.count++):(!o.topofline||Zt(l,o))&&(++le.count,J=o);for(;;){if(ve.push(...dn(void 0,A)),me??=o.offset,o.type==="TK_COMMA")K=!0,++$,++le.count,l.type==="TK_COMMA"||l.type==="TK_START_EXPR"?le.miss.push(le.comma.length):l.type==="TK_OPERATOR"&&!l.ignore&&!/(--|\+\+|%)/.test(l.content)&&fe(o),le.comma.push(o.offset),N&&(o.paraminfo=N);else if(o.topofline){K=!1;break}else{if(A===o.content)break;G!==d&&(fe(o),K=!1)}if(G===d&&(!p||o.length))break;G=d}if(W==="="||W==="=>"){let ce=_.find_token(V),ue=!0,q=_.tokens;if(ce.offset<me){for(;ce&&ce.offset<me;){if(!ce.ignore&&ce.content==="?"){ue=!1;break}ce.symbol?ce=_.find_token(_.document.offsetAt(ce.symbol.range.end),!0):ce=q[ce.next_pair_pos??ce.next_token_offset]}if(ue){if(W==="="&&ze(q[J.next_token_offset],!0)&&(K=!1,l=Qe,ce=Gt()))return[];_.addDiagnostic(`${B.unexpected(W)}, ${B.didyoumean(":=")}`,M,W.length,{code:"expect",data:":="})}}}else W&&($>=se||le.count-(o===J?1:0)<M)&&_.addDiagnostic(B.acceptparams(W,se===M?M:`${M}~${se}`),V,l.offset+l.length-V);return l.content==="*"&&(le.unknown=!0,le.count--),ve}function to(){let A=!1,W,M=o.data??{content:"",offset:o.offset+o.length,length:0};switch(W=o.content.toLowerCase()){case"#dllload":A=!0;case"#include":case"#includeagain":Ft(M.content.replaceAll("`;",";"),M,v,A);break;case"#dllimport":if(xe=M.content.match(/^((\w|[^\x00-\x7f])+)/i)){let se=de(M.offset,xe[0].length),N=T.Range.create(0,0,0,0),V={t:"ptr",i:"int",s:"str",a:"astr",w:"wstr",h:"short",c:"char",f:"float",d:"double",I:"int64"},$=xe[0],G=[],J,me="",ve=0,le="i";ie=!0,xe=M.content.substring(xe[0].length).match(/^[ \t]*,[^,]+,([^,]*)/),xe=xe?.[1].replace(/[ \t]/g,"").toLowerCase().replaceAll("i6","I")??"";for(let ue of xe.replace(/^(\w*)[=@]?=/,(q,_e)=>(le=_e||le,"")))if(ue==="u")me="u";else if(V[ue])G.push(J=Wt.create(`p${++ve}_${me+V[ue]}`,T.SymbolKind.Variable,N)),J.defaultVal=null,me="";else if(J&&(ue==="*"||ue==="p"))J.name+="p",J=void 0;else{_.addDiagnostic(B.invalidparam(),M.offset,M.length);return}let ce=Jn.create($,T.SymbolKind.Function,se,se,G);ce.type_annotations=["fd".includes(le)?"Float":"asw".includes(le)?"String":"Integer"],E.push(ce)}break;case"#requires":W=M.content.toLowerCase(),ie||=W.startsWith("autohotkey_h"),(xe=W.match(/^\w+[ \t]+v(1|2)/))&&(xe[1]==="2"?he=!0:(_.maybev1=3,!ze(M,!1,B.requirev1())&&fe(M)));break;case"#hotif":v&3?_.addDiagnostic(B.invalidscope(o.content),o.offset,o.length):(Ve!==void 0&&_.addFoldingRange(Ve,o.offset),Re(),K=!1,Ve=o.topofline?void 0:l.offset);break;case"#hotstring":W=M.content?.trim().toLowerCase()??"",W!=="nomouse"&&W!=="endchars"&&(_.hotstringExecuteAction=/x(?!0)/.test(W));break;case"#module":kn<Po?_.addDiagnostic(B.requireVerN(Po),o.offset,o.length,{code:"module"}):_.addDiagnostic(Ri.notimplemented(),o.offset,o.length,{code:"module",severity:T.DiagnosticSeverity.Warning});break;default:/^#(if|hotkey|(noenv|persistent|commentflag|escapechar|menumaskkey|maxmem|maxhotkeysperinterval|keyhistory)\b)/i.test(W)&&!ze(o)&&fe(o);break}}function li(A){let W=[],M=v,se=M===2,N;Pe=!1,se&&(v=3);e:for(;Re();){if(o.topofline===1&&!Zt(l,o,O)){K=!1;break}switch(o.type){case"TK_OPERATOR":if(!Rt.test(o.content)){fe(o),dn(",");break}case"TK_RESERVED":se||_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length),o.type="TK_WORD";case"TK_WORD":if(Re()&&o.type==="TK_EQUALS"){let V=o.content,$=d,G=mn(l,M,W);se&&(A&&(l.semantic.modifier=1),V!==":="&&_.addDiagnostic(`${B.unexpected(V)}, ${B.didyoumean(":=")}`,o.offset,o.length,{code:"expect"})),(N=a[G.selectionRange.start.line])&&We(G,N),E.push(...dn());let J=[$,l.offset+l.length];O.ranges?.push(J),V===":="||V==="??="&&(G.assigned??=1)?G.returns=J:G.cached_types=[V===".="?Zn:si],G.assigned??=!0,G.decl=G.def=!0,G.range.end=re.positionAt(l.offset+l.length)}else if(se){let V=B.propnotinit(),$=0,G=l,J=mn(l,2,W);if(J.def=!1,A&&(l.semantic.modifier=1),o.type==="TK_DOT")for(V=B.propdeclaraerr();!o.prefix_is_whitespace&&Re()&&o.type==="TK_WORD"&&Re();){if(o.type==="TK_EQUALS"){let me=d,ve=l,le=Ur.includes(o.content);le&&o.content!==":="&&_.addDiagnostic(`${B.unexpected(o.content)}, ${B.didyoumean(":=")}`,o.offset,o.length,{code:"expect"}),Sn(l),E.push(...dn());let ce=[me,l.offset+l.length];if(O.ranges?.push(ce),!$&&le&&O.static&&G.content.toLowerCase()==="prototype"){let ue=Wt.create(ve.content,T.SymbolKind.Property,de(ve.offset,ve.length)),q=O.parent.prototype;(H=a[ue.selectionRange.start.line])&&We(ue,H),ue.parent=q,ue.returns=ce,q.cache.push(ue)}continue e}if(o.type==="TK_DOT")Sn(l),$++;else break}else if(!A&&o.content===":"){let me=o.offset+1,ve="",le=!1,ce,ue=O,q=u.property.__INIT,_e=q.children.length;if(delete J.def,J.typed=!0,l=o,o=an(),V="",Rt.test(o.content))ce=o,ve+=o.content,Re();else if(o.type==="TK_START_EXPR"){let bt=E.length;O=q,le=!0,Kn(o.content,o.content==="("?")":"]"),q.children.push(...E.splice(bt)),O=ue,Re()}else o.content===":="||o.type==="TK_COMMA"||o.topofline&&Rt.test(o.content)?(fe(o),K=!1):V=B.propdeclaraerr();if(kn<sn&&_.addDiagnostic(B.requireVerN(sn),G.offset,l.offset+l.length-G.offset,{code:"typed properties"}),!V){for(;;)if(o.content==="."&&o.type!=="TK_OPERATOR")o.type!=="TK_DOT"&&fe(o),Re()&&o.type==="TK_WORD"&&(ve+="."+o.content,Sn(o),Re());else if(o.type==="TK_START_EXPR"&&!o.prefix_is_whitespace&&Rt.test(l.content)){let bt=E.length,Kt=l.previous_token?.type==="TK_DOT";O=q,le=!0,Pt(l,o.content,o.content==="["?Kt?T.SymbolKind.Property:T.SymbolKind.Variable:Kt?T.SymbolKind.Method:T.SymbolKind.Function),q.children.push(...E.splice(bt)),O=ue,Re()}else break;if(ce&&(o.previous_token===ce&&/^([iu](8|16|32|64)|f(32|64)|[iu]ptr)$/i.test(ce.content)?(J.type_annotations=[/^f/i.test(ce.content)?"Float":"Integer"],ce.semantic=Ou):ce.type==="TK_WORD"&&mn(ce,3,q.children)),J.type_annotations??=le||!ve?["Any"]:[ve],o.content===":="){q.ranges?.push([me,o.offset-1]),me=o.offset+2,E.push(...dn()),O.ranges?.push([me,l.offset+l.length]);continue e}if(o.content===","||(o.content==="}"||o.topofline&&Rt.test(o.content))&&!(K=!1)){q.ranges?.push([me,o.offset-1]);continue e}V=B.propdeclaraerr(),q.children?.splice(_e),J.def=!1}}if(V&&_.addDiagnostic(V,G.offset),o.content==="}"||o.topofline&&Rt.test(o.content)){l=Qe,K=!1;break e}o.content!==","&&(fe(o),dn())}else if(o.content===","||o.topofline&&!Zt(l,o,O)){let V=mn(l,M,W);if(V.decl=V.def=!0,(N=a[V.selectionRange.start.line])&&We(V,N),o.content!==","){K=!1;break e}}else fe(o),dn(",");break;case"TK_COMMA":l.content===","&&fe(o);continue;case"TK_END_BLOCK":K=!1;break e;default:fe(o),dn(",")}}return v=M,W}function dn(A=",",W){let M=E.length,se=[],N;for(Pe=!1;Re();){if(o.topofline===1)if(A===","&&!Zt(l,o,O)){l.type==="TK_WORD"&&h[l.offset-1]==="."&&Sn(l),K=!1;break}else l!==Qe&&(o.topofline=-1);switch(o.type){case"TK_WORD":{if(h[d]==="(")continue;let V=h[o.offset-1]===".";if(Re(),o.type==="TK_COMMA"){if(V)Sn(l),N&&(l.__ref=!0);else if(h[l.offset-1]!=="%"){let $=mn(l);$&&N!==void 0&&($.def=$.assigned=!0,N?$.pass_by_ref=!0:$.cached_types=[si])}else l.ignore=!0;return K=!1,E.splice(M)}else if(o.type==="TK_OPERATOR"&&(!o.topofline||!/^(!|~|not|\+\+|--)$/i.test(o.content))){let $=!o.topofline&&["++","--"].includes(o.content);if(h[l.offset-1]!=="%"&&h[l.offset+l.length]!=="%")if(V){if(Sn(l),N){if(o.ignore&&_.get_token(d,!0).type==="TK_DOT")continue;l.__ref=!0}}else{let G=mn(l);G&&(N!==void 0&&(G.def=G.assigned=!0,N?G.pass_by_ref=!0:G.cached_types=[si]),$?(G.def=G.assigned=!0,G.cached_types=[si]):o.content==="??"||o.ignore?G.returns=null:N===void 0&&o.content==="=>"&&Me({...Qe,offset:l.offset},K=!1,E.splice(-1),A,W??(se.length?":":void 0)))}else V?(Oi(l,null),o=l,l=o.previous_token??Qe,Wo(A),Re(),$||=!o.topofline&&["++","--"].includes(o.content)):l.ignore=!0;K=!1;break}else if(o.topofline&&o.type!=="TK_EQUALS"&&o.type!=="TK_DOT"){if(K=!1,V)h[l.offset-1]!=="%"?(Sn(l),N&&(l.__ref=!0)):l.ignore=!0;else if(h[l.offset-1]!=="%"){let $=mn(l);$&&N!==void 0&&($.def=$.assigned=!0,N?$.pass_by_ref=!0:$.cached_types=[si])}else l.ignore=!0;return ki(se),E.splice(M)}if(V){if(Sn(l),K=o.type==="TK_EQUALS")Ur.includes(o.content)&&Oi(l,void 0,()=>{let $=d;return E.push(...dn(A,W??(se.length?":":void 0))),[$,l.offset+l.length]});else if(N){if(o.type==="TK_DOT"||o.ignore&&o.content==="?"&&_.get_token(d,!0).type==="TK_DOT")continue;l.__ref=!0}}else{let $;if(h[l.offset-1]!=="%"&&($=mn(l))){if(N)if(o.type!=="TK_DOT")$.assigned=$.def=$.pass_by_ref=!0;else if(kn<sn+7)_.addDiagnostic(B.requireVerN(sn+7),l.previous_token.offset,1,{code:"virtual references"});else{o.topofline&&=-1;continue}else N===!1&&o.type!=="TK_DOT"&&($.def=$.assigned=!0,$.cached_types=[si]);if(o.type==="TK_EQUALS"){(H=a[$.selectionRange.start.line])&&We($,H);let G=o.content,J=d;K=!0,E.push(...dn(A,W??(se.length?":":void 0))),$.range.end=re.positionAt(l.offset+l.length),G===":="||G==="??="&&($.assigned??=1)?$.returns=[J,l.offset+l.length]:$.cached_types=[G===".="?Zn:si],$.assigned??=!0,$.def=!0}else K=!1}else K=!1,l.ignore=!0}break}case"TK_START_EXPR":if(o.content==="[")Kn("[","]");else{let V,$;l.type==="TK_WORD"&&l.offset+l.length===o.offset?(V=l).previous_token?.type==="TK_DOT"?$=T.SymbolKind.Method:h[l.offset-1]==="%"&&V.previous_token?.op_type===1&&(V.ignore=delete V.semantic):V={...Qe,offset:o.offset,ignore:!0},Pt(V,"(",$,A,W??(se.length?":":void 0))}continue;case"TK_START_BLOCK":if(!o.data){let V=_.diagnostics.length,$=o.offset,G;if(W==="{"?l.topofline&&l.type==="TK_RESERVED"?l.content.toLowerCase()==="switch"?!o.topofline&&!_.get_token(d,!0).topofline&&(G=!0):_.addDiagnostic(B.unexpected("{"),$,1):l.op_type===1||ai(l)||(G=!1):(G=!0,ai(l)&&_.addDiagnostic(B.unexpected("{"),$,1)),G!==void 0){if(ef(G))break;_.diagnostics.splice(V),!G&&(l.type==="TK_EQUALS"||(l.op_type??1)<1)&&_.addDiagnostic(B.unexpected("{"),$,1)}}return ki(se),K=!1,E.splice(M);case"TK_NUMBER":case"TK_STRING":break;case"TK_END_BLOCK":case"TK_END_EXPR":case"TK_COMMA":return K=!1,ki(se),E.splice(M);case"TK_LABEL":fe(o);break;case"TK_UNKNOWN":_.addDiagnostic(B.unknowntoken(o.content),o.offset,o.length);break;case"TK_RESERVED":{let V=h[o.offset+o.length];if(V==="%"||h[o.offset-1]==="%"){o.ignore=!0,o.type="TK_WORD";continue}switch(qe=o.content.toLowerCase()){case"false":case"true":o.type="TK_WORD",N!==void 0||_.get_token(d,!0).type==="TK_EQUALS"?_.addDiagnostic(B.reservedworderr(o.content),o.offset):K=!1;continue;case"isset":La(V);continue;case"super":Fa();continue}if(kn>=sn&&qe==="throw"){K=!1,o.type="TK_WORD";continue}if(o.topofline&&!")]".includes(A)&&Lu.includes(qe))return o.topofline=1,K=!1,st(o),ki(se),E.splice(M);_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);break}case"TK_OPERATOR":if(o.content==="%"){if(A==="%")return K=!1,ki(se),E.splice(M);h[o.offset-1]==="."?(Oi(o,null),Wo()):Kn("%","%");continue}else if(o.content==="=>")fe(o);else{if(Rt.test(o.content)&&(h[o.offset-1]==="%"||h[d]==="%")){o.ignore=!0,o.type="TK_WORD";continue}if(o.content===":"){if(se.pop()===void 0){if(W===":")return K=!1,E.splice(M);fe(o)}}else if(o.content==="?")if(!o.ignore)se.push(o.offset);else continue;if(ae(o)===-1){if(o.content==="&"){N=!0;continue}if(["++","--"].includes(o.content)){N=!1;continue}}}break;case"TK_EQUALS":break;case"TK_DOT":continue}N=void 0}return ki(se),E.splice(M)}function Zu(A=")"){let W=d-1,M=[],se=[",",A===")"?"(":"["],N=o,V=!1,$=!0,G=d,J=o,me=!1,ve=!1,le,ce={offset:W,count:0,comma:[],miss:[],unknown:!1};for(Pe=!1,J.paraminfo=ce,l.type==="TK_WORD"&&J.prefix_is_whitespace===void 0&&(ce.name=l.content,me=l.topofline>0);Re();)if(o.topofline===1&&(o.topofline=-1),o.content===A){l.type==="TK_COMMA"&&fe(o);break}else if(o.type==="TK_WORD")if(ce.count++,se.includes(l.content)||l===Qe)if(Re(),o.content===","||o.content===A){let ue=Wt.create(l.content,T.SymbolKind.Variable,de(l.offset,l.length));if((H=a[ue.selectionRange.start.line])&&ue.selectionRange.start.line>(le??=_.document.positionAt(W).line)&&We(ue,H),V&&(V=!1,ue.pass_by_ref=ue.def=ue.assigned=!0),M.push(ue),G=d,J=o,o.content===",")ce.comma.push(o.offset),o.paraminfo=ce;else break}else if(o.content===":="||o.content==="="){o.content==="="&&(me&&ze(l),_.addDiagnostic(`${B.unexpected("=")}, ${B.didyoumean(":=")}`,o.offset,o.length,{code:"expect",data:":="}));let ue=o,q=Wt.create(l.content,T.SymbolKind.Variable,de(l.offset,l.length));if((H=a[q.selectionRange.start.line])&&q.selectionRange.start.line>(le??=_.document.positionAt(W).line)&&We(q,H),q.def=!0,q.defaultVal=null,M.push(q),E.push(...dn(",")),K=!0,G=d,J=o,l!==ue){q.returns=[ue.offset+ue.length,l.offset+l.length],q.range.end=_.document.positionAt(l.offset+l.length);let _e=o.previous_token,bt=[];for(;_e&&_e!==ue&&bt.unshift(_e)<3;)_e=_e.previous_token;bt.length===1?bt[0].content.toLowerCase()!=="unset"&&(q.defaultVal=bt[0].content):bt.length===2&&"-+".includes(bt[0].content)?q.defaultVal=`${bt[0].content}${bt[1].content}`:(q.range_offset=[ue.offset,o.offset],ve=!0)}if(V&&(V=!1,q.pass_by_ref=q.assigned=!0),o.type==="TK_COMMA"){ce.comma.push(o.offset),o.paraminfo=ce;continue}else{$=o.content===A;break}}else if(o.type==="TK_OPERATOR")if(o.content==="*"){let ue=l;if(Re(),o.content===A){let q=Wt.create(ue.content,T.SymbolKind.Variable,de(ue.offset,ue.length));M.push(q),q.arr=!0,ce.unknown=!0,G=d,J=o;break}else{$=!1,ce.count--;break}}else if(o.content==="?"&&o.ignore){let ue=Wt.create(l.content,T.SymbolKind.Variable,de(l.offset,l.length));if(ue.def=!0,ue.defaultVal=null,M.push(ue),V&&(V=!1,ue.pass_by_ref=ue.assigned=!0),Re(),o.type==="TK_COMMA"){ce.comma.push(o.offset),G=d,J=o;continue}else{($=o.content===A)||(M.pop(),ce.count--);break}}else{$=!1,ce.count--;break}else{if(l.type==="TK_WORD"&&l.content.toLowerCase()==="byref"&&o.type==="TK_WORD"){me&&ze(l),_.addDiagnostic(B.deprecated("&","ByRef"),l.offset,o.topofline?l.length:o.offset-l.offset,{code:"expect",data:"&"}),K=!1,l=Qe;continue}$=!1,ce.count--;break}else{$=!1,ce.count--;break}else if(se.includes(l.content)){let ue=o;if(o.content==="*"){let q;if(Re(),o.content===A){M.push(q=Wt.create("",T.SymbolKind.Variable,de(ue.offset,0))),q.arr=!0;break}else fe(ue)}else if(o.content==="&")if(o=Gt(),o.type==="TK_WORD"){V=!0,K=!1;continue}else fe(ue);$=!1;break}else{$=!1;break}if(ce.comma.forEach(ue=>L[ue].paraminfo=ce),$)return ve&&(M.format=Lt.bind(void 0,_.tokens)),o.previous_pair_pos=W,N.next_pair_pos=o.offset,_.addFoldingRange(W,d,"block"),M;{let ue=E.length;d=G,o=J,Kn(A===")"?"(":"[",A,W,ce),E.splice(ue);return}}function Wo(A){for(K=!1,d=o.offset+o.length;Re();)switch(o.type){case"TK_OPERATOR":if(o.content==="%"){if(A==="%")return K=!1;if(Kn("%","%"),yn(h.charCodeAt(d)))break;return}case"TK_NUMBER":if(!Rt.test(o.content))return K=!1;case"TK_RESERVED":case"TK_WORD":if(o.type="TK_WORD",o.semantic={type:6},h[d]==="%"&&(o.ignore=!0))break;l.content==="%"&&(o.ignore=!0);return;default:return K=!1}}function ef(A=!1){let W=l,M=o,se=E.length,N=v,V=[],$={},G=!0,J,me;for(Pe=!1,K=!0,o.data=Yn,v|=8;G;)if(!ve()||le()){if(A&&!G){for(me=l,G=!0;!",}".includes(o.content);)dn("}"),K=!0;if(K=!0,_.addDiagnostic(B.objectliteralerr(),me.offset,l.offset+l.length-me.offset),o.content===",")continue}break}if(G||A)for(let ce of V)(J=L[ce]).type="TK_WORD",J.semantic=Ng;if(G)(l.content===":"||l.type==="TK_LABEL")&&fe(o);else return l=W,o=M,E.splice(se),v=N,d=o.skip_pos??o.offset+o.length,K=!1;if(M.data=Yn,o.type==="TK_END_BLOCK"){if(i=!1,_.addFoldingRange(o.previous_pair_pos=M.offset,o.offset),M.next_pair_pos=o.offset,Object.keys($).length){let ce=T.DocumentSymbol.create("",void 0,T.SymbolKind.Class,en,en);M.data=ce,ce.property=$,ce.name=ce.full=ce.extends=""}o.data=M.data}else _.addDiagnostic(B.missing("}"),M.offset,1);return v=N,!0;function ve(){for(;Re();)switch(J=void 0,o.topofline===1&&(o.topofline=-1),o.type){case"TK_OPERATOR":if(o.content==="%"){if(Kn("%","%"),yn(h.charCodeAt(d)))break;return Re(),o.content===":"?!0:G=!1}case"TK_NUMBER":if(!Rt.test(o.content))return G=!1;case"TK_RESERVED":case"TK_WORD":{if(V.push(o.offset),h[d]==="%")break;let ce=l;return Re(),o.content===":"?(ce.content!=="%"&&(J=l),!0):G=!1}case"TK_STRING":return Re(),o.content===":"?(J={...l},J.content=J.content.slice(1,-1),J.offset++,J.length-=2,!ie&&(!l.content.startsWith('"')||!ze(l))&&_.addDiagnostic(`${B.invalidpropname()}, ${B.didyoumean(J.content)}`,l.offset,l.length,{code:"expect",data:J.content}),!0):G=!1;case"TK_LABEL":return/^(\w|[^\x00-\x7f])+:$/.test(o.content)?(J={...o},J.content=J.content.slice(0,-1),J.length--,!0):G=!1;case"TK_END_BLOCK":if(l.type==="TK_START_BLOCK"||l.type==="TK_COMMA")return!1;case"TK_START_EXPR":return G=!1;case"TK_COMMA":if(l.type==="TK_COMMA"||l.type==="TK_START_BLOCK")return!0;default:return G=!1}return!1}function le(){let ce=o.offset;return E.push(...dn(",")),J&&(Sn(J),($[J.content.toUpperCase()]=Wt.create(J.content,T.SymbolKind.Property,de(J.offset,J.length))).returns=[ce+1,l.offset+l.length]),o.type==="TK_COMMA"?!(K=!0):o.type==="TK_END_BLOCK"?K=!0:o.type==="TK_EOF"?!0:!(G=!1)}}function Kn(A,W,M,se,N){let V=0,$=!1,G,J,me=[M??=o.offset],ve=[E.length],le=_.tokens[M],ce=v,ue=[];if(se??={offset:M,count:0,comma:[],miss:[],unknown:!1},A!=="%"){v|=8;let _e=le.previous_token;le.paraminfo=se,(se.name||!le.topofline&&_e&&le.prefix_is_whitespace===void 0&&((_e.previous_pair_pos??_e.in_expr)!==void 0||_e.type==="TK_WORD"||_e.type==="TK_DOT"))&&($=!0)}else le.op_type=-1;for(;Re();){if(o.topofline){if(A==="%"&&!(["TK_COMMA","TK_OPERATOR","TK_EQUALS"].includes(o.type)&&!/^(!|~|not)$/i.test(o.content))){ze(le),le.next_pair_pos=-1,_.addDiagnostic(B.missing("%"),M,1),K=!1,v=ce,ki(ue);return}o.topofline===1&&(o.topofline=-1)}if(o.content===W){if(L[o.previous_pair_pos=me.pop()].next_pair_pos=o.offset,W!=="%"?_.addFoldingRange(o.previous_pair_pos,o.offset+1,"block"):o.op_type=1,--V<0)break;G=ve.pop()}else if(o.content===A){if(A==="("){if(h[o.offset-1]===")"){Kn("(",")");continue}ve.push(E.length)}V++,me.push(d-1)}else if(o.content==="(")Pt({...Qe,offset:o.offset,ignore:!0},"(",void 0,W,ue.length?":":void 0);else switch(o.type){case"TK_WORD":if(h[o.offset-1]!==".")if(h[d]!=="(")if(A==="%"||h[o.offset-1]!=="%"&&h[o.offset+o.length]!=="%"){let _e=mn(o);if(_e){if(Re(),K=!1,o.type==="TK_EQUALS"){(H=a[_e.selectionRange.start.line])?.offset>me.at(-1)&&We(_e,H);let bt=o.content,Kt=d;K=!0,E.push(...dn(W,ue.length?":":void 0)),_e.range.end=re.positionAt(l.offset+l.length),bt===":="||bt==="??="&&(_e.assigned??=1)?_e.returns=[Kt,l.offset+l.length]:_e.cached_types=[bt===".="?Zn:si],_e.assigned??=!0,_e.def=!0}else J||(o.type==="TK_DOT"?J||=void 0:!o.topofline&&["++","--"].includes(o.content)&&(J=!1));if(J)if(o.type!=="TK_DOT")_e.assigned=_e.def=_e.pass_by_ref=!0;else if(kn<sn+7)_.addDiagnostic(B.requireVerN(sn+7),l.previous_token.offset,1,{code:"virtual references"});else{o.topofline&&=-1;continue}else J===!1?(_e.def=_e.assigned=!0,_e.cached_types=[si]):o.content==="??"||o.ignore&&o.content==="?"?_e.returns=null:o.content==="=>"&&Me({...Qe,offset:l.offset},!1,E.splice(-1),W,ue.length?":":void 0)}}else o.ignore=!0;else h[o.offset-1]==="%"&&l.op_type===1&&(o.ignore=!0),l=o,o=an(),Pt(l,"(",void 0,W,ue.length?":":void 0);else if(h[d]==="(")l=o,o=an(),Pt(l,"(",T.SymbolKind.Method);else if(A!=="%"&&h[d]==="%")Oi(o,null),Wo(),Re(),K=!1;else if(Sn(o),Re(),K=!1,o.type==="TK_EQUALS")Ur.includes(o.content)&&Oi(l,void 0,()=>{let _e=d;return E.push(...dn(W,ue.length?":":void 0)),[_e,l.offset+l.length]});else if(J){if(o.type==="TK_DOT"||o.ignore&&o.content==="?"&&_.get_token(d,!0).type==="TK_DOT")continue;l.__ref=!0}break;case"TK_START_BLOCK":if(["TK_WORD","TK_STRING","TK_NUMBER"].includes(l.type))fe(o);else if(l.content===")"&&l.previous_pair_pos!==void 0){o=L[l.previous_pair_pos],d=o.offset+1,l=o.previous_token??Qe,E.splice(G),Me({...Qe,offset:o.offset},!1,void 0,W,ue.length?":":void 0);continue}ef(!0);break;case"TK_STRING":N?.push(o),A==="["&&On("]")&&!/\n|`n/.test(o.content)&&jm(o.content.substring(1,o.content.length-1));break;case"TK_END_BLOCK":case"TK_END_EXPR":fe(o),q(),K=!1,v=ce,ki(ue);return;case"TK_RESERVED":{let _e=h[d];if(A!=="%"&&(_e==="%"||h[o.offset-1]==="%")){o.ignore=!0,o.type="TK_WORD";continue}switch(qe=o.content.toLowerCase()){case"false":case"true":o.type="TK_WORD",J!==void 0||_.get_token(d,!0).type==="TK_EQUALS"?_.addDiagnostic(B.reservedworderr(o.content),o.offset):K=!1;continue;case"isset":La(_e);continue;case"super":Fa();continue}if(kn>=sn&&qe==="throw"){K=!1,o.type="TK_WORD";continue}_.addDiagnostic(B.reservedworderr(o.content),o.offset,o.length);break}case"TK_COMMA":V===0&&A!=="%"&&(++se.count,l.type==="TK_COMMA"||l.type==="TK_START_EXPR"?se.miss.push(se.comma.length):!l.ignore&&l.type==="TK_OPERATOR"&&!/(--|\+\+|%)/.test(l.content)&&fe(o),se.comma.push(o.offset),$&&(o.paraminfo=se));break;case"TK_OPERATOR":switch(o.content){case"%":l.type==="TK_DOT"?(Oi(o,null),Wo(W)):Kn("%","%");continue;case":":ue.pop()??fe(o);break;case"?":if(o.ignore)continue;ue.push(o.offset);break;case"=>":J!==void 0||l.content!==")"||l.previous_pair_pos===void 0?(J=void 0,fe(o)):(o=L[l.previous_pair_pos],d=o.offset+1,l=o.previous_token??Qe,E.splice(G),Me({...Qe,offset:o.offset},!1,void 0,W,ue.length?":":void 0));continue;default:if(Rt.test(o.content)&&(h[o.offset-1]==="%"||h[d]==="%")){o.ignore=!0,o.type="TK_WORD";continue}}if(ae(o)===-1){if(o.content==="&"){J=!0;continue}if(["++","--"].includes(o.content)){J=!1;continue}}break;case"TK_UNKNOWN":_.addDiagnostic(B.unknown(o.content),o.offset,o.length);break;default:if(o.content==="[")Kn("[","]");else if(o.content===".")ae(o);else break;continue}J=void 0}o.type==="TK_EOF"&&V>-1?(W==="%"&&ze(le),q()):L[o.previous_pair_pos].next_pair_pos=o.offset,A!=="%"&&(l.content===","?se.miss.push(se.count++):l.type!=="TK_START_EXPR"&&(se.count++,l.content==="*"&&(se.unknown=!0,se.count--)),se.end=o.offset),v=ce,ki(ue);function q(){let _e;for(;(_e=me.pop())!==void 0;)_.addDiagnostic(B.missing(W),_e,1)}}function La(A){let W=E.length;if(o.definition=qt.ISSET,o.ignore=!0,o.type="TK_WORD",o.semantic=Ag,A==="("){let M=o;mn(o),Re(),Kn("(",")");let se=L[o.previous_pair_pos]?.paraminfo?.count??0;if(se!==1)Mt.Diagnostics.ParamsCheck&&_.addDiagnostic(B.paramcounterr(1,se),M.offset,d-M.offset);else if(E.length>W&&l.type==="TK_WORD"){let N=E.at(-1);l.content===N.name&&l.offset===_.document.offsetAt(N.range.start)&&(N.assigned??=1,N.returns??=null)}return!0}_.addDiagnostic(B.missing("("),o.offset,5)}function Fa(){if((v&3)===3){if(h[d]!=="("){let A=_.get_token(d,!0);if(A.type!=="TK_DOT"&&A.content!=="["&&!(A.topofline&&o.topofline))return _.addDiagnostic(B.syntaxerror(o.content),o.offset,o.length)}o.type="TK_WORD",K=!1}else _.addDiagnostic(B.invalidsuper(),o.offset,o.length)}function ki(A){let W;for(;(W=A.pop())!==void 0;){let M=_.tokens[W],se=_.tokens[M.next_token_offset]??Qe;se.previous_pair_pos!==void 0&&(M.ignore=!0)||(h[se.offset]==="."?kn<sn-1?_.addDiagnostic(B.requireVerN(sn-1),W,1,{code:"optional chaining"}):M.ignore=!0:_.addDiagnostic(B.missing(":"),W,1))}}function Oi(A,W=!1,M){if(D==="")return;let se,N,V=!1,$=A.previous_token?.previous_token;if(!$||h[$.offset-1]==="."&&($.content.toLowerCase()!=="prototype"||(V=!0,!($=$.previous_token?.previous_token)||h[$.offset-1]==="."))||(qe=$.content.toLowerCase(),qe!=="this"&&qe!=="super"||!(N=G())||V&&!(N=N.prototype)||!N.cache))return;if(W){let J=A.callsite?.paraminfo;if(J&&A.content.toLowerCase()==="defineprop"&&J.count>1&&J.miss[0]!==0){let me=J.comma[0],ve=!!N.prototype,le=L[A.next_token_offset];if(h[A.offset+A.length]==="("&&(le=L[le.next_token_offset]),le.type!=="TK_STRING"||le.next_token_offset!==me)N.checkmember=!1;else{let ce=L[L[me].next_token_offset],ue=le.content.slice(1,-1),q,_e,bt;se=de(le.offset+1,ue.length),(ce.type!=="TK_START_BLOCK"||!(_e=ce.data?.property)||_e.GET||_e.VALUE||_e.SET)&&(q=Wt.create(ue,T.SymbolKind.Property,se),q.full=`(${D.slice(0,-1)}) ${(q.static=ve)?"static ":""}${ue}`,q.parent=N,bt=q,(q.returns=_e?.GET?.returns)?q.eval=!0:q.returns=_e?.VALUE?.returns),(_e=_e?.CALL)&&(q=Wt.create("",T.SymbolKind.Variable,de(0,0)),q.arr=!0,q=Jn.create(ue,T.SymbolKind.Method,se,se,[q],void 0,ve),q.full=`(${D.slice(0,-1)}) ${q.full}`,q.returns=_e.returns,q.eval=!0,q.parent=N,bt?(bt={...bt,[bt.eval?"get":bt.returns?"val":"set"]:bt},bt.val?bt=q:bt.call=q):bt=q),bt&&N.cache.push(bt)}}}else{if(W===null)return N.checkmember=!1,void 0;let J=Wt.create(A.content,T.SymbolKind.Property,se=de(A.offset,A.length));J.static=!!N.prototype,N.cache.push(J),J.def=!1,J.parent=N,J.returns=M?.(),(H=a[J.selectionRange.start.line])&&We(J,H)}return;function G(){let J=O;for(;J&&J.kind!==T.SymbolKind.Class;)J=J.parent;return J}}function mn(A,W=0,M){let se=de(A.offset,A.length),N=Wt.create(A.content,T.SymbolKind.Variable,se);return W===2&&(N.kind=T.SymbolKind.Property,Sn(A,N),D&&(N.full=`(${D.slice(0,-1)}) ${N.name}`,A.symbol=N)),(M??E).push(N),N}function Sn(A,W){let M=_.object.property[A.content.toUpperCase()]??=[];A.semantic??={type:6},W?M.unshift(W):M[0]??=Wt.create(A.content,T.SymbolKind.Property,de(A.offset,A.length))}function jm(A){_.texts[A.toUpperCase()]=A}function ii(A){let W=_.diagnostics,M,se=!1,N={};if(A.decl=A.def=!0,A.kind===T.SymbolKind.Class){let V=A,$=V.$property,G=V.property??={},J=V.children??=[],me=[G.__INIT],ve=V.prototype;ve.checkmember??=V.checkmember,ii(G.__INIT),$.__INIT?.ranges?.length?(ii($.__INIT),me.push($.__INIT)):delete $.__INIT,G.PROTOTYPE={...ve,children:void 0,name:"Prototype",kind:T.SymbolKind.Property,full:`(${V.full}) Prototype`,selectionRange:en,type_annotations:[V.full]},J.forEach(le=>{if(qe=le.name.toUpperCase(),Nu.includes(qe)&&delete(L[re.offsetAt(le.selectionRange.start)]??{}).semantic,le.children){let ce=le.static||le.kind===T.SymbolKind.Class?G:$,ue=ce[qe];if(!ue)ce[qe]=le;else if(ue.kind===T.SymbolKind.Property&&!(ue.get??ue.set))(le.children.length||le.kind!==T.SymbolKind.Property)&&(ce[qe]=le);else{if(ue.kind!==le.kind&&![le.kind,ue.kind].includes(T.SymbolKind.Class)){let q,_e=ue.kind===T.SymbolKind.Property?(q=le,ue):(q=ue,le);if(!_e.call)return _e.call=q,ce[qe]=_e}W.push({message:B.dupdeclaration(),range:le.selectionRange})}}}),J.forEach(le=>{if(le.children)return;let ce=le.static?G:$;if(!(M=ce[qe=le.name.toUpperCase()]))return le.def===!1||(ce[qe]=le);if(!(M.typed===!0&&(le.typed||!le.children&&(M.typed=1)))){if(M.children&&(!le.typed||le.range.start.line<M.range.start.line)){let ue=M;if(!ue.val)return ue.val=le}le.def!==!1&&W.push({message:B.dupdeclaration(),range:le.selectionRange})}}),J.push(...me,...V.cache??[],...V.prototype.cache??[]),V.cache?.forEach(le=>G[le.name.toUpperCase()]??=le),V.prototype.cache?.forEach(le=>$[le.name.toUpperCase()]??=le),delete V.cache,delete V.prototype.cache}else{let V=A,$=V.has_this_param,G=V.declaration,J=V.local??{},me=V.global??{},ve={},le={},ce,ue=[];$&&(N.THIS=G.THIS=zr,N.SUPER=G.SUPER=Oo,V.kind===T.SymbolKind.Function&&(ue=void 0));for(let q of V.params??[])q.decl=q.def=q.assigned=q.is_param=!0,q.name&&(ue?.push(q),q.defaultVal!==void 0||q.arr?se=!0:se&&W.push({message:B.defaultvalmissing(q.name),range:q.selectionRange}),(M=N[qe=q.name.toUpperCase()])?W.push({message:B.conflictserr("parameter","parameter",M.name),range:q.selectionRange}):N[qe]=G[qe]=ve[qe]=q);for(let[q,_e]of Object.entries(J))(M=N[q])?W.push({message:B.conflictserr(_e.static?"static":"local","parameter",M.name),range:_e.selectionRange}):(G[q]=_e,_e.assigned||=!!_e.returns);for(let[q,_e]of Object.entries(me)){if(M=G[q]){if(N[q]){W.push({message:B.conflictserr("global","parameter",M.name),range:_e.selectionRange});continue}let bt=_e.static?"static":"local";if(W.push({message:B.conflictserr(...M.selectionRange.start.line<_e.selectionRange.start.line?(M=_e,["global",bt]):[bt,"global"],M.name),range:M.selectionRange}),_e!==M)continue;delete J[q]}G[q]??=_e,_.declaration[q]??=_e,_e.assigned||=!!_e.returns,_e.is_global=!0}for(let q of V.children??=[])if(qe=q.name.toUpperCase(),q.kind===T.SymbolKind.Function){let _e=q;if(_e.static||(_e.closure=!0),!qe)continue;if(G[qe]){if(M=N[qe]){W.push({message:B.conflictserr("function","parameter",M.name),range:q.selectionRange});continue}else if(M=me[qe]){if(W.push({message:B.conflictserr(...M.selectionRange.start.line<q.selectionRange.start.line||M.selectionRange.start.line===q.selectionRange.start.line&&M.selectionRange.start.character<q.selectionRange.start.character?(M=q,["function","global"]):["global","function"],M.name),range:M.selectionRange}),q===M)continue;delete me[qe],delete M.is_global,_.declaration[qe]===M&&delete _.declaration[qe]}else if(M=J[qe])if(M.selectionRange.start.line<q.selectionRange.start.line||M.selectionRange.start.line===q.selectionRange.start.line&&M.selectionRange.start.character<q.selectionRange.start.character){W.push({message:B.conflictserr("function",M.kind===T.SymbolKind.Function?"Func":M.static?"static":"local",q.name),range:q.selectionRange});continue}else M.static&&W.push({message:B.conflictserr(M.kind===T.SymbolKind.Function?"function":"static",q.kind===T.SymbolKind.Function?"Func":"static",M.name),range:M.selectionRange})}G[qe]=J[qe]=q}else q.kind===T.SymbolKind.Variable&&(((ce=q).def?ve:le)[qe]??=(ce.assigned||=!!ce.returns,q));if(V.children.unshift(...ue??[]),V.parent?.assume===2&&(V.assume??=2),V.assume===2){for(let[q,_e]of Object.entries(Object.assign(le,ve)))(M=G[q])?M.kind===T.SymbolKind.Function&&_e.def?_e.assigned!==1&&W.push({message:B.assignerr("Func",M.name),range:_e.selectionRange}):M.kind===T.SymbolKind.Variable&&_e.def&&_e.kind===M.kind&&(M.def=!0,M.assigned||=!!_e.returns):(_.declaration[q]??=me[q]=_e,_e.is_global=!0);le={}}else if(V.static!==null){let q=V.assume===1,_e=V.kind!==T.SymbolKind.Function||!V.parent;for(let[bt,Kt]of Object.entries(ve))delete le[bt],(M=G[bt])?M.kind===T.SymbolKind.Function?Kt.assigned!==1&&W.push({message:B.assignerr("Func",M.name),range:Kt.selectionRange}):M.kind===T.SymbolKind.Variable&&Kt.def&&Kt.kind===M.kind&&(M.def=!0,M.assigned||=!!Kt.returns):(G[bt]=Kt,_e?(J[bt]=Kt,Kt.static=q):q&&(Kt.static=null))}else{for(let[q,_e]of Object.entries(Object.assign(le,ve)))(M=G[q])?_e.def&&_e.assigned!==1&&M.kind===T.SymbolKind.Function&&W.push({message:B.assignerr("Func",M.name),range:_e.selectionRange}):(G[q]=_e).has_warned=!0;le={}}ve=le,le={};for(let q in ve)G[q]||((le[q]=ve[q]).def=!1);V.unresolved_vars=le;for(let q of Object.values(J))q.def=!0;N=Object.assign(J,N),$&&(delete N.THIS,delete N.SUPER,delete G.THIS,delete G.SUPER);for(let q of Object.keys(G))q.substring(0,2)==="A_"&&qt[q]&&((ce=G[q]).decl?W.push({message:B.conflictserr(ce.params?"function":ce.is_param?"parameter":"variable","built-in variable",ce.name),range:ce.selectionRange}):(delete G[q],delete J[q]))}}function Re(){return K?(l=o,K=(o=Gt()).type!=="TK_EOF"):K=o.type!=="TK_EOF"}}function Le(v,O){v.extends=(O=O.trim()).replace(/^(.+[\\/])?/,D=>{if(D=D.slice(0,-1)){let E;if(D=D.replaceAll("\\","/").toLowerCase(),D.endsWith(".ahk")||(D+=".d.ahk"),D.startsWith("~/"))E=En.parse(rr+D.slice(1));else if(/^([a-z]:)?\//.test(D))E=En.file(D);else if(D.includes(":"))E=En.parse(D);else{let re=(Se.path+"/../"+D).split("/"),L=[];re.shift();for(let o of re)if(o!=="..")L.push(o);else if(!L.pop())return"";E=Se.with({path:L.join("/")})}v.extendsuri=E.toString().toLowerCase()}return""}),!v.extendsuri&&v.extends.startsWith("#")&&(v.extendsuri=qt[(v.extends=v.extends.substring(1)).toUpperCase()]?.uri??Ht.ahk2)}function vt(v){return v.replace(/%a_(\w+)%/gi,(O,D)=>(D=D.toLowerCase(),D==="linefile"?_.fsPath:"scriptdir,initialworkingdir".includes(D)?(_.need_scriptdir=!0,_.scriptdir):"scriptname,icontip".includes(D)?(0,Hr.basename)(_.fsPath):O))}function Ft(v,O,D=0,E=!1){let re,L=!1,o=v[0];`'"`.includes(o)&&v.endsWith(o)&&(v=v.slice(1,-1)),(re=v.match(/^(\*[iI][ \t])?(.*)$/))?(L=!!re[1],re=vt(re[2]),O&&_[E?"dlldir":"includedir"].set((O.pos??=_.document.positionAt(O.offset)).line,E?c:m),re.trim()||(E?c="":O&&_.addDiagnostic(B.pathinvalid(),O.offset,O.length,{code:"include"}))):v&&O&&_.addDiagnostic(B.pathinvalid(),O.offset,O.length,{code:"include"})}function nn(v){v.startsWith("<")?v=v.replace(/(\.d)?>$/i,".d>"):v=v.replace(/(\.d\.ahk)?$/i,".d.ahk");let O=iy(v,_.libdirs,_.scriptpath,!0,{...Co,locale:Fo});if(O&&!(void 0)(O.path).isDirectory())return O}function Tt(v,O){return O?(v&&v+`

`)+O:v}function We(v,O){let D=O.content;if(D.startsWith(";")){v.detail=O.data??=D.replace(/^[ \t]*; ?/gm,"");return}if(!/^\/\*\*(?!\/)/.test(D)){v.detail=O.data??=D.replace(new RegExp(`^${h.substring(h.lastIndexOf(`
`,O.offset)+1,O.offset)}`,"gm"),"").replace(/^\/\*\s*\n|\s*\*+\/$/g,"");return}if(!O.data)O.data=Xe(_,D,v);else{let{detail:E,ignore:re,tags:L,vars:o}=O.data,l=o&&(o[v.name.toUpperCase()]??o[""]);re&&(v.ignore=re),L&&(v.tags=L),v.markdown_detail=Tt(l?.detail??"",E),l&&(v.type_annotations=l.type_annotations??=or(l.type_str))}}function Xe(v,O,D){if(D.detail=O,O=O.replace(/^[ \t]*(\*?[ \t]*(?=@)|\* ?)/gm,"").replace(/^\/\*+\s*|\s*\**\/$/g,""),!O)return{detail:D.markdown_detail=D.detail=""};let E=[],re=[],L,o="",l,nt=D,K={},qe={},H=Q=>{},Y,w,xe,Ve={[T.SymbolKind.Variable]:"var",[T.SymbolKind.Property]:"prop"}[D.kind];if(nt.params){let Q=nt.params;H=Me=>{if(!/^d/.test(Me))return qe[Me]??=Q.find(oe=>Me===oe.name.toUpperCase()&&!(oe.markdown_detail=""))??((nt.overload_params??={})[Me]={type_annotations:!1,markdown_detail:""})}}for(let Q of O.split(/\n(?=@)/)){if(!(Y=Q.match(/^@(\w*)/))){E.push(Q);continue}switch(l=Y[1].toLowerCase(),Q=Q.substring(l.length+1),xe&&!l.startsWith("prop")&&(xe=void 0),l){case"arg":case"argument":l="param";case"param":case"prop":case"property":case"var":if(Q=ae(Q),Y=Q.match(/^\s*(\[(\w|[^\x00-\x7f]|(\[\])?\.)*.*?\]|(\w|[^\x00-\x7f]|(\[\])?\.)*)/)){let Me="",oe=Y[1]??="",De=!1,it=()=>De?`<u>\`${oe}\`</u>`:`\`${oe}\``;if(Q=Q.substring(Y[0].length),oe.startsWith("[")&&(oe.slice(1,-1).replace(/^((\w|[^\x00-\x7f]|(\[\])?\.)*)(.*)$/,(...mt)=>((oe=mt[4].trimStart()).startsWith("=")&&(Me=oe.substring(1).trim()),oe=mt[1])),De=!0),l==="param"){if(w=H(oe.replace(/(\[\])?\..*$/,"").toUpperCase()),w?.name?.length===oe.length)De=w.defaultVal!==void 0,w.type_annotations??=or(o);else if(w?.name){let mt=oe.split(".");Ne(yt(w,mt.shift()),mt,o,`*@param* ${it()}${o&&`: *\`${o}\`*`}${Q.trim()&&`
___
${Q}`}`),w.markdown_detail||(w=void 0)}l=`*@param* ${it()}${o&&`: *\`${o}\`*`}${Me&&` := \`${Me}\``}${He(Q)}`,E.push(l),w&&(w.markdown_detail+=`${l}

`);continue}else if(l.startsWith("prop"))l="property",xe??=K[""]??=ct(),Ne(yt(xe,xe.name),oe.split("."),o,`*@${l}* ${it()}${o&&`: *\`${o}\`*`}${Me&&` := \`${Me}\``}${Q.trim()&&`
___
${Q}`}`);else if(Ve==="var"){Q=Q.trimStart(),D.name.toLowerCase()===oe.toLowerCase()?(D.type_annotations??=or(o),(L??={})[oe.toUpperCase()]??={detail:Q,type_annotations:D.type_annotations},D.markdown_detail??=Q):(L??={})[oe.toUpperCase()]??={detail:Q,type_str:o};continue}Q=He(Q),E.push(l=`*@${l}* \`${oe}\`${o&&`: *\`${o}\`*`}${Me&&` := \`${Me}\``}${Q}`)}continue;case"return":case"returns":case"type":Q=ae(Q),E.push(`*@${l}*${o&&` *\`${o}\`*`}${He(Q)}`),!Ve||D.get?(Ve||l!=="type")&&(D.type_annotations??=or(o)):l==="type"&&((L??={})[""]??={detail:Q,type_annotations:or(o)},E.pop());continue;case"enum":case"throws":Q=ae(Q),E.push(`*@${l}*${o&&` *\`${o}\`*`}${He(Q)}`);continue;case"typedef":Q=ae(Q),Y=Q.match(/^\s*(\$?(\w|[^\x00-\x7f])*)/),(l=Y[1])&&(v.typedef[l.toUpperCase()]??=xe={name:l,kind:T.SymbolKind.TypeParameter,range:en,selectionRange:en,type_annotations:or(o)}),E.push(`*@typedef* \`${l}\`: *\`${o||"Any"}\`*${He(Q.substring(Y[0].length))}`);continue;case"overload":if(!(Y=Q.match(/^\s*(\w|[^\x00-\x7f])*(?=[([])/)))break;re.push(`${D.name||"_"}${Q.substring(Y[0].length).trimEnd()}`);continue;case"example":E.push("*@example*"),(Q=Q.replace(/^\s*<caption>(.*?)<\/caption>/,(Me,oe)=>(E.push(oe),"")).replace(/^[ \t\r\n]+/,""))&&E.push("```ahk2\n"+Q+"\n```");continue;case"extends":l="*@extends* ",(Y=Q.match(/^\s*{([^{}]+)}/))&&(D.kind===T.SymbolKind.Class&&Le(D,Y[1]),l+=`\`${Y[1]}\``,Q=Q.substring(Y[0].length)),E.push(`${l}${He(Q)}`);continue;case"ignore":D.ignore=!0;break;case"deprecated":D.tags??=[1];break;case"since":break;case"alias":if(D.kind===T.SymbolKind.Class&&(o=Q.trim()).endsWith(">")&&o.startsWith(D.name+"<")){let Me=new e(An.create("","ahk2",0,`class ${o}{
}`),void 0,1);Me.parseScript();let oe=Me.declaration[D.name.toUpperCase()]?.type_params;oe&&(D.type_params=oe,Object.values(oe).forEach(De=>De.range=De.selectionRange=en))}break}E.push(`*@${l}*${He(Q)}`)}if(Ve){let Q=L?.[""]?.type_annotations;!Q&&(l=K[""])&&(((L??={})[""]??={detail:""}).type_annotations=Q=[l]),D.type_annotations??=Q}else nt.params&&(l=re.join(`
`))&&(D.overloads=l);return O=E.join(`

`),D.markdown_detail=Tt(D.markdown_detail??"",O),{detail:O,ignore:D.ignore,tags:D.tags,vars:L};function He(Q){Q=Q.replace(/^[ \t]*[-—]/,"");let Me=0,oe=0,De=0;for(let it of Q)switch(De++,it){case`
`:if(Me>1||++oe===2)return Q;case"	":Me=0;break;case" ":Me++;break;case"\r":break;default:if(oe){let mt=!1;if(it==="|"||it===">"||"-+*".includes(it)&&" 	".includes(Q[De])||Q.substring(De-1,De+2)==="```")mt=!0;else if(it==="#"){for(;Q[De]==="#";De++);mt=" 	".includes(Q[De])}else if(it!=="."){for(;it>="0"&&it<="9";it=Q[De++]);mt=it==="."&&" 	".includes(Q[De])}if(mt)return`
${Q}`}return` \u2014 ${Q}`}return""}function ct(Q=""){return{kind:T.SymbolKind.Class,name:Q,full:"",extends:"",uri:"",property:{},range:en,selectionRange:en}}function wt(Q,Me,oe){for(let De=Q.length-1;De>=0;De--)Me.includes(Q[De])&&Q.splice(De,1);return oe&&Q.push(oe),oe}function yt(Q,Me){let oe=Me.endsWith("]")&&(Me=Me.slice(0,-2),!0),De=K[Me=Me.toUpperCase()]??=wt(Q.type_annotations||=[],[Yn],ct(Q.name));return oe?K[`${Me}[]`]??=(De.extends||="Array",wt(Q.type_annotations||[],[da]),wt((De.generic_types??=[])[0]??=[],[Yn],ct())):De}function Ne(Q,Me,oe,De){let it=Q.name.toUpperCase(),mt=Me.length;for(let rt of Me){let $t=0,Pt;for(;rt.endsWith("]");)rt=rt.slice(0,-2),$t++;if(it+=`.${Pt=rt.toUpperCase()}`,mt--,Q=K[it]??=Q.property[Pt]??={kind:T.SymbolKind.Property,name:rt,range:en,selectionRange:en},$t||mt)do Q=K[it+"."]??=wt(Q.type_annotations||=[],[Yn],ct()),$t&&(Q=K[it+="[]"]??=(Q.extends||="Array",wt((Q.generic_types??=[])[0]??=[],$t>1?[Yn,da]:[Yn],ct())),$t--);while($t)}Q.property||(Q.markdown_detail??=De,Q.type_annotations??=or(oe))}function ae(Q){let Me=Q.match(/^\s*\{/);if(o="",!Me)return Q;let oe=1,De=Me[0].length,it=De;for(;oe;)switch(Q[De++]){case"{":oe++;continue;case"}":oe--;continue;case void 0:return Q;case'"':case"'":{let mt=Q[De-1],rt;for(;(rt=Q[De++])!==mt;)if(rt==="`")De++;else if(!rt||rt===`
`)return Q;break}}return o=Q.substring(it,De-1).trim(),Q.substring(De)}}function de(v,O){return T.Range.create(_.document.positionAt(v),_.document.positionAt(v+O))}function Je(v,O,D,E,re){let L=h.charAt(D-1),o={content:v,type:O,offset:D,length:E,topofline:re,previous_token:g,next_token_offset:-1,prefix_is_whitespace:Cn.includes(L)?L:void 0};return _.tokens[D]=o,g.next_token_offset=D,o}function Pn(v,O){let D=0,E=0,re,L="",o="",l,nt,K=[Ge.ArrayLiteral,Ge.Expression,Ge.ObjectLiteral].includes(O);return v&&(D=v.indentation_level,E=v.had_comment,L=v.last_text,o=v.last_word,K||=v.in_expression,l=v.array_style,nt=v.object_style),{array_style:l,case_body:!1,catch_block:!1,declaration_statement:!1,else_block:!1,finally_block:!1,had_comment:E,if_block:!1,in_case_statement:!1,in_case:!1,in_expression:K,indentation_level:D,last_text:L,last_word:o,loop_block:0,mode:O,object_style:nt,parent:v,start_line_index:pe.length,ternary_depth:re,try_block:!1}}function S(){return{text:[],indent:0}}function Z(){if(p!==!1)return;let v=pe.pop();for(;v?.text.length===0;)v=pe.pop();v&&pe.push(v),k.had_comment&&pe.push(S())}function Te(){return pe.at(-1).text.length===0}function $e(v=!1){if(ye.wrap_line_length&&!v){let O=pe.at(-1),D=0;O.text.length>0&&(D=O.text.join("").length+ot.length+(z?1:0),D>=ye.wrap_line_length&&(v=!0))}(ye.preserve_newlines&&F||v)&&!Te()&&ke(!0)}function ke(v=!1){if(!v&&(v===null||!Zt(we.previous_token??Qe,Qe))){for(;k.mode===Ge.Statement;)ht();k.if_block=k.try_block=k.catch_block=!1,k.loop_block=0}Te()||pe.push(S())}function Ie(v){let O=pe.at(-1);O.text.length?z&&O.text.push(" "):(Et&&O.text.push(Et),k.indentation_level=D(k.indentation_level)),z=void 0,O.text.push(v??ot);function D(E){if(E){for(let re=pe.length-2;re>=0;re--)if(pe[re].text.length){E=Math.min(pe[re].indent+1,E);break}O.text.push(fn.repeat(O.indent=E))}return E}}function dt(){k.indentation_level+=1}function Ct(){k.indentation_level>0&&(!k.parent||k.indentation_level>k.parent.indentation_level)&&(k.indentation_level-=1)}function tt(v){k?(It.push(k),lt=k):lt=Pn(void 0,v),k=Pn(lt,v)}function ht(){It.length>0&&(lt=k,k=It.pop())}function Dt(){return k.parent.mode===Ge.ObjectLiteral&&k.mode===Ge.Statement&&k.last_text===":"&&!k.ternary_depth}function Vt(){if(et==="TK_RESERVED"&&["try","else","finally"].includes(k.last_text)||et==="TK_END_EXPR"&&lt.mode===Ge.Conditional||et==="TK_WORD"&&k.mode===Ge.BlockStatement&&(!F&&we.previous_token?.callsite||!k.in_case&&!["TK_WORD","TK_RESERVED","TK_START_EXPR"].includes(xt)&&!["--","++","%"].includes(ot))||k.declaration_statement&&(!b||Zt(we.previous_token??Qe,we))||k.mode===Ge.ObjectLiteral&&k.last_text===":"&&!k.ternary_depth){switch(tt(Ge.Statement),dt(),k.last_word){case"if":case"for":case"loop":case"while":case"catch":ke(!0);case"try":case"finally":case"else":k.declaration_statement=!0;break}return!0}return!1}function gn(v){return["break","continue","global","goto","local","return","static","throw"].includes(v)}function On(v){let O=d,D=h[O];for(;D!==v&&Cn.includes(D)&&++O<C;)D=h[O];return D===v?O:0}function Gt(v=0){let O;do O=an(v);while(O.type.endsWith("COMMENT"));return O}function an(v=0){let O,D,E,re,L=0,o=d;for(b=0;Cn.includes(D=h[d++]);)D===`
`&&(R=d-1,b+=1,i=!0);if(!D)return qe(),K(),_.tokens[-1]??={content:"",type:"TK_EOF",offset:C,length:0,topofline:Zt(g,Qe)?-1:1,next_token_offset:-1,previous_token:g};let l=d-1,nt=_.tokens[l];if(nt&&nt.length){let H=!1;if((i=!!(nt.topofline&&nt.type.endsWith("_BLOCK")))&&(R=l),d=nt.skip_pos??l+nt.length,g=nt,nt.ignore?nt.type==="TK_START_EXPR"?(p=!0,H=!Be):nt.type==="TK_END_EXPR"?(p=null,H=!Be):nt.type.endsWith("COMMENT")&&(g=nt.previous_token??Qe):nt.type.endsWith("COMMENT")&&(g=nt.previous_token??Qe),!Be){let Y=nt.previous_extra_tokens,w=nt;if(Y&&(o<l&&(Y.i=0),Y.i<Y.len?(nt=Y.tokens[Y.i++],d=l):Y.i=0),H&&w===nt)return an()}return nt}if(i){i=!1,L=1;let H=h.indexOf(`
`,d);H<0&&(H=C);let Y=h.substring(R+1,H).trim().replace(/(^|[ \t]+);.*$/,"");if(Y.includes("::")&&(Pe||!`"'`.includes(Y[0])||!["TK_EQUALS","TK_COMMA","TK_START_EXPR"].includes(g.type))){if(E=Y.match(/^(:([^:]*):(`.|[^`])*?::)(.*)$/i)){let w;if((w=/x(?!0)/i.test(E[2]))||/^[ \t]*\{?$/.test(E[4])||(w=_.hotstringExecuteAction&&!/x0/i.test(E[2]))?(d+=E[1].length-1,g=Je(E[1],"TK_HOT",l,E[1].length,1)):(R=H,d=l+E[0].length,g=Je(E[1],"TK_HOTLINE",l,E[1].length,1),l+=E[1].length,g.skip_pos=d,g.data={content:h.substring(l,d),offset:l,length:d-l},_.tokenranges.push({start:l,end:d,type:3,previous:g.offset})),g.ignore=!0,K(),E[3]||_.addDiagnostic(B.invalidhotdef(),g.offset,g.length),g.type==="TK_HOTLINE"||!w&&!/^[ \t]*\{/.test(E[4])){if(v>5)return delete _.tokens[g.offset],g;ge=w=!0;let xe=g,Ve=Gt(v+1),He;for(;Ve.ignore&&Ve.type==="TK_STRING";){if((d=h.indexOf(`
`,He=d))<0&&(d=C),He<d){let ct=h.substring(He,d).trimEnd();Ve.content+=ct,Ve.length+=ct.length}_.tokenranges.push({start:Ve.offset,end:Ve.offset+Ve.length,type:3}),w=!1,Ve=Gt(v+1)}ge=!1,g=xe,!w&&g.type==="TK_HOT"?(g.type="TK_HOTLINE",g.skip_pos=d=l+E[0].length,l+=E[1].length,g.data={content:h.substring(l,d),offset:l,length:d-l},_.tokenranges.push({start:l,end:d,type:3,previous:g.offset})):d=xe.skip_pos??xe.offset+xe.length}return g}else if(E=Y.match(/^(((([<>$~*!+#^]*?)(`?;|[\x21-\x3A\x3C-\x7E]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]+))|~?(`?;|[\x21-\x3A\x3C-\x7E]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]+)[ \t]*&[ \t]*~?(`?;|[\x21-\x3A\x3C-\x7E]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]+))([ \t]+up)?[ \t]*::)(.*)$/i)){let w=E[9].match(/^([ \t]*)(([<>~*!+#^]*?)(`[{;]|[a-z]\w+|[^{]))$/i);if(K(),w){let xe=w[4].toLowerCase();if(xe.length===1||!/^joy|^pause$/.test(xe)&&Kg.test(xe))return R=H,d=l+E[0].length,g=Je(E[1].replace(/[ \t]+/g," "),"TK_HOTLINE",l,E[1].length,1),l+=g.length+w[1].length,g.skip_pos=d,g.data={content:E[9].trim(),offset:l,length:d-l,data:w[2]},_.tokenranges.push({start:l,end:d,type:3,previous:g.offset}),g}return d=h.indexOf("::",d)+2,g=Je(E[1].replace(/[ \t]+/g," "),"TK_HOT",l,E[1].length,1)}}D!=="#"&&K()}if(yn(D.charCodeAt(0))||D==="$"&&je){let H="TK_WORD";for(;d<C&&yn(h.charCodeAt(d));)D+=h[d],d+=1;if(h[l-1]!=="."){if(E=D.match(/^(\d+[Ee](\d+)?|(0[Xx][\da-fA-F]+)|(\d+))$/)){if(E[2]||E[3])return g=Je(D,"TK_NUMBER",l,D.length,L),g.data=!!E[2],g.semantic=Vr,g;if(E[4]){let Y;if(d<C&&h[d]==="."){let w="",xe="",Ve=d+1;for(;Ve<C&&yn(h.charCodeAt(Ve));)w+=h[Ve],Ve+=1;if(/^\d*([Ee]\d+)?$/.test(w))return D+="."+w,d=Ve,g=Je(D,"TK_NUMBER",l,D.length,L),g.data=!0,g.semantic=Vr,g;if(/^\d*[Ee]$/.test(w)&&Ve<C&&"-+".includes(h[Ve])){for(w+=h[Ve],Ve+=1;Ve<C&&yn(h.charCodeAt(Ve));)xe+=h[Ve],Ve+=1;/^\d+$/.test(xe)&&(D+="."+w+xe,d=Ve)}Y=!0}return g=Je(D,"TK_NUMBER",l,D.length,L),g.data=Y,g.semantic=Vr,g}else if(d<C&&"-+".includes(h[d])){let Y=h[d],w=d,xe;if(d+=1,xe=an(v+1),delete _.tokens[xe.offset],xe.type==="TK_NUMBER"&&/^\d+$/.test(xe.content))return D+=Y+xe.content,g=Je(D,"TK_NUMBER",l,D.length,L),g.data=!0,g.semantic=Vr,g;d=w}}-1<(re=Fu.indexOf(D.toLowerCase(),va))&&(H=re<ty?"TK_RESERVED":"TK_OPERATOR")}return g=Je(D,H,l,D.length,L)}if(D==="("||D==="["){if(D==="("&&L&&!p){let H=d,Y=H,w;for(;H<C;)if((w=h[H++])===`
`)if(ge){let xe=h.indexOf(`
`,H),Ve=null,He=R+1,ct=[];for(;xe>0&&!(Ve=h.substring(H,xe).match(/^[ \t]*\)/));)ct.push(xe-H),xe=h.indexOf(`
`,H=xe+1);return xe<0&&(ct.push(C-H),Ve=h.substring(H,C).match(/^[ \t]*\)/)),d=Ve?H+Ve[0].length:C,ct.push(d-H),O=h.substring(l,d).trimEnd(),g=Je(h.substring(He,l)+O,"TK_STRING",l,O.length,1),_.addFoldingRange(He,d,"block"),g.data=ct,g.ignore=!0,g}else{let xe=!g.type||g.type==="TK_START_BLOCK"&&g.topofline>0;for(g=Je(D,"TK_START_EXPR",l,1,1),g.ignore=!0,d=H-1,p=!0;" 	".includes(h[++l]););let Ve=h.substring(l,d).trimEnd();g.data={content:Ve,offset:l,length:d-l},g.skip_pos=d,_.tokenranges.push({start:l,end:d,type:3,previous:g.offset});let He=Ve.match(/(^|[ \t])join([^ \t]*)/i),ct=/(^|[ \t])[Cc]/.test(Ve),wt=g,yt=Be,Ne=g,ae=!1,Q=d,Me=0,oe,De=()=>{};if(He){let it=He[2].replace(/`[srn]/g,"  "),mt=new e(An.create("","ahk2",-10,it)),rt=!1;mt.parseScript(),delete mt.tokens[-1];let $t=Object.values(mt.tokens);l+=4+He[1].length+He.index,$t.length&&(rt=Cn.includes(it.slice(-1)),$t.forEach(Pt=>{Pt.offset+=l,Pt.length=0,Pt.next_token_offset=-1}),De=(Pt,un)=>{let _t=[];for(let to=0;to<Pt;to++){un=h.indexOf(`
`,un+1);for(let li of $t)li={...li},li.offset=un,_t.push(li)}return{i:0,len:_t.length,tokens:_t,suffix_is_whitespace:rt}},",)]}".includes($t[0].content)&&(ae=!0))}for(Be=!0,oe=an(),p&&oe.type!=="TK_EOF"&&(ct&&oe.topofline&&oe.type.endsWith("COMMENT")?Me=b-2:(b>1&&(oe.previous_extra_tokens=De(b-1,Q)),oe.topofline=xe?1:0),Q=R,Ne=oe,oe=an());p&&oe.type!=="TK_EOF";)oe.topofline&&(ct&&oe.type.endsWith("COMMENT")?Me+=b-1:((Me+=b)&&(oe.previous_extra_tokens=De(Me,Q)),oe.topofline=Me=0,ae&&Ne.content==="?"&&(Ne.ignore=!0)),Q=R),Ne=oe,oe=an();return oe.ignore&&oe.type==="TK_END_EXPR"&&(b>1&&(oe.previous_extra_tokens=De(b-1,Q)),wt.next_pair_pos=oe.offset,oe.previous_pair_pos=wt.offset,_.addFoldingRange(wt.offset,oe.offset,"block")),d=wt.skip_pos,g=(Be=yt)?wt:an()}else if(w===")"||w==="("){if(H-Y<5||h.substring(Y,Y+4).toLowerCase()!=="join")break}else(w===" "||w==="	")&&(Y=H)}return g=Je(D,"TK_START_EXPR",l,1,L)}if(D===")"||D==="]")return g=Je(D,"TK_END_EXPR",l,1,L),D===")"&&L&&p?(p=!1,g.ignore=!0,Be?g:an()):g;if(D==="{"&&(O="TK_START_BLOCK")||D==="}"&&(O="TK_END_BLOCK"))return L&&(R=l,i=!0),g=Je(D,O,l,1,L);if(D===",")return g=Je(D,"TK_COMMA",l,1,L);if(D==='"'||D==="'"){let H=D,Y=l,w=!1,xe,Ve;for(O="",` 	\r
+-*/%:?~!&|^=<>[({,.]`.includes(D=h.charAt(l-1))||(H===D?D==="'"||!ze(g)?_.addDiagnostic(B.didyoumean(D=`\`${D}`),l-1,h[l+1]===H?2:1,{code:"expect",data:D}):(l=g.offset,g=g.previous_token,_.tokenranges.pop()):_.addDiagnostic(B.missingspace(),l,1));D=h[d++];)if(D==="`")d++;else{if(D===H)return O+=h.substring(l,d),g=Je(O,"TK_STRING",l,d-l,L),_.tokenranges.push({start:l,end:d,type:2}),w&&(g.data=null,g.semantic=fa),xe&&(g=xe,d=g.offset+g.length),yn(h.charCodeAt(d))&&_.addDiagnostic(B.missingspace(),d),g;if(p){if(D===`
`){let He=d-1;for(;" 	".includes(D=h[d]);)d++;if(D===")"){O=h.substring(l,He).trimEnd(),g=Je(O,"TK_STRING",l,O.length,L=0),xe??=g,O="",_.tokenranges.push({start:l,end:l+g.length,type:3});let ct=g.previous_token;for(;ct&&(!ct.ignore||ct.content!=="(");)ct=ct.previous_token;for(_.addFoldingRange(l,He,"string"),g=Je(")","TK_END_EXPR",d,1,1),g.ignore=!0,ct&&(ct.next_pair_pos=d,g.previous_pair_pos=ct.offset),p=!1,w=!0,l=++d;" 	".includes(D=h[d]);)d++;O=h.substring(l,d),l=d}}}else if(D===`
`||D===";"&&" 	".includes(h[d-2])){O=(O+h.substring(l,d-(D===";"?2:1))).trimEnd(),--d,O&&(g=Je(O,"TK_STRING",l,O.trimStart().length,L),_.tokenranges.push({start:l,end:l+g.length,type:3}),w&&(g.data=null,g.semantic=fa),xe??=g,O="");break}}if(D){if(v>5)return g=xe,d=g.offset+g.length,delete _.tokens[g.offset],g;ge=Pe=!0;let He=Gt(v+1);e:for(;He.ignore&&He.type==="TK_STRING";){let ct=d,wt=He.data;for(w&&(He.semantic=fa);D=h[d++];)if(D==="`")d++;else if(D===H){let yt=h.substring(ct,d);He.content+=yt,He.length+=yt.length,wt[wt.length-1]+=yt.length,_.tokenranges.push({start:He.offset,end:He.offset+He.length,type:3}),yn(h.charCodeAt(d))&&_.addDiagnostic(B.missingspace(),d);break e}else if(D===`
`||D===";"&&" 	".includes(h[d-2])){let yt=h.substring(ct,d-(D===";"?2:1)).trimEnd();yt&&(He.content+=yt,He.length+=yt.length,wt[wt.length-1]+=yt.length),_.tokenranges.push({start:He.offset,end:He.offset+He.length,type:3}),d--;break}if(!D){let yt=h.substring(ct,--d);yt&&(He.content+=yt,He.length+=yt.length),_.tokenranges.push({start:He.offset,end:He.offset+He.length,type:3})}He=Gt(v+1)}return(!He.ignore||He.type!=="TK_STRING")&&((Ve=He.previous_token)?_.addDiagnostic(B.unterminated(),Ve.offset+Ve.length,1):_.addDiagnostic(B.missing(H),Y,1)),ge=!1,g=xe,d=g.offset+g.length,g}else return _.addDiagnostic(B.unterminated(),C,1),O+=h.substring(l,C),g=Je(O,"TK_STRING",l,C-l,L),_.tokenranges.push({start:l,end:C,type:3}),w&&(g.data=null,g.semantic=fa),p&&(_.addFoldingRange(l,C,"string"),p=!1),g}if(D==="."){let H=h[d];if(H==="=")return d++,g=Je(".=","TK_EQUALS",l,2,L);if(Cn.includes(H)&&Cn.includes(h[d-2]))return g=Je(D,"TK_OPERATOR",l,1,L);if(/\d/.test(H)&&["TK_EQUALS","TK_OPERATOR","TK_COMMA","TK_START_EXPR"].includes(g.type)){let Y=d+1,w="";for(;Y<C&&yn(h.charCodeAt(Y));)H+=h[Y],Y+=1;if(/^\d+([Ee]\d+)?$/.test(H))return d=Y,D+=H,g=Je("0"+D,"TK_NUMBER",l,D.length,L),g.data=!0,g.semantic=Vr,g;if(Y<C&&/^\d+[Ee]$/.test(H)&&"-+".includes(h[Y])){for(H+=h[Y],Y+=1;Y<C&&yn(h.charCodeAt(Y));)w+=h[Y],Y+=1;if(/^\d+$/.test(w))return d=Y,D+=H+w,g=Je("0"+D,"TK_NUMBER",l,D.length,L),g.data=!0,g.semantic=Vr,g}}return g=Je(D,/[%([]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]/.test(H)?"TK_DOT":"TK_UNKNOWN",l,1,L)}if(D===";"){let H=L&&`
`.includes(h.charAt(R))?"TK_COMMENT":(L=0,"TK_INLINE_COMMENT"),Y="",w,xe,Ve,He=l-1,ct,wt=0,yt=!0;for(;;){if(d=He,He=h.indexOf(`
`,d+1),ct=h.substring(d+1,He=He<0?C:He).trim(),ct.startsWith(";")){if(wt++,w=ct.match(/^;\s*@/)){if(wt>1)break;let ae=ct.substring(w[0].length).replace(/\s+;.*$/,"").toLowerCase();if(w=ae.match(/^([-.\w]+)(?=(\s|$))/))switch(w[1]){case"include":(ae=ae.substring(w[1].length).trimStart())&&Ft(ae);break;case"include-winapi":ie&&(w=te[Ht.winapi])&&Object.defineProperty(y,Ht.winapi,{value:w.fsPath,enumerable:!1});break;case"reference":_.d_uri||=ae.substring(w[1].length).trimStart();break;case"lint-disable":case"lint-enable":ae=ae.substring(w[1].length).trimStart(),ae==="class-non-dynamic-member-check"&&(w[1]==="lint-enable"?delete(u??_).checkmember:(u??_).checkmember=!1);break}Ve=!0}else if(w=ct.match(/^;+\s*([{}])/)){if(yt=!1,w[1]==="{"?f.bracket.push(d+1):(w=f.bracket.pop())!==void 0&&_.addFoldingRange(w,d+1,"block"),wt===1&&(Ve=!0),L&&!Ve)continue;d=He;break}if((w=ct.match(/^;\s*(~?\s*|@)(todo|fixme)(:?\s*)(.*)/i))&&(_.children.push(T.DocumentSymbol.create(`${w[2].toUpperCase()}: ${w[4].trim()}`,void 0,T.SymbolKind.Null,xe=de(d+1,He-d-1),xe)),L))continue;if(L){if(w=ct.match(/^;\s*[@#](end)?region\b/i))Ve=!0,yt=!1,qe(),w[1]?(w=f.region.pop())!==void 0&&_.addFoldingRange(w,d+1,"region"):(f.region.push(d+1),(ct=ct.substring(w[0].length).trim())&&_.children.push(T.DocumentSymbol.create(ct,void 0,T.SymbolKind.Null,xe=de(d+1,He-d-1),xe)));else if(Eo&&(w=ct.match(Eo))){let ae=w.groups;for(let Q in ae)if(Q.startsWith("tag")&&(w=ae[Q]?.trim()))break;typeof w!="string"&&(w=w[1]?.trim()),w&&(_.children.push(T.DocumentSymbol.create(w,void 0,T.SymbolKind.Null,xe=de(d+1,He-d-1),xe)),Ve=!0)}if(!Ve)continue}d=He}break}Y=h.substring(l,d).trimEnd(),_.tokenranges.push({start:l,end:d,type:1});let Ne=_.tokens[l]={type:H,content:Y,offset:l,length:Y.length,next_token_offset:-1,topofline:L,ignore:Ve,skip_pos:d,previous_token:g};if(!L)Cn.includes(h[l-1])||fe(Ne);else{let ae=_.document.positionAt(d).line;!ge&&!Ve&&ct[0]&&!ct.startsWith("/*")&&(a[ae+1]=Ne),ne&&(g.pos??=_.document.positionAt(g.offset)).line>ne.endLine&&qe(),ne?ne.endLine=ae:yt&&(ne=T.FoldingRange.create(_.document.positionAt(l).line,ae,void 0,void 0,"comment"))}return Ne}if(D==="/"&&L&&h[d]==="*"){let H=h.indexOf(`
`,--d),Y=0,w="";for(;!(E=h.substring(d,H>0?H:C).match(/(^[ \t]*\*\/)|\*\/([ \t]*\r?)$/))&&H>0;)R=H,H=h.indexOf(`
`,d=H+1),Y++;E?.[1]?(d=h.indexOf("*/",R)+2,i=!0,R=d-1):d=(H<0?C:H)-(E?.[2].length??(w="*/",0)),_.tokenranges.push({start:l,end:d,type:1});let xe={type:"TK_BLOCK_COMMENT",content:h.substring(l,d)+w,offset:l,length:d-l,next_token_offset:-1,previous_token:g,topofline:L,skip_pos:d};if(!ge){let Ve=d,He=0;for(;" 	\r".includes(D=h[Ve]??"\0")||D===`
`&&++He<2;Ve++);(h[l+2]==="*"&&h[l+3]!=="/"&&!(xe.data=null)||!`
\0`.includes(D))&&(a[_.document.positionAt(Ve).line]=xe)}return qe(),_.tokens[l]=xe,Y&&_.addFoldingRange(l,d,"comment"),xe}if(-1<(re=Mu.indexOf(D))){if(je&&"<>".includes(D))return g=Je(D,D==="<"?"TK_START_EXPR":"TK_END_EXPR",l,D.length,L);for(;d<C&&-1<(E=Mu.indexOf(D+h[d],re));)D+=h[d++],re=E;if(D==="?"){g=Je(D,"TK_OPERATOR",l,1,L);let H=d,Y=g,w=Gt(v+1);return d=H,(")]},:??".includes(w.content)||w.content==="."&&w.type!=="TK_OPERATOR")&&(Y.ignore=!0,w.content==="."&&kn<sn-1&&_.addDiagnostic(B.requireVerN(sn-1),Y.offset,Y.length,{code:"optional chaining"})),g=Y}else D==="??="&&kn<sn-1&&_.addDiagnostic(B.requireVerN(sn-1),l,D.length,{code:"maybe-assign"});return g=Je(D,re>=ey?"TK_EQUALS":"TK_OPERATOR",l,D.length,L)}if(D==="#"){let H="#";for(;yn(h.charCodeAt(d));)H+=h[d++];if(X.push(l),g=Je(H,"TK_SHARP",l,H.length,L),gt=H.toLowerCase(),L&&Cn.includes(D=h.charAt(d))&&(gt==="#hotif"||ie&&gt==="#initexec"))return g;if(R=h.indexOf(`
`,l=d),d=R<0?C:R,L&&Cn.includes(D)){if(D===" "||D==="	"){for(;" 	".includes(h[l]);)l++;let Y=h.substring(l,d).trimEnd().replace(/(^|[ \t]+);.*$/,"");g.data={content:Y,offset:l,length:Y.length},d=l+Y.length,Y&&(g.skip_pos=d,_.tokenranges.push({start:l,end:l+Y.length,type:3,previous:g.offset}))}}else g.type="TK_UNKNOWN",g.content+=h.substring(l,d).trimEnd(),g.length+=d-l;return g}return g=Je(D,"TK_UNKNOWN",l,D.length,L);function K(){X.length>1&&_.addFoldingRange(X[0],X.pop(),"imports"),X.length=0}function qe(){ne&&(ne.endLine>ne.startLine&&_.foldingranges.push(ne),ne=void 0)}}function eo(v=k.start_line_index){let O=pe[v-1];return O?.text.length?O.indent:k.indentation_level}function Aa(){if(k.mode===Ge.ObjectLiteral)return k.object_style??ye.object_style;if(k.mode===Ge.ArrayLiteral)return k.array_style??ye.array_style}function Rm(){Vt()?k.last_word="_":(Yu()||F&&!Zt(we.previous_token??Qe,we))&&ke(null);let v=Ge.Expression;if(ot!=="("){if(we.ignore){tt(v),z=we.previous_token?.content!=="(",Ie(),k.last_word="";return}if(we.topofline<1&&ai(we.previous_token??Qe)){tt(v),Ie(),k.last_word="",k.indentation_level=eo()+1,ye.space_in_paren&&(z=!0);return}(!F&&we.previous_token?.callsite||et==="TK_RESERVED")&&(z=!0),v=Ge.ArrayLiteral}else we.ignore?ke(!0):et==="TK_END_EXPR"||et==="TK_WORD"?z=Cn.includes(we.prefix_is_whitespace||"\0"):et==="TK_STRING"?z=!0:et==="TK_RESERVED"&&(/^(break|continue|goto)$/i.test(I)?z=!1:["if","for","while","loop","case","catch","switch"].includes(I)?z=!!ye.space_before_conditional:z=kt);if(Dt()||(F&&ye.preserve_newlines?ke(!0):(et==="TK_EQUALS"||et==="TK_COMMA"||et==="TK_OPERATOR")&&$e()),tt(v),k.last_word="",k.indentation_level=eo(),k.indentation_level<lt.indentation_level&&(lt.indentation_level=k.indentation_level,k.indent_after=!0),Ie(),we.ignore){let O=we.data.content;O&&Ie(O)}else ye.space_in_paren&&(z=!0);dt(),ot==="["&&(k.array_style??ye.array_style)===sr.expand&&ke(!0)}function xm(){for(;k.mode===Ge.Statement;)ht();let v=ot==="]"&&k.mode===Ge.ArrayLiteral;if(ht(),k.had_comment=lt.had_comment,v){let O=k.array_style??ye.array_style;O===sr.collapse||I==="["||k.indentation_level>=lt.indentation_level?Z():(O||F&&ye.preserve_newlines)&&ke(!0)}else(et==="TK_END_EXPR"||et==="TK_END_BLOCK")&&k.indentation_level>=lt.indentation_level?Z():et!=="TK_START_EXPR"&&$e();z=!!(ye.space_in_paren&&!(et==="TK_START_EXPR"&&!ye.space_in_empty_paren)),Ie(),lt.indent_after&&dt(),p??=!1}function Cm(){if(we.data)tt(Ge.ObjectLiteral),k.indentation_level=eo(),lt.mode!==Ge.Conditional&&(k.indent_after=k.indentation_level<lt.indentation_level,lt.indentation_level=k.indentation_level),z||=kt&&et!=="TK_START_EXPR",Ie(),dt(),(k.object_style??ye.object_style)===sr.expand?ke(!0):z=kt;else{let v;if(we.in_expr)v=eo();else if(["try","if","for","while","loop","catch","else","finally","switch"].includes(k.last_word))v=eo();else for(;k.mode===Ge.Statement;)ht();k.declaration_statement=!1,tt(Ge.BlockStatement),k.in_expression=!1,k.indentation_level=v??=k.indentation_level,z??=kt,lt.in_case_statement&&et==="TK_LABEL"&&/^(default)?:$/.test(I)?(k.case_body=null,ke(),k.indentation_level--):(ye.brace_style===0||F&&ye.preserve_newlines&&!ye.brace_style)&&(we.in_expr===void 0||k.mode===Ge.Expression)&&ke(!0);let O=!Te();Ie(),k.indentation_level<lt.indentation_level&&(lt.indentation_level=k.indentation_level,k.indent_after=!0),ye.switch_case_alignment&&k.last_word==="switch"||dt(),O||ye.brace_style!==void 0?ke(!0):z=kt}k.last_word=""}function Dm(){for(;k.mode===Ge.Statement;)ht();let v=k.mode===Ge.ObjectLiteral,O=v||we.in_expr!==void 0;if(v){let D=k.object_style??ye.object_style;D===sr.collapse||I==="{"?Z():(D||F&&ye.preserve_newlines)&&ke(!0),z=kt&&I!=="{"}else(ye.brace_style!==void 0||F)&&ke(!0);ht(),Ie(),lt.indent_after&&dt(),O||(lt.case_body===null&&dt(),ye.brace_style!==void 0&&ke(!0),z=kt)}function Na(){let v=!1;if(z||=/^(TK_NUMBER|TK_WORD|TK_RESERVED|TK_STRING|TK_END_)/.test(et),Vt()&&(v=k.declaration_statement,!F&&["try","else","finally"].includes(k.last_word)&&["if","while","loop","for","try","switch"].includes(gt)&&Ct()),xt==="TK_RESERVED"){if(ye.keyword_start_with_uppercase!==void 0&&(ot=ye.keyword_start_with_uppercase?gt.replace(/^./,O=>O.toUpperCase()):gt),gn(gt))F&&ke(v);else{let O=!1;switch(gt){case"else":for(;k.mode===Ge.Statement&&!k.if_block&&!k.loop_block&&!(k.catch_block&&!k.else_block);)ht();break;case"finally":for(;k.mode===Ge.Statement&&!k.catch_block&&!k.try_block&&!(k.else_block&&k.catch_block);)ht();break;case"catch":for(;k.mode===Ge.Statement&&!k.try_block&&!(k.catch_block&&!k.else_block);)ht();break;case"until":for(;k.mode===Ge.Statement&&k.loop_block!==1;)ht();break;case"case":case"class":for(;k.mode===Ge.Statement;)ht();break;case"if":case"for":case"loop":case"while":case"try":case"switch":if(!v)if(F&&k.mode===Ge.Statement&&!k.declaration_statement&&!k.in_expression)ke(!1);else for(;k.mode===Ge.Statement&&k.declaration_statement;)ht();break}if(k.if_block?gt==="else"?(k.if_block=!1,k.else_block=!0,O=!0):k.if_block=!1:k.loop_block?k.loop_block===1&&gt==="until"?(k.loop_block=0,O=!0):gt==="else"?(k.else_block=!0,k.loop_block=0,O=!0):k.loop_block=0:k.try_block?gt==="catch"?(k.try_block=!1,k.catch_block=!0,O=!0):gt==="finally"?(k.try_block=!1,k.finally_block=!0,O=!0):k.try_block=!1:k.catch_block?gt==="finally"?(k.catch_block=k.else_block=!1,k.finally_block=!0,O=!0):gt==="else"?(k.else_block=!0,O=!0):gt==="catch"?O=!0:k.catch_block=k.else_block=!1:k.else_block=k.finally_block=!1,gt==="class"){we.topofline===1&&ke(),Ie(),k.last_word=gt,k.start_line_index=pe.length,tt(Ge.Statement),Oe=!0;return}else if(gt==="case"){ke(),k.case_body&&(Ct(),k.case_body=!1),Ie(),k.in_case=!0,k.in_case_statement=!0;return}switch(O?(Z(),k.last_text!=="}"||ye.brace_style<1||F&&ye.preserve_newlines&&!ye.brace_style?ke(!0):z=kt):F&&(I==="else"&&!ye.preserve_newlines&&["if","for","loop","while","try","switch"].includes(gt)?Ct():ke(v)),gt){case"loop":k.loop_block=1;break;case"while":case"for":k.loop_block=2;break;case"if":k.if_block=!0;break;case"try":k.try_block=!0;break}}k.last_word=gt,k.start_line_index=pe.length}else F&&k.mode===Ge.Statement&&!k.in_expression&&!Zt(we.previous_token??Qe,we)?ke(v):F&&(ye.preserve_newlines||we.symbol)?(we.symbol||Aa()!==sr.collapse)&&ke(!we.symbol):["TK_COMMA","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"].includes(et)&&(Dt()||$e()),!Oe&&k.mode===Ge.BlockStatement&&we.symbol?.children&&(tt(Ge.Statement),Oe=!0),k.last_word="_",ye.symbol_with_same_case&&(ot=we.definition?.name||ot);Ie()}function Sm(){if(Vt())if(F&&ye.preserve_newlines)ke(!0);else if(k.declaration_statement)z=et!=="TK_OPERATOR";else{let v=we.previous_token;z=v.op_type!==-1&&!v.next_pair_pos&&kt}else et==="TK_RESERVED"||et==="TK_WORD"?F?ke():z=!0:et==="TK_COMMA"||et==="TK_START_EXPR"||et==="TK_EQUALS"||et==="TK_OPERATOR"?Dt()||$e():(F&&ke(),we.ignore||we.data!==void 0?z=!1:z=!0);if(we.ignore){let v;if(ke(!0),ye.ignore_comment&&ot.trimStart().startsWith("(")&&(v=ot.indexOf(`
`))>0){let O=ot.slice(0,v).trimEnd().replace(/[ \t]+;.*$/,"");/(^[ \t]*\(|[ \t])c(om(ments?)?)?/i.test(O)?ot=`${O}
${ot.slice(v+1).replace(/^[ \t]*;.*\r?\n/gm,"").replace(/[ \t]+;.*/gm,"")}`:ot=`${O}
${ot.slice(v+1)}`}Ie(),pe[pe.length-1].text=[ot];return}Ie()}function Em(){Vt(),z=kt,Ie(),z=kt}function Pm(){delete k.ternary_depth,(k.mode===Ge.BlockStatement||k.declaration_statement)&&(tt(Ge.Statement),dt()),et==="TK_WORD"&&Cn.includes(we.prefix_is_whitespace||"\0")&&we.previous_token?.callsite?F&&ye.preserve_newlines?ke(!0):z=!0:(z=kt&&et==="TK_COMMA"||I==="for"&&et==="TK_RESERVED",k.mode===Ge.Statement&&k.parent.mode===Ge.ObjectLiteral&&ht(),F&&ye.preserve_newlines?ke(!0):Te()||(F=!1));let v=Aa();v&&Z(),Ie(),v===sr.expand?ke(!0):z=kt}function Om(){let v=!!(kt||/^\w/.test(ot)),O=v;if(we.previous_token?.callsite&&(z=!0),Vt()){if(k.declaration_statement&&/^(\+\+|--|%|!|~|not)$/.test(gt)){z=!0,k.last_word="_",Ie(),gt==="not"&&(z=!0);return}}else if(ot==="=>")Oe&&k.mode===Ge.Statement&&k.parent.mode===Ge.BlockStatement&&(Oe=!1),tt(Ge.Statement),dt(),k.in_fat_arrow=!0;else if(/^(\+\+|--|%|!|~|not)$/.test(gt)&&Yu()){ke(),Ie(),gt==="not"&&(z=!0);return}if(et==="TK_RESERVED"&&(z=!0),ot==="%"){O=!!(we.previous_pair_pos!==void 0&&" 	".includes(h[we.offset+1])),z||=!!(we.next_pair_pos&&" 	".includes(we.prefix_is_whitespace||"\0")),F&&ye.preserve_newlines&&k.mode===Ge.Statement&&Zt(we.previous_token??Qe,we)&&ke(!0),Ie(),z=O;return}if(ot===":"&&(k.in_case||k.mode===Ge.Statement&&k.parent.in_case)){k.in_case||ht(),dt(),Ie(),On(`
`)?ke():z=kt,k.in_case=!1,k.case_body=!0,tt(Ge.Statement),k.case_body=!0,xt="TK_LABEL";return}F&&ye.preserve_newlines?ke(!0):et==="TK_OPERATOR"&&!/^(--|\+\+|%|!|~|not)$/.test(I)&&$e(),["--","++","!","~"].includes(ot)||"-+".includes(ot)&&(["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR","TK_COMMA","TK_RESERVED"].includes(et)||we.previous_token?.callsite)?(O=!1,v=ot==="!"&&et==="TK_WORD",!z&&(ot==="++"||ot==="--")&&["TK_END_EXPR","TK_WORD"].includes(et)&&(O=!0)):ot===":"?k.ternary_depth?(ht(),Ct(),k.ternary_depth--):(v=!1,Aa()&&Z()):ot==="?"?we.ignore?(v=!1,O=_.tokens[we.next_token_offset]?.content.startsWith("?")??!1):(k.ternary_depth===void 0?k.ternary_depth=1:k.ternary_depth++,dt(),tt(Ge.Expression),k.ternary_depth=k.parent.ternary_depth):ot==="."?O=v=!0:ot==="&"?((et!=="TK_WORD"&&et!=="TK_END_EXPR"||we.previous_token?.callsite)&&(O=!1),(et==="TK_COMMA"||et==="TK_START_EXPR")&&(v=!1)):ot==="*"&&(I===","?O=!1:_.tokens[we.next_token_offset]?.type==="TK_END_EXPR"&&(v=O=!1)),z||=v,Ie(),z=O}function Am(){if(k.mode===Ge.Statement){let E=_.tokens[we.previous_token?.next_token_offset];!E||!k.in_expression&&!Zt(E.previous_token??Qe,E)?ke():k.had_comment<2&&Z()}if(ye.ignore_comment)return;let v=ot.split(`
`),O=/^\/\*\*(?!\/)/.test(ot),D="";O||(D=new RegExp(`^${h.substring(h.lastIndexOf(`
`,we.offset)+1,we.offset)}`)),ke(!0),Ie(v[0].trimEnd());for(let E=1,re=v.length-1;E<re;E++)ke(!0),Ie(O?v[E].replace(/^(\s*(\*?\s*(?=@)|\* ?))?/," * "):v[E].trimEnd().replace(D,""));v.length>1&&(ke(!0),Ie((O?" ":"")+v.at(-1).trim())),ke(!0),k.had_comment=3}function Ju(v){let O=v.match(/^;\s*@format\b/i);if(!O)return;let D=Wu(Object.fromEntries(v.substring(O[0].length).split(",").map(E=>{let re=E.indexOf(":");return[E.substring(0,re).trim(),E.substring(re+1).trim()]})));for(let E of["array_style","object_style"])E in D&&(k[E]=D[E],delete D[E]);Object.assign(ye,D)}function Nm(){if(Ju(ot),ye.ignore_comment)return;Te()&&pe.length>1&&pe.pop();let v;pe[pe.length-1].text.push(ye.white_space_before_inline_comment||((v=we.previous_token)?h.substring(v.skip_pos??v.offset+v.length,we.offset):"	"),ot),ke(!0),k.had_comment=1}function Mm(){if(k.mode===Ge.Statement){let v=_.tokens[we.previous_token?.next_token_offset];!v||!k.in_expression&&!Zt(v.previous_token??Qe,v)?ke():k.had_comment<2&&Z()}Ju(ot),!ye.ignore_comment&&(ot.split(`
`).forEach(v=>{ke(!0),Ie(v.trim())}),ke(!0),k.had_comment=2)}function Lm(){Vt(),$e(k.last_text===")"&&ye.break_chained_methods),Ie()}function Fm(){xt="TK_WORD",Na()}function Ma(){if(ke(),ye.symbol_with_same_case&&xt==="TK_SHARP"&&(ot=Jr[gt]?.[0]||ot),gt==="#hotif"&&ye.indent_between_hotif_directive){k.hotif_block&&(Ct(),k.hotif_block=!1),Ie(),_.tokens[we.next_token_offset]?.topofline===0&&(dt(),k.hotif_block=!0),z=!0;return}Ie();let v=we.data?.content;v?Ie(xt==="TK_HOTLINE"?v:" "+v):xt==="TK_HOT"?z=!!ye.space_after_double_colon:z=kt||xt==="TK_SHARP"}function Km(){if(ke(null),gt==="default:"&&(k.in_case_statement||k.mode===Ge.BlockStatement&&k.last_word==="switch")){k.case_body?Ct():k.case_body=!0,Ie(),dt(),k.in_case=!1,k.in_case_statement=!0,z=kt,tt(Ge.Statement),k.case_body=!0;return}Ie();let v=pe.at(-1).text;v[0].trim()===""?pe[pe.length-1].text=v.slice(1):dt()}function qm(){Ie(),_.tokens[we.next_token_offset]?.topofline===1&&ke()}function Yu(){return F&&(k.parent.mode===Ge.BlockStatement&&["TK_END_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_WORD","TK_STRING"].includes(et)||et==="TK_OPERATOR"&&/^(\+\+|--|%)$/.test(I)||et==="TK_RESERVED"&&/^(break|continue|goto|global|local|loop|return|static|throw)$/.test(I))}}clear(){this.texts={},this.declaration={},this.include={},this.tokens={},this.linepos={},this.labels={},this.typedef={},this.object={method:{},property:{}},this.need_scriptdir=this.hotstringExecuteAction=this.isparsed=!1,this.children.length=this.dllpaths.length=this.tokenranges.length=0,this.diagnostics.length=this.foldingranges.length=0,this.includedir.clear(),this.dlldir.clear(),this.d_uri="",delete this.maybev1,delete this.checkmember,delete this.symbolInformation}get included(){return ar[this.uri]??{}}get relevance(){let t=this.uri,n={...xi[t]};for(let r in ar[t])Object.assign(n,xi[r]);return delete n[t],n}findSymbol(t,n,r){let i,s,a=this.uri;if(n===T.SymbolKind.Field){let y=this.tokens,h=r?this.document.offsetAt(r):-1,C;s=r&&this.searchScopedNode(r);for(i of(s??this).labels?.[t.endsWith(":")?t.slice(0,-1):t]??[]){if(!i.def)break;if((C=i.data)===-1||C<h&&(!(C=y[y[C].next_pair_pos]?.offset)||h<C))return{node:i,uri:a,scope:s}}return s&&null}let p,u,f=!0;if(t.startsWith("$"))return(i=m(this.d?a:this.d_uri)??this.typedef[t])&&{node:i,uri:a,is_global:!0};if(s=r&&this.searchScopedNode(r)){if(s.kind===T.SymbolKind.Class)s=void 0;else if(s.kind===T.SymbolKind.Property&&t==="THIS")return{node:s.parent,uri:a,scope:s,is_this:!0}}let c=s;for(;c?.local;){if(p=c.local[t]){i=p,u=c,f=!1,i.is_param&&c.parent?.kind===T.SymbolKind.Property&&(u=c.parent);break}if(c.has_this_param&&(t==="THIS"||t==="SUPER")){for(i=c;i.kind!==T.SymbolKind.Class;)if(!(i=i.parent))return null;return t==="THIS"?{node:i,uri:a,scope:s,is_this:!0}:(i=ya(i,this))?{node:i,uri:a,scope:s,is_this:!1}:null}if(((p=c.global?.[t])&&(i=p)||c.assume===2)&&(f=!0))break;if((p=c.declaration?.[t])?(i=p,u=c,f=!1):i??=(u=c,c.unresolved_vars?.[t]),c.static&&c.kind===T.SymbolKind.Function){(p=c.parent?.local[t])?.static&&(i=p,u=c.parent),i?.def&&(f=!1);break}c=c.parent}return f&&(i=m(this.d_uri)??this.declaration[t]??(f=1,i)??(f=!0,this.typedef[t])),i&&{node:i,uri:a,scope:s,is_global:f,parent:u};function m(y){let h=te[y];if(!h)return;let C=h.declaration[t]??h.typedef[t];return C&&(a=C.uri=y,C)}}getContext(t,n=!1){let r,i,s,a,p,u,f=this.document,c=this.tokens,{line:m}=t,y=f.getText(T.Range.create(m,0,m+1,0)).trimEnd(),{character:h}=t;for(a=h;--a>=0&&yn(y.charCodeAt(a)););if(!n)for(;yn(y.charCodeAt(h));h++);let C=T.Range.create(m,a+=this.d&&y[a]==="$"?0:1,m,h),F=u=y.slice(a,h),ne=f.offsetAt(C.start),R=(s=c[ne])?s.previous_token:c[ne-1];if(R?.content==="."&&!s?.prefix_is_whitespace&&R.type!=="TK_OPERATOR"||(p=R&&ai(R)&&s?.type==="TK_START_EXPR"&&s.topofline<1&&(s.content==="["||s.prefix_is_whitespace===void 0))){let g=R,b=p?R:R.previous_token,d=!!s?.paraminfo||y[h]==="(";for(;b;)switch(b.type){case"TK_DOT":g=b,b=b.previous_token;break;case"TK_END_EXPR":if(!(b=c[b.previous_pair_pos]))break;g=b,!b.next_pair_pos||b.topofline>0?b=void 0:b.prefix_is_whitespace===void 0||b.content==="["&&!b.previous_token?.callsite?(b=b.previous_token)&&(b.type==="TK_NUMBER"||b.type==="TK_STRING"||b.content==="%"&&(b=Qe)?(g=b,b=void 0):b.type==="TK_WORD"||b.type==="TK_DOT"||b.type.startsWith("TK_END_")||(b=void 0)):b=void 0;break;case"TK_END_BLOCK":if(b.in_expr!==void 0){g=c[b.in_expr],b=void 0;break}if(g=b,!(b=c[b.previous_pair_pos]))break;case"TK_START_BLOCK":g=b.data?b:Qe,b=void 0;break;case"TK_NUMBER":case"TK_STRING":g=b,b=void 0;break;case"TK_WORD":if(g=b,b=b.previous_token){if(b.type==="TK_DOT")break;if(b.type==="TK_START_BLOCK"){b=void 0;break}g.prefix_is_whitespace===void 0&&b.previous_pair_pos!==void 0&&b.content==="%"&&(g=Qe),b=void 0}break;case"TK_OPERATOR":if(b.ignore&&b.content==="?"){g=b,b=b.previous_token;break}default:b=void 0;break}/TK_WORD|TK_NUMBER|TK_STRING|TK_START_/.test(g.type)?(s=g,C.start=f.positionAt(g.offset),C.end=f.positionAt(R.offset+(p?1:0))):(s=Qe,r=T.SymbolKind.Null),u="",r??=p?T.SymbolKind.Variable:d?T.SymbolKind.Method:T.SymbolKind.Property}else if(s)if(s.type==="TK_WORD"){let g=s.semantic,b=(i=s.symbol)??s.definition,d;if(b)r=b.kind,d=b,r===T.SymbolKind.Class?u=d.full:(r===T.SymbolKind.Property||r===T.SymbolKind.Method)&&(u=d.full.replace(/^\(([^ \t]+)\).*$/,(...X)=>`${X[1]}${d.static?".":"#"}${d.name}`));else if(g)switch(g.type){case 1:r=T.SymbolKind.Function;break;case 2:r=T.SymbolKind.Method;break;case 0:r=T.SymbolKind.Class;break;case 6:r=T.SymbolKind.Property;break;case 5:if(s.ignore)break;case 4:r=T.SymbolKind.Variable;break}else{let X;(!s.ignore||!((X=c[ne-1])?.op_type===1&&X.content==="%"||(X=c[ne+s.length])?.op_type===-1&&X.content==="%"))&&(r=T.SymbolKind.Variable)}}else s.type==="TK_LABEL"&&!s.hover_word&&(r=T.SymbolKind.Field);else if(R?.content.startsWith("#"))s=R,u=R.content;else if(s=this.find_token(C.start.character===y.length?ne-1:ne),s.type==="TK_STRING")u=s.content;else if(s.type.endsWith("COMMENT")){let g=y.substring(0,h),b=g.match(/(@see|\{@link(code|plain)?|@param(\s+\{[^}]*\})?)\s+((\[[ \t]*)?[^ \t]+)$/);if(b){if(g=b[4],b[1].startsWith("@param")){g=g.replace(/^\[[ \t]*/,"");let d=s.symbol;d?.params&&Rt.test(g)&&(g=`${$u(d)}~${g}`)}else y[h]===":"&&/^[a-zA-Z]+$/.test(g)&&(g="");(b=g.match(/^(([\w.$#~]|[^\x00-\x7f])+)(\(\))?$/))&&(u=b[1],r=u.includes(".")?b[3]?T.SymbolKind.Method:T.SymbolKind.Property:b[3]?T.SymbolKind.Function:T.SymbolKind.Class)}else(b=g.match(/(([\w.]|[^\x00-\x7f])+)$/))&&(u=b[1]+F)}return r??=T.SymbolKind.Null,{text:u,word:F,range:C,kind:r,linetext:y,token:s,symbol:i}}searchScopedNode(t,n){let{line:r,character:i}=t,s,a,p,u;for(let f of n??this.children)if(!(!(s=f.children)||r>f.range.end.line||r<f.selectionRange.start.line||r===f.selectionRange.start.line&&i<f.selectionRange.start.character||r===f.range.end.line&&i>f.range.end.character)){if(t.line>f.selectionRange.start.line||t.character>f.selectionRange.end.character){switch(f=this.searchScopedNode(t,s)??f,f.kind){case T.SymbolKind.Property:return this.searchScopedNode(t,[f.get,f.set].filter(Boolean))??f;case T.SymbolKind.Class:u=this.document.offsetAt(t),a=f;for(p of[a.property.__INIT,a.$property?.__INIT])for(let c of p?.ranges??[]){if(u<c[0])break;if(u<=c[1])return this.searchScopedNode(t,p.children)??p}}return f}return}}getScopeSymbols(t){if(!t||t.kind===T.SymbolKind.Class||t.kind===T.SymbolKind.Property)return{};let n=t,r=[n];for(;(n=n.parent)&&n.kind!==T.SymbolKind.Class;)r.push(n);let i=n?.kind===T.SymbolKind.Class?{THIS:zr,SUPER:Oo}:{};for(;n=r.pop();)n.kind!==T.SymbolKind.Property&&(n.assume===2?i={}:n.assume===1&&Object.entries(i).forEach(([s,a])=>!a.static&&a.static!==null&&delete i[s]),Object.assign(i,n.local??{}),Object.entries(n.declaration??{}).forEach(([s,a])=>i[s]??=a),Object.entries(n.unresolved_vars??{}).forEach(([s,a])=>i[s]??=a),Object.keys(n.global??{}).forEach(s=>delete i[s]));return i}initLibDirs(t){}getColors(){let t=this.tokenranges,n=this.document,r=n.getText(),i=[];for(let s of t)if(s.type===2){let a=s.start,p="",u=s.end,f=Yb.exec(r.substring(a,u));if(!f||!f[1]&&u-a!==f[2].length+2)continue;let c=T.Range.create(n.positionAt(a+=f.index+1+(f[1]?.length??0)),n.positionAt(a+f[2].length));p=f[5]?Zb[f[5].toLowerCase()]:f[3]===void 0?f[2]:f[2].substring(2);let m={red:0,green:0,blue:0,alpha:1},y=["red","green","blue"];f[4]!==void 0&&y.unshift("alpha");for(let h of y)m[h]=parseInt("0x"+p.substring(0,2))/255,p=p.slice(2);i.push({range:c,color:m})}return i}addDiagnostic(t,n,r=0,i){let s=this.document.positionAt(n),a=r?this.document.positionAt(n+r):s;this.diagnostics.push({message:t,range:T.Range.create(s,a),...i})}addFoldingRange(t,n,r="block"){let i=this.document.positionAt(t).line,s=this.document.positionAt(n).line-(r==="block"?1:0);i<s&&this.foldingranges.push(T.FoldingRange.create(i,s,void 0,void 0,r))}addFoldingRangePos(t,n,r="block"){let i=t.line,s=n.line-(r==="block"?1:0);i<s&&this.foldingranges.push(T.FoldingRange.create(i,s,void 0,void 0,r))}addSymbolFolding(t,n){let r=Mt.SymbolFoldingFromOpenBrace?this.document.positionAt(n).line:t.range.start.line,i=t.range.end.line-1,s=this.foldingranges;r<i&&(s[s.length-1]?.startLine===r&&s.pop(),s.push(T.FoldingRange.create(r,i,void 0,void 0,"block")))}update(){let t=this.uri,n=this.include;this.parseScript(),this.foldingranges.reverse(),Ci[t]&&(Ci[t].length=0,Ci[t].push(...Object.values(this.declaration).filter(m=>m.kind===T.SymbolKind.Class||m.kind===T.SymbolKind.Function)));let r=this.include,i=Object.keys(r).length,s=0;for(let m in n)if(!(m in r)){s=2;break}if(!s&&(i>Object.keys(n).length||""in n)&&(s=1),!s)return this.sendDiagnostics(!0);if(s===1){let m=No(this);for(let y in this.included)Object.assign(xi[y],m)}else Ao();let a=this.scriptpath,p=Object.keys(xi[t]).length;for(let m in ar[t])i=Object.keys(xi[m]).length,(i>p||i===p&&te[m].scriptpath.length<a.length)&&(a=te[m].scriptpath,p=i);let u,f=a.toLowerCase(),c=this.relevance;(f+"\\").startsWith(this.scriptdir.toLowerCase()+"\\lib\\")?(a=this.scriptdir,f=a.toLowerCase()):f!==this.scriptdir.toLowerCase()&&this.initLibDirs(a);for(let m in c)delete n[m],!(!(u=te[m])||u.scriptdir.toLowerCase()===f)&&(u.initLibDirs(a),u.need_scriptdir&&u.parseScript());for(let m in n){let y=te[m];y&&!y.actived&&y.close()}this.sendDiagnostics(!0,!0)}clearDiagnostics(){this.last_diags&&(this.include={},this.diagnostics=[],this.last_diags=0,Dn?.sendDiagnostics({uri:this.document.uri,diagnostics:[]}))}sendDiagnostics(t=!1,n=!1){let r=this.last_diags;if((r!==this.diagnostics.length||t&&r)&&(this.last_diags=this.diagnostics.length,Dn&&(this.diag_pending=!0,clearTimeout(this.diag_timer)||(this.diag_timer=setTimeout(async()=>{this.diag_pending=!1,await Dn.sendDiagnostics({uri:this.document.uri,diagnostics:this.diagnostics}),this.diag_pending||=void 0},500)))),!!n)for(let i in this.relevance)te[i]?.sendDiagnostics(t)}setWorkspaceFolder(){let t=this.uri;for(let n of zi)if(t.startsWith(n))return this.workspaceFolder=n;return this.workspaceFolder=""}keepAlive(){if(this.actived)return!0;let{uri:t,d:n}=this;if(!te[t])return!1;if(n&&n>2&&!t.includes("?"))return!0;for(let r in this.relevance)if(te[r]?.actived)return!0;return!1}close(t=!1,n=!0){if(this.actived=!1,!t&&this.keepAlive())return;let r=n?this.relevance:void 0;if(delete this.diag_timer,this.clearDiagnostics(),(t||!this.workspaceFolder)&&(delete te[this.uri],delete xi[this.uri],!this.actived&&te[this.d_uri]?.close(!1,!1)),!n)return;let i=!0;for(let s in r)i=!1,te[s]?.close(!1,!1);i?te[this.uri]||delete ar[this.uri]:Ao()}findStrOrComment(t){let n=this.tokenranges,r=0,i=n.length-1,s=0,a;for(;r<=i;)if(a=n[s=r+i>>1],t<a.start)i=s-1;else if(t>=a.end)r=s+1;else break;if(r<=i&&a)return this.tokens[a.start]??((a=this.tokens[a.previous])?.data&&{...a.data,previous_token:a,type:""})}};function Di(e,t=0,n=""){return{name:e,full:e,kind:t,extends:n,range:en,selectionRange:en,uri:""}}function Lg(e){let t=e.match(/^((([<>$~*!+#^]*?)(`?;|[\x21-\x3A\x3C-\x7E]|\w+|[^\x00-\x7f]))|~?(`?;|[\x21-\x3A\x3C-\x7E]|\w+|[^\x00-\x7f])[ \t]+&[ \t]+~?(`?;|[\x21-\x3A\x3C-\x7E]|\w+|[^\x00-\x7f]))([ \t]+up)?::$/i);if(!t)return!1;for(let n=4;n<7;n++)if((t[n]??"").length>1&&!Kg.test(t[n]))return!1;return!0}function iy(e,t,n="",r=!1,i=Co){let s,a="",p=e;if(e.startsWith("<")&&e.endsWith(">")){if(!(e=e.slice(1,-1)))return;let u=[e+".ahk"];(s=e.match(/^((\w|[^\x00-\x7f])+)_.*/))&&u.push(s[1]+".ahk");for(let f of t)for(let c of u)if((void 0)(e=f+c))return a=En.file(e).toString().toLowerCase(),{uri:a,path:te[a]?.fsPath??e,raw:p}}else{for(;s=e.match(/%a_(\w+)%/i);){let u=s[1].toLowerCase();if(i[u])e=e.replace(s[0],i[u]);else return}return e.indexOf(":")<0?e=(0,Hr.resolve)(n,e):e.includes("..")&&(e=(0,Hr.resolve)(e)),r&&!(void 0)(e)?void 0:(a=En.file(e).toString().toLowerCase(),{uri:a,path:te[a]?.fsPath??e,raw:p})}}function ya(e,t){let n=!1,r,i,s,a;switch(e.kind){case T.SymbolKind.Method:case T.SymbolKind.Function:s="func";break;case T.SymbolKind.Number:s=e.name;break;case T.SymbolKind.String:s="string";break;default:if(!e.property)return;case T.SymbolKind.Class:if(a=e,i=a.base)return i;if(n=!!a.prototype,s=a.extends,t??=te[a.uri],r=a.extendsuri,!s)if((a.full||a.name).toLowerCase()==="any")if(n)n=!1,s="class";else return;else s="object";break}return a=Si(t??te[Ht.ahk2],s,r),n?a:a?.prototype}function tn(e,t,n,r,i){let s,a,p,u,f=0,c=t,m=i??=[];for(n=n.toUpperCase();;){if(f===m.length){if(m.includes(c))break;m.push(c)}if(p=c.property?.[n])if(r){if(p.kind===T.SymbolKind.Method)return p.uri??=c.uri,p;if((u=p).kind===T.SymbolKind.Class||(u=p.call))return u.uri??=c.uri,u;s??=(p.uri??=c.uri,p)}else if(p.kind===T.SymbolKind.Method)a??=(p.uri??=c.uri,p);else{if(p.children||p.has_this_param)return p.uri??=c.uri,p;s??=(p.uri??=c.uri,p)}if((u=m[++f])===null)break;if(!(c=u??ya(c,e))){m.push(null);break}}if(s??=a)return s}function fr(e,t,n){let r=t,i=n??[],s=[];for(;r&&!i.includes(r);)i.push(r),s.push(r.property),r=ya(r,e);if(!n)for(let a;r=i.pop();a=r.checkmember??=a);return Object.assign({},...s.reverse())}function dr(e,t){let n=tn(t??=te[e.uri],e,"call",!0);return n?.full?.startsWith("(Object) static Call(")?tn(t,e.prototype,"__new",!0)??n:n}function jg(e,t,n){let r=[],i;do if(i=t.property?.[n])return i.uri??=t.uri,i;while(t=(i=t.extends?.toLowerCase())&&[i,`(${i}) prototype`].includes(t.full.toLowerCase())&&!r.includes(t)&&r.push(t)?ya(t,e):void 0)}function Si(e,t,n){let r=t.toUpperCase().split("."),i=r.shift(),s=n?te[n]?.declaration[i]:bi(e,i)?.node;if(!(!s?.property||s.def===!1)){n??=s.uri;for(i of r)if(!(s=jg(e,s,i)))return;return s.uri??=n,s}}function ai(e){switch(e.type){case"TK_DOT":return!0;case"TK_END_BLOCK":return!!(e.data??e.in_expr!==void 0);case"TK_END_EXPR":case"TK_NUMBER":case"TK_STRING":return!0;case"TK_WORD":return!e.paraminfo;case"TK_RESERVED":return qg.includes(e.content.toLowerCase(),3);case"TK_OPERATOR":if(e.op_type===1)return!0;switch(e.content){case"?":return!!e.ignore;case"%":return e.previous_pair_pos!==void 0;case"++":case"--":return!e.topofline&&ai(e.previous_token??Qe)}default:return!1}}function ti(e,t,n,r){let i=[],s=[],a=e.tokens,p=[0],u=Qe,f,c,m;typeof n=="object"?f=e.document.offsetAt(n):f=n;e:for(;t&&t.offset<f;){switch(t.type){case"TK_STRING":case"TK_NUMBER":if(R())break e;i.push(t),u=t;break;case"TK_WORD":if(R())break e;if(i.push(t),u=t,t.symbol){t=e.find_token(e.document.offsetAt(t.symbol.range.end),!0);continue}else if(t.callsite){if(t.next_token_offset>=f||t.next_token_offset===-1)break e;if(i.push(c={content:"",type:"TK_FUNC",paraminfo:t.callsite.paraminfo??t.paraminfo}),t=a[t.next_token_offset],c.data=t?.content==="(",!t||!(t=a[t.next_pair_pos])){i.length=0;break e}}break;case"TK_DOT":if((t=a[t.next_token_offset])?.type==="TK_WORD"){if(c=a[t.next_token_offset],c?.content==="["&&c.topofline<1||c?.content==="("&&!c.prefix_is_whitespace){let d={content:t.content,type:"TK_FUNC"};if(i.push(d),c.offset>=f)break e;if(d.data=c.content==="(",d.paraminfo=c.paraminfo,!(t=a[c.next_pair_pos])){i.length=0;break e}break}c?.content==="%"&&!c.prefix_is_whitespace&&c.previous_pair_pos===void 0?g():i.push({content:t.content,type:"TK_FUNC"})}else if(t?.type==="TK_START_EXPR"){if(t.offset>=f)break e;if(i.push({content:"",type:"TK_FUNC",data:t.content==="(",paraminfo:t.paraminfo}),!(t=a[t.next_pair_pos])){i.length=0;break e}}else g();break;case"TK_OPERATOR":if(t.content==="%"&&t.previous_pair_pos===void 0){if(!t.prefix_is_whitespace)g();else{if(R())break e;g()}break}case"TK_EQUALS":if(ne(t))break e;break;case"TK_START_EXPR":if(!(t=a[(c=t).next_pair_pos])){i.length=0;break e}if(!c.symbol&&(!c.prefix_is_whitespace||c.content==="["&&c.topofline<1)&&(u.op_type===1||["TK_WORD","TK_NUMBER","TK_STRING","TK_END_EXPR"].includes(u.type)||u.type==="TK_END_BLOCK"&&(m=a[u.previous_pair_pos])&&(m.data??m.in_expr!==void 0)))i.push({content:"",type:"TK_FUNC",paraminfo:c.paraminfo,data:c.content==="("});else if(c.content==="[")i.push({symbol:da});else{if(R())break e;if(i.push(c),c.symbol){u=t,t=e.find_token(e.document.offsetAt(c.symbol.range.end),!0);continue}}u=t;break;case"TK_START_BLOCK":if(!(t=a[(c=t).next_pair_pos])){i.length=0;break e}i.push(c);break;case"TK_COMMENT":case"TK_INLINE_COMMENT":case"TK_BLOCK_COMMENT":break;case"TK_COMMA":i.length=s.length=0,u=Qe,p=[0];break;case"TK_END_BLOCK":case"TK_END_EXPR":if(t.offset===f-1)break e;default:i.length=0;break e}t=a[t.next_token_offset]}if(!i.length)return[];for(;t=s.pop();)F(t);let y=new Set,h=[],C;for(t of i){if(t.symbol)if(t.symbol.kind===T.SymbolKind.Property){let d=t.symbol,X=d.parent;(d=X?.property?.[d.name.toUpperCase()])?h=hn(d,te[X.uri]??e,X):h=[]}else h=[t.symbol],t.symbol.uri??=e.uri;else switch(t.type){case"TK_FUNC":{let d=!!t.data,X=t.content.toLowerCase()||(d?"call":"__item");h=_i(e,h,X,d,t.paraminfo,C);break}case"TK_WORD":{let d=e.document.positionAt(t.offset),X=bi(e,t.content,T.SymbolKind.Variable,d);if(!X)break;h=new Set;let _=X.node;if(_.kind===T.SymbolKind.Variable){X.uri!==e.uri&&(d.line=NaN);for(let Se of oy(_,te[X.uri]??e,d,X.scope,r))h.add(Se)}else if(h.add(_),X.is_this!==void 0){C=r??_;continue}break}case"TK_NUMBER":/^[-+]?(\d+$|0[xX])/.test(t.content)?h=[_a]:/^[-+]?\d+[.eE]/.test(t.content)?h=[ma]:h=[si];break;case"TK_STRING":h=[Zn];break;case"TK_START_BLOCK":if(!(c=t.data))break;if(h=[c],c.uri??=e.uri,m=!c.extends&&c.property?.BASE){let d=hn(m,e,r);if(d.length<2)c.base=d[0];else{h=[];for(let X of d)h.push({...c,base:X})}}break;case"TK_START_EXPR":{let d=(c=t.paraminfo?.comma)?.length?c.at(-1):t.next_token_offset;h=ti(e,a[d],t.next_pair_pos-1,r);break}default:if(t.content==="||")for(let d of h)y.add(d);h=[];break}C=void 0}for(let d of h)y.add(d);return[...y];function F(d){let X=p.pop(),_={content:"",type:"TK_NUMBER"},Se=i.splice(X??0);if(X===void 0||!Se.length)return!(i.length=0);switch(d.op_type??(d.type==="TK_EQUALS"&&0)){case-1:if(d.content==="&"&&Se[0]?.offset&&Se[0].type==="TK_WORD")if(Se.length===1)_={symbol:ci};else{let je=Se.at(-1);if(je.type!=="TK_FUNC"||je.data)return!(i.length=0);p.push(i.length),je.content="__ref",je.data=!0,i.push(...Se);return}case 1:break;case 0:{let je=i.splice((X=p.pop())??0),Pe;if(X===void 0||!je.length)return!(i.length=0);if(d.content.startsWith("."))_.type="TK_STRING";else if(d.content===":="){p.push(i.length),i.push(...Se);return}else if(["&&","and"].includes(Pe=d.content.toLowerCase())){p.push(i.length),i.push(_),i.push({type:"TK_OPERATOR",content:"||",op_type:0}),i.push(...Se);return}else if(["||","or","??","??=",":"].includes(Pe)){p.push(i.length),i.push(...je),i.push({type:"TK_OPERATOR",content:"||",op_type:0}),i.push(...Se);return}break}default:return!(i.length=0)}p.push(i.length),i.push(_)}function ne(d){let X=b(d,!1),_=s.length?b(s[s.length-1]):-1;for(;X<=_;){if(F(s.pop()))return!0;_=s.length?b(s[s.length-1]):-1}d.content==="?"?d.ignore||i.splice(p[p.length-1]??0):(s.push(d),!d.op_type&&p.push(i.length)),u=d}function R(){if(ai(u))return ne(u={content:".",type:"TK_OPERATOR",op_type:0})}function g(){let d=t;i.splice(p[p.length-1]),i.push({symbol:Bt});do{for(;t;)if(t.type==="TK_WORD"){if(d=t,t=a[t.next_token_offset],!t||t.content!=="%"||t.prefix_is_whitespace)break}else if(t.content==="%"&&t.previous_pair_pos===void 0){if(d=a[t.next_pair_pos],t=a[d?.next_token_offset],!t||t.type!=="TK_WORD"||t.prefix_is_whitespace)break}else break;if(t&&(t.content==="["||t.content==="("&&!t.prefix_is_whitespace)){if(d=t,t=a[t.next_pair_pos],!t)break;d=t,t=a[t.next_token_offset]}if(t?.type==="TK_DOT"&&t.offset<f)d=t,t=a[t.next_token_offset];else break}while(t);u=t=d}function b(d,X=!0){if(d.type==="TK_OPERATOR")switch(d.content.toLowerCase()){case"++":case"--":return d.op_type===-1?77:82;case"||":case"or":return 17;case"&&":case"and":return 21;case"is":return 28;case">":case"<":case">=":case"<=":return 34;case"=":case"==":case"!=":case"!==":return 30;case"~=":return 36;case".":return 38;case"|":return 42;case"^":return 46;case"&":return d.op_type===-1?67:50;case"<<":case">>":case"<<<":return 54;case"//":return 62;case"+":case"-":return d.op_type===-1?67:58;case"*":case"/":return 62;case"**":return 73;case"not":return 25;case"!":return 67;case"?":return d.ignore?85:11;case":":return 11;default:return 0}return d.type==="TK_DOT"?86:d.type==="TK_EQUALS"?X?7:99:d.type==="TK_COMMA"?6:0}}function _i(e,t,n,r,i,s){let a=new Set,p=s;for(let f of t){let c=f;switch(p=s??c,f.kind){case 0:return[Bt];case T.SymbolKind.Class:if(r&&n==="call"){if(!(f=tn(e,c,n,r))){if(f=u(c))break;continue}if((f.full??"").startsWith("(ComObject)")){let y=e.tokens,h=[],C=y[y[i?.offset]?.next_token_offset];C?.type==="TK_STRING"&&(h.push(C.content),(C=y[C.next_token_offset])?.content===","&&(C=y[C.next_token_offset],C?.type==="TK_STRING"&&(h.push(C.content),C=y[C.next_token_offset])),C?.content===")"&&a.add({kind:T.SymbolKind.Interface,name:"ComObject",full:`ComObject<${h.join(", ")}>`,generic_types:[h],range:en,selectionRange:en}));continue}break}case T.SymbolKind.Function:case T.SymbolKind.Method:if(r&&n==="call"){if(!f.has_this_param||(p=void 0,!i))break;for(let m of ti(e,e.find_token(i.offset+1),i.comma[0]??i.end,s))for(let y of hn(f,te[f.uri]??e,m))a.add(y);continue}default:if(!(f=tn(e,c,n,r))){if(f=u(c))break;continue}if(f.kind!==T.SymbolKind.Property){if(f.eval){let m=hn(f,te[f.uri]??e,p);for(let y of r?_i(e,m,"call",!0):m)a.add(y);continue}else if(r)break;if(!i)a.add(f);else for(let m of _i(e,[f],"__item",!1,i,p))a.add(m);continue}else if(f.eval){let m=_i(e,hn(f,te[f.uri]??e,p),"call",!0);for(let y of r?_i(e,m,"call",!0):m)a.add(y);continue}else if(r||i&&!f.get?.params.length){for(let m of _i(e,hn(f,te[f.uri]??e,p),r?"call":"__item",r,i))a.add(m);continue}break}for(let m of hn(f,te[f.uri]??e,p))a.add(m)}return a;function u(f){let c=tn(e,f,r?"__call":"__get",r);if(!c)return;if(c.kind===T.SymbolKind.Method&&!c.eval)return c;let m=c.kind===T.SymbolKind.Class?[c]:c.children?void 0:hn(c,te[c.uri]??e,p);if(m?.length)for(let y of _i(e,m,"call",!0,i))a.add(y)}}function ry(e,t,n,r){let i=Lo(t,e.selectionRange.start);if(!i||i.index<0)return[];let{pos:s,index:a,kind:p}=i,u=t.getContext(s),f=ti(t,u.token,u.range.end,r),c=!0;if(f.includes(Bt))return[Bt];if(!f.length)return[];let m=u.text?"":u.word.toLowerCase();p===T.SymbolKind.Property?(m||="__item",c=!1):m||="call";for(let h of f)if(y(h,m,n))return[Bt];return n=[...new Set(n)],n.includes(Bt)?[Bt]:n;function y(h,C,F,ne=0){switch(h.kind){case T.SymbolKind.Method:ne++;case T.SymbolKind.Function:if(!c||C!=="call")break;case T.SymbolKind.Property:{let R=h.params?.[a+ne],g;if(!R||!(g=R.type_annotations))break;for(let b of g){if(b===ci)return!0;b.data===ci&&F.push(...ha(b.generic_types?.[0]??[],t,r,$g(t,r)?.type_params))}break}case T.SymbolKind.Class:{let R=tn(t,h,C,c),g=h;if(!R)break;if(c){if(R.kind===T.SymbolKind.Class)R=dr(R);else if(R.full?.startsWith("(Object) static Call("))R=tn(t,g.prototype,"__new",!0)??R;else if(R.kind===T.SymbolKind.Property||R.eval){let b=hn(R,te[R.uri]??t,g);R.kind===T.SymbolKind.Property&&R.eval&&(b=_i(t,b,"call",!0)),b.forEach(d=>y(d,"call",F,-1));return}R?.kind===T.SymbolKind.Method&&y(R,"call",F,-1);return}else if(R.kind===T.SymbolKind.Class)R=tn(t,R,"__item",!1);else{if(R.kind!==T.SymbolKind.Property)return;if(!R.params){for(let b of hn(R,te[R.uri]??t,g))(b=tn(t,b,"__item",!1))&&y(b,"",F);return}}R&&y(R,"",F)}}}}function $g(e,t){if(!t||t.children)return t;let n=bi(e,t.full.replace(/<.+/,""))?.node;if(n?.prototype)return n}function oy(e,t,n,r,i){let s=e.name.toUpperCase(),a=e,p=e.type_annotations?[e]:[];if(!r)for(let m in t?.relevance){let y=te[m]?.declaration?.[s];y?.type_annotations&&(p.includes(y)||p.push(y))}let u,f;for(let m of p){if((f=m.returns)&&(m.returns=void 0),u=hn(m,t,i),f&&(m.returns=f),m.is_param&&m.pass_by_ref){let y=new Set;for(let h of u){if(h===ci)return[Bt];h.data===ci?ka(h.generic_types?.[1]??[Bt],y,t,i):y.add(h)}u=[...y]}if(u.includes(Bt)&&(u=[Bt])||!u.includes(Yn))return u;break}u??=[],f=void 0;for(let m of(r??t).children??[])if(s===m.name.toUpperCase())if(m.kind===T.SymbolKind.Variable){if(m.range.end.line>n.line||m.range.end.line===n.line&&m.range.end.character>n.character)break;(m.pass_by_ref||m.returns&&(m.for_index===void 0||Fg(m,f??=t.document.offsetAt(n))))&&(e=m)}else return[m];if(e.for_index!==void 0){let y=function(h,C=!0){let F=0,ne;switch(h.kind){case T.SymbolKind.Class:{let R=[];if(C&&(f=tn(t,h,"__enum",!0,R))){if(f.kind!==T.SymbolKind.Method)break;for(let g of hn(f,te[f.uri]??t,h))y(g,!1);break}else if((f=tn(t,h,"call",!0,R))?.kind===T.SymbolKind.Method)F=-1,ne=h,h=f;else break}case T.SymbolKind.Method:F++;case T.SymbolKind.Function:{let R=h.params?.[e.for_index+F],g;if(!R||!(g=R.type_annotations))break;for(let b of g){if(b===ci)return!0;b.data===ci&&u.push(...ha(b.generic_types?.[0]??[],t,ne,$g(t,ne)?.type_params))}break}}};var c=y;if(e===a&&!Fg(e,f??=t.document.offsetAt(n)))return[];let m=hn(e,t,i);for(let h of m)if(y(h))return[Bt];return u=[...new Set(u)],u.includes(Bt)?[Bt]:u}return e.pass_by_ref&&!e.is_param?ry(e,t,u,i):(u.push(...hn(e,t,i)),u=[...new Set(u)],u.includes(Bt)?[Bt]:u)}function Fg(e,t){let n=e.data;return n[0]<=t&&t<n[1]}function ha(e,t,n,r){let i=new Set,s;for(let p of e){if(typeof p=="object"){i.add(p);continue}(s=p.startsWith("typeof "))&&(p=p.substring(7)),`'"`.includes(p[0])?i.add(Zn):/^[-+]?(\d+$|0[xX])/.test(p)?i.add(_a):/^[-+]?\d+[.eE]/.test(p)?i.add(ma):i.add(`${s?"typeof ":""}${p}`)}let a=new Set;return ka([...i],a,t,n,r),[...a]}function ka(e,t,n,r,i){let s,a=-1,p,u,f,c,m;for(let h of e)a++,typeof h=="string"?((u=h.startsWith("typeof "))&&(h=h.substring(7)),(c=i?.[h.toUpperCase()])?ka(r.generic_types?.[c.data]??(c.type_annotations||[]),t,n,r,i):(f=(p=h==="this")&&r||bi(n,h)?.node)&&(f.kind===T.SymbolKind.TypeParameter?(m=!0,e[a]="",e.push(...ha(f.type_annotations||[],n))):f.kind!==T.SymbolKind.Variable&&(t.add(f=!u&&f.prototype||f),!p&&(e[a]=f)))):h.kind===T.SymbolKind.TypeParameter?(m=!0,e[a]="",e.push(...ha(h.type_annotations||[],n))):t.add(i?y(h):h);m&&e.push(...new Set(e.splice(0).filter(Boolean)));function y(h){let C=h.generic_types;return!C||(s??=new RegExp(`[< ](${Object.keys(i).join("|")})[,>]`,"i"),!s.test(h.full))?h:(C=C.map(F=>F.flatMap(ne=>typeof ne=="object"?[y(ne)]:(c=i[ne.toUpperCase()])?r.generic_types?.[c.data]??(c.type_annotations||[]):[ne])),C.length||(C=void 0),{...h,generic_types:C,full:h.full.replace(/<.+/,C?`<${C.map(F=>Wn(F)).join(", ")}>`:"")})}}function hn(e,t,n){let r,i,s,a;switch(!e.cached_types){case!0:{let u=e.type_annotations;if(!u)break;r=new Set;for(let f of u){if(typeof f=="object"){r.add(f);continue}(s=f.startsWith("typeof "))&&(f=f.substring(7)),`'"`.includes(f[0])?r.add(Zn):/^[-+]?(\d+$|0[xX])/.test(f)?r.add(_a):/^[-+]?\d+[.eE]/.test(f)?r.add(ma):r.add(`${s?"typeof ":""}${f}`)}if(r.has(Bt))return e.cached_types=[Bt];e.cached_types=[...r],a=r.has(Yn)}default:if(ka(i=e.cached_types,r=new Set,t,n,n&&e.parent?.type_params),!a)return[...r]}let p;if(t&&e.returns){e.cached_types=[Bt],p=[];for(let u=0,f=e.returns,c=f.length;u<c;u+=2)p.push(...ti(t,t.find_token(f[u],!0),f[u+1],n));if(r){for(let u of new Set(p))u.property&&!u.name&&!r.has(u)&&(r.add(u),i.push(u));p=[...r],e.cached_types=i}else r=new Set(p),e.cached_types=p=[...r]}else p=r?[...r]:[];return p}function $u(e){let t;switch(e.kind){case T.SymbolKind.Interface:return e.full;case T.SymbolKind.Class:return t=e,t.prototype?`typeof ${t.full}`:t.full||"Object";case T.SymbolKind.Function:{if(e.name){let r=e,i=[e],s=[e.name];for(;r.parent?.params;)i.push(r=r.parent),s.push(r.name);if(!s.includes("")&&r.kind!==T.SymbolKind.Property)return r.kind!==T.SymbolKind.Function&&s.splice(-1,1,$u(r)),s.reverse().join("~")}let n=e;return t=n.full.replace(/^[^()]+/,""),t.length===n.param_def_len&&(n.params.some(r=>r.range_offset)&&(t=`(${n.params.map(r=>`${r.pass_by_ref?"&":""}${r.name}${r.defaultVal===null||r.range_offset?"?":r.defaultVal?` := ${r.defaultVal}`:r.arr?"*":""}`).join(", ")})`),t+=` => ${Xr(e)||"void"}`),t}case T.SymbolKind.String:case T.SymbolKind.Number:return(e.data??e.name).toString();case 0:return"Any";case T.SymbolKind.Null:return"unset";case T.SymbolKind.Method:case T.SymbolKind.Property:if(t=e.full?.match(/^\((.+?)\)/)?.[1])return`${t}${e.static?".":"#"}${e.name}`;default:return"unknown"}}function Xr(e,t,n){return Wn(e.type_annotations||hn(e,te[e.uri]??t,n))}function Wn(e){if(!e)return"";let t=[...new Set(e.map(r=>typeof r=="string"?r:$u(r)))],n=t.pop();return n?((t=t.map(r=>r.includes("=>")&&!`"'`.includes(r[0])?`(${r})`:r)).push(n),t.join(" | ")):""}function or(e){if(e){let t=new ei(An.create("","ahk2",0,`$:${e}`),void 0,-1);return t.parseScript(),t.declaration.$?.type_annotations??!1}return!1}var sy=[T.SymbolKind.Variable,T.SymbolKind.Function,T.SymbolKind.Field];function bi(e,t,n,r){let i=t.toUpperCase().split(/[.#~]/),s=i.length-1,a=i.shift(),p=!0,u,f,c=e.findSymbol(a,n,!s&&sy.includes(n)?r:void 0);if(c===null)return;let m=c?.scope;if(!c||c.is_global===1?c=ne(e.relevance,a)??c:c.is_global&&c.node.kind===T.SymbolKind.Variable&&(f=ne(e.relevance,a),f&&(f.node.kind!==T.SymbolKind.Variable||f.node.def&&!c.node.def)&&(c=f)),n===T.SymbolKind.Field)return c;if((!c||c.node.kind===T.SymbolKind.Variable&&((p=!c.node.def)||c.is_global))&&(f=F(a))?c={uri:f.uri,node:f,is_global:!0}:m&&(m.uri??=e.uri,c.scope=m),!c)return;let y=a.length,h,C=c.node;C.uri??=c.uri;for(a of i){switch(t[y]){default:return;case"#":if(!(C=C.prototype))return;case".":if(!(C=jg(e,C,a)))return;break;case"~":if(!(C=(h=C).declaration?.[a]))return;C.uri??=h.uri}y+=a.length+1}return s&&(n===T.SymbolKind.Method&&(f=C.call)&&(f.uri??=C.uri,C=f),c={node:C,uri:C.uri,parent:h}),c;function F(R){if(f=qt[R])return f;for(let g of[Ht.ahk2_h,Ht.ahk2])if(f=te[g]?.typedef[R])return f.uri??=g,f;if(p&&!s&&(f=te[u=Ht.winapi]?.declaration[R]))return f.uri??=u,f}function ne(R,g){let b,d;for(let X in R)if(d=(te[X]??Vg(Gi(R[X]),!1))?.findSymbol(g,n)){if(d.node.kind!==T.SymbolKind.Variable)return d;(!b||d.node.def&&!b.node.def)&&(b=d)}return b}}function Ei(e,t){let{text:n,word:r,range:i,kind:s}=t,a;if(n)return(a=bi(e,n,s,i.end))&&[a];let p=[],u=s===T.SymbolKind.Method,f=ti(e,t.token,i.end);if(!r&&f.length){for(let c of f)p.push({node:c,uri:c.uri});return p}for(let c of f)(a=tn(e,c,r,u))&&p.push({node:a,uri:a.uri,parent:c});if(p.length)return p}function Lo(e,t,n){let r,i,s,a,p=e.tokens,u=e.document.offsetAt(t);function f(y){let h=p[y.offset];if(r=e.document.positionAt(y.offset),h.type==="TK_WORD"){if(a&&t.line>e.document.positionAt(a.offset+a.length).line&&!Zt(a,Qe))return;i=u>y.offset+h.content.length?0:-1}else{let C=h.previous_token??Qe;if(C.symbol||C.ignore)return null;if(i=0,h.content==="["){if(h.topofline===1||!ai(h.previous_token))return;s=T.SymbolKind.Property}else if(h.prefix_is_whitespace||!ai(C))return}if(i!==-1)for(let C of y.comma)if(u>C)++i;else break;return s??=y.method?T.SymbolKind.Method:T.SymbolKind.Function,{name:y.name??"",pos:r,index:i,kind:s,count:y.count}}if(n)return f(n);let c=e.find_token(u),m=a=c.previous_token;if(!(u<=c.offset&&!(c=m))){if(c.callsite&&u>c.offset+c.length&&t.line<=c.callsite.range.end.line)return f(c.paraminfo);if(!(c.topofline>0))for(;c.topofline<=0;){switch(c.type){case"TK_END_BLOCK":c=p[c.previous_pair_pos];break;case"TK_END_EXPR":c=p[(m=c).previous_pair_pos],c=c?.previous_token;break;case"TK_START_EXPR":case"TK_COMMA":if(m=c,c.paraminfo)return f(c.paraminfo);break;case"TK_OPERATOR":c.content==="%"&&!c.next_pair_pos&&(c=p[c.previous_pair_pos]);default:break}if(!(c=c?.previous_token))break;if(c.callsite&&c.paraminfo)return f(c.paraminfo)}}}var xi={},ar={};function Ao(){xi={},ar={};for(let e of Object.values(te))No(e)}function No(e,t){let{uri:n,include:r}=e,i=!0,s=xi[n]??=(i=!1,{[n]:e.fsPath});t=(t??=ar[n])?{...t}:{},e.is_virtual||(t[n]=e.fsPath);for(let a in r)if(Object.assign(ar[a]??={},t),!!(e=te[a]))if(s[a])t[a]||No(e,t);else{if(i&&t[a])continue;let p=No(e,t);p[n]?s=xi[n]=Object.assign(p,s):Object.assign(s,p)}return s}function pr(e,t,n){let r=e.markdown_detail;return r===void 0?e.detail??"":(n&&(r=r.replace(n,"")),r=r.replace(/\{@link(code|plain)?\b([^{}\n]*)\}/gm,(...i)=>{let s=i[2]?.trim()??"",a="",p,u=s.search(/[|\s]/);if(u!==-1&&(a=s.substring(u+1).trim(),s=s.slice(0,u).trim()),t&&(p=s.match(/^(([\w.$#~]|[^\x00-\x7f])+)(\(\))?$/)?.[1])){let f=bi(t,p,p.includes(".")?s.endsWith(")")?T.SymbolKind.Method:T.SymbolKind.Property:s.endsWith(")")?T.SymbolKind.Function:T.SymbolKind.Class);if(f&&(t=te[f.uri])){let{start:{line:c,character:m}}=f.node.selectionRange,y=encodeURIComponent(JSON.stringify([En.parse(t.document.uri).toJSON(),[-1,{selection:{startLineNumber:c+1,startColumn:m+1}}]]));a||=s,s=`command:_workbench.open?${y}`}}return/^[a-z]+:/.test(s)&&(a||=s)?`[${i[1]==="code"?`\`${a}\``:a}](${s})`:` ${s} ${a} `}),r?{kind:"markdown",value:r}:"")}function Br(e,t){if(e.kind===t.kind)return e.kind===T.SymbolKind.Class?B.conflictserr("class","Class",e.name):e.kind===T.SymbolKind.Function?B.conflictserr("function","Func",e.name):B.dupdeclaration();switch(t.kind){case T.SymbolKind.Variable:return B.assignerr(e.kind===T.SymbolKind.Function?"Func":"Class",e.name);case T.SymbolKind.Function:return e.kind===T.SymbolKind.Variable?B.assignerr("Func",e.name):B.conflictserr("function","Class",e.name);case T.SymbolKind.Class:return e.kind===T.SymbolKind.Function?B.conflictserr("class","Func",e.name):e.kind===T.SymbolKind.Property||e.kind===T.SymbolKind.Method?B.dupdeclaration():B.assignerr("Class",e.name);case T.SymbolKind.Property:case T.SymbolKind.Method:return B.dupdeclaration()}return""}function Gr(e,t,n){let{children:r,diagnostics:i,uri:s,relevance:a}=n,p=T.DiagnosticSeverity.Error,u="",f,c;for(let m of t){if(!m.name||!m.selectionRange.end.character)continue;let y;switch((f=m).kind){case T.SymbolKind.Variable:f.assigned||=!!f.returns,y=!0;case T.SymbolKind.Class:case T.SymbolKind.Function:case T.SymbolKind.Module:if(c=e[u=m.name.toUpperCase()],u.substring(0,2)==="A_"&&qt[u]){if(y)continue;m.params&&(m.has_warned??=i.push({message:B.conflictserr("function","built-in variable",m.name),range:m.selectionRange}))}if(t===r)m.uri=s;else if(c&&!a[c.uri]){e[u]=m;continue}if(!c)e[u]=m;else if(c.is_global){if(y){if(f.def&&c.kind!==T.SymbolKind.Variable){f.assigned!==1&&(m.has_warned??=i.push({message:B.assignerr(c.kind===T.SymbolKind.Function?"Func":"Class",m.name),range:m.selectionRange,severity:p}));continue}}else if(c.kind===T.SymbolKind.Function){m.has_warned??=i.push({message:Br(c,m),range:m.selectionRange,severity:p});continue}else c.def&&c.assigned!==1&&(c.has_warned??=i.push({message:B.assignerr(m.kind===T.SymbolKind.Function?"Func":"Class",m.name),range:c.selectionRange,severity:p}));e[u]=m}else y?c.kind===T.SymbolKind.Variable?f.def&&!c.def?e[u]=m:c.assigned||=f.assigned:f.def&&(delete f.def,f.assigned!==1&&(m.has_warned??=i.push({message:Br(c,m),range:m.selectionRange,severity:p}))):c.kind===T.SymbolKind.Variable?(c.def&&(delete c.def,c.assigned!==1&&(c.has_warned??=i.push({message:Br(m,c),range:c.selectionRange,severity:p}))),e[u]=m):c.def!==!1?m.has_warned??=i.push({message:Br(c,m),range:m.selectionRange,severity:p}):f.def!==!1&&(e[u]=m);break}}}function Zt(e,t,n){switch(e.type){case"":case"TK_COMMA":case"TK_EQUALS":case"TK_START_EXPR":return!0;case"TK_OPERATOR":if(e.ignore)return!1;if(!/^(%|\+\+|--)$/.test(e.content))return!0;default:switch(t.type){case"TK_DOT":case"TK_COMMA":case"TK_EQUALS":return!0;case"TK_OPERATOR":return!/^(!|~|not|%|\+\+|--)$/i.test(t.content)&&(!n?.has_this_param||!Rt.test(t.content)||n.returns?.[1]!==0||n.kind===T.SymbolKind.Function);case"TK_STRING":if(t.ignore)return!0;default:return!1}}}function Wg(e){let t=Eo;try{Eo=e?new RegExp(e,"i"):void 0}catch(n){throw Eo=t,n}}function Wu(e){if(typeof e.brace_style=="string")switch(e.brace_style){case"0":case"Allman":e.brace_style=0;break;case"1":case"One True Brace":e.brace_style=1;break;case"-1":case"One True Brace Variant":e.brace_style=-1;break;default:delete e.brace_style;break}for(let t of["array_style","object_style"]){let n=e[t];typeof n=="string"&&(e[t]=sr[n])}return e}var ay=vn($n());async function Ug(e,t){let{range:n,color:r,textDocument:{uri:i}}=e,s=te[i.toLowerCase()]?.document.getText(n);if(!s||t.isCancellationRequested)return;let a=/^0x/.test(s)?"0x":"",p=s.length-(a?2:0)>6?"A":"",u=[r.red,r.green,r.blue];return p&&u.unshift(r.alpha),u=u.map(f=>`0${Math.round(f*255).toString(16)}`.slice(-2)),u=[u.join(""),u.reverse().join("")],[{label:`${p}RGB: ${u[0]}`,textEdit:{range:n,newText:`${a}${u[0]}`}},{label:`BGR${p}: ${u[1]}`,textEdit:{range:n,newText:`${a}${u[1]}`}}]}async function Bg(e,t){if(!t.isCancellationRequested)return te[e.textDocument.uri.toLowerCase()]?.getColors()}var Xi=vn($n());var Ta={};function cy(e,t,n=!1){if(Mt.commands?.includes(e))return Dn?.sendRequest(e,t);n||Dn?.window.showWarningMessage(`Command '${e}' is not implemented!`)}function Hg(){return Dn.sendRequest("getEditorLocation")}function zg(e){return e?.replace(/^[ \t]*(\*?[ \t]*(?=@)|\* ?)/gm,"").replace(/^\/\*+\s*|\s*\**\/$/g,"")??""}function Ku(e,t){return cy("setTextDocumentLanguage",[e,t])}function wa(e,t,n){let r=n?.replace(/\$/g,"\\$").split(`
`),i={},s=[],a=[],p=["/**"],u,f,c=0,m=!0;if(r?.forEach(h=>{(f=h.match(/^@(param|arg)\s+(({[^}]*}\s)?\s*(\[.*?\]|\S+).*)$/i))?(u=i[f[4].replace(/^\[?((\w|[^\x00-\x7f])+).*$/,"$1").toUpperCase()]??=[]).push("@param "+f[2].trim()):(f=h.match(/^@(returns?)([\s:]\s*(.*))?$/i))?(u=s,s.push(`@${f[1].toLowerCase()} ${f[3]}`)):u&&!h.startsWith("@")?u.push(h):(u=void 0,a.push(h))}),a.join("").trim()?a.forEach(h=>p.push(" * "+h)):(p.push(" * $0"),m=!1),t.params.forEach(h=>{if(u=i[h.name.toUpperCase()])u.forEach(C=>p.push(" * "+C));else if(h.name){let C=Xr(h,e);C?p.push(` * @param \${${++c}:{${C}\\}} ${h.name} $${++c}`):p.push(` * @param ${h.name} $${++c}`)}}),s.length)s.forEach(h=>p.push(" * "+h));else{let h=Xr(t,e);h&&p.push(` * @returns \${${++c}:{${h}\\}} $${++c}`)}p.push(" */");let y=p.join(`
`);return m&&(y=y.replace(new RegExp(`\\$${c}\\b`),"$0")),y}async function ly(){let{uri:e,position:t}=await Hg(),n=te[e.toLowerCase()],r=n.searchScopedNode(t),i=r?.children||n.children;for(let f of i)if((f.kind===Xi.SymbolKind.Function||f.kind===Xi.SymbolKind.Method)&&f.selectionRange.start.line===t.line&&f.selectionRange.start.character<=t.character&&t.character<=f.selectionRange.end.character){r=f;break}if(!r||!r.params)return;let s,a=r.selectionRange.start,p,u;if(r.markdown_detail===void 0)s=`${wa(n,r)}
`,p=n.tokens[n.document.offsetAt(a)],p.topofline===2&&(p=p.previous_token),a=n.document.positionAt(p.offset),u={start:a,end:a};else{if(p=n.find_token(n.document.offsetAt({line:a.line-1,character:0})),p.type!=="TK_BLOCK_COMMENT")return;s=wa(n,r,zg(r.detail)),u={start:n.document.positionAt(p.offset),end:n.document.positionAt(p.offset+p.length)}}Dn.sendRequest("insertSnippet",[s,u])}function Gg(e){let t=te[e.toLowerCase()],n={},r={};if(!t)return;Ao();for(let s of[t.uri,...Object.keys(t.relevance)]){if(!(t=te[s]))continue;let a;a=Object.entries(t.include).map(p=>te[p[0]]?.fsPath??Gi(p[1])),!a.length&&(a=void 0),i(Object.values(t.declaration),r[t.fsPath||t.document.uri]={includes:a},t)}return r;function i(s,a,p,u){let f,c,m,y;for(let R of s)if(R.selectionRange.end.character)switch(f=R.kind){case Xi.SymbolKind.Class:m=R,(a.classes??=[]).push(y={name:R.name,label:m.full,extends:C(m),detail:F(R)}),i(Object.values(m.property??{}),y,p,m),i(Object.values(m.$property??{}),y,p,m.prototype);break;case Xi.SymbolKind.Property:if(c=R,(a.properties??=[]).push({name:R.name,label:c.full,static:c.static??!1,variadic:c.variadic??!1,params:ne(c.params),readonly:c.params&&!R.set||!1,type:Xr(c,p,u),detail:F(R)}),!(R=R.call))break;case Xi.SymbolKind.Function:case Xi.SymbolKind.Method:c=R,(a[f===Xi.SymbolKind.Function?"functions":"methods"]??=[]).push({name:R.name,label:c.full,static:c.static??!1,variadic:c.variadic??!1,params:ne(c.params),returns:Xr(c,p,u),detail:F(R)});break}function h(R){switch(R.defaultVal){case!1:return null;case null:return"unset";default:return R.defaultVal}}function C(R){let g;if(g=R.extends)return n[`${R.extendsuri},${g}`]??=Si(t,g,R.extendsuri)?.full||g}function F(R){return R.markdown_detail?zg(R.detail):R.detail??""}function ne(R){return R?.map(g=>({name:g.name,defval:h(g),byref:g.pass_by_ref??!1,variadic:g.arr??!1,type:Wn(g.type_annotations)}))}}}async function uy(){let{uri:e}=await Hg(),t=te[e.toLowerCase()];if(t){Ao();for(let n in t.relevance)(n=te[n]?.document.uri)&&Ko({textDocument:{uri:n}});Ko({textDocument:{uri:e}})}}function Xg(e){let t=te[e.toLowerCase()];if(!t)return;let n=t.document,r=t.tokens,i={line:0,character:0},s=t.get_token(0);for(;s.type==="TK_SHARP";)i.line=n.positionAt(s.offset).line+1,s=t.get_token(n.offsetAt(i));let a=[];(!s.type||s.type.endsWith("COMMENT"))&&/^\s*[;*]?\s*@(date|version)\b/im.test(s.content)&&a.push({uri:e,content:s.content,single:!1,range:{start:n.positionAt(s.offset),end:n.positionAt(s.offset+s.length)}});for(let p of t.tokenranges)p.type===1&&(s=r[p.start])?.topofline&&/^;\s*@ahk2exe-set(file|product)?version\b/i.test(s.content)&&a.push({uri:e,content:s.content,single:!0,range:{start:n.positionAt(p.start),end:n.positionAt(p.end)}});return a}function Qg(e){return e?.length?(e.includes("getEditorLocation")&&(Ta["ahk2.diagnose.all"]=uy,e.includes("insertSnippet")&&(Ta["ahk2.generate.comment"]=ly)),Object.keys(Ta)):[]}function Jg(e,t){if(!t?.isCancellationRequested)return Ta[e.command](...e.arguments??[])}var gr=vn(ca()),be=vn($n());async function Yg(e,t){let{position:n,textDocument:{uri:r}}=e,i=te[r=r.toLowerCase()],s={};if(!i||t.isCancellationRequested)return;let a=[],p=a.pop(),u,f,c,m,y,{triggerKind:h,triggerCharacter:C}=e.context??{},F=I=>I;if(C==="*"){let I=i.tokens[i.document.offsetAt(n)-3];if(I?.type==="TK_BLOCK_COMMENT"){!I.previous_token?.type&&I===i.get_token(0,!1)&&a.push({label:"/** */",detail:"File Doc",kind:be.CompletionItemKind.Text,insertTextFormat:be.InsertTextFormat.Snippet,textEdit:be.TextEdit.replace({start:i.document.positionAt(I.offset),end:i.document.positionAt(I.offset+I.length)},["/************************************************************************"," * @description ${1:}"," * @author ${2:}"," * @date ${3:$CURRENT_YEAR/$CURRENT_MONTH/$CURRENT_DATE}"," * @version ${4:0.0.0}"," ***********************************************************************/","$0"].join(`
`))});let z=It(I);if(z){let Oe=z;a=[{label:"/** */",detail:"JSDoc Comment",kind:be.CompletionItemKind.Snippet,insertTextFormat:be.InsertTextFormat.Snippet,textEdit:be.TextEdit.replace({start:i.document.positionAt(I.offset),end:i.document.positionAt(I.offset+I.length)},`/**
 * $0
 */`)}],Oe.params&&(a[0].textEdit.newText=wa(i,Oe))}}return a}if(C==="@"){let I=i.findStrOrComment(i.document.offsetAt(n)-1);if(I?.type.endsWith("COMMENT")){let z=i.document.positionAt(I.offset).line===n.line,Oe=I.type==="TK_BLOCK_COMMENT"?"/*":";";return zt.directive["@"].filter(Ae=>Oe.includes(u=Ae.data)&&(z||u!=="/"))}return}let ne=Object.fromEntries(Object.entries(Mt.CompletionCommitCharacters??{}).map(I=>(I[1]=(I[1]||void 0)?.split(""),I))),{text:R,word:g,token:b,range:d,linetext:X,kind:_,symbol:Se}=i.getContext(n,!0),je=i.relevance,{line:Pe,character:Be}=n,ie=!1,P=Yr(g),j;switch(b.type){case"TK_UNKNOWN":if(b.content===".")break;if(b.content!=="#")return;case"TK_SHARP":return b.topofline===1?zt.directive["#"]:[];case"TK_HOT":case"TK_HOTLINE":{if(!b.ignore)return zt.key.filter(z=>!z.label.toLowerCase().includes("alttab"));let I=i.document.offsetAt(n)-b.offset;return 0<I&&I<=R.indexOf(":",1)?zt.option.hotstring:void 0}case"":case"TK_EOF":if((c=b.previous_token)?.type==="TK_SHARP"){let I=!1;switch(c.content.toLowerCase()){case"#dllload":I=!0;case"#include":case"#includeagain":{return;for(let We of Lt){try{if(!(void 0)(We=(0,gr.resolve)(We,Ae)+"\\")||!(void 0)(We).isDirectory()||s[We=We.toUpperCase()])continue;s[We]=1;for await(let Xe of await(void 0)(We)){let de=Xe.name;if(Xe.isDirectory()){if(!Ee.test(de))continue;s[`${de.toUpperCase()}/`]??=(de=de.replace(/(`|(?<= );)/g,"`$1"),nn(p={label:de,command:vt,kind:be.CompletionItemKind.Folder},de+ze),1)}else{if(!Le.test(de)||!Ee.test(st?de=de.replace(Le,""):de))continue;s[de.toUpperCase()]??=(de=de.replace(/(`|(?<= );)/g,"`$1"),Tt(p={label:de,kind:be.CompletionItemKind.File},de+fe),1)}a.push(p)}}catch{}if(Ae.includes(":"))break}}default:return}}else if(c?.type!=="TK_HOTLINE")return;if(c.ignore)return kt(),a;a.push(...zt.key),_=be.SymbolKind.Event;break;case"TK_BLOCK_COMMENT":if(!/[<{|:.,][ \t]*$/.test(X.substring(0,d.start.character)))return;if(R.includes("."))for(let I of Object.values(Si(i,R.replace(/\.[^.]*$/,""))?.property??{}))I.kind===be.SymbolKind.Class&&P.test(I.name)&&a.push(xt(I));else ye();return a;case"TK_COMMENT":case"TK_INLINE_COMMENT":return;default:{if(b.callsite||b.topofline>0)break;let I=["TK_COMMA","TK_DOT","TK_EQUALS","TK_NUMBER","TK_OPERATOR","TK_RESERVED","TK_STRING","TK_WORD"],z=b.type==="TK_STRING"?0:3,Oe=i.tokens,Ae=0,Lt,fe=(c=b).callsite,st=fe?.paraminfo;for(;(c=(Lt=Oe[c.previous_pair_pos])??c.previous_token)&&++Ae!==z;){if(Lt){if(ie=!0,c.topofline>0||(Ae++,!(c=Lt.previous_token))||c.topofline>0){c=void 0;break}continue}if(ie||=c.next_pair_pos!==void 0||I.includes(c.type),st??=c.paraminfo){c=Oe[st.offset]?.previous_token,Ae++,ie=!0;break}if((fe??=c.callsite)||c.topofline>0)break}if((fe??st)&&(st??=fe?.paraminfo,ie=!0),c?.type==="TK_RESERVED")switch(u=c.content.toLowerCase()){case"class":if(Ae===2)return[{label:"extends",kind:be.CompletionItemKind.Keyword,preselect:!0}];if(Ae===3&&b.previous_token?.content.toLowerCase()==="extends")Ae=1;else return;case"catch":if(Ae!==1)return;if(R)ye();else{let Ze=b,ze=i.document.offsetAt(d.end);for(R=b.content;(Ze=Oe[Ze.next_token_offset])&&Ze.offset<ze;R+=Ze.content);if(Rt.test(R.replaceAll(".","")))for(let Ee of Object.values(Si(i,R)?.property??{}))Ee.kind===be.SymbolKind.Class&&P.test(Ee.name)&&a.push(xt(Ee))}return a;case"break":case"continue":case"goto":{if(Ae===1&&b.type!=="TK_WORD")return;m=i.searchScopedNode(n);let Ze=(m??i).labels,ze,Ee=i.document.offsetAt(n);for(let Le in Ze)if(P.test(Le))for(let vt of Ze[Le]){if(!vt.def)break;if((ze=vt.data)===-1||ze<Ee&&(!(ze=Oe[Oe[ze].next_pair_pos]?.offset)||Ee<ze)){a.push(xt(vt));break}}if(!m){for(let Le in je)for(let vt in Ze=te[Le]?.labels)if(P.test(vt))for(let Ft of Ze[vt]){if(!Ft.def)break;if(Ft.data===-1){a.push(xt(Ft));break}}}if(Ae===1||Ae===2&&!z)return a;if(z)for(let Le of a)Le.insertText=`'${Le.insertText}'`}}else if(!z&&!b.ignore){let Ze=new Set,ze=st&&Lo(i,n,st),Ee,Le,vt=R.substring(1).endsWith(R[0])?"":R[0],Ft=vt?Tt=>({label:Tt,kind:Ee,insertText:`${Tt}${vt}`}):Tt=>({label:Tt,kind:Ee,command:Le});if(ze){let Tt,We,Xe,de,Je,Pn=Ei(i,i.getContext(ze.pos))??[],S=Object.values(Ht),Z=[],Te=[];for(Je of Pn){if(Tt=Je.node,Te.includes(Tt))continue;switch(Te.push(Tt),de=S.includes(Tt.uri),Xe=ze.index,We=Tt.name.toLowerCase(),Ee=be.CompletionItemKind.Value,Le={title:"cursorRight",command:"cursorRight"},de&&(Je.kind??ze.kind)){case be.SymbolKind.Method:switch(We){case"deleteprop":case"getmethod":case"getownpropdesc":case"hasownprop":case"hasmethod":case"hasprop":{if(Xe!==0||!Je.parent)continue;let ke=We.endsWith("method")?Ie=>Ie!==be.SymbolKind.Method:void 0;for(let Ie of Object.values(fr(i,Je.parent,Z)))P.test(Ie.name)&&!ke?.(Ie.kind)&&we(Ie.name,Ie.kind===be.SymbolKind.Method?be.CompletionItemKind.Method:be.CompletionItemKind.Property);continue}case"bind":case"call":if(Te.pop(),!Je.parent||![be.SymbolKind.Function,We==="call"&&be.SymbolKind.Class].includes(Je.parent.kind))break;{let ke=Je.parent;Pn.push({node:ke,uri:ke.uri,kind:ke.kind});continue}}break;case be.SymbolKind.Function:switch(We){case"dynacall":if(Xe!==0)continue;case"dllcall":if(Xe===0){await fn();continue}Xe++;case"comcall":if(Xe>1&&Xe%2===0)for(let ke of["cdecl"].concat(Su))we(ke,be.CompletionItemKind.TypeParameter)&&(p.commitCharacters=["*"]);continue;case"comobject":Xe===0&&a.push(...(await Vu("GetProgID",[]))?.filter(ke=>P.test(ke)).map(Ft)??[]);continue;case"numget":if(Xe===2||Xe===1)Xe=0;else continue;case"numput":if(Xe%2===0)for(let ke of Su.filter(Ie=>!/str$/i.test(Ie)))we(ke,be.CompletionItemKind.TypeParameter);continue;case"hotkey":Xe<2&&a.push(...zt.key.filter(ke=>P.test(ke.label)));continue;case"objbindmethod":case"hasmethod":case"objhasownprop":case"hasprop":if(Xe===1){let ke=st?.comma[0];if(!ke)continue;let Ie=We.endsWith("method")?dt=>dt!==be.SymbolKind.Method:void 0;for(let dt of ti(i,i.find_token(st.offset+1,!0),ke))for(let Ct of Object.values(fr(i,dt,Z)))P.test(Ct.name)&&!Ie?.(Ct.kind)&&we(Ct.name,Ct.kind===be.SymbolKind.Method?be.CompletionItemKind.Method:be.CompletionItemKind.Property)}continue}}Tt.kind===be.SymbolKind.Class&&(ze.kind===be.SymbolKind.Property?Tt=tn(te[Tt.uri],Tt,"__item",!1):Tt=dr(Tt));let $e=Tt?.params?.[Xe];if($e){if(de){if($e.name==="Keys"){Ee=be.CompletionItemKind.Text,Le=void 0,We.includes("send")&&a.push(Ft("Blind")),a.push(...zt.key.filter(ke=>P.test(ke.label)));continue}if($e.name==="WinTitle"){a.push(...zt.option.ahk_criteria.filter(ke=>P.test(ke.label)));continue}}await nn($e.type_annotations||[])}}}if(!a.length&&(c=b.previous_token)?.content===":="&&(c=c?.previous_token)?.type==="TK_WORD"){let Tt=Ei(i,i.getContext(i.document.positionAt(c.offset)))??[];Ee=be.CompletionItemKind.Value,Le={title:"cursorRight",command:"cursorRight"};for(let We of Tt)await nn(We.node.type_annotations||[])}return!a.length&&kt(),a;async function nn(Tt){let We;for(let Xe of Tt)if(!Ze.has(Xe))switch(Ze.add(Xe),Xe){case ju:await Et(!0);break;case qu:await fn();break;case ba:await Et();break;case Zn:Ee=be.CompletionItemKind.Text,Le=void 0;break;default:if(typeof Xe=="string"){/['"]/.test(Xe[0])?Xe.endsWith(Xe[0])&&P.test(Xe=Xe.slice(1,-1))&&a.push(Ft(Xe)):(We=bi(i,Xe)?.node)?.type_annotations&&!Ze.has(We)&&We.kind===be.SymbolKind.TypeParameter&&(Ze.add(We),await nn(We.type_annotations));break}Xe.data===ba&&(Xe=Xe.generic_types?.[0]?.[0]??"",typeof Xe=="string"&&/^(['"])\w+(\|\w+)*\1$/.test(Xe)&&await Et(!1,new RegExp(`[^.\\/]+$(?<!\\.(${Xe.slice(1,-1)}))`,"i")));break}}}}}let he="([".includes(X[d.end.character]||"\0"),ge=Mt.FormatOptions.brace_style===0?`
`:" ";if(Se){if(!Se.children&&(m??=i.searchScopedNode(n))?.kind===be.SymbolKind.Class){let I=m,z=["__Init()","__Call(${1:Name}, ${2:Params})","__Delete()","__Enum(${1:NumberOfVars})","__Get(${1:Key}, ${2:Params})","__Item[$1]","__New($1)","__Set(${1:Key}, ${2:Params}, ${3:Value})"];if(a.push(...zt.snippet),b.topofline===1&&a.push(zt.keyword.static??{label:"static",kind:be.CompletionItemKind.Keyword},{label:"class",insertText:["class $1",`{
	$0
}`].join(ge),kind:be.CompletionItemKind.Snippet,insertTextFormat:be.InsertTextFormat.Snippet}),i.tokens[b.next_token_offset]?.topofline===0)return b.topofline===1?(a.pop(),a):void 0;Se.static??!1?z.splice(0,1):I=I.prototype??{},b.topofline&&z.forEach(Ae=>{let Lt=Ae.replace(/[([].*$/,"");a.push({label:Lt,kind:be.CompletionItemKind.Snippet,insertTextFormat:be.InsertTextFormat.Snippet,insertText:Ae+ge+`{
	$0
}`})});for(let Ae of Object.values(fr(i,I)))we(Ae.name,Ae.kind===be.SymbolKind.Method?be.CompletionItemKind.Method:be.CompletionItemKind.Property);return a}return}if(_===be.SymbolKind.Null)return;if(_===be.SymbolKind.Property||_===be.SymbolKind.Method){if(!b.symbol&&b.semantic?.type===6)return;let I={},z=ti(i,b,d.end),Oe=0,Ae=z.includes(Bt),Lt=[],fe={};X[d.end.character]==="."&&(he="([".includes(X[d.end.character+g.length+1])),Ae?z=[]:F=Ze=>fe[Ze]??Ze;for(let Ze of z){if(Ze.kind===be.SymbolKind.Interface){let Ee=Ze.generic_types?.[0]?.map(vt=>`'"`.includes(vt[0])?vt.slice(1,-1):vt);if(!Ee?.length)continue;let Le=await Vu("GetDispMember",Ee)??{};Object.entries(Le).forEach(vt=>P.test(vt[0])&&we(vt[0],vt[1]===1?be.CompletionItemKind.Method:be.CompletionItemKind.Property));continue}let ze=fr(i,Ze,Lt);for(let Ee=Lt.length;Oe<Ee;Oe++)fe[Lt[Oe].full]=`0000${Oe}`.slice(-4);for(let[Ee,Le]of Object.entries(ze))P.test(Ee)&&((y=I[Ee])?y.detail?.endsWith(Le.full??"")||(y.detail="(...) "+(y.insertText=Le.name),y.commitCharacters=y.command=y.documentation=void 0,y.sortText=y.labelDetails=void 0):a.push(I[Ee]=xt(Le)))}if(!Ae&&(h!==1||g.length<3))return a;let st=new Set([i.object,te[Ht.ahk2]?.object,te[Ht.ahk2_h]?.object]);st.delete(void 0);for(let Ze in je)st.add(te[Ze].object);for(let Ze in y=i.object.property){let ze=y[Ze];ze.length===1&&!ze[0].full&&ot(ze[0])&&delete y[Ze]}for(let Ze of st)for(let ze of Object.values(Ze))for(let[Ee,Le]of Object.entries(ze))if(P.test(Ee)){if(y=I[Ee]){if(y.detail?.endsWith(Le[0].full??""))continue}else if(a.push(I[Ee]=y=xt(Le[0])),Le.length===1)continue;y.detail="(...) "+y.label,y.insertText?.endsWith(")")&&Le.some(vt=>vt.kind===be.SymbolKind.Property)&&(y.insertText=y.label,y.kind=be.CompletionItemKind.Property),y.commitCharacters=y.command=y.documentation=void 0}return a}if(a.push(...zt.snippet),m??=i.searchScopedNode(n),m?.children&&m.kind===be.SymbolKind.Property)return b.topofline!==1?void 0:[{label:"get",kind:be.CompletionItemKind.Function},{label:"set",kind:be.CompletionItemKind.Function}];let pe=Mt.FormatOptions?.keyword_start_with_uppercase,k=pe?function(I){a.push(I=Object.assign({},I)),I.insertText=(I.insertText??I.label).replace(/(?<=^(loop\s)?)[a-z]/g,z=>z.toUpperCase())}:I=>a.push(I);if(ie)for(let I of Object.values(zt.keyword)){if(I.label==="break")break;P.test(I.label)&&k(I)}else{let I=be.CompletionItemKind.Snippet,z=be.InsertTextFormat.Snippet,Oe=Mt.FormatOptions?.switch_case_alignment?"":"	",Ae=st=>st,Lt=Ae;pe&&(Ae=st=>st.replace(/\b[a-z](?=\w)/g,Ze=>Ze.toUpperCase())),Mt.FormatOptions?.switch_case_alignment&&(Lt=st=>st.replace(/^\t/gm,""));for(let[st,Ze]of[["switch",["switch ${1:[SwitchValue, CaseSense]}",Lt(`{
${Oe}case \${2:}:
	${Oe}\${3:}
${Oe}default:
	${Oe}$0
}`)]],["trycatch",["try",`{
	$1
}`,"catch ${2:Error} as ${3:e}",`{
	$0
}`]],["class",["class $1",`{
	$0
}`]]])a.push({label:st,kind:I,insertTextFormat:z,insertText:Ae(Ze.join(ge))});a.at(-3).detail=zt.keyword.switch?.detail;let fe={...zt.keyword};delete fe.switch;for(let st in fe)P.test(st)&&k(fe[st])}!m&&(y=X.match(/^\s*(((([<>$~*!+#^]*?)(`?;|[a-z]\w+|[\x21-\x3A\x3C-\x7E]|[^\x00-\x7f]))|~?(`?;|[\x21-\x3A\x3C-\x7E]|[a-z]\w+|[^\x00-\x7f])\s*&\s*~?(`?;|[\x21-\x3A\x3C-\x7E]|[a-z]\w+|[^\x00-\x7f]))\s*(\s(up?)?)?)$/i))&&(a=a.concat(y[8]?{label:"Up",kind:be.CompletionItemKind.Keyword}:zt.key.filter(I=>!I.label.toLowerCase().includes("alttab"))));for(let I in qt)P.test(I)&&(s[I]=xt(qt[I]));for(let I of Object.values(i.declaration))P.test(u=I.name.toUpperCase())&&!ot(I)&&(!s[u]||I.kind!==be.SymbolKind.Variable)&&(s[u]=xt(I));let lt=Object.keys(je).reverse();for(let I of new Set([i.d_uri,...lt.map(z=>te[z]?.d_uri),...lt])){if(!(y=te[I]))continue;let z=y.d;f=y.fsPath,y=y.declaration;for(let Oe in y){let Ae=y[Oe];P.test(Oe)&&(z||!s[Oe]||s[Oe].kind===be.CompletionItemKind.Variable&&Ae.kind!==be.SymbolKind.Variable)&&(s[Oe]=p=xt(Ae))}}if(m&&(n=d.end,Object.entries(i.getScopeSymbols(m)).forEach(([I,z])=>{P.test(I)&&(z.def!==!1||!s[I]&&!ot(z))&&(s[I]=xt(z))})),Mt.AutoLibInclude){let Ze=function(ze){let Ee=(ze=ze.replace(/(\s);/g,"$1`;")).toLowerCase(),Le=[],vt=i.scriptpath,Ft=0,nn=-1;for(let de of I)if(++Ft,Ee.startsWith(de.toLowerCase())){let Je=(0,gr.basename)(ze);Ee.endsWith(".ahk")&&!I.slice(0,Ft-1).some(Pn=>(void 0)(Pn+Je))?Le.push(`#Include <${(0,gr.relative)(de,ze.slice(0,-4))}>`):Ft===1?Le.push(`#Include %A_MyDocuments%\\AutoHotkey\\Lib\\${Je}`):Ft===2?Le.push(`#Include %A_AhkPath%\\..\\Lib\\${Je}`):Le.push(`#Include %A_ScriptDir%\\Lib\\${Je}`)}i.includedir.forEach((de,Je)=>{Ee.startsWith(de.toLowerCase()+"\\")?de.length>=vt.length&&(nn=Je,vt=de):vt||(nn=Je)}),nn===-1&&(nn=Ae),vt[0]===Ee[0]&&Le.push(`#Include ${(0,gr.relative)(vt,ze)}`);let Tt={line:i.document.lineCount,character:0},We=`#Include ${ze}`,Xe;return Le.forEach(de=>de.length<We.length&&(We=de)),We=`
`+We,nn!==-1?(Xe=i.document.getText({start:{line:nn,character:0},end:{line:nn+1,character:0}}),Tt={line:nn,character:Xe.length}):n.line===Tt.line-1&&((Lt??=(fe=i.find_token(0))?.type.endsWith("COMMENT")&&!It(fe))?(Tt=i.document.positionAt(fe.offset+fe.length),We=`
`+We):(Tt.line=0,We=We.trimStart()+`
`)),[be.TextEdit.insert(Tt,We)]};var et=Ze;let I=i.libdirs,z={},Oe=0,Ae=-1,Lt,fe,st=i.workspaceFolder;st=(st?En.parse(st).fsPath:i.scriptdir).toLowerCase(),i.includedir.forEach((ze,Ee)=>Ae=Ee);for(let ze in Ci)if(!je[ze]&&(f=Ci[ze].fsPath)&&(Mt.AutoLibInclude>1&&Ci[ze].islib||Mt.AutoLibInclude&1&&f.toLowerCase().startsWith(st))){for(let Ee of Ci[ze])P.test(u=Ee.name)&&(s[u.toUpperCase()]??=(p=xt(Ee),Oe++,p.additionalTextEdits=z[f]??=Ze(f),p.detail=`${wi.include(f)}

${p.detail??""}`,p));if(Oe>300)break}}if(lt.unshift(i.uri),!lt.includes(Ht.winapi)&&lt.some(I=>te[I]?.include[Ht.winapi]))for(let I in y=te[Ht.winapi]?.declaration)P.test(I)&&(s[I]??=xt(y[I]));if(!ie&&_!==be.SymbolKind.Event&&(h===1&&R.length>2&&R.includes("_")||/[A-Z]{2,}/.test(R)))for(let I of zt.constant)P.test(I.label)&&a.push(I);return a.concat(Object.values(s));function It(I){if(I.symbol)return I.symbol;let z,Oe=i.tokens[I.next_token_offset];if(Oe&&((z=Oe.symbol)?.detail??(z=i.tokens[Oe.next_token_offset]?.symbol)?.detail)!==void 0)return z}function ye(){let I,z=[qt,i.declaration];for(let Oe in je)(I=te[Oe])&&z.push(I.declaration);for(let Oe of z)for(let Ae in Oe)(I=Oe[Ae]).kind===be.SymbolKind.Class&&P.test(Ae)&&(s[Ae]??=a.push(xt(I)))}async function Et(I=!1,z){return;try{if(!(void 0)(Oe)||!(void 0)(Oe).isDirectory())return}catch{return}try{for await(let Ee of await(void 0)(Oe)){let Le=Ee.name;if(fe.test(Le)){if(Ee.isDirectory())Le=Le.replace(/(`|(?<= );)/g,"`$1"),ze(p={label:Le,command:st,kind:be.CompletionItemKind.Folder},Le+Lt);else{if(I||z?.test(Le))continue;Le=Le.replace(/(`|(?<= );)/g,"`$1"),p={label:Le,kind:be.CompletionItemKind.File},Ze&&(p.textEdit={range:Ze,newText:Le})}a.push(p)}}}catch{}}async function fn(){return;if(I){if(await Et(!1,/[^.\\/]+$(?<!\.(dll|ocx|cpl))/i),I.endsWith("/")||I.endsWith(":\\"))return;let Ee=new Set,Le=I.slice(0,-1).replaceAll("\\","/").toLowerCase(),vt=!0;/\.\w+$/.test(Le)||(Le+=".dll"),Le.includes(":")?Ee.add(Le):Le.includes("/")?Ee.add(i.scriptpath+(Le.startsWith("/")?Le:`/${Le}`)):(Le=`/${Le}`,Ae.forEach(Ft=>Ft.dllpaths.forEach(nn=>{(nn=nn.toLowerCase()).endsWith(Le)&&(Ee.add(nn),vt=!1)})),vt&&(Ee.add(Le.substring(1)),Ae.forEach(Ft=>Ee.add(Ft.scriptpath+Le))));for(let Ft of await Qr.get_DllExport(Ee,!0))fe.test(Ft)&&a.push({label:Ft,kind:st})}else{Ae.forEach(Ee=>Ee.dllpaths.forEach(Le=>fe.test(Le=Le.replace(/^.*[\\/]/,""))&&(Lt[Le.toUpperCase()]??=a.push(ze(Le.replace(/\.dll$/i,""))))));try{let Ee;for await(let Le of await(void 0)("C:\\Windows\\System32"))/\.(dll|ocx|cpl)$/i.test(Ee=Le.name)&&fe.test(Ee)&&(Lt[Ee.toUpperCase()]??=a.push(ze(Ee.replace(/\.dll$/i,""))))}catch{}for(let Ee of Zg)fe.test(Ee)&&a.push({label:Ee,kind:st})}}function kt(){for(let I of zt.text)P.test(I.label)&&(s[I.label.toUpperCase()]=!0,a.push(I));for(let I in y=i.texts)P.test(I)&&we(y[I],be.CompletionItemKind.Text);for(let I in je)for(let z in y=te[I]?.texts)P.test(z)&&we(y[z],be.CompletionItemKind.Text)}function we(I,z){return s[u=I.toUpperCase()]?!1:(a.push(p={label:I,kind:z}),s[u]=!0)}function ot(I){return I.selectionRange.end.line===Pe&&Be===I.selectionRange.end.character}function gt(I,z){let Oe=z?.full;Oe&&(I.sortText=F(Oe),I.labelDetails={description:Oe})}function xt(I){let z=be.CompletionItem.create(I.name);switch(I.kind){case be.SymbolKind.Method:gt(z,I.parent);case be.SymbolKind.Function:z.kind=I.kind===be.SymbolKind.Method?be.CompletionItemKind.Method:be.CompletionItemKind.Function,Mt.CompleteFunctionParens?he?z.command={title:"cursorRight",command:"cursorRight"}:I.params.length?(z.command={title:"Trigger Parameter Hints",command:"editor.action.triggerParameterHints"},z.insertText=z.label+"($0)",z.insertTextFormat=be.InsertTextFormat.Snippet):z.insertText=z.label+"()":z.commitCharacters=ne.Function,z.detail=I.full;break;case be.SymbolKind.Variable:if(z.kind=be.CompletionItemKind.Variable,!I.range.end.character)return z.detail=I.detail,z;break;case be.SymbolKind.Class:z.kind=be.CompletionItemKind.Class,z.commitCharacters=ne.Class,z.detail="class "+(I.full||z.label);break;case be.SymbolKind.Event:return z.kind=be.CompletionItemKind.Event,z;case be.SymbolKind.Field:return z.kind=be.CompletionItemKind.Field,z.label=z.insertText=z.label.slice(0,-1),z;case be.SymbolKind.Property:{z.kind=be.CompletionItemKind.Property,z.detail=I.full||z.label,gt(z,I.parent);let Ae=I;!Ae.call&&Ae.get?.params.length&&(z.insertTextFormat=be.InsertTextFormat.Snippet,z.insertText=z.label+"[$0]");break}case be.SymbolKind.Module:z.kind=be.CompletionItemKind.Module;break;default:return z.kind=be.CompletionItemKind.Text,z}I.tags&&(z.tags=I.tags);let Oe=pr(I,i);return Oe&&(z.documentation=Oe),z}}var Qi=vn($n());async function em(e,t){if(t.isCancellationRequested)return;let n=e.textDocument.uri.toLowerCase(),r=te[n],i=r?.getContext(e.position),s=[];if(!i)return;if(!i.token.type){let p=i.token.previous_token;if(p?.content.match(/^#include/i)){let u=e.position.line,f=i.linetext.indexOf("#"),c=p.data,m=c?.data;if(m){f+=c.offset-p.offset;let y=Qi.Range.create(0,0,te[m[1]]?.document.lineCount??0,0),h=f+c.content.length,C=m[0]?En.file(Gi(m[0].replaceAll("`;",";"))).toString():m[1];return[Qi.LocationLink.create(C,y,y,Qi.Range.create(u,f,u,h))]}}return}if(i.kind===Qi.SymbolKind.Null)return;let a=[];return Ei(r,i)?.forEach(p=>{!a.includes(p.node)&&a.push(p.node)&&p.node.selectionRange.end.character&&(n=p.node.uri??p.uri)&&s.push(Qi.LocationLink.create(te[n].document.uri,p.node.range,p.node.selectionRange))}),s}var xa=vn($n());async function tm(e){let t=te[e.textDocument.uri.toLowerCase()],n=xa.Range.create(0,0,t.document.lineCount,0),r={...Mt.FormatOptions};r.indent_string??=e.options.insertSpaces?" ".repeat(e.options.tabSize):"	";let i=t.beautify(r);return[{range:n,newText:i}]}async function nm(e){let t=te[e.textDocument.uri.toLowerCase()],n=e.range,r={...Mt.FormatOptions};r.indent_string=e.options.insertSpaces?" ".repeat(e.options.tabSize):"	";let i=t.beautify(r,n).trim();return[{range:n,newText:i}]}async function im(e){let t=te[e.textDocument.uri.toLowerCase()],{ch:n,position:r}=e,i={...Mt.FormatOptions},s,a,p,u;if(i.indent_string=" ".repeat(e.options.tabSize),a=t.document.getText({start:{line:0,character:0},end:{line:0,character:1}}),(a==="	"||!e.options.insertSpaces&&a!==" ")&&(i.indent_string="	"),n===`
`){let{line:c,character:m}=r,y=t.document.getText({start:{line:c-1,character:0},end:{line:c+2,character:0}}).split(/\r?\n/),h=y[0].trimEnd(),C;if(y[1].trim()||(m=y[1].length),h.endsWith("{")){let F=i.indent_string;(u=f({line:c-1,character:h.length}))&&(C=i.indent_string,y[1].substring(0,m)!==C&&u.push({newText:C,range:{start:{line:c,character:0},end:{line:c,character:m}}}),(h=(y[2]??="").trimStart()).startsWith("}")&&!y[2].startsWith((C=C.replace(F,""))+"}")&&u.push({newText:C,range:{start:{line:c+1,character:0},end:{line:c+1,character:y[2].length-h.length}}}))}else if((p=t.linepos[c-1])!==void 0){let F={start:t.document.positionAt(p),end:{line:c-1,character:h.length}},ne=t.beautify(i,F).trim();u=[{range:F,newText:ne}],C=i.indent_string,y[1].substring(0,m)!==C&&u.push({newText:C,range:{start:{line:c,character:0},end:{line:c,character:m}}})}else if(!h&&y[0]!==(y[1]=y[1].substring(0,m))){if(!y[0]){if(s=t.find_token(t.document.offsetAt(r)),s.type==="TK_STRING"||s.type.endsWith("COMMENT"))return;let F=["TK_START_EXPR","TK_START_BLOCK",""];for(;(s=s.previous_token)&&!F.includes(s.type););if(F.pop(),F.includes(s?.type))return}u=[{newText:y[0],range:{start:{line:c,character:0},end:{line:c,character:m}}}]}return u}else{if(n==="}")return f(r);if(a=Do[n]){let c={line:r.line,character:r.character-1};if(s=t.find_token(t.document.offsetAt(c)),s.type==="TK_WORD")return s.length>1&&(a=s.content.replace(/./g,m=>Do[m]??m),c=t.document.positionAt(s.offset),r.character=c.character+s.length),[xa.TextEdit.replace({start:c,end:r},a)]}}function f(c){if(s=t.tokens[t.document.offsetAt({line:c.line,character:c.character-1})],p=s?.previous_pair_pos,p!==void 0){for(;(s=t.tokens[p])?.previous_pair_pos!==void 0;)p=s.previous_pair_pos;let m={start:t.document.positionAt(p),end:c},y=t.beautify(i,m).trim();return[{range:m,newText:y}]}}}var qo=vn($n());async function rm(e,t){if(t.isCancellationRequested)return;let n=e.textDocument.uri.toLowerCase(),r=te[n],i=r?.getContext(e.position),s=[],a;if(!i)return;if(i.kind===qo.SymbolKind.Null)return i.token.semantic?.type!==5&&(a=i.token,a=Jr[(a.hover_word||a.content).toLowerCase()])?a[1]:void 0;let p=Ei(r,i);if(!p?.length)return;let u=[];if(p=p.filter(f=>!u.includes(f.node)&&u.push(f.node)),p.length>1)for(a of p)(a=a.node.full)&&s.push({kind:"ahk2",value:a});else{let{node:f,is_global:c,uri:m}=p[0],y=f;if(f.kind===qo.SymbolKind.Class&&!y.full?.startsWith("("))s.push({kind:"ahk2",value:"class "+(y.full||f.name)});else if(y.full){s.push({kind:"ahk2",value:y.full});let C=y.overloads;switch(typeof C){case"object":C=C.map(F=>F.full).join(`
`);case"string":y.name&&(C=C.replace(/^(\w|[^\x00-\x7f])+/gm,y.full.substring(0,y.full.search(/(?!^)[([]/)))),s.at(-1).value+=`
${C}`;break}}let h=pr(f,te[m]);typeof h=="string"?h=h&&"```plaintext\n"+h+"\n```":h=h.value,f.is_param?h.startsWith("*@param* ")?h=h.replace(/\n|(?<=`\*?) — /,`
___
`):h=`*@param* \`${f.name}\`${(a=Wn(f.type_annotations))&&`: *\`${a}\`*`}
___
${h}`:f.kind===qo.SymbolKind.Variable?h=`${c===!0?"*@global*":f.static?"*@static*":"*@local*"} \`${f.name}\`${(a=Wn(f.type_annotations))&&`: *\`${a}\`*`}
___
${h}`:f.kind===qo.SymbolKind.Property&&s.length&&(a=Wn(f.type_annotations))&&(s[0].value+=`: ${a}`),h&&s.push({value:(s.length?`___
`:"")+h})}return{contents:{kind:"markdown",value:s.map(f=>f.kind==="ahk2"?"```ahk2\n"+f.value+"\n```":f.value).join(`

`)}}}var jt=vn($n());async function om(e,t){let n=[],r=te[e.textDocument.uri.toLowerCase()];if(!r||t.isCancellationRequested)return;let i=Uu(r,r.getContext(e.position));for(let s in i)n.push(...i[s].map(a=>({uri:s,range:a})));return n}function Uu(e,t,n=!0){if(t.kind===jt.SymbolKind.Null)return;let r=Ei(e,t);if(r?.length!==1)return;let i=t.text.toUpperCase(),s={},{node:a,uri:p,scope:u,is_this:f,is_global:c}=r[0];if(!(!p||!a.selectionRange.end.character||f===!1)){if(!n&&(a===qt[i]||p===Ht.winapi))return null;if(f){let m=a,y=[],h=m.property;for(let C of Object.values(h??{}))C.children?.length&&jo(C,i,y,!1,!1);return y.length?{[te[p].document.uri]:y}:void 0}switch(a.kind){case jt.SymbolKind.Field:if(u){let m=u.labels;m&&m[i]&&(s[te[p].document.uri]=m[i].map(y=>y.selectionRange))}else{let m=e.labels;m[i]&&(s[e.document.uri]=m[i].map(y=>y.selectionRange));for(let y in e.relevance)m=te[y].labels,m[i]&&(s[te[y].document.uri]=m[i].map(h=>h.selectionRange))}break;case jt.SymbolKind.Function:case jt.SymbolKind.Variable:case jt.SymbolKind.Class:if(a.kind!==jt.SymbolKind.Class||!a.full.includes(".")){let m=c===!0?void 0:r[0].parent,y={[e.uri]:m};if(p!==e.uri&&(y[p]=void 0),!m)for(let h in e.relevance)y[h]=void 0;for(let h in y){let C=Ca(y[h]??te[h],i,jt.SymbolKind.Variable);C.length&&(s[te[h].document.uri]=C)}break}default:if(a.kind===jt.SymbolKind.Class||a.static){if(a.kind===jt.SymbolKind.Class)i=a.full.toUpperCase();else{let R=a,g=R.full?.match(/^\(([^)]+)\)[ \t]static[ \t]([^([]+)($|[([])/);if(g)i=`${g[1]}.${g[2]}`.toUpperCase();else if(R.parent?.kind===jt.SymbolKind.Class)i=`${R.parent.full}.${R.name}`.toUpperCase();else return}let m=i.split("."),y=m.length,h=0,C={};for(let R of new Set([e.uri,...Object.keys(e.relevance)]))C[te[R].document.uri]=Ca(te[R],m[0],jt.SymbolKind.Variable);for(;h<y;){let R=m.slice(0,++h).join("."),g=bi(e,R);if(g?.node.kind===jt.SymbolKind.Class)for(let b of Object.values(g.node.property??{})){let d=[];if(b.children?.length&&d.push(b),b.kind===jt.SymbolKind.Property){let _=b;d.push(...[_.get,_.set,_.call].filter(Boolean))}if(!d.length)continue;let X=C[te[g.uri].document.uri]??=[];for(let _ of d)jo(_,"THIS",X,!1,!1)}for(let b in C){let d=C[b],X=te[b.toLowerCase()],_=s[b]??=[],Se=X.document,je=X.tokens;e:for(let Pe of d){let Be=je[Se.offsetAt(Pe.start)];if(Be){for(let ie=h;ie<y;ie++)if((Be=je[Be.next_token_offset])?.type!=="TK_DOT"||(Be=je[Be.next_token_offset])?.type!=="TK_WORD"||Be.content.toUpperCase()!==m[ie])continue e;_.push({start:Se.positionAt(Be.offset),end:Se.positionAt(Be.offset+Be.length)})}}s[b].length||delete s[b]}C={}}let F=a.parent,ne=s[te[p].document.uri]??=[];for(;F&&F.kind!==jt.SymbolKind.Class;)F=F.parent;if(F){let R=a.name.toLowerCase(),g=[];for(let b of F.children??[])b.static&&b.name.toLowerCase()===R&&g.push(b.selectionRange);ne.unshift(...g)}else ne.includes(a.selectionRange)||ne.unshift(a.selectionRange);break}return}if(Object.keys(s).length){for(let m in s){let y={};for(let h of s[m])y[`${h.start.line},${h.start.character}`]??=h;s[m]=Object.values(y)}return s}}}function Ca(e,t,n,r=[]){if(!(n===jt.SymbolKind.Method||n===jt.SymbolKind.Property)){let i=e,s=!e.kind,a=!i?.local?.[t]?.static,p=s;if(a&&!s&&i.declaration?.[t]?.static===null&&(a=!1),p)p=!1;else{let u=i.local,f=i.declaration;u?.[t]||f?.[t]||(p=void 0)}for(let u of i.children??[])u.name.toUpperCase()===t&&r.push(u.selectionRange),u.children?.length&&jo(u,t,r,s,s||u.kind===jt.SymbolKind.Function?p:void 0,a);if(i.kind===jt.SymbolKind.Property){let u=i;for(let f of[u.get,u.set,u.call])f?.children?.length&&Ca(f,t,n,r)}}return r}function jo(e,t,n,r,i,s=!0){let a=e.kind===jt.SymbolKind.Function&&e.static,p=a||e.closure,u,f=i;if(a&&s&&!r)return;if(r&&e.has_this_param&&["THIS","SUPER"].includes(t))i=f=!1;else if(e.assume===2||e.global?.[t]){if(!r)return;i=f=!0}else if(e.local?.[t]||(!p||r&&!i)&&e.declaration?.[t]){if(!r)return;i=f=!1}else r&&!i&&(a&&(!(u=e.declaration?.[t])||u.kind===jt.SymbolKind.Variable&&!u.def)||e.unresolved_vars?.[t]||t.substring(0,2)==="A_")&&(f=!0);s&&(s=!e?.local?.[t]?.static),f===r?e.children?.forEach(m=>{m.name.toUpperCase()===t&&m.kind!==jt.SymbolKind.Property&&m.kind!==jt.SymbolKind.Method&&m.kind!==jt.SymbolKind.Class&&n.push(m.selectionRange),m.children?.length&&jo(m,t,n,r,m.kind===jt.SymbolKind.Function?i:r||void 0,s),m.kind===jt.SymbolKind.Property&&c(m)}):e.children?.forEach(m=>{m.children?.length&&jo(m,t,n,r,r?!1:void 0,s),m.kind===jt.SymbolKind.Property&&c(m)});function c(m){for(let y of[m.get,m.set,m.call])y?.children?.length&&Ca(y,t,jt.SymbolKind.Variable,n)}}var sm=vn(Fi());var Da;async function am(e,t){let n=te[e.textDocument.uri.toLowerCase()];if(!n||t.isCancellationRequested)return;let r=n.getContext(e.position);return(Da=Uu(n,r,!1))?{range:r.range,placeholder:r.text.split(".").pop()||""}:new sm.ResponseError(0,Da===null?Pu.cannotrenamestdlib():Pu.cannotrename())}async function cm(e,t){if(t.isCancellationRequested)return;let n={changes:{}},r=e.newName;for(let i in Da)n.changes[i]=Da[i].map(s=>({range:s,newText:r}));return n}var In=vn($n());var At,yi=new Map;function lm(e,t){let n=e.semantic,r;if(n){let i=e.pos??(e.pos=t.document.positionAt(e.offset)),s=n.type;if(s===8)if(e.ignore){let a=i.line+1,p=e.data;for(let u=0;u<p.length;u++)t.STB.push(a++,0,p[u],s,0)}else t.STB.push(i.line,i.character,e.length,s,0);else(At&&(s===2||s===6)&&e.previous_token?.type==="TK_DOT"||(At=void 0,s===0))&&(s=dy(e,t)),t.STB.push(i.line,i.character,e.length,s,(n.modifier??0)|e.definition?.static===!0)}else if(At&&e.type!=="TK_DOT"&&!e.type.endsWith("COMMENT"))At=void 0;else if(e.type==="TK_WORD"&&["THIS","SUPER"].includes(r=e.content.toUpperCase())&&e.previous_token?.type!=="TK_DOT"){let i=t.findSymbol(r,In.SymbolKind.Variable,t.document.positionAt(e.offset));i?.is_this!==void 0&&(At=i.node)}}function Ko(e,t){let n=te[e.textDocument.uri.toLowerCase()];return!n||t?.isCancellationRequested?{data:[]}:(n.STB.previousResult(""),At=void 0,yi.clear(),Hi({textDocument:e.textDocument},null),Object.values(n.tokens).forEach(r=>lm(r,n)),fm(n),yi.clear(),n.sendDiagnostics(),n.STB.build())}function um(e,t){let n=te[e.textDocument.uri.toLowerCase()];if(!n||t?.isCancellationRequested)return{data:[]};let r=n.document.offsetAt(e.range.start),i=n.document.offsetAt(e.range.end);n.STB.previousResult(""),At=void 0,yi.clear(),Hi({textDocument:e.textDocument},null);for(let s of Object.values(n.tokens))if(!(s.offset<r)){if(s.offset>i)break;lm(s,n)}return fm(n),yi.clear(),n.STB.build()}function dy(e,t){let n=e.content.toUpperCase(),r=e.semantic;switch(r.type){case 0:return At=Bu[n],At?.kind!==In.SymbolKind.Class&&(At=void 0),0;case 2:case 6:if(At&&!e.ignore){let s=At.property[n],a=s?.kind,p;if(!s||s.def===!1){let u=(p=yi.get(At)??(yi.set(At,p=fr(t,At)),p))[n];u?(s=u,a=u.kind):r.type===2?p.__CALL&&(a=In.SymbolKind.Null):p.__GET&&(a=In.SymbolKind.Null)}switch(a){case In.SymbolKind.Method:if(r.modifier=(r.modifier??0)|2|1,e.callsite){if(At){if(s.full?.startsWith("(Object) static Call("))s=tn(t,At.prototype,"__new",!0)??s;else if(s.full?.startsWith("(Object) DefineProp(")){let u=t.tokens[e.next_token_offset];u?.content==="("&&(u=t.tokens[u.next_token_offset]),u&&(u.type==="TK_STRING"?i(At,u.content.slice(1,-1),u.offset+1):i(At,""))}}Sa(t,s,e.callsite)}return At=void 0,r.type=2;case In.SymbolKind.Class:return r.modifier=(r.modifier??0)|2,At=At.property[n],e.callsite&&Sa(t,At,e.callsite),r.type=0;case In.SymbolKind.Property:{let u=s;return r.modifier=(r.modifier??0)|(s.static?1:0)|(!u.set&&u.children?2:0),At=At.range===s.range?At.prototype:void 0,r.type=6}case void 0:if((At.checkmember??t.checkmember)!==!1&&Mt.Diagnostics.ClassNonDynamicMemberCheck){let u=t.tokens[e.next_token_offset];Ur.includes(u?.content)?i(At,e.content,e.offset):(e.__ref||u?.content[0]!=="?"||!u.ignore&&u.content==="?")&&yi.get(At)?.["#checkmember"]!==!1&&(((At.undefined??={})[n]??=e).has_warned||=e.__ref)}}}default:return At=void 0,r.type}function i(s,a,p){let u=te[s.uri];if(u&&p){if(s.property[a.toUpperCase()])return;let f=In.Range.create(u.document.positionAt(p),u.document.positionAt(p+a.length)),c=In.DocumentSymbol.create(a,void 0,In.SymbolKind.Property,f,f);if(c.static=c.def=!0,a=a.toUpperCase(),u===t&&u.d<2)s.children?.push(c),s.property[a]??=c;else{let m=yi.get(s);m&&(m[a]??=c)}s.undefined&&delete s.undefined[a]}else if(delete s.undefined,u&&u.d<2)s.checkmember=!1;else{let f=yi.get(s);f&&(f["#checkmember"]=!1)}}}function fm(e){for(let t of yi.keys()){if(!t.undefined)continue;let n=t.name;for(let r of Object.values(t.undefined))r.has_warned||(r.has_warned=!0,e.addDiagnostic(B.maybehavenotmember(n,r.content),r.offset,r.length,{severity:2}))}}var Vn=vn($n());var Pi={};async function dm(e,t){if(t.isCancellationRequested)return;let{textDocument:{uri:n},context:r,position:i}=e,s=te[n.toLowerCase()],a=r?.activeSignatureHelp?.activeSignature,p,u;switch(r?.triggerKind){case 2:if(r.isRetrigger){if(r.triggerCharacter===" "||!(u=s.tokens[p=s.document.offsetAt(i)-1]?.paraminfo))return b()}else{if(p=s.document.offsetAt(i),r.triggerCharacter===" "){let X=s.find_token(p);X.offset>=p&&(u=X.previous_token?.callsite)&&(u=u.range.start.line===i.line&&u.paraminfo)}else u=s.tokens[p-1]?.paraminfo;if(!u)return}break}let f=Lo(s,i,u);if(!f||f.index<0){f===null&&(Pi.loc="");return}let{name:c,pos:m,index:y,kind:h,count:C}=f,F=`${s.uri}?${c},${m.line},${m.character}`;if(F===Pi.loc){if(y===Pi.index)return b();Pi.index=y}else Pi={loc:F,index:y};let ne=Pi.nodes,R=new Set,g={activeSignature:a,signatures:[]};if(!ne){let je=function(Pe,Be,ie=0){let P,j=Pe.uri;switch(Pe.kind){case Vn.SymbolKind.Method:if(!_)break;if(ie++,Be==="call"){ne.push({node:Pe,needthis:ie,uri:j});break}P=Pe,he();break;case Vn.SymbolKind.Function:if(!_)break;if(Be==="call"){ne.push({node:Pe,needthis:ie,uri:j});break}P=Pe;default:he();break}function he(){let ge,pe=Pe;if(ge=tn(s,pe,Be,_)){if(_){if(ge.kind===Vn.SymbolKind.Class)ge=dr(ge);else if(ge.full?.startsWith("(Object) static Call("))ge=tn(s,pe.prototype,"__new",!0)??ge;else if(ge.kind===Vn.SymbolKind.Property||ge.eval){let k=hn(ge,te[ge.uri]??s,pe);return ge.kind===Vn.SymbolKind.Property&&ge.eval&&(k=_i(s,k,"call",!0)),k.forEach(lt=>je(lt,"call",-1))}else if(P&&Be==="bind"){if(R.has(P))return;R.add(P);let k=P.full.indexOf("(",P.name?1:0);P={...P,name:ge.name,detail:ge.markdown_detail===void 0?ge.detail:void 0,full:`(Func) Bind${P.full.slice(k,k+P.param_def_len)} => BoundFunc`,markdown_detail:ge.markdown_detail},ge=P}}else if(ge.kind===Vn.SymbolKind.Class)ge=tn(s,ge,"__item",!1);else{if(ge.kind!==Vn.SymbolKind.Property)return;if(!ge.params){for(let k of hn(ge,te[ge.uri]??s,pe))(k=tn(s,k,"__item",!1))&&ne.push({node:k,needthis:ie,uri:k.uri});return}}ge&&ne.push({node:ge,needthis:ie,uri:ge.uri})}}};var d=je;let X=s.getContext(m),_=!0;if(Pi.nodes=ne=[],X.kind===Vn.SymbolKind.Null||X.token.symbol)return;let Se=ti(s,X.token,X.range.end);if(Se.includes(Bt)){if(h!==Vn.SymbolKind.Method)return;let Pe=c.toUpperCase();ne=[];for(let Be of new Set([Ht.ahk2,Ht.ahk2_h,s.uri,...Object.keys(s.relevance)]))for(let ie of te[Be]?.object.method[Pe]??[])ne.push({node:ie,uri:Be})}else{let Pe=X.text?"":X.word.toLowerCase();h===Vn.SymbolKind.Property?(Pe||="__item",_=!1):Pe||="call";for(let Be of Se)je(Be,Pe)}}for(let X of ne){let _=X.node,Se=te[X.uri],je=X.needthis??0;if(!_.params||R.has(_))continue;let Pe=[_],Be=y-je,ie=[],P=_.name&&_.full.match(/^(\(.+?\))?[^([]+/)?.[0].length||0,j,he,ge,pe,k,lt,It=pr(_,Se,/(^|\n)\*@param\*(.|\n|\r)*?(?=\n\*@|$)/g);if(_.overloads)if(typeof _.overloads=="string"){let ye=new ei(An.create("","ahk2",-10,_.kind===Vn.SymbolKind.Function?_.overloads:`class _ {
${_.overloads}
}`),void 0,-1);ye.parseScript(),k=_.name||"_";let Et=_.kind===Vn.SymbolKind.Function?ye.children:ye.declaration._?.children??[],fn=_.full.match(/^(\(.+?\))?[^([]+/)?.[0]??k;for(let kt of Et)kt.name!==k||!kt.params||(kt.full=fn+kt.full.replace(/^(\(.+?\))?[^([]+/,""),Pe.push(kt));_.overloads=Pe.slice(1)}else Pe.push(..._.overloads);P+=je>0?7:1,R.add(_);for(let ye of Pe){if(k=ye.full,j=ye.params,pe=j.length,ge=ye.variadic&&j[pe-1].arr?Math.min(Be,pe-1):Be,lt=j[ge]?.name.toUpperCase()??(je&&ge===-1?"this":"\0"),he=_.params.find(Et=>Et.name.toUpperCase()===lt)??_.overload_params?.[lt],ie=ye.param_offsets.map((Et,fn)=>({label:[Et+=P,Et+(j[fn]?.name.length||1)]})),je>0&&(ie.unshift({label:"this"}),ge++,k=k.replace(/(?<=.)\(/,"(this"+(j.length?", ":""))),he){if(he.arr===2){let Et=Be%2!==he.data,fn=pe%2!==he.data,kt=fn?2:1;(!Et||++ge&&fn)&&y>=C-kt&&(y===C-1||ge-kt!==pe-2)&&(ge-=kt),he=j[ge]??he}else if(y<C-1&&j.at(-1)?.arr===2){let Et=j.at(-1),fn=pe%2!==Et.data,kt=fn?2:1;y<C-kt&&!j[ge+kt]?.name.length&&(he=j[ge+=kt]??Et)}ie[ge].documentation=pr(he,Se)}g.signatures.push({label:k,parameters:ie,documentation:It,activeParameter:ge})}}return Pi.signinfo=g;function b(){let X=Pi.signinfo;return X&&(X.activeSignature=a),X}}var ut=vn($n());var Bu={};function Hi(e,t){let n=e.textDocument.uri.toLowerCase(),r=te[n];if(!r||t?.isCancellationRequested)return[];if(t!==null&&r.symbolInformation)return r.symbolInformation;let{document:i,tokens:s}=r,a=Bu={...qt},p=[n,...Object.keys(r.relevance)],u={};p=p.map(R=>te[R]?.d_uri).concat(p);for(let R of p){let g=te[R];if(!g)continue;let b=g.d,d=g.declaration,X;for(let _ in d)!(X=a[_])||b||d[_].kind!==ut.SymbolKind.Variable&&(X.kind===ut.SymbolKind.Variable||X.def===!1)?a[_]=d[_]:X.kind===ut.SymbolKind.Variable&&(X.assigned||=d[_].assigned,d[_].def)&&(X.def??=!1)}if(r.symbolInformation)return r.symbolInformation;Ht.winapi&&!p.includes(Ht.winapi)&&(u=te[Ht.winapi]?.declaration??u);let f=Mt.Warn?.LocalSameAsGlobal,c=[],m=new Map,y=[ut.SymbolKind.Method,ut.SymbolKind.Property,ut.SymbolKind.Class];for(let[R,g]of Object.entries(r.declaration)){let b=a[R],d=!1;b.kind===ut.SymbolKind.Variable&&!b.assigned&&(u[R]?(b=a[R]=u[R],d=!0):g.returns===void 0&&m.set(b,g)),(b===g||g.kind!==ut.SymbolKind.Variable&&(a[R]=g))&&(c.push(g),ne(g,g,d||g===qt[R]).definition=g)}if(C(r),Mt.Warn?.VarUnset)for(let[R,g]of m){if(R.assigned||R.has_warned)continue;R.has_warned=!0;let b,d,X=Ri.varisunset(g.name);!R.decl&&(d=cr[R.name.toUpperCase()])&&(X+=`, ${B.requireversion(d)}`,b="built-in library"),r.diagnostics.push({code:b,message:X,range:g.selectionRange,severity:ut.DiagnosticSeverity.Warning})}return r.actived&&(F(r),r.sendDiagnostics(!1,!0)),n=r.document.uri,r.symbolInformation=c.map(R=>ut.SymbolInformation.create(R.name,R.kind,R.range,n));function h(R,g){!(R.assigned||=g.assigned)&&g.returns===void 0&&(m.has(R)||m.set(R,g))}function C(R,g={},b=!1){let d=[],X=R.kind===ut.SymbolKind.Class,_;R.children?.forEach(Se=>{if(Se.children&&d.push(Se),!Se.name)return;let je=Se.kind;if(je===ut.SymbolKind.Variable||je===ut.SymbolKind.Function||!X&&je===ut.SymbolKind.Class){let Pe=Se.name.toUpperCase(),Be=g[Pe]??a[Pe];if(Be===Se||!Be)return;(_=ne(Se,Be,Be===qt[Pe])).definition=Be,Be.selectionRange.end.character?Se.kind!==ut.SymbolKind.Variable?c.push(Se):Be.kind===ut.SymbolKind.Variable?h(Be,Se):_.callsite&&Sa(r,Be,_.callsite):delete _.semantic}else y.includes(je)||c.push(Se)});for(let Se of d){let je={},Pe,Be=b,ie=Se;switch(Se.kind){case ut.SymbolKind.Class:{let P=Se;je={THIS:zr,SUPER:Oo},b=!1;for(let j of[P.property,P.prototype?.property??{}])Object.values(j).forEach(he=>he.selectionRange.end.character&&c.push(he));break}case ut.SymbolKind.Property:if(ie.has_this_param){let P=Se;for(let j of[P.get,P.set,P.call])j&&(d.push(j),j.selectionRange.end.character&&c.push(j))}else break;case ut.SymbolKind.Method:case ut.SymbolKind.Function:if(ie.has_this_param)je={THIS:zr,SUPER:Oo};else if(g.SUPER?.range.end.character===0&&delete g.SUPER,ie.assume!==2)if(ie.assume===1&&(b=!1),ie.static)for(let[P,j]of Object.entries(g))(j.static||j===a[P])&&(je[P]=j);else je={...g};else b=!0;case ut.SymbolKind.Event:b||=ie.assume===2;for(let[P,j]of Object.entries(ie.global??{}))Pe=je[P]=a[P]??=j,ne(j,Pe,Pe===qt[P]).definition=Pe,Pe.kind===ut.SymbolKind.Variable&&h(Pe,j);for(let[P,j]of Object.entries(ie.local??{})){if(ne(je[P]=j,j).definition=j,j.kind===ut.SymbolKind.Variable){if(j.is_param)continue;!j.assigned&&j.returns===void 0?m.set(j,j):f&&!j.decl&&a[P]&&r.diagnostics.push({message:Ri.localsameasglobal(j.name),range:j.selectionRange,severity:ut.DiagnosticSeverity.Warning})}c.push(j)}if(ie.static===null){let P={...ie.global,...ie.local};for(let[j,he]of Object.entries(ie.declaration??={}))P[j]||(ne(je[j]=he,he).definition=he);break}for(let[P,j]of Object.entries(ie.declaration??={}))(Pe=je[P])?Pe!==j&&(ne(j,Pe,Pe===qt[P]).definition=Pe,Pe.kind===ut.SymbolKind.Variable&&h(Pe,j)):b?(Pe=a[P]??=(c.push(j),j.is_global=!0,r.declaration[P]=j),ne(j,Pe,Pe===qt[P]).definition=Pe,Pe.kind===ut.SymbolKind.Variable&&h(Pe,j)):!j.def&&(Pe=a[P])?ne(j,Pe,Pe===qt[P]).definition=Pe:(ne(je[P]=ie.local[P]=j,j).definition=j,c.push(j),j.static===null&&(j.static=!0),f&&j.kind===ut.SymbolKind.Variable&&a[P]&&r.diagnostics.push({message:Ri.localsameasglobal(j.name),range:j.selectionRange,severity:ut.DiagnosticSeverity.Warning}));for(let[P,j]of Object.entries(ie.unresolved_vars??{}))(Pe=je[P]??a[P]??u[P])?ne(j,Pe,Pe===qt[P]).definition=Pe:(ne(j,j).definition=j,c.push(je[P]=j),ie.assume===1&&(j.static=!0),j.returns===void 0&&m.set(j,j));break;default:je={...g};break}C(Se,je,b),b=Be}}function F(R){if(R.d)return;let g={...qt},b={},d=ut.DiagnosticSeverity.Error,{relevance:X,uri:_}=R,Se,je;Object.entries(R.labels).forEach(P=>P[1][0].def&&(b[P[0]]=_));for(let P in X)if(Se=te[P]){if(Se.d)continue;Gr(g,Object.values(Se.declaration).filter(ge=>ge.kind!==ut.SymbolKind.Variable),Se);let j=Se.labels;if(!Object.keys(j).length)continue;let he=Se.relevance;for(let ge in j){if(!(je=j[ge][0]).def)continue;let pe=b[ge];pe?he[pe]&&(je.has_warned??=Se.diagnostics.push({message:B.duplabel(),range:je.selectionRange,severity:d})):b[ge]=P}}let Pe=Object.values(R.declaration);Gr(g,Pe,R);for(let P in X)(Se=te[P])&&Gr(g,Object.values(Se.declaration).filter(j=>j.kind===ut.SymbolKind.Variable),Se);let Be;Pe.forEach(P=>{if(P.kind===ut.SymbolKind.Class&&(Be=P).extendsuri===void 0){let j=Be.extends?.toUpperCase();j===P.name.toUpperCase()?ie(R,Be,!1):j&&!Si(R,j)?.prototype&&ie(R,Be)}});for(let P in X)if(Se=te[P]){for(let j of Object.values(Se.declaration))if(j.kind===ut.SymbolKind.Class&&(Be=j).extendsuri===void 0){let he=Be.extends?.toUpperCase();he===j.name.toUpperCase()?ie(Se,Be,!1):he&&!Si(Se,he)?.prototype&&ie(Se,Be)}}function ie(P,j,he=!0){let ge=P.document.offsetAt(j.selectionRange.start),pe,k=P.tokens;if(!(pe=k[k[ge].next_token_offset])||!(pe=k[pe.next_token_offset])||pe.has_warned)return;ge=pe.offset,pe.has_warned=!0;let lt={start:P.document.positionAt(ge),end:P.document.positionAt(ge+j.extends.length)};P.diagnostics.push({message:he?B.unknown("class '"+j.extends)+"'":B.unexpected(j.extends),range:lt,severity:ut.DiagnosticSeverity.Warning})}}function ne(R,g,b=!1){let d,X,_=g.kind;switch(_){case ut.SymbolKind.Variable:if(g.is_param){if(!R.selectionRange.end.character)return{};X=4}else b||(X=5);break;case ut.SymbolKind.Class:X=0;break;case ut.SymbolKind.Function:X=1;break;case ut.SymbolKind.Module:X=3;break}let Se=s[i.offsetAt(R.selectionRange.start)];if(!Se)return{};if(X===void 0)delete Se.semantic;else if(!Se.ignore){if(d=Se.semantic)_!==void 0&&(d.type=X);else if(Se.semantic=d={type:X},R.kind===ut.SymbolKind.Variable&&R.def&&(_===ut.SymbolKind.Class||_===ut.SymbolKind.Function)&&(r.diagnostics.push({message:Br(R,{kind:_}),range:R.selectionRange}),delete R.def),!Se.callsite&&X===1){let je=r.tokens[Se.next_token_offset];je&&je.topofline<1&&!(je.op_type>=0||":?.+-*/=%<>,)]}".includes(je.content.charAt(0))||!je.data&&je.content==="{")&&r.diagnostics.push({message:B.funccallerr2(),range:R.selectionRange,severity:2})}X<4&&(d.modifier=(d.modifier??0)|2|(b?8:0))}return Se}}function py(e){let t=e.params,n=t.length,r=n;for(e.variadic&&(r=1/0,n>0&&t[n-1].arr&&n--);n>0&&t[n-1].defaultVal!==void 0;)--n;for(let i=0;i<n;++i)t[i].defaultVal===!1&&--n;return{min:n,max:r,has_this_param:e.has_this_param}}function Sa(e,t,n){let r=n.paraminfo,i,s;if(!r||!Mt.Diagnostics.ParamsCheck||((i=t?.kind===ut.SymbolKind.Class)&&(t=dr(t)),!(s=t?.params)))return;let{max:a,min:p}=py(t),u=s.length-(t.variadic?1:0),f={},{count:c,miss:m}=r,y;for(m=[...m];(y=m.pop())!==void 0;)if(y!==--c){c++,m.push(y);break}(c<p&&!r.unknown||c>a)&&e.diagnostics.push({message:B.paramcounterr(p===a?p:a===1/0?`${p}+`:`${p}-${a}`,c),range:n.range,severity:ut.DiagnosticSeverity.Error});for(y of m){if(y>=u)break;f[y]=!0,h(s,y)&&e.addDiagnostic(B.missingparam(),r.comma[y]??e.document.offsetAt(n.range.end),1)}if(t.hasref&&s.forEach((C,F)=>{if(F<c&&C.pass_by_ref&&!f[F]){let ne,R;if(F===0?ne=n.offset+n.name.length+1:ne=r.comma[F-1]+1,(R=e.find_token(ne)).content!=="&"&&(R.content.toLowerCase()!=="unset"||C.defaultVal===void 0)&&e.tokens[R.next_token_offset]?.type!=="TK_DOT"){let g=0,b=ti(e,R,r.comma[F]??(g=r.end));if(b.some(X=>X===ci||X===Bt||X.data===ci)||kn>=sn+7&&b.some(X=>tn(e,X,"__value",!1)))return;let d=e.tokens[r.comma[F]]?.previous_token;d&&(g=d.offset+d.length),e.addDiagnostic(B.typemaybenot("VarRef"),R.offset,Math.max(0,g-R.offset),{severity:2})}}}),!t.returns?.length&&!(t.type_annotations||null)?.length&&!(i&&t.name.toLowerCase()==="__new")){let C=e.tokens[n.offset];if(C?.previous_token?.type==="TK_EQUALS"){let F=e.get_token(e.document.offsetAt(n.range.end),!0);(!F||!Zt(F.previous_token,F)||F.content!=="??"&&(F.content!=="?"||!F.ignore))&&e.addDiagnostic(B.missingretval(),C.offset,C.length,{severity:2})}}function h(C,F){if(C[F].defaultVal!==void 0)return!1;let ne=F-1;for(;ne>=0;){for(;ne>=0&&C[ne].defaultVal===!1;ne--,F++);if(!C[F]||C[F].defaultVal!==void 0)return!1;for(;ne>=0&&C[ne].defaultVal!==!1;ne--);}return!0}}async function pm(e,t){let n=[],r=e.query,i=0;if(t.isCancellationRequested||!r||!r.match(/^(\w|[^\x00-\x7f])+$/))return n;let s=new RegExp(r.match(/[^\w]/)?r.replace(/(.)/g,"$1.*"):"("+r.replace(/(.)/g,"$1.*")+"|[^\\w])","i");for(let p in te)if(a(p))return n;{let p=await Dn?.sendRequest("getWorkspaceFiles",[])||[];for(let u of p){let f=u.toLowerCase(),c;if(!te[f]){let m=await Dn?.sendRequest("getWorkspaceFileContent",[u]);if(c=new ei(An.create(u,"ahk2",-10,m)),c.parseScript(),te[f]=c,a(f))return n}}}return n;function a(p){for(let u of Hi({textDocument:{uri:p}}))if(s.test(u.name)&&(n.push(u),++i>=1e3))return!0;return!1}}var hm=(r=>(r[r.Disabled=0]="Disabled",r[r.Local=1]="Local",r[r["User and Standard"]=2]="User and Standard",r[r.All=3]="All",r))(hm||{}),hy=(void 0).native,gm={ALPHA:3,BETA:2,RC:1,3:"alpha",2:"beta",1:"rc"},Zg=[],te={},sn=_m("2.1-alpha.3"),Po=sn+8,Mt={ActionWhenV1IsDetected:"Warn",AutoLibInclude:0,CommentTags:"^;;\\s*(.*)",CompleteFunctionParens:!1,CompletionCommitCharacters:{Class:".(",Function:"("},Diagnostics:{ClassNonDynamicMemberCheck:!0,ParamsCheck:!0},Files:{Exclude:[],MaxDepth:2},FormatOptions:{},InterpreterPath:"C:\\Program Files\\AutoHotkey\\v2\\AutoHotkey.exe",SymbolFoldingFromOpenBrace:!1,Warn:{VarUnset:!0,LocalSameAsGlobal:!1,CallWithoutParentheses:!1},WorkingDirs:[]},Qr={get_DllExport:(e,t=!1)=>Promise.resolve([]),get_RCDATA:e=>{},get_ahkProvider:async()=>null},Dn,Fo="en-us",rr="",ga=!1;var kn=1/0,va=0,Ht={},qt={},cr={},Ci={},Jr={},Ig=[],zi=[],zt;function Iu(e,t=!0){{let n=So(e);if(n)return An.create(n.url,"ahk2",-10,n.text)}}function Vg(e,t=!0,n=!0){let r=Iu(e,t);if(r){let i=new ei(r);return i.parseScript(),n&&(te[i.uri]=i),i}}function Gi(e){return e;try{t=hy(e)}catch{return e}try{let u,f;for(u=0;u<p&&a[u]===s[u];u++);e:for(t=i.slice(0,u||=(i[0]=a[0],1)).join($o.sep);u<p;){f=a[u++];for(let c of(void 0)(t+=$o.sep))if(c.toUpperCase()===f){t+=c;continue e}break}}catch{}}function So(e){let t,n=e.match(/<>./),r=[],i=new XMLHttpRequest;if(n?(r.push(e.replace("<>",Fo)),Fo.toLowerCase()==="zh-tw"&&r.unshift(e.replace("<>","zh-cn")),r.unshift(e.replace(n[0],""))):r.push(e),t=r.pop())return s(t);function s(a){if(i.open("GET",a,!1),i.send(),i.status===200)return{url:a,text:i.responseText};if(t=r.pop())return s(t)}}function mm(){let e=Bn.Keyword,t="*";qt={},Ht={},cr={},zt={constant:[],directive:{"#":[],"@":Dg.map(n=>({label:n,kind:e,data:t}))},key:[],keyword:{},snippet:[],text:[],option:{ahk_criteria:[],hotstring:[]}}}function Ea(e="ahk2",t=3){let n,r=`${rr}/syntaxes/<>/${e}`;if(1){let a=Iu(r+".d.ahk");if(a){let u=new ei(a,void 0,t);u.parseScript(),te[u.uri]=u,Ht[e]=u.uri}let p;e==="ahk2"&&(p=So(`${rr}/syntaxes/ahk2_common.json`))&&i(JSON.parse(p.text)),(p=So(r+".json"))&&i(JSON.parse(p.text))}else var s;function i(a){let p,u,f,c,m=Qt.create(0,0,0,0);for(let C in a){let F=a[C];switch(C){case"constants":u=Bn.Constant,p=Ki.Snippet;for(c of F)zt.constant.push({label:c.prefix,kind:u,insertTextFormat:p,insertText:`\${1:${c.prefix} := }${c.body}$0`,detail:c.description??c.body});break;case"directives":f="",u=Bn.Keyword,p=Ki.Snippet;for(c of F)c.prefix??=c.body.trim(),"@#".includes(f=c.prefix.charAt(0))&&(zt.directive[f].push({label:c.prefix.replace(/^[^#\w]/,""),insertText:c.body.replace(/^\W+/,""),kind:u,insertTextFormat:p,detail:c.description,data:c.body.charAt(0)}),f==="#"&&(Jr[c.prefix.toLowerCase()]=[c.prefix,{contents:{kind:"markdown",value:"```ahk2\n"+(c.syntax??h(c.body))+"\n```\n\n"+(c.description??"")}}]));break;case"keys":u=Bn.Keyword;for(c of F)zt.key.push({label:c.body,kind:u,detail:c.description});break;case"keywords":u=Bn.Keyword,p=Ki.Snippet;for(c of F)c.prefix??=c.body.trim(),zt.keyword[c.prefix]={label:c.prefix,kind:u,insertTextFormat:p,insertText:c.body,detail:c.description,preselect:!0},Jr[c.prefix.toLowerCase()]=[c.prefix,{contents:{kind:"markdown",value:"```ahk2\n"+(c.syntax??h(c.body))+"\n```\n\n"+(c.description??"")}}];break;case"snippet":u=Bn.Snippet,p=Ki.Snippet;for(c of F)zt.snippet.push({label:c.prefix,insertText:y(c.body),detail:c.description,kind:u,insertTextFormat:p});break;case"variables":for(c of F)qt[c.body.toUpperCase()]={name:c.body,kind:go.Variable,range:m,selectionRange:m,detail:c.description};break;case"texts":u=Bn.Text;for(c of F)zt.text.push({label:c.body,kind:u});break;case"options":u=Bn.Text;for(let ne in F){let R=zt.option[ne]??=[];for(c of F[ne])R.push({label:c.body,kind:u,detail:c.description})}break;default:break}}function y(C){return typeof C=="object"?C.join(`
`):C}function h(C){return C.replace(/\$\{\d+((\|)|:)([^}]*)\2\}|\$\d/g,(...F)=>F[2]?F[3].replaceAll(",","|"):F[3]||"")}}}var Hu={};function zu(e){typeof e.AutoLibInclude=="string"?e.AutoLibInclude=hm[e.AutoLibInclude]:typeof e.AutoLibInclude=="boolean"&&(e.AutoLibInclude=e.AutoLibInclude?3:0),typeof e.Warn?.CallWithoutParentheses=="string"&&(e.Warn.CallWithoutParentheses={On:!0,Off:!1,Parentheses:1}[e.Warn.CallWithoutParentheses]),Wu(e.FormatOptions??{});try{Wg(e.CommentTags)}catch(t){delete e.CommentTags,Dn?.window.showWarningMessage(Eu.valueerr("CommentTags","RegExp",t.message))}if(e.WorkingDirs instanceof Array?e.WorkingDirs=e.WorkingDirs.map(t=>(t=En.file(t.includes(":")?t:(0,$o.resolve)(t)).toString().toLowerCase()).endsWith("/")?t:t+"/"):e.WorkingDirs=[],Hu={},e.Files){let t=[],n=[];for(let r of e.Files.Exclude??[])try{(/[\\/]$/.test(r)?n:t).push(gy(r))}catch{Dn?.window.showWarningMessage(Eu.valueerr("Files.Exclude","glob pattern",r))}t.length&&(Hu.file=t),n.length&&(Hu.folder=n),(e.Files.MaxDepth??=2)<0&&(e.Files.MaxDepth=1/0)}e.Syntaxes,Object.assign(Mt,e)}function _m(e){let t=e.replace(/-\w+/,r=>`.-${gm[r.substring(1).toUpperCase()]}`).split("."),n=0;for(let r=0;r<4;r++)n+=parseInt(t[r]??"0")*1e3**(3-r);return n}function Og(e){let t=[];e+=3e3;for(let n=0;n<4;n++)t[3-n]=e%1e3,e=Math.floor(e/1e3);return(t[2]-=3)>=0&&(e=t.pop())&&t.push(e),t.join(".").replace(/\.-\d+/,n=>`-${gm[n.substring(2)]}`)}async function Vu(e,t){}function Yr(e){let t;return e=e.replace(/([*.?+^$|\\/[\](){}])|([^\x00-\x7f])|(.)/g,(n,r,i,s)=>`${s||(t??=i)||`\\${r}`}.*`),new RegExp(t?e:`([^\\x00-\\x7f]|${e})`,"i")}function Gu(e){return Object.values(e).filter(t=>typeof t=="string")}function bm(e){ga=e}function ym(e){return Dn=e}function km(e){rr=e.replace(/[/\\]$/,"")}function vm(e){e&&(Fo=e.toLowerCase())}function Tm(e){kn=_m(e),kn<Po?va=1:va=0}function Pa(e){let t=zi;if(zi=[...e],Mt.WorkingDirs.forEach(n=>!e.has(n)&&zi.push(n)),zi.sort().reverse(),!(t.length===zi.length&&!t.some((n,r)=>zi[r]!==n)))for(let n of Object.values(te))te[n.uri]&&!n.setWorkspaceFolder()&&!n.actived&&n.close()}function gy(e){let t="",n=!1,r,i;(r=e.startsWith("!"))&&(e=e.slice(1));for(let s=0,a,p=e.length;s<p;s++)switch(i=e[s]){case"/":case"\\":t+="[\\x5c/]";break;case"$":case"^":case"+":case".":case"(":case")":case"=":case"|":t+="\\"+i;break;case"?":t+=".";break;case"!":s?t.endsWith("[")?t+="^":t+="\\"+i:r=!0;break;case"{":n=!0,t+="(";break;case"}":n=!1,t+=")";break;case",":t+=n?"|":",";break;case"*":for(a=s;e[s+1]==="*";)s++;s>a&&/^[\x5c/]?\*+[\x5c/]?$/.test(e.substring(a-1,s+2))?(t+="((?:[^\\x5c/]*(?:[\\x5c/]|$))*)",s++):t+="([^\\x5c/]*)";break;default:t+=i}return/^([a-zA-Z]:|\*\*)/.test(e)?t="^"+t:/[\\/]/.test(e[0])||(t="[\\x5c/]"+t),/[\\/]$/.test(e)||(t+="$"),r&&(t=t.startsWith("^")?`^(?!${t})`:`(?!${t})`),new RegExp(t,"i")}var my="ahk2-language-server",_y=new ni.BrowserMessageReader(self),by=new ni.BrowserMessageWriter(self),Oa=new ni.TextDocuments(An),Zr=new Set,Nt=ym((0,ni.createConnection)(_y,by)),Qu=!1,Xu=!1,wm="";Nt.onInitialize(e=>{let t=e.capabilities,n=e.initializationOptions;Qu=!!(t.workspace&&t.workspace.configuration),Xu=!!(t.workspace&&t.workspace.workspaceFolders);let r={serverInfo:{name:my},capabilities:{textDocumentSync:{change:ni.TextDocumentSyncKind.Incremental,openClose:!0},completionProvider:{resolveProvider:!1,triggerCharacters:[".","#","*","@"]},signatureHelpProvider:{triggerCharacters:["(",","," "]},documentSymbolProvider:!0,definitionProvider:!0,documentFormattingProvider:!0,documentRangeFormattingProvider:!0,documentOnTypeFormattingProvider:{firstTriggerCharacter:"}",moreTriggerCharacter:[`
`,...Object.keys(Do)]},executeCommandProvider:{commands:Qg(n.commands)},hoverProvider:!0,foldingRangeProvider:!0,colorProvider:!0,renameProvider:{prepareProvider:!0},referencesProvider:{workDoneProgress:!0},semanticTokensProvider:{legend:{tokenTypes:Gu(ur),tokenModifiers:Gu(Mo)},full:!0,range:!0},workspaceSymbolProvider:!0}};return Xu&&(e.workspaceFolders?.forEach(i=>Zr.add(i.uri.toLowerCase()+"/")),r.capabilities.workspace={workspaceFolders:{supported:!0}}),bm(!0),vm(e.locale),km(n.extensionUri),Pg(),zu(n),Pa(Zr),Tm("3.0.0"),mm(),Ea(),Ea("ahk2_h"),Ea("winapi",4),r});Nt.onInitialized(()=>{Qu&&Nt.client.register(ni.DidChangeConfigurationNotification.type),Xu&&Nt.workspace.onDidChangeWorkspaceFolders(e=>{e.removed.forEach(t=>Zr.delete(t.uri.toLowerCase()+"/")),e.added.forEach(t=>Zr.add(t.uri.toLowerCase()+"/")),Pa(Zr)})});Nt.onDidChangeConfiguration(async e=>{let t=e?.settings;if(Qu&&!t&&(t=await Nt.workspace.getConfiguration("AutoHotkey2")),!t){Nt.window.showWarningMessage("Failed to obtain the configuration");return}zu(t),Pa(Zr)});Oa.onDidOpen(e=>{let t=wm===e.document.uri,n=e.document.uri.toLowerCase(),r=te[n];r?r.document=e.document:te[n]=r=new ei(e.document),r.actived=!0,t&&(r.actionwhenv1="Continue")});Oa.onDidClose(e=>te[e.document.uri.toLowerCase()]?.close());Oa.onDidChangeContent(e=>te[e.document.uri.toLowerCase()].update());Nt.onCompletion(Yg);Nt.onColorPresentation(Ug);Nt.onDocumentColor(Bg);Nt.onDefinition(em);Nt.onDocumentFormatting(tm);Nt.onDocumentRangeFormatting(nm);Nt.onDocumentOnTypeFormatting(im);Nt.onDocumentSymbol(Hi);Nt.onFoldingRanges(e=>te[e.textDocument.uri.toLowerCase()].foldingranges);Nt.onHover(rm);Nt.onPrepareRename(am);Nt.onReferences(om);Nt.onRenameRequest(cm);Nt.onSignatureHelp(dm);Nt.onExecuteCommand(Jg);Nt.onWorkspaceSymbol(pm);Nt.languages.semanticTokens.on(Ko);Nt.languages.semanticTokens.onRange(um);Nt.onRequest("exportSymbols",Gg);Nt.onRequest("getContent",e=>te[e.toLowerCase()]?.document.getText());Nt.onRequest("getVersionInfo",Xg);Nt.onNotification("onDidCloseTextDocument",e=>{e.id==="ahk2"?te[e.uri.toLowerCase()]?.close(!0):wm=e.uri});Oa.listen(Nt);Nt.listen();
function process_cwd(){return""}
//# sourceMappingURL=browserServerMain.js.map
